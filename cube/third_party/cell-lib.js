!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.cell=t():e.cell=t()}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=16)}([function(e,t,n){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var r in n)i(n,r)&&(e[r]=n[r])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var a={arraySet:function(e,t,n,r,i){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+r),i);else for(var a=0;a<r;a++)e[i+a]=t[n+a]},flattenChunks:function(e){var t,n,r,i,a,s;for(r=0,t=0,n=e.length;t<n;t++)r+=e[t].length;for(s=new Uint8Array(r),i=0,t=0,n=e.length;t<n;t++)a=e[t],s.set(a,i),i+=a.length;return s}},s={arraySet:function(e,t,n,r,i){for(var a=0;a<r;a++)e[i+a]=t[n+a]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,a)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,s))},t.setTyped(r)},function(e,t,n){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t,n){"use strict";var r={};(0,n(0).assign)(r,n(8),n(11),n(7)),e.exports=r},function(e,t,n){"use strict";e.exports=function(e,t,n,r){for(var i=65535&e|0,a=e>>>16&65535|0,s=0;0!==n;){n-=s=n>2e3?2e3:n;do{a=a+(i=i+t[r++]|0)|0}while(--s);i%=65521,a%=65521}return i|a<<16|0}},function(e,t,n){"use strict";var r=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();e.exports=function(e,t,n,i){var a=r,s=i+n;e^=-1;for(var o=i;o<s;o++)e=e>>>8^a[255&(e^t[o])];return-1^e}},function(e,t,n){"use strict";var r=n(0),i=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(e){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){a=!1}for(var s=new r.Buf8(256),o=0;o<256;o++)s[o]=o>=252?6:o>=248?5:o>=240?4:o>=224?3:o>=192?2:1;function l(e,t){if(t<65534&&(e.subarray&&a||!e.subarray&&i))return String.fromCharCode.apply(null,r.shrinkBuf(e,t));for(var n="",s=0;s<t;s++)n+=String.fromCharCode(e[s]);return n}s[254]=s[254]=1,t.string2buf=function(e){var t,n,i,a,s,o=e.length,l=0;for(a=0;a<o;a++)55296==(64512&(n=e.charCodeAt(a)))&&a+1<o&&56320==(64512&(i=e.charCodeAt(a+1)))&&(n=65536+(n-55296<<10)+(i-56320),a++),l+=n<128?1:n<2048?2:n<65536?3:4;for(t=new r.Buf8(l),s=0,a=0;s<l;a++)55296==(64512&(n=e.charCodeAt(a)))&&a+1<o&&56320==(64512&(i=e.charCodeAt(a+1)))&&(n=65536+(n-55296<<10)+(i-56320),a++),n<128?t[s++]=n:n<2048?(t[s++]=192|n>>>6,t[s++]=128|63&n):n<65536?(t[s++]=224|n>>>12,t[s++]=128|n>>>6&63,t[s++]=128|63&n):(t[s++]=240|n>>>18,t[s++]=128|n>>>12&63,t[s++]=128|n>>>6&63,t[s++]=128|63&n);return t},t.buf2binstring=function(e){return l(e,e.length)},t.binstring2buf=function(e){for(var t=new r.Buf8(e.length),n=0,i=t.length;n<i;n++)t[n]=e.charCodeAt(n);return t},t.buf2string=function(e,t){var n,r,i,a,o=t||e.length,u=new Array(2*o);for(r=0,n=0;n<o;)if((i=e[n++])<128)u[r++]=i;else if((a=s[i])>4)u[r++]=65533,n+=a-1;else{for(i&=2===a?31:3===a?15:7;a>1&&n<o;)i=i<<6|63&e[n++],a--;a>1?u[r++]=65533:i<65536?u[r++]=i:(i-=65536,u[r++]=55296|i>>10&1023,u[r++]=56320|1023&i)}return l(u,r)},t.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+s[e[n]]>t?n:t}},function(e,t,n){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t,n){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t,n){"use strict";var r=n(9),i=n(0),a=n(5),s=n(1),o=n(6),l=Object.prototype.toString;function u(e){if(!(this instanceof u))return new u(e);this.options=i.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;var n=r.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(0!==n)throw new Error(s[n]);if(t.header&&r.deflateSetHeader(this.strm,t.header),t.dictionary){var c;if(c="string"==typeof t.dictionary?a.string2buf(t.dictionary):"[object ArrayBuffer]"===l.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,0!==(n=r.deflateSetDictionary(this.strm,c)))throw new Error(s[n]);this._dict_set=!0}}function c(e,t){var n=new u(t);if(n.push(e,!0),n.err)throw n.msg||s[n.err];return n.result}u.prototype.push=function(e,t){var n,s,o=this.strm,u=this.options.chunkSize;if(this.ended)return!1;s=t===~~t?t:!0===t?4:0,"string"==typeof e?o.input=a.string2buf(e):"[object ArrayBuffer]"===l.call(e)?o.input=new Uint8Array(e):o.input=e,o.next_in=0,o.avail_in=o.input.length;do{if(0===o.avail_out&&(o.output=new i.Buf8(u),o.next_out=0,o.avail_out=u),1!==(n=r.deflate(o,s))&&0!==n)return this.onEnd(n),this.ended=!0,!1;0!==o.avail_out&&(0!==o.avail_in||4!==s&&2!==s)||("string"===this.options.to?this.onData(a.buf2binstring(i.shrinkBuf(o.output,o.next_out))):this.onData(i.shrinkBuf(o.output,o.next_out)))}while((o.avail_in>0||0===o.avail_out)&&1!==n);return 4===s?(n=r.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,0===n):2!==s||(this.onEnd(0),o.avail_out=0,!0)},u.prototype.onData=function(e){this.chunks.push(e)},u.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Deflate=u,t.deflate=c,t.deflateRaw=function(e,t){return(t=t||{}).raw=!0,c(e,t)},t.gzip=function(e,t){return(t=t||{}).gzip=!0,c(e,t)}},function(e,t,n){"use strict";var r,i=n(0),a=n(10),s=n(3),o=n(4),l=n(1);function u(e,t){return e.msg=l[t],t}function c(e){return(e<<1)-(e>4?9:0)}function h(e){for(var t=e.length;--t>=0;)e[t]=0}function f(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(i.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function d(e,t){a._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,f(e.strm)}function p(e,t){e.pending_buf[e.pending++]=t}function v(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function y(e,t){var n,r,i=e.max_chain_length,a=e.strstart,s=e.prev_length,o=e.nice_match,l=e.strstart>e.w_size-262?e.strstart-(e.w_size-262):0,u=e.window,c=e.w_mask,h=e.prev,f=e.strstart+258,d=u[a+s-1],p=u[a+s];e.prev_length>=e.good_match&&(i>>=2),o>e.lookahead&&(o=e.lookahead);do{if(u[(n=t)+s]===p&&u[n+s-1]===d&&u[n]===u[a]&&u[++n]===u[a+1]){a+=2,n++;do{}while(u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&a<f);if(r=258-(f-a),a=f-258,r>s){if(e.match_start=t,s=r,r>=o)break;d=u[a+s-1],p=u[a+s]}}}while((t=h[t&c])>l&&0!=--i);return s<=e.lookahead?s:e.lookahead}function g(e){var t,n,r,a,l,u,c,h,f,d,p=e.w_size;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=p+(p-262)){i.arraySet(e.window,e.window,p,p,0),e.match_start-=p,e.strstart-=p,e.block_start-=p,t=n=e.hash_size;do{r=e.head[--t],e.head[t]=r>=p?r-p:0}while(--n);t=n=p;do{r=e.prev[--t],e.prev[t]=r>=p?r-p:0}while(--n);a+=p}if(0===e.strm.avail_in)break;if(u=e.strm,c=e.window,h=e.strstart+e.lookahead,f=a,d=void 0,(d=u.avail_in)>f&&(d=f),n=0===d?0:(u.avail_in-=d,i.arraySet(c,u.input,u.next_in,d,h),1===u.state.wrap?u.adler=s(u.adler,c,d,h):2===u.state.wrap&&(u.adler=o(u.adler,c,d,h)),u.next_in+=d,u.total_in+=d,d),e.lookahead+=n,e.lookahead+e.insert>=3)for(l=e.strstart-e.insert,e.ins_h=e.window[l],e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+3-1])&e.hash_mask,e.prev[l&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=l,l++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<262&&0!==e.strm.avail_in)}function m(e,t){for(var n,r;;){if(e.lookahead<262){if(g(e),e.lookahead<262&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-262&&(e.match_length=y(e,n)),e.match_length>=3)if(r=a._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(d(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(d(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(d(e,!1),0===e.strm.avail_out)?1:2}function _(e,t){for(var n,r,i;;){if(e.lookahead<262){if(g(e),e.lookahead<262&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-262&&(e.match_length=y(e,n),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=a._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(d(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((r=a._tr_tally(e,0,e.window[e.strstart-1]))&&d(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=a._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(d(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(d(e,!1),0===e.strm.avail_out)?1:2}function b(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}function k(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(1146),this.dyn_dtree=new i.Buf16(122),this.bl_tree=new i.Buf16(78),h(this.dyn_ltree),h(this.dyn_dtree),h(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(16),this.heap=new i.Buf16(573),h(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(573),h(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function w(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:113,e.adler=2===t.wrap?0:1,t.last_flush=0,a._tr_init(t),0):u(e,-2)}function S(e){var t,n=w(e);return 0===n&&((t=e.state).window_size=2*t.w_size,h(t.head),t.max_lazy_match=r[t.level].max_lazy,t.good_match=r[t.level].good_length,t.nice_match=r[t.level].nice_length,t.max_chain_length=r[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),n}function A(e,t,n,r,a,s){if(!e)return-2;var o=1;if(-1===t&&(t=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),a<1||a>9||8!==n||r<8||r>15||t<0||t>9||s<0||s>4)return u(e,-2);8===r&&(r=9);var l=new k;return e.state=l,l.strm=e,l.wrap=o,l.gzhead=null,l.w_bits=r,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new i.Buf8(2*l.w_size),l.head=new i.Buf16(l.hash_size),l.prev=new i.Buf16(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new i.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=s,l.method=n,S(e)}r=[new b(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(g(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,d(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-262&&(d(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(d(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(d(e,!1),e.strm.avail_out),1)})),new b(4,4,8,4,m),new b(4,5,16,8,m),new b(4,6,32,32,m),new b(4,4,16,16,_),new b(8,16,32,32,_),new b(8,16,128,128,_),new b(8,32,128,256,_),new b(32,128,258,1024,_),new b(32,258,258,4096,_)],t.deflateInit=function(e,t){return A(e,t,8,15,8,0)},t.deflateInit2=A,t.deflateReset=S,t.deflateResetKeep=w,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?-2:(e.state.gzhead=t,0):-2},t.deflate=function(e,t){var n,i,s,l;if(!e||!e.state||t>5||t<0)return e?u(e,-2):-2;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||666===i.status&&4!==t)return u(e,0===e.avail_out?-5:-2);if(i.strm=e,n=i.last_flush,i.last_flush=t,42===i.status)if(2===i.wrap)e.adler=0,p(i,31),p(i,139),p(i,8),i.gzhead?(p(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),p(i,255&i.gzhead.time),p(i,i.gzhead.time>>8&255),p(i,i.gzhead.time>>16&255),p(i,i.gzhead.time>>24&255),p(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),p(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(p(i,255&i.gzhead.extra.length),p(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=o(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(p(i,0),p(i,0),p(i,0),p(i,0),p(i,0),p(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),p(i,3),i.status=113);else{var y=8+(i.w_bits-8<<4)<<8;y|=(i.strategy>=2||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(y|=32),y+=31-y%31,i.status=113,v(i,y),0!==i.strstart&&(v(i,e.adler>>>16),v(i,65535&e.adler)),e.adler=1}if(69===i.status)if(i.gzhead.extra){for(s=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>s&&(e.adler=o(e.adler,i.pending_buf,i.pending-s,s)),f(e),s=i.pending,i.pending!==i.pending_buf_size));)p(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>s&&(e.adler=o(e.adler,i.pending_buf,i.pending-s,s)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){s=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>s&&(e.adler=o(e.adler,i.pending_buf,i.pending-s,s)),f(e),s=i.pending,i.pending===i.pending_buf_size)){l=1;break}l=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,p(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>s&&(e.adler=o(e.adler,i.pending_buf,i.pending-s,s)),0===l&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){s=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>s&&(e.adler=o(e.adler,i.pending_buf,i.pending-s,s)),f(e),s=i.pending,i.pending===i.pending_buf_size)){l=1;break}l=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,p(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>s&&(e.adler=o(e.adler,i.pending_buf,i.pending-s,s)),0===l&&(i.status=103)}else i.status=103;if(103===i.status&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&f(e),i.pending+2<=i.pending_buf_size&&(p(i,255&e.adler),p(i,e.adler>>8&255),e.adler=0,i.status=113)):i.status=113),0!==i.pending){if(f(e),0===e.avail_out)return i.last_flush=-1,0}else if(0===e.avail_in&&c(t)<=c(n)&&4!==t)return u(e,-5);if(666===i.status&&0!==e.avail_in)return u(e,-5);if(0!==e.avail_in||0!==i.lookahead||0!==t&&666!==i.status){var m=2===i.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(g(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,n=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(d(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(d(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(d(e,!1),0===e.strm.avail_out)?1:2}(i,t):3===i.strategy?function(e,t){for(var n,r,i,s,o=e.window;;){if(e.lookahead<=258){if(g(e),e.lookahead<=258&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(r=o[i=e.strstart-1])===o[++i]&&r===o[++i]&&r===o[++i]){s=e.strstart+258;do{}while(r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&i<s);e.match_length=258-(s-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=a._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(d(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(d(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(d(e,!1),0===e.strm.avail_out)?1:2}(i,t):r[i.level].func(i,t);if(3!==m&&4!==m||(i.status=666),1===m||3===m)return 0===e.avail_out&&(i.last_flush=-1),0;if(2===m&&(1===t?a._tr_align(i):5!==t&&(a._tr_stored_block(i,0,0,!1),3===t&&(h(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),f(e),0===e.avail_out))return i.last_flush=-1,0}return 4!==t?0:i.wrap<=0?1:(2===i.wrap?(p(i,255&e.adler),p(i,e.adler>>8&255),p(i,e.adler>>16&255),p(i,e.adler>>24&255),p(i,255&e.total_in),p(i,e.total_in>>8&255),p(i,e.total_in>>16&255),p(i,e.total_in>>24&255)):(v(i,e.adler>>>16),v(i,65535&e.adler)),f(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?0:1)},t.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&103!==t&&113!==t&&666!==t?u(e,-2):(e.state=null,113===t?u(e,-3):0):-2},t.deflateSetDictionary=function(e,t){var n,r,a,o,l,u,c,f,d=t.length;if(!e||!e.state)return-2;if(2===(o=(n=e.state).wrap)||1===o&&42!==n.status||n.lookahead)return-2;for(1===o&&(e.adler=s(e.adler,t,d,0)),n.wrap=0,d>=n.w_size&&(0===o&&(h(n.head),n.strstart=0,n.block_start=0,n.insert=0),f=new i.Buf8(n.w_size),i.arraySet(f,t,d-n.w_size,n.w_size,0),t=f,d=n.w_size),l=e.avail_in,u=e.next_in,c=e.input,e.avail_in=d,e.next_in=0,e.input=t,g(n);n.lookahead>=3;){r=n.strstart,a=n.lookahead-2;do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+3-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++}while(--a);n.strstart=r,n.lookahead=2,g(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=u,e.input=c,e.avail_in=l,n.wrap=o,0},t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t,n){"use strict";var r=n(0);function i(e){for(var t=e.length;--t>=0;)e[t]=0}var a=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],s=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],l=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],u=new Array(576);i(u);var c=new Array(60);i(c);var h=new Array(512);i(h);var f=new Array(256);i(f);var d=new Array(29);i(d);var p,v,y,g=new Array(30);function m(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}function _(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function b(e){return e<256?h[e]:h[256+(e>>>7)]}function k(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function w(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,k(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function S(e,t,n){w(e,n[2*t],n[2*t+1])}function A(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function T(e,t,n){var r,i,a=new Array(16),s=0;for(r=1;r<=15;r++)a[r]=s=s+n[r-1]<<1;for(i=0;i<=t;i++){var o=e[2*i+1];0!==o&&(e[2*i]=A(a[o]++,o))}}function E(e){var t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function x(e){e.bi_valid>8?k(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function O(e,t,n,r){var i=2*t,a=2*n;return e[i]<e[a]||e[i]===e[a]&&r[t]<=r[n]}function C(e,t,n){for(var r=e.heap[n],i=n<<1;i<=e.heap_len&&(i<e.heap_len&&O(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!O(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r}function R(e,t,n){var r,i,o,l,u=0;if(0!==e.last_lit)do{r=e.pending_buf[e.d_buf+2*u]<<8|e.pending_buf[e.d_buf+2*u+1],i=e.pending_buf[e.l_buf+u],u++,0===r?S(e,i,t):(S(e,(o=f[i])+256+1,t),0!==(l=a[o])&&w(e,i-=d[o],l),S(e,o=b(--r),n),0!==(l=s[o])&&w(e,r-=g[o],l))}while(u<e.last_lit);S(e,256,t)}function B(e,t){var n,r,i,a=t.dyn_tree,s=t.stat_desc.static_tree,o=t.stat_desc.has_stree,l=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<l;n++)0!==a[2*n]?(e.heap[++e.heap_len]=u=n,e.depth[n]=0):a[2*n+1]=0;for(;e.heap_len<2;)a[2*(i=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[i]=0,e.opt_len--,o&&(e.static_len-=s[2*i+1]);for(t.max_code=u,n=e.heap_len>>1;n>=1;n--)C(e,a,n);i=l;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],C(e,a,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,a[2*i]=a[2*n]+a[2*r],e.depth[i]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,a[2*n+1]=a[2*r+1]=i,e.heap[1]=i++,C(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,r,i,a,s,o,l=t.dyn_tree,u=t.max_code,c=t.stat_desc.static_tree,h=t.stat_desc.has_stree,f=t.stat_desc.extra_bits,d=t.stat_desc.extra_base,p=t.stat_desc.max_length,v=0;for(a=0;a<=15;a++)e.bl_count[a]=0;for(l[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(a=l[2*l[2*(r=e.heap[n])+1]+1]+1)>p&&(a=p,v++),l[2*r+1]=a,r>u||(e.bl_count[a]++,s=0,r>=d&&(s=f[r-d]),o=l[2*r],e.opt_len+=o*(a+s),h&&(e.static_len+=o*(c[2*r+1]+s)));if(0!==v){do{for(a=p-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[p]--,v-=2}while(v>0);for(a=p;0!==a;a--)for(r=e.bl_count[a];0!==r;)(i=e.heap[--n])>u||(l[2*i+1]!==a&&(e.opt_len+=(a-l[2*i+1])*l[2*i],l[2*i+1]=a),r--)}}(e,t),T(a,u,e.bl_count)}function L(e,t,n){var r,i,a=-1,s=t[1],o=0,l=7,u=4;for(0===s&&(l=138,u=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=s,s=t[2*(r+1)+1],++o<l&&i===s||(o<u?e.bl_tree[2*i]+=o:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,a=i,0===s?(l=138,u=3):i===s?(l=6,u=3):(l=7,u=4))}function z(e,t,n){var r,i,a=-1,s=t[1],o=0,l=7,u=4;for(0===s&&(l=138,u=3),r=0;r<=n;r++)if(i=s,s=t[2*(r+1)+1],!(++o<l&&i===s)){if(o<u)do{S(e,i,e.bl_tree)}while(0!=--o);else 0!==i?(i!==a&&(S(e,i,e.bl_tree),o--),S(e,16,e.bl_tree),w(e,o-3,2)):o<=10?(S(e,17,e.bl_tree),w(e,o-3,3)):(S(e,18,e.bl_tree),w(e,o-11,7));o=0,a=i,0===s?(l=138,u=3):i===s?(l=6,u=3):(l=7,u=4)}}i(g);var N=!1;function P(e,t,n,i){w(e,0+(i?1:0),3),function(e,t,n,i){x(e),i&&(k(e,n),k(e,~n)),r.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n,!0)}t._tr_init=function(e){N||(!function(){var e,t,n,r,i,l=new Array(16);for(n=0,r=0;r<28;r++)for(d[r]=n,e=0;e<1<<a[r];e++)f[n++]=r;for(f[n-1]=r,i=0,r=0;r<16;r++)for(g[r]=i,e=0;e<1<<s[r];e++)h[i++]=r;for(i>>=7;r<30;r++)for(g[r]=i<<7,e=0;e<1<<s[r]-7;e++)h[256+i++]=r;for(t=0;t<=15;t++)l[t]=0;for(e=0;e<=143;)u[2*e+1]=8,e++,l[8]++;for(;e<=255;)u[2*e+1]=9,e++,l[9]++;for(;e<=279;)u[2*e+1]=7,e++,l[7]++;for(;e<=287;)u[2*e+1]=8,e++,l[8]++;for(T(u,287,l),e=0;e<30;e++)c[2*e+1]=5,c[2*e]=A(e,5);p=new m(u,a,257,286,15),v=new m(c,s,0,30,15),y=new m(new Array(0),o,0,19,7)}(),N=!0),e.l_desc=new _(e.dyn_ltree,p),e.d_desc=new _(e.dyn_dtree,v),e.bl_desc=new _(e.bl_tree,y),e.bi_buf=0,e.bi_valid=0,E(e)},t._tr_stored_block=P,t._tr_flush_block=function(e,t,n,r){var i,a,s=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),B(e,e.l_desc),B(e,e.d_desc),s=function(e){var t;for(L(e,e.dyn_ltree,e.l_desc.max_code),L(e,e.dyn_dtree,e.d_desc.max_code),B(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*l[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(a=e.static_len+3+7>>>3)<=i&&(i=a)):i=a=n+5,n+4<=i&&-1!==t?P(e,t,n,r):4===e.strategy||a===i?(w(e,2+(r?1:0),3),R(e,u,c)):(w(e,4+(r?1:0),3),function(e,t,n,r){var i;for(w(e,t-257,5),w(e,n-1,5),w(e,r-4,4),i=0;i<r;i++)w(e,e.bl_tree[2*l[i]+1],3);z(e,e.dyn_ltree,t-1),z(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),R(e,e.dyn_ltree,e.dyn_dtree)),E(e),r&&x(e)},t._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(f[n]+256+1)]++,e.dyn_dtree[2*b(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){w(e,2,3),S(e,256,u),function(e){16===e.bi_valid?(k(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},function(e,t,n){"use strict";var r=n(12),i=n(0),a=n(5),s=n(7),o=n(1),l=n(6),u=n(15),c=Object.prototype.toString;function h(e){if(!(this instanceof h))return new h(e);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var n=r.inflateInit2(this.strm,t.windowBits);if(n!==s.Z_OK)throw new Error(o[n]);if(this.header=new u,r.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=a.string2buf(t.dictionary):"[object ArrayBuffer]"===c.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=r.inflateSetDictionary(this.strm,t.dictionary))!==s.Z_OK))throw new Error(o[n])}function f(e,t){var n=new h(t);if(n.push(e,!0),n.err)throw n.msg||o[n.err];return n.result}h.prototype.push=function(e,t){var n,o,l,u,h,f=this.strm,d=this.options.chunkSize,p=this.options.dictionary,v=!1;if(this.ended)return!1;o=t===~~t?t:!0===t?s.Z_FINISH:s.Z_NO_FLUSH,"string"==typeof e?f.input=a.binstring2buf(e):"[object ArrayBuffer]"===c.call(e)?f.input=new Uint8Array(e):f.input=e,f.next_in=0,f.avail_in=f.input.length;do{if(0===f.avail_out&&(f.output=new i.Buf8(d),f.next_out=0,f.avail_out=d),(n=r.inflate(f,s.Z_NO_FLUSH))===s.Z_NEED_DICT&&p&&(n=r.inflateSetDictionary(this.strm,p)),n===s.Z_BUF_ERROR&&!0===v&&(n=s.Z_OK,v=!1),n!==s.Z_STREAM_END&&n!==s.Z_OK)return this.onEnd(n),this.ended=!0,!1;f.next_out&&(0!==f.avail_out&&n!==s.Z_STREAM_END&&(0!==f.avail_in||o!==s.Z_FINISH&&o!==s.Z_SYNC_FLUSH)||("string"===this.options.to?(l=a.utf8border(f.output,f.next_out),u=f.next_out-l,h=a.buf2string(f.output,l),f.next_out=u,f.avail_out=d-u,u&&i.arraySet(f.output,f.output,l,u,0),this.onData(h)):this.onData(i.shrinkBuf(f.output,f.next_out)))),0===f.avail_in&&0===f.avail_out&&(v=!0)}while((f.avail_in>0||0===f.avail_out)&&n!==s.Z_STREAM_END);return n===s.Z_STREAM_END&&(o=s.Z_FINISH),o===s.Z_FINISH?(n=r.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===s.Z_OK):o!==s.Z_SYNC_FLUSH||(this.onEnd(s.Z_OK),f.avail_out=0,!0)},h.prototype.onData=function(e){this.chunks.push(e)},h.prototype.onEnd=function(e){e===s.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Inflate=h,t.inflate=f,t.inflateRaw=function(e,t){return(t=t||{}).raw=!0,f(e,t)},t.ungzip=f},function(e,t,n){"use strict";var r=n(0),i=n(3),a=n(4),s=n(13),o=n(14);function l(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function u(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function c(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new r.Buf32(852),t.distcode=t.distdyn=new r.Buf32(592),t.sane=1,t.back=-1,0):-2}function h(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,c(e)):-2}function f(e,t){var n,r;return e&&e.state?(r=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?-2:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,h(e))):-2}function d(e,t){var n,r;return e?(r=new u,e.state=r,r.window=null,0!==(n=f(e,t))&&(e.state=null),n):-2}var p,v,y=!0;function g(e){if(y){var t;for(p=new r.Buf32(512),v=new r.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(o(1,e.lens,0,288,p,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;o(2,e.lens,0,32,v,0,e.work,{bits:5}),y=!1}e.lencode=p,e.lenbits=9,e.distcode=v,e.distbits=5}function m(e,t,n,i){var a,s=e.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new r.Buf8(s.wsize)),i>=s.wsize?(r.arraySet(s.window,t,n-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):((a=s.wsize-s.wnext)>i&&(a=i),r.arraySet(s.window,t,n-i,a,s.wnext),(i-=a)?(r.arraySet(s.window,t,n-i,i,0),s.wnext=i,s.whave=s.wsize):(s.wnext+=a,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=a))),0}t.inflateReset=h,t.inflateReset2=f,t.inflateResetKeep=c,t.inflateInit=function(e){return d(e,15)},t.inflateInit2=d,t.inflate=function(e,t){var n,u,c,h,f,d,p,v,y,_,b,k,w,S,A,T,E,x,O,C,R,B,L,z,N=0,P=new r.Buf8(4),H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return-2;12===(n=e.state).mode&&(n.mode=13),f=e.next_out,c=e.output,p=e.avail_out,h=e.next_in,u=e.input,d=e.avail_in,v=n.hold,y=n.bits,_=d,b=p,B=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;y<16;){if(0===d)break e;d--,v+=u[h++]<<y,y+=8}if(2&n.wrap&&35615===v){n.check=0,P[0]=255&v,P[1]=v>>>8&255,n.check=a(n.check,P,2,0),v=0,y=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&v)<<8)+(v>>8))%31){e.msg="incorrect header check",n.mode=30;break}if(8!=(15&v)){e.msg="unknown compression method",n.mode=30;break}if(y-=4,R=8+(15&(v>>>=4)),0===n.wbits)n.wbits=R;else if(R>n.wbits){e.msg="invalid window size",n.mode=30;break}n.dmax=1<<R,e.adler=n.check=1,n.mode=512&v?10:12,v=0,y=0;break;case 2:for(;y<16;){if(0===d)break e;d--,v+=u[h++]<<y,y+=8}if(n.flags=v,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=v>>8&1),512&n.flags&&(P[0]=255&v,P[1]=v>>>8&255,n.check=a(n.check,P,2,0)),v=0,y=0,n.mode=3;case 3:for(;y<32;){if(0===d)break e;d--,v+=u[h++]<<y,y+=8}n.head&&(n.head.time=v),512&n.flags&&(P[0]=255&v,P[1]=v>>>8&255,P[2]=v>>>16&255,P[3]=v>>>24&255,n.check=a(n.check,P,4,0)),v=0,y=0,n.mode=4;case 4:for(;y<16;){if(0===d)break e;d--,v+=u[h++]<<y,y+=8}n.head&&(n.head.xflags=255&v,n.head.os=v>>8),512&n.flags&&(P[0]=255&v,P[1]=v>>>8&255,n.check=a(n.check,P,2,0)),v=0,y=0,n.mode=5;case 5:if(1024&n.flags){for(;y<16;){if(0===d)break e;d--,v+=u[h++]<<y,y+=8}n.length=v,n.head&&(n.head.extra_len=v),512&n.flags&&(P[0]=255&v,P[1]=v>>>8&255,n.check=a(n.check,P,2,0)),v=0,y=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((k=n.length)>d&&(k=d),k&&(n.head&&(R=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),r.arraySet(n.head.extra,u,h,k,R)),512&n.flags&&(n.check=a(n.check,u,k,h)),d-=k,h+=k,n.length-=k),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===d)break e;k=0;do{R=u[h+k++],n.head&&R&&n.length<65536&&(n.head.name+=String.fromCharCode(R))}while(R&&k<d);if(512&n.flags&&(n.check=a(n.check,u,k,h)),d-=k,h+=k,R)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===d)break e;k=0;do{R=u[h+k++],n.head&&R&&n.length<65536&&(n.head.comment+=String.fromCharCode(R))}while(R&&k<d);if(512&n.flags&&(n.check=a(n.check,u,k,h)),d-=k,h+=k,R)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;y<16;){if(0===d)break e;d--,v+=u[h++]<<y,y+=8}if(v!==(65535&n.check)){e.msg="header crc mismatch",n.mode=30;break}v=0,y=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=12;break;case 10:for(;y<32;){if(0===d)break e;d--,v+=u[h++]<<y,y+=8}e.adler=n.check=l(v),v=0,y=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=f,e.avail_out=p,e.next_in=h,e.avail_in=d,n.hold=v,n.bits=y,2;e.adler=n.check=1,n.mode=12;case 12:if(5===t||6===t)break e;case 13:if(n.last){v>>>=7&y,y-=7&y,n.mode=27;break}for(;y<3;){if(0===d)break e;d--,v+=u[h++]<<y,y+=8}switch(n.last=1&v,y-=1,3&(v>>>=1)){case 0:n.mode=14;break;case 1:if(g(n),n.mode=20,6===t){v>>>=2,y-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=30}v>>>=2,y-=2;break;case 14:for(v>>>=7&y,y-=7&y;y<32;){if(0===d)break e;d--,v+=u[h++]<<y,y+=8}if((65535&v)!=(v>>>16^65535)){e.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&v,v=0,y=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(k=n.length){if(k>d&&(k=d),k>p&&(k=p),0===k)break e;r.arraySet(c,u,h,k,f),d-=k,h+=k,p-=k,f+=k,n.length-=k;break}n.mode=12;break;case 17:for(;y<14;){if(0===d)break e;d--,v+=u[h++]<<y,y+=8}if(n.nlen=257+(31&v),v>>>=5,y-=5,n.ndist=1+(31&v),v>>>=5,y-=5,n.ncode=4+(15&v),v>>>=4,y-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;y<3;){if(0===d)break e;d--,v+=u[h++]<<y,y+=8}n.lens[H[n.have++]]=7&v,v>>>=3,y-=3}for(;n.have<19;)n.lens[H[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,L={bits:n.lenbits},B=o(0,n.lens,0,19,n.lencode,0,n.work,L),n.lenbits=L.bits,B){e.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;T=(N=n.lencode[v&(1<<n.lenbits)-1])>>>16&255,E=65535&N,!((A=N>>>24)<=y);){if(0===d)break e;d--,v+=u[h++]<<y,y+=8}if(E<16)v>>>=A,y-=A,n.lens[n.have++]=E;else{if(16===E){for(z=A+2;y<z;){if(0===d)break e;d--,v+=u[h++]<<y,y+=8}if(v>>>=A,y-=A,0===n.have){e.msg="invalid bit length repeat",n.mode=30;break}R=n.lens[n.have-1],k=3+(3&v),v>>>=2,y-=2}else if(17===E){for(z=A+3;y<z;){if(0===d)break e;d--,v+=u[h++]<<y,y+=8}y-=A,R=0,k=3+(7&(v>>>=A)),v>>>=3,y-=3}else{for(z=A+7;y<z;){if(0===d)break e;d--,v+=u[h++]<<y,y+=8}y-=A,R=0,k=11+(127&(v>>>=A)),v>>>=7,y-=7}if(n.have+k>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=30;break}for(;k--;)n.lens[n.have++]=R}}if(30===n.mode)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,L={bits:n.lenbits},B=o(1,n.lens,0,n.nlen,n.lencode,0,n.work,L),n.lenbits=L.bits,B){e.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,L={bits:n.distbits},B=o(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,L),n.distbits=L.bits,B){e.msg="invalid distances set",n.mode=30;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(d>=6&&p>=258){e.next_out=f,e.avail_out=p,e.next_in=h,e.avail_in=d,n.hold=v,n.bits=y,s(e,b),f=e.next_out,c=e.output,p=e.avail_out,h=e.next_in,u=e.input,d=e.avail_in,v=n.hold,y=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;T=(N=n.lencode[v&(1<<n.lenbits)-1])>>>16&255,E=65535&N,!((A=N>>>24)<=y);){if(0===d)break e;d--,v+=u[h++]<<y,y+=8}if(T&&0==(240&T)){for(x=A,O=T,C=E;T=(N=n.lencode[C+((v&(1<<x+O)-1)>>x)])>>>16&255,E=65535&N,!(x+(A=N>>>24)<=y);){if(0===d)break e;d--,v+=u[h++]<<y,y+=8}v>>>=x,y-=x,n.back+=x}if(v>>>=A,y-=A,n.back+=A,n.length=E,0===T){n.mode=26;break}if(32&T){n.back=-1,n.mode=12;break}if(64&T){e.msg="invalid literal/length code",n.mode=30;break}n.extra=15&T,n.mode=22;case 22:if(n.extra){for(z=n.extra;y<z;){if(0===d)break e;d--,v+=u[h++]<<y,y+=8}n.length+=v&(1<<n.extra)-1,v>>>=n.extra,y-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;T=(N=n.distcode[v&(1<<n.distbits)-1])>>>16&255,E=65535&N,!((A=N>>>24)<=y);){if(0===d)break e;d--,v+=u[h++]<<y,y+=8}if(0==(240&T)){for(x=A,O=T,C=E;T=(N=n.distcode[C+((v&(1<<x+O)-1)>>x)])>>>16&255,E=65535&N,!(x+(A=N>>>24)<=y);){if(0===d)break e;d--,v+=u[h++]<<y,y+=8}v>>>=x,y-=x,n.back+=x}if(v>>>=A,y-=A,n.back+=A,64&T){e.msg="invalid distance code",n.mode=30;break}n.offset=E,n.extra=15&T,n.mode=24;case 24:if(n.extra){for(z=n.extra;y<z;){if(0===d)break e;d--,v+=u[h++]<<y,y+=8}n.offset+=v&(1<<n.extra)-1,v>>>=n.extra,y-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===p)break e;if(k=b-p,n.offset>k){if((k=n.offset-k)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=30;break}k>n.wnext?(k-=n.wnext,w=n.wsize-k):w=n.wnext-k,k>n.length&&(k=n.length),S=n.window}else S=c,w=f-n.offset,k=n.length;k>p&&(k=p),p-=k,n.length-=k;do{c[f++]=S[w++]}while(--k);0===n.length&&(n.mode=21);break;case 26:if(0===p)break e;c[f++]=n.length,p--,n.mode=21;break;case 27:if(n.wrap){for(;y<32;){if(0===d)break e;d--,v|=u[h++]<<y,y+=8}if(b-=p,e.total_out+=b,n.total+=b,b&&(e.adler=n.check=n.flags?a(n.check,c,b,f-b):i(n.check,c,b,f-b)),b=p,(n.flags?v:l(v))!==n.check){e.msg="incorrect data check",n.mode=30;break}v=0,y=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;y<32;){if(0===d)break e;d--,v+=u[h++]<<y,y+=8}if(v!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=30;break}v=0,y=0}n.mode=29;case 29:B=1;break e;case 30:B=-3;break e;case 31:return-4;case 32:default:return-2}return e.next_out=f,e.avail_out=p,e.next_in=h,e.avail_in=d,n.hold=v,n.bits=y,(n.wsize||b!==e.avail_out&&n.mode<30&&(n.mode<27||4!==t))&&m(e,e.output,e.next_out,b-e.avail_out)?(n.mode=31,-4):(_-=e.avail_in,b-=e.avail_out,e.total_in+=_,e.total_out+=b,n.total+=b,n.wrap&&b&&(e.adler=n.check=n.flags?a(n.check,c,b,e.next_out-b):i(n.check,c,b,e.next_out-b)),e.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),(0===_&&0===b||4===t)&&0===B&&(B=-5),B)},t.inflateEnd=function(e){if(!e||!e.state)return-2;var t=e.state;return t.window&&(t.window=null),e.state=null,0},t.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?-2:(n.head=t,t.done=!1,0):-2},t.inflateSetDictionary=function(e,t){var n,r=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?-2:11===n.mode&&i(1,t,r,0)!==n.check?-3:m(e,t,r,r)?(n.mode=31,-4):(n.havedict=1,0):-2},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t,n){"use strict";e.exports=function(e,t){var n,r,i,a,s,o,l,u,c,h,f,d,p,v,y,g,m,_,b,k,w,S,A,T,E;n=e.state,r=e.next_in,T=e.input,i=r+(e.avail_in-5),a=e.next_out,E=e.output,s=a-(t-e.avail_out),o=a+(e.avail_out-257),l=n.dmax,u=n.wsize,c=n.whave,h=n.wnext,f=n.window,d=n.hold,p=n.bits,v=n.lencode,y=n.distcode,g=(1<<n.lenbits)-1,m=(1<<n.distbits)-1;e:do{p<15&&(d+=T[r++]<<p,p+=8,d+=T[r++]<<p,p+=8),_=v[d&g];t:for(;;){if(d>>>=b=_>>>24,p-=b,0===(b=_>>>16&255))E[a++]=65535&_;else{if(!(16&b)){if(0==(64&b)){_=v[(65535&_)+(d&(1<<b)-1)];continue t}if(32&b){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}k=65535&_,(b&=15)&&(p<b&&(d+=T[r++]<<p,p+=8),k+=d&(1<<b)-1,d>>>=b,p-=b),p<15&&(d+=T[r++]<<p,p+=8,d+=T[r++]<<p,p+=8),_=y[d&m];n:for(;;){if(d>>>=b=_>>>24,p-=b,!(16&(b=_>>>16&255))){if(0==(64&b)){_=y[(65535&_)+(d&(1<<b)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(w=65535&_,p<(b&=15)&&(d+=T[r++]<<p,(p+=8)<b&&(d+=T[r++]<<p,p+=8)),(w+=d&(1<<b)-1)>l){e.msg="invalid distance too far back",n.mode=30;break e}if(d>>>=b,p-=b,w>(b=a-s)){if((b=w-b)>c&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(S=0,A=f,0===h){if(S+=u-b,b<k){k-=b;do{E[a++]=f[S++]}while(--b);S=a-w,A=E}}else if(h<b){if(S+=u+h-b,(b-=h)<k){k-=b;do{E[a++]=f[S++]}while(--b);if(S=0,h<k){k-=b=h;do{E[a++]=f[S++]}while(--b);S=a-w,A=E}}}else if(S+=h-b,b<k){k-=b;do{E[a++]=f[S++]}while(--b);S=a-w,A=E}for(;k>2;)E[a++]=A[S++],E[a++]=A[S++],E[a++]=A[S++],k-=3;k&&(E[a++]=A[S++],k>1&&(E[a++]=A[S++]))}else{S=a-w;do{E[a++]=E[S++],E[a++]=E[S++],E[a++]=E[S++],k-=3}while(k>2);k&&(E[a++]=E[S++],k>1&&(E[a++]=E[S++]))}break}}break}}while(r<i&&a<o);r-=k=p>>3,d&=(1<<(p-=k<<3))-1,e.next_in=r,e.next_out=a,e.avail_in=r<i?i-r+5:5-(r-i),e.avail_out=a<o?o-a+257:257-(a-o),n.hold=d,n.bits=p}},function(e,t,n){"use strict";var r=n(0),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],s=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],o=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,n,l,u,c,h,f){var d,p,v,y,g,m,_,b,k,w=f.bits,S=0,A=0,T=0,E=0,x=0,O=0,C=0,R=0,B=0,L=0,z=null,N=0,P=new r.Buf16(16),H=new r.Buf16(16),j=null,I=0;for(S=0;S<=15;S++)P[S]=0;for(A=0;A<l;A++)P[t[n+A]]++;for(x=w,E=15;E>=1&&0===P[E];E--);if(x>E&&(x=E),0===E)return u[c++]=20971520,u[c++]=20971520,f.bits=1,0;for(T=1;T<E&&0===P[T];T++);for(x<T&&(x=T),R=1,S=1;S<=15;S++)if(R<<=1,(R-=P[S])<0)return-1;if(R>0&&(0===e||1!==E))return-1;for(H[1]=0,S=1;S<15;S++)H[S+1]=H[S]+P[S];for(A=0;A<l;A++)0!==t[n+A]&&(h[H[t[n+A]]++]=A);if(0===e?(z=j=h,m=19):1===e?(z=i,N-=257,j=a,I-=257,m=256):(z=s,j=o,m=-1),L=0,A=0,S=T,g=c,O=x,C=0,v=-1,y=(B=1<<x)-1,1===e&&B>852||2===e&&B>592)return 1;for(;;){_=S-C,h[A]<m?(b=0,k=h[A]):h[A]>m?(b=j[I+h[A]],k=z[N+h[A]]):(b=96,k=0),d=1<<S-C,T=p=1<<O;do{u[g+(L>>C)+(p-=d)]=_<<24|b<<16|k|0}while(0!==p);for(d=1<<S-1;L&d;)d>>=1;if(0!==d?(L&=d-1,L+=d):L=0,A++,0==--P[S]){if(S===E)break;S=t[n+h[A]]}if(S>x&&(L&y)!==v){for(0===C&&(C=x),g+=T,R=1<<(O=S-C);O+C<E&&!((R-=P[O+C])<=0);)O++,R<<=1;if(B+=1<<O,1===e&&B>852||2===e&&B>592)return 1;u[v=L&y]=x<<24|O<<16|g-c|0}}return 0!==L&&(u[g+L]=S-C<<24|64<<16|0),f.bits=x,0}},function(e,t,n){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t),n.d(t,"cell",(function(){return tt}));var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.length=0,this.obj={}}var t,n,i;return t=e,(n=[{key:"isEmpty",value:function(){return 0==this.length}},{key:"containsKey",value:function(e){return e in this.obj}},{key:"containsValue",value:function(e){for(var t in this.obj)if(this.obj[t]==e)return!0;return!1}},{key:"put",value:function(e,t){this.containsKey(e)||this.length++,this.obj[e]=t}},{key:"get",value:function(e){return this.containsKey(e)?this.obj[e]:null}},{key:"remove",value:function(e){if(this.containsKey(e)){var t=this.obj[e];return delete this.obj[e],this.length--,t}return null}},{key:"values",value:function(){var e=new Array;for(var t in this.obj)e.push(this.obj[t]);return e}},{key:"keySet",value:function(){var e=new Array;for(var t in this.obj)e.push(t);return e}},{key:"size",value:function(){return this.length}},{key:"clear",value:function(){this.length=0,this.obj={}}}])&&r(t.prototype,n),i&&r(t,i),e}();function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.host=t,this.port=n}var t,n,r;return t=e,(n=[{key:"getHost",value:function(){return this.host}},{key:"getPort",value:function(){return this.port}},{key:"toString",value:function(){return this.host+":"+this.port}}])&&a(t.prototype,n),r&&a(t,r),e}();function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var l={toBytes:function(e){if(void 0!==e){var t=o(e);if("string"==t)return this.stringToBytes(e);if("number"==t){return/^-?\d+$/.test(e.toString())?e>-2147483648&&e<2147483647?this.intToBytes(e):this.longToBytes(e):/^[-\+]?\d+(\.\d+)?$/.test(e.toString())?this.doubleToBytes(e):this.floatToBytes(e)}if("boolean"==t)return this.boolToBytes(e);if("object"==t)return this.stringToBytes(JSON.stringify(e))}},intToBytes:function(e){var t=[];return t[0]=this.over127(255&e),t[1]=this.over127((65280&e)>>8),t[2]=this.over127((16711680&e)>>16),t[3]=this.over127((4278190080&e)>>24),t},longToBytes:function(e){var t=[];return t[0]=255&e,t[1]=255&this.toRight(e,8),t[2]=255&this.toRight(e,16),t[3]=255&this.toRight(e,24),t[4]=255&this.toRight(e,32),t[5]=255&this.toRight(e,40),t[6]=255&this.toRight(e,48),t[7]=255&this.toRight(e,56),t},floatToBytes:function(e){for(var t=e.toString(),n=[],r=0;r<t.length;++r)n.push(t.charCodeAt(r));return n},doubleToBytes:function(e){for(var t=e.toString(),n=[],r=0;r<t.length;++r)n.push(t.charCodeAt(r));return n},stringToBytes:function(e){return new TextEncoder("utf-8").encode(e)},boolToBytes:function(e){return[e?1:0]},toArray:function(e){for(var t=new Array,n=0,r=e.length;n<r;++n)t.push(e.charAt(n));return t},toInt:function(e){return 255&e[0]|65280&e[1]<<8|16711680&e[2]<<16|4278190080&e[3]<<24},toLong:function(e){var t=e[0]|e[1]<<8|e[2]<<16|e[3]<<24;return 4294967296*((e[4]|e[5]<<8|e[6]<<16|e[7]<<24)>>>0)+(t>>>0)},toFloat:function(e){for(var t=[],n=0;n<e.length;++n)t.push(String.fromCharCode(e[n]));var r=t.join("");return parseFloat(r)},toDouble:function(e){for(var t=[],n=0;n<e.length;++n)t.push(String.fromCharCode(e[n]));var r=t.join("");return parseFloat(r)},toBool:function(e){return 1==e[0]},toString:function(e){return new TextDecoder("utf-8").decode(new Uint8Array("object"==o(e)?e:[e]))},toRight:function(e,t){try{return parseInt(Array(t+1).join("0")+(t>e.toString(2).length?0:e.toString(2).slice(0,e.toString(2).length-t)),2)}catch(n){console.log(e,t,n)}},over127:function(e){return e>127?e-256:e},floatToIntBits:function(e){Math.pow(2,23);if(e!=e)return 2143289344;var t=e<0||0==e&&1/e<0?-2147483648:0,n=Math.abs(e);if(n==Number.POSITIVE_INFINITY)return 2139095040|t;for(var r=0,i=n;i>=2&&r<=127;)r++,i/=2;for(;i<1&&r>=-126;)r--,i*=2;var a=r+127;if(255==a)return 2139095040|signBit;if(0==a)Math.pow(2,23);else Math.pow(2,23),Math.pow(2,23);return t|a<<23&2139095040|8388607&mantissa}},u={sMagicNum:Math.round(Date.now()),ALPHABET:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],NUMBERS:[1,2,3,4,5,6,7,8,9,0],randomString:function(e){for(var t=new Array,n=0;n<e;++n){var r=Math.floor(Math.random()*this.ALPHABET.length);t.push(this.ALPHABET[r])}return t.join("")},randomNumberFixedLength:function(e){if(e<0)return 0;var t=new Array,n=Math.floor(Math.random()*(this.NUMBERS.length-1));t.push(this.NUMBERS[n]);for(var r=1;r<e;++r)n=Math.floor(Math.random()*this.NUMBERS.length),t.push(this.NUMBERS[n]);var i=t.join("");return parseInt(i)},randomNumber:function(e,t){return void 0===e&&(e=-32768),void 0===t&&(t=32767),Math.floor(Math.random()*(t-e))+e},randomBytes:function(e){for(var t=new Array,n=0;n<e;++n){var r=Math.floor(128*Math.random());t.push(r)}return t},parseInt32:function(e){var t=parseInt(e);return t<-2147483648?-2147483648:t>2147483647?2147483647:t},parseInt64:function(e){return parseInt(e)},generateSerialNumber:function(){var e=Date.now();return e+=this.randomNumber(),Math.abs(e)},simpleEncrypt:function(e,t){var n=null;if("string"==typeof e){n=[];for(var r=0;r<e.length;++r)n.push(e.charCodeAt(r)-256)}else n=e;var i=null;if("string"==typeof t){i=[];for(var a=0;a<t.length;++a)i.push(t.charCodeAt(a))}else i=t;if(8!=i.length)return null;var s=11+i[0];s-=i[1],s+=i[2],s-=i[3],s+=i[4],s-=i[5],s+=i[6];for(var o=(s-=i[7])%8,l=s%2==0?2:1,u=n.length,c=new Array,h=0;h<u;++h){var f=n[h]^l^o;f<0&&(f+=256),c[h]=f}return c},simpleDecrypt:function(e,t){var n=[];if("string"==typeof e){n=[];for(var r=0;r<e.length;++r)n.push(e.charCodeAt(r)-256)}else n=e;var i=[];if("string"==typeof t)for(var a=0;a<t.length;++a)i.push(t.charCodeAt(a)-256);else i=t;if(8!=i.length)return null;var s=11+i[0];s-=i[1],s+=i[2],s-=i[3],s+=i[4],s-=i[5],s+=i[6];for(var o=(s-=i[7])%8,l=s%2==0?2:1,u=n.length,c=new Array,h=0;h<u;++h){var f=n[h]^o^l;f<0&&(f+=256),c[h]=f}return c},toCharCode:function(e){var t=new Array;if("string"==typeof e)for(var n=0;n<e.length;++n)t.push(e.charCodeAt(n));else for(var r=0;r<e.length;++r)if("string"==typeof e[r])for(var i=e[r],a=0;a<i.length;++a)t.push(i.charCodeAt(a));else t.push(e[r]);return t},fromCharCode:function(e){for(var t=new Array,n=0;n<e.length;++n)t.push(String.fromCharCode(e[n]));return t.join("")}},c={DEBUG:1,INFO:2,WARNING:3,ERROR:4};function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var f=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"debug",value:function(e,t,n){}},{key:"info",value:function(e,t,n){}},{key:"warn",value:function(e,t,n){}},{key:"error",value:function(e,t,n){}}])&&h(t.prototype,n),r&&h(t,r),e}();void 0===window.console?window.console={error:function(){},warn:function(){},info:function(){},log:function(){}}:(void 0===window.console.error&&(window.console.error=window.console.log),void 0===window.console.warn&&(window.console.warn=window.console.log),void 0===window.console.info&&(window.console.info=window.console.log));var d={enabled:!0,level:c.INFO,handlers:[],isDebugLevel:function(){return this.level==c.DEBUG},addHandler:function(e){this.handlers.indexOf(e)>=0||this.handlers.push(e)},removeHandler:function(e){var t=this.handlers.indexOf(e);t>=0&&this.handlers.splice(t,1)},d:function(e,t){if(this.enabled&&!(this.level>c.DEBUG)){for(var n=this._formatTime(),r=0;r<this.handlers.length;++r)this.handlers[r].debug(n,e,t);var i=[n," [DEBUG] ",e," - ",t];window.console.log(i.join("")),i=null}},i:function(e,t){if(this.enabled&&!(this.level>c.INFO)){for(var n=this._formatTime(),r=0;r<this.handlers.length;++r)this.handlers[r].info(n,e,t);var i=[n," [INFO]  ",e," - ",t];window.console.info(i.join("")),i=null}},w:function(e,t){if(this.enabled&&!(this.level>c.WARNING)){for(var n=this._formatTime(),r=0;r<this.handlers.length;++r)this.handlers[r].warn(n,e,t);var i=[n," [WARN]  ",e," - ",t];window.console.warn(i.join("")),i=null}},e:function(e,t){if(this.enabled&&!(this.level>c.ERROR)){for(var n=this._formatTime(),r=0;r<this.handlers.length;++r)this.handlers[r].error(n,e,t);var i=[n," [ERROR] ",e," - ",t];window.console.error(i.join("")),i=null}},log:function(e,t,n){if(this.enabled)switch(n){case c.DEBUG:this.d(e,t);break;case c.INFO:this.i(e,t);break;case c.WARNING:this.w(e,t);break;case c.ERROR:this.e(e,t);break;default:var r=[this._formatTime()," [LOG] ",e," - ",t];window.console.log(r.join("")),r=null}},_formatTime:function(){var e=new Date,t=e.getHours(),n=e.getMinutes(),r=e.getSeconds(),i=e.getMilliseconds();return e=null,[t<10?"0":"",t,":",n<10?"0":"",n,":",r<10?"0":"",r,".",i<10?"00":i<100?"0":"",i].join("")}};function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var v=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.MAJOR=2,this.MINOR=3,this.REVISION=9,this.NAME="Genie"}var t,n,r;return t=e,(n=[{key:"getNumbers",value:function(){return[this.MAJOR,".",this.MINOR,".",this.REVISION].join("")}},{key:"toString",value:function(){return[this.MAJOR,".",this.MINOR,".",this.REVISION," (",this.NAME,")"].join("")}}])&&p(t.prototype,n),r&&p(t,r),e}(),y=function(){var e,t="0123456789abcdef".split(""),n=[],r=Math.random;n[8]=n[13]=n[18]=n[23]="-",n[14]="4";for(var i=0;i<36;i++)n[i]||(e=0|16*r(),n[i]=t[19==i?3&e|8:15&e]);return n.join("")};function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var m=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.uuid=void 0!==t?t:y().toString()}var t,n,r;return t=e,(n=[{key:"reset",value:function(){this.uuid=y().toString()}},{key:"asString",value:function(){return this.uuid}},{key:"toString",value:function(){return this.uuid}}])&&g(t.prototype,n),r&&g(t,r),e}();var _=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.heartbeat=6e4},b=1,k=2,w=3,S=4;function A(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var T=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.timer=0,this.runnable=t,this.scope=void 0===n?null:n}var t,n,r;return t=e,(n=[{key:"start",value:function(){var e=this;this.timer=setTimeout((function(t){e.runnable.call(e.scope),clearTimeout(e.timer),e.timer=0}),0)}},{key:"delay",value:function(e){var t=this,n=setTimeout((function(){t.start(),clearTimeout(n)}),e)}}])&&A(t.prototype,n),r&&A(t,r),e}();function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function x(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function O(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&C(e,t)}function C(e,t){return(C=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function R(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=z(e);if(t){var i=z(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return B(this,n)}}function B(e,t){return!t||"object"!==E(t)&&"function"!=typeof t?L(e):t}function L(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function z(e){return(z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function N(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function P(e){return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function H(e,t){return(H=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function j(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=D(e);if(t){var i=D(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I(this,n)}}function I(e,t){return!t||"object"!==P(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function D(e){return(D=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var M=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&H(e,t)}(n,e);var t=j(n);function n(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),t.call(this,e)}return n}(function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.address=t,this.id=u.generateSerialNumber(),this.timestamp=Date.now(),this.secretKey=null}var t,n,r;return t=e,(n=[{key:"getId",value:function(){return this.id}},{key:"getAddress",value:function(){return this.address}},{key:"setSecretKey",value:function(e){this.secretKey=e}},{key:"getSecretKey",value:function(){return this.secretKey}},{key:"toString",value:function(){return this.address.toString()}}])&&N(t.prototype,n),r&&N(t,r),e}()),V=n(2),F=n.n(V);function Z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var U=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.payload=t,this.context=null,this.compressible=!1,this.verifyCompression()}var t,n,r;return t=e,r=[{key:"pack",value:function(t,n){var r=null;return(r=null!=n?u.simpleEncrypt(t,n):t).length>e.CompressionThreshold?e.compress(r):r}},{key:"unpack",value:function(t,n){var r=null;return null==(r=120==t[0]&&156==t[1]?e.uncompress(t):t)?null:null!=n?u.simpleDecrypt(r,n):r}},{key:"compress",value:function(e){return F.a.deflate(e)}},{key:"uncompress",value:function(e){var t=null;try{t=F.a.inflate(e)}catch(e){d.e("Message","Uncompress error: "+e)}return t}}],(n=[{key:"setPayload",value:function(e){this.payload=e}},{key:"setContext",value:function(e){this.context=e}},{key:"getPayload",value:function(){return this.payload}},{key:"getContext",value:function(){return this.context}},{key:"verifyCompression",value:function(){return 120==this.payload[0]&&-100==this.payload[1]||120==this.payload[0]&&156==this.payload[1]?this.compressible=!0:this.compressible=!1,this.compressible}},{key:"needCompressible",value:function(){return this.payload.length>=e.CompressionThreshold}}])&&Z(t.prototype,n),r&&Z(t,r),e}();function G(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}U.DefaultHead=[32,19,9,8],U.DefaultTail=[25,120,16,4],U.CompressionThreshold=1024;var K=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"initializer",value:function(){}},{key:"sessionCreated",value:function(e){}},{key:"sessionDestroyed",value:function(e){}},{key:"sessionOpened",value:function(e){}},{key:"sessionClosed",value:function(e){}},{key:"messageReceived",value:function(e,t){}},{key:"messageSent",value:function(e,t){}},{key:"errorOccurred",value:function(e,t){}}])&&G(t.prototype,n),r&&G(t,r),e}();function J(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var W=200,Q=201,Y=202,q=203,$=300,X=301,ee=401,te=402,ne=403,re=404,ie=405;function ae(e){return(ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function se(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function oe(e,t){return(oe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function le(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ce(e);if(t){var i=ce(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ue(this,n)}}function ue(e,t){return!t||"object"!==ae(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ce(e){return(ce=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var he=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&oe(e,t)}(a,e);var t,n,r,i=le(a);function a(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this)).writeLimit=32768,e.address=null,e.connectTimeout=1e4,e.connectTimer=0,e.socket=null,e.session=null,e.closed=!0,e.messages=null,e.secure=window.location.protocol.toLowerCase().indexOf("https")>=0,e.receivedBuf=[],e}return t=a,(n=[{key:"getAddress",value:function(){return this.address}},{key:"connect",value:function(e){if(null!=this.socket&&this.socket.readyState==WebSocket.OPEN)return d.w("MessageConnector","Connector has connected to "+e.toString()),!1;if(!this.closed&&null!=this.socket){try{this.socket.close(1e3,"close")}catch(e){}this.destroySocketEvent(),this.socket=null,this.closed=!0}this.connectTimer>0&&(clearTimeout(this.connectTimer),this.connectTimer=0),this.messages=[],this.address=e;var t=this;return this.session=new M(this.address),t.fireSessionCreated(),this.connectTimer=setTimeout((function(){t.fireErrorOccurred(X)}),this.connectTimeout),this.socket=this.createSocket(this.address.getHost(),this.address.getPort()),null!=this.socket||(new T((function(){t.fireSessionDestroyed(),t.connectTimer>0&&(clearTimeout(t.connectTimer),t.connectTimer=0)})).start(),!1)}},{key:"disconnect",value:function(){if(this.connectTimer>0&&(clearTimeout(this.connectTimer),this.connectTimer=0),null!=this.socket)try{this.socket.close(1e3,"disconnect")}catch(e){d.e("MessageConnector","Close socket has exception.")}else this.fireSessionDestroyed();this.destroySocketEvent(),this.socket=null}},{key:"destroySocketEvent",value:function(){null!=this.socket&&(this.socket.onopen=function(e){},this.socket.onclose=function(e){},this.socket.onmessage=function(e){},this.socket.onerror=function(e){})}},{key:"createSocket",value:function(e,t){var n=this;if(void 0===window.WebSocket)return null;var r=null;try{r=this.secure?void 0!==t?new WebSocket("wss://"+e+":"+t+"/cell/","cell"):new WebSocket("wss://"+e+"/cell/","cell"):void 0!==t?new WebSocket("ws://"+e+":"+t+"/cell/","cell"):new WebSocket("ws://"+e+"/cell/","cell")}catch(e){this.fireErrorOccurred(W),console.log("WebSocket: "+e)}return null==r?null:(r.binaryType="arraybuffer",r.onopen=function(e){n.fireSessionOpened(e)},r.onclose=function(e){n.fireSessionClosed(e)},r.onmessage=function(e){n.receive(e)},r.onerror=function(e){n.fireErrorOccurred(W,e)},r)}},{key:"setConnectTimeout",value:function(e){this.connectTimeout=e}},{key:"getConnectTimeout",value:function(){return this.connectTimeout}},{key:"getSession",value:function(){return this.session}},{key:"write",value:function(e){null!=e&&void 0!==e?(this.messages.push(e),this._send()):this.fireErrorOccurred(ne)}},{key:"_send",value:function(){if(!this.closed)try{if(this.messages.length>0){var e=this.messages.shift();if(null==e)return;for(var t=e.payload,n=this.session.secretKey,r=U.pack(t,n),i=new Array,a=0;a<r.length;++a)i.push(r[a]);Array.prototype.push.apply(i,U.DefaultTail);var s=new Uint8Array(i);if(this.socket.send(s),null!=this.handler&&this.handler.messageSent(this.session,e),this.messages.length>0){var o=this;new T((function(){o._send()})).delay(10)}}}catch(e){d.log("MessageConnector",e,c.WARNING)}}},{key:"receive",value:function(e){if("string"==typeof e.data)d.w("MessageConnector","Not supported string type");else if(this.receivedBuf=this.receivedBuf.concat(Array.from(new Uint8Array(e.data))),this.receivedBuf.length>4){var t=this.receivedBuf.length-1;if(this.receivedBuf[t-3]==U.DefaultTail[0]&&this.receivedBuf[t-2]==U.DefaultTail[1]&&this.receivedBuf[t-1]==U.DefaultTail[2]&&this.receivedBuf[t]==U.DefaultTail[3]){var n=this.receivedBuf.slice(0,this.receivedBuf.length-4);this.process(U.unpack(n,this.session.secretKey)),this.receivedBuf.length=0,this.receivedBuf=[]}}}},{key:"process",value:function(e){null!=this.handler&&this.handler.messageReceived(this.session,new U(e))}},{key:"fireSessionCreated",value:function(){null!=this.handler&&this.handler.sessionCreated(this.session)}},{key:"fireSessionOpened",value:function(e){this.closed=!1,this.connectTimer>0&&(clearTimeout(this.connectTimer),this.connectTimer=0),null!=this.handler&&this.handler.sessionOpened(this.session)}},{key:"fireSessionClosed",value:function(e){this.connectTimer>0&&(clearTimeout(this.connectTimer),this.connectTimer=0),this.closed||(this.closed=!0,null!=this.handler&&this.handler.sessionClosed(this.session),this.fireSessionDestroyed(this.session)),this.destroySocketEvent()}},{key:"fireSessionDestroyed",value:function(){null!=this.session&&null!=this.handler&&this.handler.sessionDestroyed(this.session),this.destroySocketEvent(),this.session=null,this.socket=null}},{key:"fireErrorOccurred",value:function(e,t){this.connectTimer>0&&(clearTimeout(this.connectTimer),this.connectTimer=0),null!=this.handler&&this.handler.errorOccurred(e,this.session),this.destroySocketEvent(),this.socket=null}}])&&se(t.prototype,n),r&&se(t,r),a}(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.handler=null}var t,n,r;return t=e,(n=[{key:"setHandler",value:function(e){this.handler=e}},{key:"getHandler",value:function(){return this.handler}}])&&J(t.prototype,n),r&&J(t,r),e}());var fe=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.session=t,this.tag=n,this.originateTimestamp=0,this.receiveTimestamp=0,this.transmitTimestamp=0,this.localTimestamp=0};function de(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var pe=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"initializer",value:function(){}},{key:"onSessionTimeout",value:function(e,t){}}])&&de(t.prototype,n),r&&de(t,r),e}(),ve={STRING:83,INT:73,LONG:76,FLOAT:102,DOUBLE:100,BOOL:66,JSON:74,BIN:78};function ye(e){return(ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ge(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var me=function(){function e(t,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),void 0!==t||void 0!==n)if(void 0!==n&&null!=n)switch(this.literal=n,n){case ve.STRING:this.value=l.stringToBytes(t);break;case ve.INT:this.value=l.intToBytes(t);break;case ve.LONG:this.value=l.longToBytes(t);break;case ve.JSON:this.value=l.stringToBytes(JSON.stringify(t));break;case ve.BOOL:this.value=l.boolToBytes(t);break;case ve.FLOAT:this.value=l.floatToBytes(t);break;case ve.DOUBLE:this.value=l.doubleToBytes(t);break;case ve.BIN:this.value=t}else{var r=ye(t);if("string"==r)this.value=l.stringToBytes(t),this.literal=ve.STRING;else if("object"==r)this.literal=ve.JSON,this.value=l.stringToBytes(JSON.stringify(t));else if("number"==r){/^-?\d+$/.test(t.toString())?t>=-2147483648&&t<=2147483647?(this.literal=ve.INT,this.value=l.intToBytes(t)):(this.literal=ve.LONG,this.value=l.longToBytes(t)):/^[-\+]?\d+(\.\d+)?$/.test(t.toString())?(this.literal=ve.DOUBLE,this.value=l.doubleToBytes(t)):(this.literal=ve.FLOAT,this.value=l.floatToBytes(t))}else"boolean"==r?(this.literal=ve.BOOL,this.value=l.boolToBytes(t)):(this.literal=ve.BIN,this.value=t)}}var t,n,r;return t=e,(n=[{key:"restore",value:function(e,t){this.value=e,this.literal=t}},{key:"getLiteralBase",value:function(){return this.literal}},{key:"getValue",value:function(){return this.value}},{key:"getLiteralValue",value:function(){return this.getValueAs(this.literal)}},{key:"getValueAs",value:function(e){switch(e){case ve.STRING:return this.getValueAsString();case ve.INT:return this.getValueAsInt();case ve.LONG:return this.getValueAsLong();case ve.JSON:return this.getValueAsJson();case ve.BOOL:return this.getValueAsBool();case ve.FLOAT:return this.getValueAsFloat();case ve.DOUBLE:return this.getValueAsDouble();case ve.BIN:return this.getValue();default:return this.value}}},{key:"getValueAsString",value:function(){return l.toString(this.value)}},{key:"getValueAsInt",value:function(){return l.toInt(this.value)}},{key:"getValueAsLong",value:function(){return l.toLong(this.value)}},{key:"getValueAsFloat",value:function(){return l.toFloat(this.value)}},{key:"getValueAsDouble",value:function(){return l.toDouble(this.value)}},{key:"getValueAsBool",value:function(){return l.toBool(this.value)}},{key:"getValueAsJson",value:function(){var e=l.toString(this.value);return JSON.parse(e)}},{key:"equals",value:function(t){if(null==t||!(t instanceof e))return!1;if(t.literal!=this.literal||t.value.length!=this.value.length)return!1;for(var n=0,r=t.value.length;n<r;++n)if(t.value[n]!=this.value[n])return!1;return!0}}])&&ge(t.prototype,n),r&&ge(t,r),e}();function _e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var be=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sn=void 0!==t?t:u.randomBytes(4),this.stuffList=[]}var t,n,r;return t=e,(n=[{key:"getSN",value:function(){return this.sn}},{key:"commit",value:function(e){return this.stuffList.push(e),this.stuffList.length-1}},{key:"setStuff",value:function(e,t){this.stuffList[e]=t}},{key:"getStuff",value:function(e){return this.stuffList[e]}},{key:"removeStuff",value:function(e){this.stuffList.splice(e,1)}},{key:"numStuff",value:function(){return this.stuffList.length}},{key:"equals",value:function(e){if(null==e||void 0===e)return!1;if(e.stuffList.length!=this.stuffList.length)return!1;if(e.sn.length!=this.sn.length)return!1;for(var t=0,n=this.sn.length;t<n;++t)if(e.sn[t]!=this.sn[t])return!1;return!0}},{key:"equalsSN",value:function(e){if(e.length!=this.sn.length)return!1;for(var t=0;t<e.length;++t)if(e[t]!=this.sn[t])return!1;return!0}},{key:"clone",value:function(){for(var t=new e(this.sn),n=0;n<this.stuffList.length;++n){var r=this.stuffList[n];switch(r.literal){case ve.STRING:t.commit(new me(r.getValueAsString(),r.literal));break;case ve.INT:t.commit(new me(r.getValueAsInt(),r.literal));break;case ve.LONG:t.commit(new me(r.getValueAsLong(),r.literal));break;case ve.FLOAT:t.commit(new me(r.getValueAsFloat(),r.literal));break;case ve.DOUBLE:t.commit(new me(r.getValueAsDouble(),r.literal));break;case ve.BOOL:t.commit(new me(r.getValueAsBool(),r.literal));break;case ve.JSON:t.commit(new me(r.getValueAsJson(),r.literal));break;case ve.BIN:default:t.commit(new me(r.getValue(),r.literal))}}return t}}])&&_e(t.prototype,n),r&&_e(t,r),e}(),ke={Handshake:[72,83],SpeakNoAck:[83,78],SpeakAck:[83,65],Stream:[83,84],StreamControl:[83,67],Ack:[65,67],Heartbeat:[72,66],HeartbeatAck:[72,65],Goodbye:[71,66],Version:1,Reserve:[17,36,17,36],SEPARATE_CHAR:30,ESCAPE_CHAR:92,sGlobalSN:0,recognize:function(e){if(e.length<10)return null;var t=parseInt(e[6]),n=parseInt(e[7]);return t==ke.SpeakNoAck[0]&&n==ke.SpeakNoAck[1]?ke.SpeakNoAck:t==ke.SpeakAck[0]&&n==ke.SpeakAck[1]?ke.SpeakAck:t==ke.Stream[0]&&n==ke.Stream[1]?ke.Stream:t==ke.StreamControl[0]&&n==ke.StreamControl[1]?ke.StreamControl:t==ke.Ack[0]&&n==ke.Ack[1]?ke.Ack:t==ke.Heartbeat[0]&&n==ke.Heartbeat[1]?ke.Heartbeat:t==ke.HeartbeatAck[0]&&n==ke.HeartbeatAck[1]?ke.HeartbeatAck:t==ke.Handshake[0]&&n==ke.Handshake[1]?ke.Handshake:null},serializeHandshake:function(e,t){var n=new Array;return n.push(ke.Version),n.push(ke.consumeSN()),Array.prototype.push.apply(n,ke.Reserve),Array.prototype.push.apply(n,ke.Handshake),Array.prototype.push.apply(n,e),n.push(ke.SEPARATE_CHAR),Array.prototype.push.apply(n,l.stringToBytes(t)),n},deserializeHandshake:function(e){for(var t={key:null,tag:null},n=new Array,r=0,i=8;i<e.length;++i){do{var a=e[i];if(a==ke.SEPARATE_CHAR)break;n.push(String.fromCharCode(a)),++i}while(i<e.length);0==r?(t.key=new Array,Array.prototype.push.apply(t.key,n)):1==r&&(t.tag=n.join("")),n.splice(0,n.length),++r}return t},serializeSpeak:function(e,t,n){var r=new Array;r.push(ke.Version),r.push(ke.consumeSN()),Array.prototype.push.apply(r,t.getSN()),n?Array.prototype.push.apply(r,ke.SpeakAck):Array.prototype.push.apply(r,ke.SpeakNoAck),Array.prototype.push.apply(r,l.stringToBytes(e)),r.push(ke.SEPARATE_CHAR);for(var i=0,a=t.stuffList;i<a.length;++i){r.push(a[i].literal);for(var s=0,o=a[i].value;s<o.length;++s)(o[s]==ke.SEPARATE_CHAR||o[s]==ke.ESCAPE_CHAR)&&r.push(ke.ESCAPE_CHAR),r.push(o[s]);r.push(ke.SEPARATE_CHAR)}return r},deserializeSpeak:function(e){if(e.length<10)return null;for(var t=ke.recognize(e),n=e.slice(2,6),r={target:null,primitive:null,ack:t==ke.SpeakAck},i=new Array,a=8;a<e.length;++a){var s=e[a];if(s==ke.SEPARATE_CHAR)break;i.push(String.fromCharCode(s))}r.target=i.join("");for(var o=8+i.length+1,l=new be(n),u=o;u<e.length;++u){var c=e[u],h=[];for(++u;u<e.length;){var f=e[u];if(f!=ke.ESCAPE_CHAR){if(f==ke.SEPARATE_CHAR)break;h.push(f),++u}else f=e[++u],h.push(f),++u}var d=new me;d.restore(h,c),l.commit(d)}return r.primitive=l,r},serializeAck:function(e,t){var n=new Array;return n.push(ke.Version),n.push(ke.consumeSN()),Array.prototype.push.apply(n,t.getSN()),Array.prototype.push.apply(n,ke.Ack),Array.prototype.push.apply(n,l.stringToBytes(e)),n},deserializeAck:function(e){if(e.length<8)return null;var t={target:null,sn:null};return t.sn=e.slice(2,6),t.target=l.toString(e.slice(8,e.length)),t},serializeHeartbeat:function(e,t){var n=new Array;return n.push(ke.Version),n.push(ke.consumeSN()),Array.prototype.push.apply(n,ke.Reserve),Array.prototype.push.apply(n,ke.Heartbeat),Array.prototype.push.apply(n,l.toBytes(e)),n.push(ke.SEPARATE_CHAR),Array.prototype.push.apply(n,l.longToBytes(t)),n},deserializeHeartbeat:function(e){for(var t={tag:null,originateTimestamp:0,receiveTimestamp:0,transmitTimestamp:0},n=0,r=8;r<e.length;++r){var i=new Array;do{var a=e[r];if(a==ke.SEPARATE_CHAR)break;a==ke.ESCAPE_CHAR&&(a=e[r+=1]),i.push(a),++r}while(r<e.length);0==n?t.tag=l.toString(i):1==n&&(t.originateTimestamp=l.toLong(i)),i.splice(0,i.length),++n}return t},serializeHeartbeatAck:function(e,t,n,r){var i=new Array;return i.push(ke.Version),i.push(ke.consumeSN()),Array.prototype.push.apply(i,ke.Reserve),Array.prototype.push.apply(i,ke.HeartbeatAck),Array.prototype.push.apply(i,l.toBytes(e)),i.push(ke.SEPARATE_CHAR),Array.prototype.push.apply(i,ke.escape(l.longToBytes(t))),i.push(ke.SEPARATE_CHAR),Array.prototype.push.apply(i,ke.escape(l.longToBytes(n))),i.push(ke.SEPARATE_CHAR),Array.prototype.push.apply(i,ke.escape(l.longToBytes(r))),i},deserializeHeartbeatAck:function(e){for(var t={tag:null,originateTimestamp:0,receiveTimestamp:0,transmitTimestamp:0},n=0,r=8;r<e.length;++r){var i=new Array;do{var a=e[r];if(a==ke.SEPARATE_CHAR)break;a==ke.ESCAPE_CHAR&&(a=e[r+=1]),i.push(a),++r}while(r<e.length);if(0==n)t.tag=l.toString(i);else if(1==n){var s=i.slice(0,8);t.originateTimestamp=l.toLong(s)}else if(2==n){var o=i.slice(0,8);t.receiveTimestamp=l.toLong(o)}else if(3==n){var u=i.slice(0,8);t.transmitTimestamp=l.toLong(u)}i.splice(0,i.length),++n}return t},serializeGoodbye:function(){var e=new Array;return e.push(ke.Version),e.push(ke.consumeSN()),Array.prototype.push.apply(e,ke.Reserve),Array.prototype.push.apply(e,ke.Goodbye),e},consumeSN:function(){var e=ke.sGlobalSN;return ke.sGlobalSN+=1,ke.sGlobalSN>127&&(ke.sGlobalSN=0),e},escape:function(e){for(var t=0,n=0;n<e.length;++n)++t,e[n]!=ke.SEPARATE_CHAR&&e[n]!=ke.ESCAPE_CHAR||++t;if(t==e.length)return e;for(var r=new Array(t),i=0,a=0;i<e.length;++i,++a){var s=e[i];(s==ke.SEPARATE_CHAR||s==ke.ESCAPE_CHAR)&&(r[a]=ke.ESCAPE_CHAR,++a),r[a]=s}return r}};function we(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Se=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.connector=t,this.hbInterval=45e3,this.hbDuration=1e4,this.daemon=0,this.contextMap=new i,this.listener=null}var t,n,r;return t=e,(n=[{key:"startup",value:function(){if(0==this.daemon){var e=this;this.daemon=setInterval((function(){e._daemon()}),this.hbInterval)}}},{key:"shutdown",value:function(){0!=this.daemon&&(clearInterval(this.daemon),this.daemon=0)}},{key:"setHeartbeatInterval",value:function(e){this.hbInterval!=e&&(this.hbInterval=e,this.shutdown(),this.startup())}},{key:"setListener",value:function(e){this.listener=e}},{key:"addSession",value:function(e,t){this.contextMap.containsKey(e.getId())||this.contextMap.put(e.getId(),new fe(e,t))}},{key:"removeSession",value:function(e){this.contextMap.remove(e.getId())}},{key:"getContext",value:function(e){return this.contextMap.get(e.getId())}},{key:"processHeartbeat",value:function(e,t,n){if(d.isDebugLevel()&&d.d("HM","Heartbeat from "+e.address.toString()),null!=this.contextMap.get(e.getId())){var r=ke.deserializeHeartbeat(t),i=ke.serializeHeartbeatAck(r.tag,r.originateTimestamp,n,Date.now()),a=new U(i);this.connector.write(a)}else d.w("HM","No context: "+e.toString())}},{key:"processHeartbeatAck",value:function(e,t){var n=this.contextMap.get(e.getId());if(null!=n){var r=ke.deserializeHeartbeatAck(t);r.originateTimestamp==n.originateTimestamp?d.d("HM","Received ack: "+e.toString()):d.d("HM","Can not find context : "+e.toString()),n.receiveTimestamp=r.receiveTimestamp,n.transmitTimestamp=r.transmitTimestamp,n.localTimestamp=Date.now()}else d.e("HM","Can not find session : "+e.toString())}},{key:"_daemon",value:function(){var e=Date.now(),t=this.contextMap.values();d.isDebugLevel()&&d.d("HM","Heartbeat ("+t.length+")");for(var n=0;n<t.length;++n){var r=t[n],i=r.localTimestamp-r.originateTimestamp;i>this.hbDuration&&this.listener.onSessionTimeout(r.session,i),r.originateTimestamp=e;var a=ke.serializeHeartbeat(r.tag.toString(),e),s=new U(a);this.connector.write(s)}}}])&&we(t.prototype,n),r&&we(t,r),e}();function Ae(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Te=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.session=t,this.data=new i}var t,n,r;return t=e,(n=[{key:"addPrimitive",value:function(e,t){var n=this.data.get(e);null==n?this.data.put(e,[t]):this.data.put(e,n.push(t))}},{key:"removePrimitive",value:function(e,t){var n=null,r=this.data.get(e);if(null!=r)for(var i=0;i<r.length;++i){var a=r[i];if(a.equalsSN(t)){n=a,r.splice(i,1);break}}return n}},{key:"clean",value:function(){this.data.clear()}}])&&Ae(t.prototype,n),r&&Ae(t,r),e}();function Ee(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var xe=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.errorCode=t,this.description="Network error"}var t,n,r;return t=e,r=[{key:"transformError",value:function(t){var n=new e(1e3);switch(t){case $:case X:n.errorCode=e.NetworkConnectError,n.description="Network connection error";break;case W:case Q:case Y:case q:n.errorCode=e.NetworkSocketError,n.description="Socket error";break;case ee:case te:case ne:case re:case ie:n.errorCode=e.NetworkIOError,n.description="Socket I/O error"}return n}}],(n=[{key:"getErrorCode",value:function(){return this.errorCode}},{key:"getDescription",value:function(){return this.description}}])&&Ee(t.prototype,n),r&&Ee(t,r),e}();xe.NetworkError=1e3,xe.NetworkConnectError=1010,xe.NetworkSocketError=1020,xe.NetworkIOError=1030,xe.HeartbeatTimeout=1040,xe.HandshakeError=2e3,xe.HandshakeTimeout=2001;var Oe=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.target=t,this.primitive=n};function Ce(e){return(Ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Re(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Be(e,t){return(Be=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Le(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Ne(e);if(t){var i=Ne(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ze(this,n)}}function ze(e,t){return!t||"object"!==Ce(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ne(e){return(Ne=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Pe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Be(e,t)}(a,e);var t,n,r,i=Le(a);function a(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(r=i.call(this)).tag=e,r.address=t,r.listener=n,r.serverTag=null,r.state=b,r.connector=null,r.session=null,r.secretKey=null,r.primitiveCapsule=null,r.reconnectTimer=0,r.reconnectEnabled=!0,r.handshakeTimer=0,r.handshakeTimeout=1e4,r.hm=null,r}return t=a,(n=[{key:"start",value:function(){if(null==this.address)return!1;if(this.state==k||this.state==w)return!0;if(this.state=k,this.reconnectTimer>0&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=0),this.connector=new he,this.connector.setHandler(this),this.hm=new Se(this.connector),this.hm.setListener(this),!this.connector.connect(this.address)){this.state=b,this.connector.setHandler(null),this.connector=null,this.hm.shutdown(),this.hm.setListener(null),this.hm=null;var e=this;this.reconnectTimer=setTimeout((function(){d.i("Speaker","Restart speaker: "+e.address.toString()),e.stop(),e.reconnectEnabled=!0,e.start()}),5e3)}return this.reconnectEnabled=!0,!0}},{key:"stop",value:function(){S!=this.state&&b!=this.state&&(d.i("Speaker","Stop speaker "+this.address.toString()),this.reconnectEnabled=!1,this.state=S,this.reconnectTimer>0&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=0),null!=this.connector&&this.connector.disconnect(),null!=this.hm&&(this.hm.shutdown(),this.hm.setListener(null),this.hm=null),this.handshakeTimer>0&&(clearTimeout(this.handshakeTimer),this.handshakeTimer=0),this.state=b)}},{key:"speak",value:function(e,t,n){if(this.state!=w)return!1;void 0===n&&(n=!1),n&&this.primitiveCapsule.addPrimitive(e,t);var r=ke.serializeSpeak(e,t,n),i=new U(r);return i.setContext(new Oe(e,t)),this.connector.write(i),!0}},{key:"sessionCreated",value:function(e){d.d("Speaker","sessionCreated"),this.session=e,this.primitiveCapsule=new Te(e)}},{key:"sessionDestroyed",value:function(e){if(d.d("Speaker","sessionDestroyed"),null!=this.connector&&this.stop(),null!=this.primitiveCapsule&&(this.primitiveCapsule.clean(),this.primitiveCapsule=null),null!=this.hm&&(this.hm.removeSession(e),this.hm.shutdown(),this.hm=null),this.reconnectEnabled){var t=this;this.reconnectTimer=setTimeout((function(){d.i("Speaker","Reconnect "+t.address.toString()),t.stop(),t.reconnectEnabled=!0,t.start()}),5e3)}}},{key:"sessionOpened",value:function(e){d.d("Speaker","sessionOpened"),this.state=k,this.hm.addSession(e,this.tag.toString()),this.secretKey=null;var t=this;new T((function(){t.handshake()})).start()}},{key:"sessionClosed",value:function(e){d.d("Speaker","sessionClosed"),this.state=b,null!=this.hm&&(this.hm.shutdown(),this.hm.removeSession(e),this.hm.setListener(null),this.hm=null),this.handshakeTimer>0&&(clearTimeout(this.handshakeTimer),this.handshakeTimer=0),this.listener.onQuitted(this)}},{key:"messageReceived",value:function(e,t){var n=this;if(e&&t){var r=ke.recognize(t.payload);ke.SpeakNoAck==r?n.processSpeak(e,t,!1):ke.SpeakAck==r?n.processSpeak(e,t,!0):ke.Ack==r?n.processAck(e,t):ke.Heartbeat==r?n.processHeartHeat(e,t):ke.HeartbeatAck==r?n.processHeartHeatAck(e,t):ke.Handshake==r?new T((function(){n.processHandshake(e,t)})).start():d.w("Speaker","Unknown protocol")}}},{key:"messageSent",value:function(e,t){var n=ke.recognize(t.getPayload());if(ke.SpeakNoAck==n||ke.SpeakAck==n){var r=t.getContext();this.listener.onSpoke(this,r.target,r.primitive)}else ke.Handshake==n&&this.session.setSecretKey(this.secretKey)}},{key:"errorOccurred",value:function(e,t){this.reconnectTimer>0&&clearTimeout(this.reconnectTimer);var n=this;this.reconnectTimer=setTimeout((function(){d.i("Speaker","Reconnect "+n.address.toString()),n.stop(),n.reconnectEnabled=!0,n.start()}),e==W?5e3:3e3);var r=xe.transformError(e);this.listener.onFailed(this,r)}},{key:"onSessionTimeout",value:function(e,t){var n=new xe(xe.HeartbeatTimeout);this.listener.onFailed(this,n)}},{key:"handshake",value:function(){d.isDebugLevel()&&d.d("Speaker","Handshake : "+this.address.toString()),this.handshakeTimer>0&&clearTimeout(this.handshakeTimer);var e=this;this.handshakeTimer=setTimeout((function(){var t=new xe(xe.HandshakeTimeout);e.listener.onFailed(e,t),clearTimeout(e.handshakeTimer),e.handshakeTimer=0,e.stop()}),this.handshakeTimeout),this.secretKey=u.toCharCode(u.randomString(8));var t=ke.serializeHandshake(this.secretKey,this.tag.asString()),n=new U(t);try{this.connector.write(n)}catch(e){d.e("Speaker","Handshake failed: "+e)}}},{key:"processHandshake",value:function(e,t){var n=ke.deserializeHandshake(t.payload);if(null!=n.key&&null!=n.tag){if(d.isDebugLevel()&&d.d("Speaker","Handshake Success"),this.handshakeTimer>0&&(clearTimeout(this.handshakeTimer),this.handshakeTimer=0),this.state==b)return;this.hm.startup(),this.serverTag=n.tag.toString(),this.state=w,this.listener.onContacted(this)}else{this.stop();var r=new xe(xe.HandshakeError);this.listener.onFailed(this,r)}}},{key:"processHeartHeat",value:function(e,t){this.hm.processHeartbeat(e,t.payload,Date.now())}},{key:"processHeartHeatAck",value:function(e,t){this.hm.processHeartbeatAck(e,t.payload)}},{key:"processSpeak",value:function(e,t,n){if(this.state==w){var r=ke.deserializeSpeak(t.payload);null!=r.target&&null!=r.primitive&&(n&&this.ack(r.target,r.primitive),this.listener.onListened(this,r.target,r.primitive))}}},{key:"processAck",value:function(e,t){var n=ke.deserializeAck(t.payload),r=this.primitiveCapsule.removePrimitive(n.target,n.sn);null!=n&&this.listener.onAck(this,n.target,r)}},{key:"ack",value:function(e,t){if(this.state!=w)return!1;if(null!=this.connector){var n=ke.serializeAck(e,t),r=new U(n);this.connector.write(r)}return!0}}])&&Re(t.prototype,n),r&&Re(t,r),a}(function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=function(e){O(r,e);var t=R(r);function r(){var e;x(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return e=t.call.apply(t,[this].concat(a)),n.forEach((function(t){t.prototype.initializer.call(L(e))})),e}return r}(e),a=function(e,t){Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t)).forEach((function(n){n.match(/^(?:constructor|prototype|arguments|caller|name|bind|call|apply|toString|length)$/)||Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))};return n.forEach((function(e){a(i.prototype,e.prototype),a(i,e)})),i}(K,pe));function He(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var je=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"ctor",value:function(){}},{key:"initializer",value:function(){}},{key:"onListened",value:function(e,t,n){}},{key:"onSpoke",value:function(e,t,n){}},{key:"onAck",value:function(e,t,n){}},{key:"onSpeakTimeout",value:function(e,t,n){}},{key:"onContacted",value:function(e){}},{key:"onQuitted",value:function(e){}},{key:"onFailed",value:function(e,t){}}])&&He(t.prototype,n),r&&He(t,r),e}();function Ie(e){return(Ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function De(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Me(e,t){return(Me=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ve(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Ze(e);if(t){var i=Ze(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Fe(this,n)}}function Fe(e,t){return!t||"object"!==Ie(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ze(e){return(Ze=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ue=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Me(e,t)}(a,e);var t,n,r,i=Ve(a);function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this)).service=e,t}return t=a,(n=[{key:"onListened",value:function(e,t,n){if(null!=this.service.allEventListeners)for(var r=0,i=this.service.allEventListeners.length;r<i;++r)this.service.allEventListeners[r].onListened(e,t,n);if(null!=this.service.listeners){var a=this.service.listeners.get(t);null!=a&&a.onListened(e,t,n)}null!=this.service.eventListeners&&this.triggerEvent("onListened",{speaker:e,cellet:t,primitive:n})}},{key:"onSpoke",value:function(e,t,n){if(null!=this.service.allEventListeners)for(var r=0,i=this.service.allEventListeners.length;r<i;++r)this.service.allEventListeners[r].onSpoke(e,t,n);if(null!=this.service.listeners){var a=this.service.listeners.get(t);null!=a&&a.onSpoke(e,t,n)}null!=this.service.eventListeners&&this.triggerEvent("onSpoke",{speaker:e,cellet:t,primitive:n})}},{key:"onAck",value:function(e,t,n){if(null!=this.service.allEventListeners)for(var r=0,i=this.service.allEventListeners.length;r<i;++r)this.service.allEventListeners[r].onAck(e,t,n);if(null!=this.service.listeners){var a=this.service.listeners.get(t);null!=a&&a.onAck(e,t,n)}null!=this.service.eventListeners&&this.triggerEvent("onAck",{speaker:e,cellet:t,primitive:n})}},{key:"onSpeakTimeout",value:function(e,t,n){if(null!=this.service.allEventListeners)for(var r=0,i=this.service.allEventListeners.length;r<i;++r)this.service.allEventListeners[r].onSpeakTimeout(e,t,n);if(null!=this.service.listeners){var a=this.service.listeners.get(t);null!=a&&a.onSpeakTimeout(e,t,n)}null!=this.service.eventListeners&&this.triggerEvent("onSpeakTimeout",{speaker:e,cellet:t,primitive:n})}},{key:"onContacted",value:function(e){if(null!=this.service.eventListeners&&this.triggerEvent("onContacted",{speaker:e}),null!=this.service.allEventListeners)for(var t=0,n=this.service.allEventListeners.length;t<n;++t)this.service.allEventListeners[t].onContacted(e);if(null!=this.service.listeners)for(var r=this.service.listeners.keySet(),i=0;i<r.length;++i){var a=r[i],s=this.service.listeners.get(a),o=this.service.celletSpeakerMap.get(a);null!=o?o==e&&s.onContacted(e):s.onContacted(e)}}},{key:"onQuitted",value:function(e){if(null!=this.service.eventListeners&&this.triggerEvent("onQuitted",{speaker:e}),null!=this.service.allEventListeners)for(var t=0,n=this.service.allEventListeners.length;t<n;++t)this.service.allEventListeners[t].onQuitted(e);if(null!=this.service.listeners)for(var r=this.service.listeners.keySet(),i=0;i<r.length;++i){var a=r[i],s=this.service.listeners.get(a),o=this.service.celletSpeakerMap.get(a);null!=o?o==e&&s.onQuitted(e):s.onQuitted(e)}}},{key:"onFailed",value:function(e,t){if(null!=this.service.allEventListeners)for(var n=0,r=this.service.allEventListeners.length;n<r;++n)this.service.allEventListeners[n].onFailed(e,t);if(null!=this.service.listeners)for(var i=this.service.listeners.values(),a=0;a<i.length;++a)i[a].onFailed(e,t);null!=this.service.eventListeners&&this.triggerEvent("onFailed",{speaker:e,error:t})}},{key:"triggerEvent",value:function(e,t){var n=this.service.eventListeners.get(e);if(null!=n)for(var r=0;r<n.length;++r)n[r].call(null,t);if(null!=(n=this.service.eventListeners.get("*")))for(var i=0;i<n.length;++i)n[i].call(null,t)}}])&&De(t.prototype,n),r&&De(t,r),a}(je);function Ge(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ke=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tag=t,this.config=n,this.speakers=new i,this.celletSpeakerMap=new i,this.listenerProxy=new Ue(this),this.listeners=null,this.eventListeners=null,this.allEventListeners=null}var t,n,r;return t=e,(n=[{key:"hangupAll",value:function(){for(var e=this.speakers.values(),t=0;t<e.length;++t)e[t].stop();new Thread((function(){this.speakers.clear(),this.celletSpeakerMap.clear()}),this).delay(10)}},{key:"isWebSocketSupported",value:function(){return void 0!==window.WebSocket}},{key:"isCalled",value:function(e){if(void 0!==e){var t=this.celletSpeakerMap.get(e);return null!=t&&t.state==w}var n=this.speakers.values();return 0!=n.length&&n[0].state==w}},{key:"call",value:function(e,t){if(!this.isWebSocketSupported())return d.i("Brower",window.navigator.userAgent),d.e("TalkService","This brower can NOT support WebSocket"),null;var n=e.toString(),r=this.speakers.get(n);if(null==r&&(r=new Pe(this.tag,e,this.listenerProxy),this.speakers.put(n,r)),!r.start())return this.speakers.remove(n),null;if(void 0!==t)for(var i=0;i<t.length;++i)this.celletSpeakerMap.put(t[i],r);return r}},{key:"hangup",value:function(e){var t=e.toString(),n=this.speakers.get(t);if(null!=n){n.stop();for(var r=this.celletSpeakerMap.keySet(),i=0;i<r.length;++i){var a=r[i];this.celletSpeakerMap.get(a)==n&&this.celletSpeakerMap.remove(a)}}}},{key:"speak",value:function(e,t,n){var r=this.celletSpeakerMap.get(e);if(null==r){var i=this.speakers.values();if(0==i.length)return!1;r=i[0],this.celletSpeakerMap.put(e,r)}return r.speak(e,t,n)}},{key:"setListener",value:function(e,t){null==this.listeners&&(this.listeners=new i),null==t?this.listeners.remove(e):this.listeners.put(e,t)}},{key:"addListener",value:function(e,t){if("string"==typeof e){null==this.eventListeners&&(this.eventListeners=new i);var n=this.eventListeners.get(e);null==n?(n=[t],this.eventListeners.put(e,n)):n.push(t)}else null==this.allEventListeners?this.allEventListeners=[e]:this.allEventListeners.indexOf(e)<0&&this.allEventListeners.push(e)}},{key:"removeListener",value:function(e,t){if("string"==typeof e){if(null!=this.listeners&&this.listeners.remove(e),null==this.eventListeners)return;var n=this.eventListeners.get(e);if(null!=n){var r=n.indexOf(t);r>=0&&(n.splice(r,1),0==n.length&&this.eventListeners.remove(e))}}else if(null!=this.allEventListeners){var i=this.allEventListeners.indexOf(e);i>=0&&this.allEventListeners.splice(i,1)}}}])&&Ge(t.prototype,n),r&&Ge(t,r),e}();function Je(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var We=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=void 0===t?new _:t,this.version=new v,this.tag=new m,this.talkService=new Ke(this.tag,t),this.talk=this.talkService,d.i("Nucleus","Cell "+this.version.getNumbers()+" (Build JavaScript/Web - "+this.version.NAME+")")}var t,n,r;return t=e,(n=[{key:"destroy",value:function(){null!=this.talkService&&(this.talkService.hangupAll(),this.talkService=null,this.talk=null),this.config=null,this.version=null,this.tag=null}},{key:"getTag",value:function(){return this.tag}},{key:"getTalkService",value:function(){return this.talkService}}])&&Je(t.prototype,n),r&&Je(t,r),e}();function Qe(e){return(Qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ye(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function qe(e,t){return(qe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function $e(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=et(e);if(t){var i=et(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Xe(this,n)}}function Xe(e,t){return!t||"object"!==Qe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function et(e){return(et=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var tt={ByteUtils:l,Utils:u,Logger:d,LogLevel:c,LogHandler:f,Version:v,FastMap:i,InetAddress:s,Nucleus:We,NucleusConfig:_,NucleusTag:m,TalkService:Ke,TalkListener:je,Speaker:Pe,Primitive:be,ActionDialect:function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&qe(e,t)}(a,e);var t,n,r,i=$e(a);function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),t=i.call(this),"string"==typeof e?t.stuffList.push(new me(e.toString(),ve.STRING)):(t.sn=e.sn,t.stuffList=e.stuffList),t}return t=a,(n=[{key:"setName",value:function(e){this.stuffList[0]=new me(e,ve.STRING)}},{key:"getName",value:function(){return this.stuffList[0].getValueAsString()}},{key:"numParams",value:function(){return parseInt((this.stuffList.length-1)/2)}},{key:"containsParam",value:function(e){for(var t=1,n=this.stuffList.length;t<n;t+=2)if(this.stuffList[t].getValueAsString()==e)return!0;return!1}},{key:"addParam",value:function(e,t,n){var r=this.keyIndex(e);r>0?this.stuffList[r+1]=new me(t,n):(this.stuffList.push(new me(e,ve.STRING)),this.stuffList.push(new me(t,n)))}},{key:"getParam",value:function(e){var t=this.getValueStuff(e);return null==t?null:t.getLiteralValue()}},{key:"getParamAsString",value:function(e){var t=this.getValueStuff(e);return null==t?null:t.getValueAsString()}},{key:"getParamAsInt",value:function(e){var t=this.getValueStuff(e);return null==t?null:t.getValueAsInt()}},{key:"getParamAsLong",value:function(e){var t=this.getValueStuff(e);return null==t?null:t.getValueAsLong()}},{key:"getParamAsFloat",value:function(e){var t=this.getValueStuff(e);return null==t?null:t.getValueAsFloat()}},{key:"getParamAsDouble",value:function(e){var t=this.getValueStuff(e);return null==t?null:t.getValueAsDouble()}},{key:"getParamAsBool",value:function(e){var t=this.getValueStuff(e);return null==t?null:t.getValueAsBool()}},{key:"getParamAsJson",value:function(e){var t=this.getValueStuff(e);return null==t?null:t.getValueAsJson()}},{key:"getValueStuff",value:function(e){for(var t=1,n=this.stuffList.length;t<n;t+=2)if(this.stuffList[t].getValueAsString()==e)return this.stuffList[t+1];return null}},{key:"keyIndex",value:function(e){for(var t=1,n=this.stuffList.length;t<n;t+=2)if(this.stuffList[t].getValueAsString()==e)return t;return-1}}])&&Ye(t.prototype,n),r&&Ye(t,r),a}(be),LiteralBase:ve,TalkError:xe};t.default=tt}])}));
//# sourceMappingURL=cell-lib.js.map