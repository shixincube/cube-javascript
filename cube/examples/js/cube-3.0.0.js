!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=132)}([function(e,t,n){var r=n(3),i=n(19),o=n(12),a=n(13),u=n(20),s=function(e,t,n){var c,l,f,h,p=e&s.F,d=e&s.G,v=e&s.S,y=e&s.P,g=e&s.B,m=d?r:v?r[t]||(r[t]={}):(r[t]||{}).prototype,b=d?i:i[t]||(i[t]={}),w=b.prototype||(b.prototype={});for(c in d&&(n=t),n)f=((l=!p&&m&&void 0!==m[c])?m:n)[c],h=g&&l?u(f,r):y&&"function"==typeof f?u(Function.call,f):f,m&&a(m,c,f,e&s.U),b[c]!=f&&o(b,c,h),y&&w[c]!=f&&(w[c]=f)};r.core=i,s.F=1,s.G=2,s.S=4,s.P=8,s.B=16,s.W=32,s.U=64,s.R=128,e.exports=s},function(e,t,n){(function(e){var n,r,i,o;function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}window,o=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==a(e)&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=16)}([function(e,t,n){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=a(n))throw new TypeError(n+"must be non-object");for(var r in n)i(n,r)&&(e[r]=n[r])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var o={arraySet:function(e,t,n,r,i){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+r),i);else for(var o=0;o<r;o++)e[i+o]=t[n+o]},flattenChunks:function(e){var t,n,r,i,o,a;for(r=0,t=0,n=e.length;t<n;t++)r+=e[t].length;for(a=new Uint8Array(r),i=0,t=0,n=e.length;t<n;t++)o=e[t],a.set(o,i),i+=o.length;return a}},u={arraySet:function(e,t,n,r,i){for(var o=0;o<r;o++)e[i+o]=t[n+o]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,o)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,u))},t.setTyped(r)},function(e,t,n){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t,n){"use strict";var r={};(0,n(0).assign)(r,n(8),n(11),n(7)),e.exports=r},function(e,t,n){"use strict";e.exports=function(e,t,n,r){for(var i=65535&e|0,o=e>>>16&65535|0,a=0;0!==n;){n-=a=n>2e3?2e3:n;do{o=o+(i=i+t[r++]|0)|0}while(--a);i%=65521,o%=65521}return i|o<<16|0}},function(e,t,n){"use strict";var r=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();e.exports=function(e,t,n,i){var o=r,a=i+n;e^=-1;for(var u=i;u<a;u++)e=e>>>8^o[255&(e^t[u])];return-1^e}},function(e,t,n){"use strict";var r=n(0),i=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(e){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){o=!1}for(var a=new r.Buf8(256),u=0;u<256;u++)a[u]=u>=252?6:u>=248?5:u>=240?4:u>=224?3:u>=192?2:1;function s(e,t){if(t<65534&&(e.subarray&&o||!e.subarray&&i))return String.fromCharCode.apply(null,r.shrinkBuf(e,t));for(var n="",a=0;a<t;a++)n+=String.fromCharCode(e[a]);return n}a[254]=a[254]=1,t.string2buf=function(e){var t,n,i,o,a,u=e.length,s=0;for(o=0;o<u;o++)55296==(64512&(n=e.charCodeAt(o)))&&o+1<u&&56320==(64512&(i=e.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),s+=n<128?1:n<2048?2:n<65536?3:4;for(t=new r.Buf8(s),a=0,o=0;a<s;o++)55296==(64512&(n=e.charCodeAt(o)))&&o+1<u&&56320==(64512&(i=e.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|63&n):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},t.buf2binstring=function(e){return s(e,e.length)},t.binstring2buf=function(e){for(var t=new r.Buf8(e.length),n=0,i=t.length;n<i;n++)t[n]=e.charCodeAt(n);return t},t.buf2string=function(e,t){var n,r,i,o,u=t||e.length,c=new Array(2*u);for(r=0,n=0;n<u;)if((i=e[n++])<128)c[r++]=i;else if((o=a[i])>4)c[r++]=65533,n+=o-1;else{for(i&=2===o?31:3===o?15:7;o>1&&n<u;)i=i<<6|63&e[n++],o--;o>1?c[r++]=65533:i<65536?c[r++]=i:(i-=65536,c[r++]=55296|i>>10&1023,c[r++]=56320|1023&i)}return s(c,r)},t.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+a[e[n]]>t?n:t}},function(e,t,n){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t,n){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t,n){"use strict";var r=n(9),i=n(0),o=n(5),a=n(1),u=n(6),s=Object.prototype.toString;function c(e){if(!(this instanceof c))return new c(e);this.options=i.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var n=r.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(0!==n)throw new Error(a[n]);if(t.header&&r.deflateSetHeader(this.strm,t.header),t.dictionary){var l;if(l="string"==typeof t.dictionary?o.string2buf(t.dictionary):"[object ArrayBuffer]"===s.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,0!==(n=r.deflateSetDictionary(this.strm,l)))throw new Error(a[n]);this._dict_set=!0}}function l(e,t){var n=new c(t);if(n.push(e,!0),n.err)throw n.msg||a[n.err];return n.result}c.prototype.push=function(e,t){var n,a,u=this.strm,c=this.options.chunkSize;if(this.ended)return!1;a=t===~~t?t:!0===t?4:0,"string"==typeof e?u.input=o.string2buf(e):"[object ArrayBuffer]"===s.call(e)?u.input=new Uint8Array(e):u.input=e,u.next_in=0,u.avail_in=u.input.length;do{if(0===u.avail_out&&(u.output=new i.Buf8(c),u.next_out=0,u.avail_out=c),1!==(n=r.deflate(u,a))&&0!==n)return this.onEnd(n),this.ended=!0,!1;0!==u.avail_out&&(0!==u.avail_in||4!==a&&2!==a)||("string"===this.options.to?this.onData(o.buf2binstring(i.shrinkBuf(u.output,u.next_out))):this.onData(i.shrinkBuf(u.output,u.next_out)))}while((u.avail_in>0||0===u.avail_out)&&1!==n);return 4===a?(n=r.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,0===n):2!==a||(this.onEnd(0),u.avail_out=0,!0)},c.prototype.onData=function(e){this.chunks.push(e)},c.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Deflate=c,t.deflate=l,t.deflateRaw=function(e,t){return(t=t||{}).raw=!0,l(e,t)},t.gzip=function(e,t){return(t=t||{}).gzip=!0,l(e,t)}},function(e,t,n){"use strict";var r,i=n(0),o=n(10),a=n(3),u=n(4),s=n(1);function c(e,t){return e.msg=s[t],t}function l(e){return(e<<1)-(e>4?9:0)}function f(e){for(var t=e.length;--t>=0;)e[t]=0}function h(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(i.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function p(e,t){o._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,h(e.strm)}function d(e,t){e.pending_buf[e.pending++]=t}function v(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function y(e,t){var n,r,i=e.max_chain_length,o=e.strstart,a=e.prev_length,u=e.nice_match,s=e.strstart>e.w_size-262?e.strstart-(e.w_size-262):0,c=e.window,l=e.w_mask,f=e.prev,h=e.strstart+258,p=c[o+a-1],d=c[o+a];e.prev_length>=e.good_match&&(i>>=2),u>e.lookahead&&(u=e.lookahead);do{if(c[(n=t)+a]===d&&c[n+a-1]===p&&c[n]===c[o]&&c[++n]===c[o+1]){o+=2,n++;do{}while(c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&o<h);if(r=258-(h-o),o=h-258,r>a){if(e.match_start=t,a=r,r>=u)break;p=c[o+a-1],d=c[o+a]}}}while((t=f[t&l])>s&&0!=--i);return a<=e.lookahead?a:e.lookahead}function g(e){var t,n,r,o,s,c,l,f,h,p,d=e.w_size;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=d+(d-262)){i.arraySet(e.window,e.window,d,d,0),e.match_start-=d,e.strstart-=d,e.block_start-=d,t=n=e.hash_size;do{r=e.head[--t],e.head[t]=r>=d?r-d:0}while(--n);t=n=d;do{r=e.prev[--t],e.prev[t]=r>=d?r-d:0}while(--n);o+=d}if(0===e.strm.avail_in)break;if(c=e.strm,l=e.window,f=e.strstart+e.lookahead,h=o,p=void 0,(p=c.avail_in)>h&&(p=h),n=0===p?0:(c.avail_in-=p,i.arraySet(l,c.input,c.next_in,p,f),1===c.state.wrap?c.adler=a(c.adler,l,p,f):2===c.state.wrap&&(c.adler=u(c.adler,l,p,f)),c.next_in+=p,c.total_in+=p,p),e.lookahead+=n,e.lookahead+e.insert>=3)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+3-1])&e.hash_mask,e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<262&&0!==e.strm.avail_in)}function m(e,t){for(var n,r;;){if(e.lookahead<262){if(g(e),e.lookahead<262&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-262&&(e.match_length=y(e,n)),e.match_length>=3)if(r=o._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(p(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(p(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(p(e,!1),0===e.strm.avail_out)?1:2}function b(e,t){for(var n,r,i;;){if(e.lookahead<262){if(g(e),e.lookahead<262&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-262&&(e.match_length=y(e,n),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=o._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(p(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((r=o._tr_tally(e,0,e.window[e.strstart-1]))&&p(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=o._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(p(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(p(e,!1),0===e.strm.avail_out)?1:2}function w(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}function k(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(1146),this.dyn_dtree=new i.Buf16(122),this.bl_tree=new i.Buf16(78),f(this.dyn_ltree),f(this.dyn_dtree),f(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(16),this.heap=new i.Buf16(573),f(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(573),f(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function S(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:113,e.adler=2===t.wrap?0:1,t.last_flush=0,o._tr_init(t),0):c(e,-2)}function _(e){var t,n=S(e);return 0===n&&((t=e.state).window_size=2*t.w_size,f(t.head),t.max_lazy_match=r[t.level].max_lazy,t.good_match=r[t.level].good_length,t.nice_match=r[t.level].nice_length,t.max_chain_length=r[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),n}function O(e,t,n,r,o,a){if(!e)return-2;var u=1;if(-1===t&&(t=6),r<0?(u=0,r=-r):r>15&&(u=2,r-=16),o<1||o>9||8!==n||r<8||r>15||t<0||t>9||a<0||a>4)return c(e,-2);8===r&&(r=9);var s=new k;return e.state=s,s.strm=e,s.wrap=u,s.gzhead=null,s.w_bits=r,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=o+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new i.Buf8(2*s.w_size),s.head=new i.Buf16(s.hash_size),s.prev=new i.Buf16(s.w_size),s.lit_bufsize=1<<o+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new i.Buf8(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=t,s.strategy=a,s.method=n,_(e)}r=[new w(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(g(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,p(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-262&&(p(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(p(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(p(e,!1),e.strm.avail_out),1)})),new w(4,4,8,4,m),new w(4,5,16,8,m),new w(4,6,32,32,m),new w(4,4,16,16,b),new w(8,16,32,32,b),new w(8,16,128,128,b),new w(8,32,128,256,b),new w(32,128,258,1024,b),new w(32,258,258,4096,b)],t.deflateInit=function(e,t){return O(e,t,8,15,8,0)},t.deflateInit2=O,t.deflateReset=_,t.deflateResetKeep=S,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?-2:(e.state.gzhead=t,0):-2},t.deflate=function(e,t){var n,i,a,s;if(!e||!e.state||t>5||t<0)return e?c(e,-2):-2;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||666===i.status&&4!==t)return c(e,0===e.avail_out?-5:-2);if(i.strm=e,n=i.last_flush,i.last_flush=t,42===i.status)if(2===i.wrap)e.adler=0,d(i,31),d(i,139),d(i,8),i.gzhead?(d(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),d(i,255&i.gzhead.time),d(i,i.gzhead.time>>8&255),d(i,i.gzhead.time>>16&255),d(i,i.gzhead.time>>24&255),d(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),d(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(d(i,255&i.gzhead.extra.length),d(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=u(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(d(i,0),d(i,0),d(i,0),d(i,0),d(i,0),d(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),d(i,3),i.status=113);else{var y=8+(i.w_bits-8<<4)<<8;y|=(i.strategy>=2||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(y|=32),y+=31-y%31,i.status=113,v(i,y),0!==i.strstart&&(v(i,e.adler>>>16),v(i,65535&e.adler)),e.adler=1}if(69===i.status)if(i.gzhead.extra){for(a=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>a&&(e.adler=u(e.adler,i.pending_buf,i.pending-a,a)),h(e),a=i.pending,i.pending!==i.pending_buf_size));)d(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>a&&(e.adler=u(e.adler,i.pending_buf,i.pending-a,a)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(e.adler=u(e.adler,i.pending_buf,i.pending-a,a)),h(e),a=i.pending,i.pending===i.pending_buf_size)){s=1;break}s=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,d(i,s)}while(0!==s);i.gzhead.hcrc&&i.pending>a&&(e.adler=u(e.adler,i.pending_buf,i.pending-a,a)),0===s&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(e.adler=u(e.adler,i.pending_buf,i.pending-a,a)),h(e),a=i.pending,i.pending===i.pending_buf_size)){s=1;break}s=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,d(i,s)}while(0!==s);i.gzhead.hcrc&&i.pending>a&&(e.adler=u(e.adler,i.pending_buf,i.pending-a,a)),0===s&&(i.status=103)}else i.status=103;if(103===i.status&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&h(e),i.pending+2<=i.pending_buf_size&&(d(i,255&e.adler),d(i,e.adler>>8&255),e.adler=0,i.status=113)):i.status=113),0!==i.pending){if(h(e),0===e.avail_out)return i.last_flush=-1,0}else if(0===e.avail_in&&l(t)<=l(n)&&4!==t)return c(e,-5);if(666===i.status&&0!==e.avail_in)return c(e,-5);if(0!==e.avail_in||0!==i.lookahead||0!==t&&666!==i.status){var m=2===i.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(g(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,n=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(p(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(p(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(p(e,!1),0===e.strm.avail_out)?1:2}(i,t):3===i.strategy?function(e,t){for(var n,r,i,a,u=e.window;;){if(e.lookahead<=258){if(g(e),e.lookahead<=258&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(r=u[i=e.strstart-1])===u[++i]&&r===u[++i]&&r===u[++i]){a=e.strstart+258;do{}while(r===u[++i]&&r===u[++i]&&r===u[++i]&&r===u[++i]&&r===u[++i]&&r===u[++i]&&r===u[++i]&&r===u[++i]&&i<a);e.match_length=258-(a-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=o._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(p(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(p(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(p(e,!1),0===e.strm.avail_out)?1:2}(i,t):r[i.level].func(i,t);if(3!==m&&4!==m||(i.status=666),1===m||3===m)return 0===e.avail_out&&(i.last_flush=-1),0;if(2===m&&(1===t?o._tr_align(i):5!==t&&(o._tr_stored_block(i,0,0,!1),3===t&&(f(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),h(e),0===e.avail_out))return i.last_flush=-1,0}return 4!==t?0:i.wrap<=0?1:(2===i.wrap?(d(i,255&e.adler),d(i,e.adler>>8&255),d(i,e.adler>>16&255),d(i,e.adler>>24&255),d(i,255&e.total_in),d(i,e.total_in>>8&255),d(i,e.total_in>>16&255),d(i,e.total_in>>24&255)):(v(i,e.adler>>>16),v(i,65535&e.adler)),h(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?0:1)},t.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&103!==t&&113!==t&&666!==t?c(e,-2):(e.state=null,113===t?c(e,-3):0):-2},t.deflateSetDictionary=function(e,t){var n,r,o,u,s,c,l,h,p=t.length;if(!e||!e.state)return-2;if(2===(u=(n=e.state).wrap)||1===u&&42!==n.status||n.lookahead)return-2;for(1===u&&(e.adler=a(e.adler,t,p,0)),n.wrap=0,p>=n.w_size&&(0===u&&(f(n.head),n.strstart=0,n.block_start=0,n.insert=0),h=new i.Buf8(n.w_size),i.arraySet(h,t,p-n.w_size,n.w_size,0),t=h,p=n.w_size),s=e.avail_in,c=e.next_in,l=e.input,e.avail_in=p,e.next_in=0,e.input=t,g(n);n.lookahead>=3;){r=n.strstart,o=n.lookahead-2;do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+3-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++}while(--o);n.strstart=r,n.lookahead=2,g(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=c,e.input=l,e.avail_in=s,n.wrap=u,0},t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t,n){"use strict";var r=n(0);function i(e){for(var t=e.length;--t>=0;)e[t]=0}var o=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],a=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],s=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],c=new Array(576);i(c);var l=new Array(60);i(l);var f=new Array(512);i(f);var h=new Array(256);i(h);var p=new Array(29);i(p);var d,v,y,g=new Array(30);function m(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}function b(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function w(e){return e<256?f[e]:f[256+(e>>>7)]}function k(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function S(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,k(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function _(e,t,n){S(e,n[2*t],n[2*t+1])}function O(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function R(e,t,n){var r,i,o=new Array(16),a=0;for(r=1;r<=15;r++)o[r]=a=a+n[r-1]<<1;for(i=0;i<=t;i++){var u=e[2*i+1];0!==u&&(e[2*i]=O(o[u]++,u))}}function E(e){var t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function x(e){e.bi_valid>8?k(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function C(e,t,n,r){var i=2*t,o=2*n;return e[i]<e[o]||e[i]===e[o]&&r[t]<=r[n]}function P(e,t,n){for(var r=e.heap[n],i=n<<1;i<=e.heap_len&&(i<e.heap_len&&C(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!C(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r}function T(e,t,n){var r,i,u,s,c=0;if(0!==e.last_lit)do{r=e.pending_buf[e.d_buf+2*c]<<8|e.pending_buf[e.d_buf+2*c+1],i=e.pending_buf[e.l_buf+c],c++,0===r?_(e,i,t):(_(e,(u=h[i])+256+1,t),0!==(s=o[u])&&S(e,i-=p[u],s),_(e,u=w(--r),n),0!==(s=a[u])&&S(e,r-=g[u],s))}while(c<e.last_lit);_(e,256,t)}function A(e,t){var n,r,i,o=t.dyn_tree,a=t.stat_desc.static_tree,u=t.stat_desc.has_stree,s=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<s;n++)0!==o[2*n]?(e.heap[++e.heap_len]=c=n,e.depth[n]=0):o[2*n+1]=0;for(;e.heap_len<2;)o[2*(i=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[i]=0,e.opt_len--,u&&(e.static_len-=a[2*i+1]);for(t.max_code=c,n=e.heap_len>>1;n>=1;n--)P(e,o,n);i=s;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],P(e,o,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,o[2*i]=o[2*n]+o[2*r],e.depth[i]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,o[2*n+1]=o[2*r+1]=i,e.heap[1]=i++,P(e,o,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,r,i,o,a,u,s=t.dyn_tree,c=t.max_code,l=t.stat_desc.static_tree,f=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,d=t.stat_desc.max_length,v=0;for(o=0;o<=15;o++)e.bl_count[o]=0;for(s[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(o=s[2*s[2*(r=e.heap[n])+1]+1]+1)>d&&(o=d,v++),s[2*r+1]=o,r>c||(e.bl_count[o]++,a=0,r>=p&&(a=h[r-p]),u=s[2*r],e.opt_len+=u*(o+a),f&&(e.static_len+=u*(l[2*r+1]+a)));if(0!==v){do{for(o=d-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[d]--,v-=2}while(v>0);for(o=d;0!==o;o--)for(r=e.bl_count[o];0!==r;)(i=e.heap[--n])>c||(s[2*i+1]!==o&&(e.opt_len+=(o-s[2*i+1])*s[2*i],s[2*i+1]=o),r--)}}(e,t),R(o,c,e.bl_count)}function j(e,t,n){var r,i,o=-1,a=t[1],u=0,s=7,c=4;for(0===a&&(s=138,c=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=a,a=t[2*(r+1)+1],++u<s&&i===a||(u<c?e.bl_tree[2*i]+=u:0!==i?(i!==o&&e.bl_tree[2*i]++,e.bl_tree[32]++):u<=10?e.bl_tree[34]++:e.bl_tree[36]++,u=0,o=i,0===a?(s=138,c=3):i===a?(s=6,c=3):(s=7,c=4))}function M(e,t,n){var r,i,o=-1,a=t[1],u=0,s=7,c=4;for(0===a&&(s=138,c=3),r=0;r<=n;r++)if(i=a,a=t[2*(r+1)+1],!(++u<s&&i===a)){if(u<c)do{_(e,i,e.bl_tree)}while(0!=--u);else 0!==i?(i!==o&&(_(e,i,e.bl_tree),u--),_(e,16,e.bl_tree),S(e,u-3,2)):u<=10?(_(e,17,e.bl_tree),S(e,u-3,3)):(_(e,18,e.bl_tree),S(e,u-11,7));u=0,o=i,0===a?(s=138,c=3):i===a?(s=6,c=3):(s=7,c=4)}}i(g);var N=!1;function L(e,t,n,i){S(e,0+(i?1:0),3),function(e,t,n,i){x(e),k(e,n),k(e,~n),r.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n)}t._tr_init=function(e){N||(function(){var e,t,n,r,i,s=new Array(16);for(n=0,r=0;r<28;r++)for(p[r]=n,e=0;e<1<<o[r];e++)h[n++]=r;for(h[n-1]=r,i=0,r=0;r<16;r++)for(g[r]=i,e=0;e<1<<a[r];e++)f[i++]=r;for(i>>=7;r<30;r++)for(g[r]=i<<7,e=0;e<1<<a[r]-7;e++)f[256+i++]=r;for(t=0;t<=15;t++)s[t]=0;for(e=0;e<=143;)c[2*e+1]=8,e++,s[8]++;for(;e<=255;)c[2*e+1]=9,e++,s[9]++;for(;e<=279;)c[2*e+1]=7,e++,s[7]++;for(;e<=287;)c[2*e+1]=8,e++,s[8]++;for(R(c,287,s),e=0;e<30;e++)l[2*e+1]=5,l[2*e]=O(e,5);d=new m(c,o,257,286,15),v=new m(l,a,0,30,15),y=new m(new Array(0),u,0,19,7)}(),N=!0),e.l_desc=new b(e.dyn_ltree,d),e.d_desc=new b(e.dyn_dtree,v),e.bl_desc=new b(e.bl_tree,y),e.bi_buf=0,e.bi_valid=0,E(e)},t._tr_stored_block=L,t._tr_flush_block=function(e,t,n,r){var i,o,a=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),A(e,e.l_desc),A(e,e.d_desc),a=function(e){var t;for(j(e,e.dyn_ltree,e.l_desc.max_code),j(e,e.dyn_dtree,e.d_desc.max_code),A(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*s[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(o=e.static_len+3+7>>>3)<=i&&(i=o)):i=o=n+5,n+4<=i&&-1!==t?L(e,t,n,r):4===e.strategy||o===i?(S(e,2+(r?1:0),3),T(e,c,l)):(S(e,4+(r?1:0),3),function(e,t,n,r){var i;for(S(e,t-257,5),S(e,n-1,5),S(e,r-4,4),i=0;i<r;i++)S(e,e.bl_tree[2*s[i]+1],3);M(e,e.dyn_ltree,t-1),M(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),T(e,e.dyn_ltree,e.dyn_dtree)),E(e),r&&x(e)},t._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(h[n]+256+1)]++,e.dyn_dtree[2*w(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){S(e,2,3),_(e,256,c),function(e){16===e.bi_valid?(k(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},function(e,t,n){"use strict";var r=n(12),i=n(0),o=n(5),a=n(7),u=n(1),s=n(6),c=n(15),l=Object.prototype.toString;function f(e){if(!(this instanceof f))return new f(e);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var n=r.inflateInit2(this.strm,t.windowBits);if(n!==a.Z_OK)throw new Error(u[n]);if(this.header=new c,r.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=o.string2buf(t.dictionary):"[object ArrayBuffer]"===l.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=r.inflateSetDictionary(this.strm,t.dictionary))!==a.Z_OK))throw new Error(u[n])}function h(e,t){var n=new f(t);if(n.push(e,!0),n.err)throw n.msg||u[n.err];return n.result}f.prototype.push=function(e,t){var n,u,s,c,f,h=this.strm,p=this.options.chunkSize,d=this.options.dictionary,v=!1;if(this.ended)return!1;u=t===~~t?t:!0===t?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof e?h.input=o.binstring2buf(e):"[object ArrayBuffer]"===l.call(e)?h.input=new Uint8Array(e):h.input=e,h.next_in=0,h.avail_in=h.input.length;do{if(0===h.avail_out&&(h.output=new i.Buf8(p),h.next_out=0,h.avail_out=p),(n=r.inflate(h,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&d&&(n=r.inflateSetDictionary(this.strm,d)),n===a.Z_BUF_ERROR&&!0===v&&(n=a.Z_OK,v=!1),n!==a.Z_STREAM_END&&n!==a.Z_OK)return this.onEnd(n),this.ended=!0,!1;h.next_out&&(0!==h.avail_out&&n!==a.Z_STREAM_END&&(0!==h.avail_in||u!==a.Z_FINISH&&u!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(s=o.utf8border(h.output,h.next_out),c=h.next_out-s,f=o.buf2string(h.output,s),h.next_out=c,h.avail_out=p-c,c&&i.arraySet(h.output,h.output,s,c,0),this.onData(f)):this.onData(i.shrinkBuf(h.output,h.next_out)))),0===h.avail_in&&0===h.avail_out&&(v=!0)}while((h.avail_in>0||0===h.avail_out)&&n!==a.Z_STREAM_END);return n===a.Z_STREAM_END&&(u=a.Z_FINISH),u===a.Z_FINISH?(n=r.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===a.Z_OK):u!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),h.avail_out=0,!0)},f.prototype.onData=function(e){this.chunks.push(e)},f.prototype.onEnd=function(e){e===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Inflate=f,t.inflate=h,t.inflateRaw=function(e,t){return(t=t||{}).raw=!0,h(e,t)},t.ungzip=h},function(e,t,n){"use strict";var r=n(0),i=n(3),o=n(4),a=n(13),u=n(14);function s(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function c(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function l(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new r.Buf32(852),t.distcode=t.distdyn=new r.Buf32(592),t.sane=1,t.back=-1,0):-2}function f(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,l(e)):-2}function h(e,t){var n,r;return e&&e.state?(r=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?-2:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,f(e))):-2}function p(e,t){var n,r;return e?(r=new c,e.state=r,r.window=null,0!==(n=h(e,t))&&(e.state=null),n):-2}var d,v,y=!0;function g(e){if(y){var t;for(d=new r.Buf32(512),v=new r.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(u(1,e.lens,0,288,d,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;u(2,e.lens,0,32,v,0,e.work,{bits:5}),y=!1}e.lencode=d,e.lenbits=9,e.distcode=v,e.distbits=5}function m(e,t,n,i){var o,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new r.Buf8(a.wsize)),i>=a.wsize?(r.arraySet(a.window,t,n-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((o=a.wsize-a.wnext)>i&&(o=i),r.arraySet(a.window,t,n-i,o,a.wnext),(i-=o)?(r.arraySet(a.window,t,n-i,i,0),a.wnext=i,a.whave=a.wsize):(a.wnext+=o,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=o))),0}t.inflateReset=f,t.inflateReset2=h,t.inflateResetKeep=l,t.inflateInit=function(e){return p(e,15)},t.inflateInit2=p,t.inflate=function(e,t){var n,c,l,f,h,p,d,v,y,b,w,k,S,_,O,R,E,x,C,P,T,A,j,M,N=0,L=new r.Buf8(4),I=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return-2;12===(n=e.state).mode&&(n.mode=13),h=e.next_out,l=e.output,d=e.avail_out,f=e.next_in,c=e.input,p=e.avail_in,v=n.hold,y=n.bits,b=p,w=d,A=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;y<16;){if(0===p)break e;p--,v+=c[f++]<<y,y+=8}if(2&n.wrap&&35615===v){n.check=0,L[0]=255&v,L[1]=v>>>8&255,n.check=o(n.check,L,2,0),v=0,y=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&v)<<8)+(v>>8))%31){e.msg="incorrect header check",n.mode=30;break}if(8!=(15&v)){e.msg="unknown compression method",n.mode=30;break}if(y-=4,T=8+(15&(v>>>=4)),0===n.wbits)n.wbits=T;else if(T>n.wbits){e.msg="invalid window size",n.mode=30;break}n.dmax=1<<T,e.adler=n.check=1,n.mode=512&v?10:12,v=0,y=0;break;case 2:for(;y<16;){if(0===p)break e;p--,v+=c[f++]<<y,y+=8}if(n.flags=v,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=v>>8&1),512&n.flags&&(L[0]=255&v,L[1]=v>>>8&255,n.check=o(n.check,L,2,0)),v=0,y=0,n.mode=3;case 3:for(;y<32;){if(0===p)break e;p--,v+=c[f++]<<y,y+=8}n.head&&(n.head.time=v),512&n.flags&&(L[0]=255&v,L[1]=v>>>8&255,L[2]=v>>>16&255,L[3]=v>>>24&255,n.check=o(n.check,L,4,0)),v=0,y=0,n.mode=4;case 4:for(;y<16;){if(0===p)break e;p--,v+=c[f++]<<y,y+=8}n.head&&(n.head.xflags=255&v,n.head.os=v>>8),512&n.flags&&(L[0]=255&v,L[1]=v>>>8&255,n.check=o(n.check,L,2,0)),v=0,y=0,n.mode=5;case 5:if(1024&n.flags){for(;y<16;){if(0===p)break e;p--,v+=c[f++]<<y,y+=8}n.length=v,n.head&&(n.head.extra_len=v),512&n.flags&&(L[0]=255&v,L[1]=v>>>8&255,n.check=o(n.check,L,2,0)),v=0,y=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((k=n.length)>p&&(k=p),k&&(n.head&&(T=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),r.arraySet(n.head.extra,c,f,k,T)),512&n.flags&&(n.check=o(n.check,c,k,f)),p-=k,f+=k,n.length-=k),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===p)break e;k=0;do{T=c[f+k++],n.head&&T&&n.length<65536&&(n.head.name+=String.fromCharCode(T))}while(T&&k<p);if(512&n.flags&&(n.check=o(n.check,c,k,f)),p-=k,f+=k,T)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===p)break e;k=0;do{T=c[f+k++],n.head&&T&&n.length<65536&&(n.head.comment+=String.fromCharCode(T))}while(T&&k<p);if(512&n.flags&&(n.check=o(n.check,c,k,f)),p-=k,f+=k,T)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;y<16;){if(0===p)break e;p--,v+=c[f++]<<y,y+=8}if(v!==(65535&n.check)){e.msg="header crc mismatch",n.mode=30;break}v=0,y=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=12;break;case 10:for(;y<32;){if(0===p)break e;p--,v+=c[f++]<<y,y+=8}e.adler=n.check=s(v),v=0,y=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=h,e.avail_out=d,e.next_in=f,e.avail_in=p,n.hold=v,n.bits=y,2;e.adler=n.check=1,n.mode=12;case 12:if(5===t||6===t)break e;case 13:if(n.last){v>>>=7&y,y-=7&y,n.mode=27;break}for(;y<3;){if(0===p)break e;p--,v+=c[f++]<<y,y+=8}switch(n.last=1&v,y-=1,3&(v>>>=1)){case 0:n.mode=14;break;case 1:if(g(n),n.mode=20,6===t){v>>>=2,y-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=30}v>>>=2,y-=2;break;case 14:for(v>>>=7&y,y-=7&y;y<32;){if(0===p)break e;p--,v+=c[f++]<<y,y+=8}if((65535&v)!=(v>>>16^65535)){e.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&v,v=0,y=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(k=n.length){if(k>p&&(k=p),k>d&&(k=d),0===k)break e;r.arraySet(l,c,f,k,h),p-=k,f+=k,d-=k,h+=k,n.length-=k;break}n.mode=12;break;case 17:for(;y<14;){if(0===p)break e;p--,v+=c[f++]<<y,y+=8}if(n.nlen=257+(31&v),v>>>=5,y-=5,n.ndist=1+(31&v),v>>>=5,y-=5,n.ncode=4+(15&v),v>>>=4,y-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;y<3;){if(0===p)break e;p--,v+=c[f++]<<y,y+=8}n.lens[I[n.have++]]=7&v,v>>>=3,y-=3}for(;n.have<19;)n.lens[I[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,j={bits:n.lenbits},A=u(0,n.lens,0,19,n.lencode,0,n.work,j),n.lenbits=j.bits,A){e.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;R=(N=n.lencode[v&(1<<n.lenbits)-1])>>>16&255,E=65535&N,!((O=N>>>24)<=y);){if(0===p)break e;p--,v+=c[f++]<<y,y+=8}if(E<16)v>>>=O,y-=O,n.lens[n.have++]=E;else{if(16===E){for(M=O+2;y<M;){if(0===p)break e;p--,v+=c[f++]<<y,y+=8}if(v>>>=O,y-=O,0===n.have){e.msg="invalid bit length repeat",n.mode=30;break}T=n.lens[n.have-1],k=3+(3&v),v>>>=2,y-=2}else if(17===E){for(M=O+3;y<M;){if(0===p)break e;p--,v+=c[f++]<<y,y+=8}y-=O,T=0,k=3+(7&(v>>>=O)),v>>>=3,y-=3}else{for(M=O+7;y<M;){if(0===p)break e;p--,v+=c[f++]<<y,y+=8}y-=O,T=0,k=11+(127&(v>>>=O)),v>>>=7,y-=7}if(n.have+k>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=30;break}for(;k--;)n.lens[n.have++]=T}}if(30===n.mode)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,j={bits:n.lenbits},A=u(1,n.lens,0,n.nlen,n.lencode,0,n.work,j),n.lenbits=j.bits,A){e.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,j={bits:n.distbits},A=u(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,j),n.distbits=j.bits,A){e.msg="invalid distances set",n.mode=30;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(p>=6&&d>=258){e.next_out=h,e.avail_out=d,e.next_in=f,e.avail_in=p,n.hold=v,n.bits=y,a(e,w),h=e.next_out,l=e.output,d=e.avail_out,f=e.next_in,c=e.input,p=e.avail_in,v=n.hold,y=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;R=(N=n.lencode[v&(1<<n.lenbits)-1])>>>16&255,E=65535&N,!((O=N>>>24)<=y);){if(0===p)break e;p--,v+=c[f++]<<y,y+=8}if(R&&0==(240&R)){for(x=O,C=R,P=E;R=(N=n.lencode[P+((v&(1<<x+C)-1)>>x)])>>>16&255,E=65535&N,!(x+(O=N>>>24)<=y);){if(0===p)break e;p--,v+=c[f++]<<y,y+=8}v>>>=x,y-=x,n.back+=x}if(v>>>=O,y-=O,n.back+=O,n.length=E,0===R){n.mode=26;break}if(32&R){n.back=-1,n.mode=12;break}if(64&R){e.msg="invalid literal/length code",n.mode=30;break}n.extra=15&R,n.mode=22;case 22:if(n.extra){for(M=n.extra;y<M;){if(0===p)break e;p--,v+=c[f++]<<y,y+=8}n.length+=v&(1<<n.extra)-1,v>>>=n.extra,y-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;R=(N=n.distcode[v&(1<<n.distbits)-1])>>>16&255,E=65535&N,!((O=N>>>24)<=y);){if(0===p)break e;p--,v+=c[f++]<<y,y+=8}if(0==(240&R)){for(x=O,C=R,P=E;R=(N=n.distcode[P+((v&(1<<x+C)-1)>>x)])>>>16&255,E=65535&N,!(x+(O=N>>>24)<=y);){if(0===p)break e;p--,v+=c[f++]<<y,y+=8}v>>>=x,y-=x,n.back+=x}if(v>>>=O,y-=O,n.back+=O,64&R){e.msg="invalid distance code",n.mode=30;break}n.offset=E,n.extra=15&R,n.mode=24;case 24:if(n.extra){for(M=n.extra;y<M;){if(0===p)break e;p--,v+=c[f++]<<y,y+=8}n.offset+=v&(1<<n.extra)-1,v>>>=n.extra,y-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===d)break e;if(k=w-d,n.offset>k){if((k=n.offset-k)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=30;break}k>n.wnext?(k-=n.wnext,S=n.wsize-k):S=n.wnext-k,k>n.length&&(k=n.length),_=n.window}else _=l,S=h-n.offset,k=n.length;k>d&&(k=d),d-=k,n.length-=k;do{l[h++]=_[S++]}while(--k);0===n.length&&(n.mode=21);break;case 26:if(0===d)break e;l[h++]=n.length,d--,n.mode=21;break;case 27:if(n.wrap){for(;y<32;){if(0===p)break e;p--,v|=c[f++]<<y,y+=8}if(w-=d,e.total_out+=w,n.total+=w,w&&(e.adler=n.check=n.flags?o(n.check,l,w,h-w):i(n.check,l,w,h-w)),w=d,(n.flags?v:s(v))!==n.check){e.msg="incorrect data check",n.mode=30;break}v=0,y=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;y<32;){if(0===p)break e;p--,v+=c[f++]<<y,y+=8}if(v!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=30;break}v=0,y=0}n.mode=29;case 29:A=1;break e;case 30:A=-3;break e;case 31:return-4;case 32:default:return-2}return e.next_out=h,e.avail_out=d,e.next_in=f,e.avail_in=p,n.hold=v,n.bits=y,(n.wsize||w!==e.avail_out&&n.mode<30&&(n.mode<27||4!==t))&&m(e,e.output,e.next_out,w-e.avail_out)?(n.mode=31,-4):(b-=e.avail_in,w-=e.avail_out,e.total_in+=b,e.total_out+=w,n.total+=w,n.wrap&&w&&(e.adler=n.check=n.flags?o(n.check,l,w,e.next_out-w):i(n.check,l,w,e.next_out-w)),e.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),(0===b&&0===w||4===t)&&0===A&&(A=-5),A)},t.inflateEnd=function(e){if(!e||!e.state)return-2;var t=e.state;return t.window&&(t.window=null),e.state=null,0},t.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?-2:(n.head=t,t.done=!1,0):-2},t.inflateSetDictionary=function(e,t){var n,r=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?-2:11===n.mode&&i(1,t,r,0)!==n.check?-3:m(e,t,r,r)?(n.mode=31,-4):(n.havedict=1,0):-2},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t,n){"use strict";e.exports=function(e,t){var n,r,i,o,a,u,s,c,l,f,h,p,d,v,y,g,m,b,w,k,S,_,O,R,E;n=e.state,r=e.next_in,R=e.input,i=r+(e.avail_in-5),o=e.next_out,E=e.output,a=o-(t-e.avail_out),u=o+(e.avail_out-257),s=n.dmax,c=n.wsize,l=n.whave,f=n.wnext,h=n.window,p=n.hold,d=n.bits,v=n.lencode,y=n.distcode,g=(1<<n.lenbits)-1,m=(1<<n.distbits)-1;e:do{d<15&&(p+=R[r++]<<d,d+=8,p+=R[r++]<<d,d+=8),b=v[p&g];t:for(;;){if(p>>>=w=b>>>24,d-=w,0==(w=b>>>16&255))E[o++]=65535&b;else{if(!(16&w)){if(0==(64&w)){b=v[(65535&b)+(p&(1<<w)-1)];continue t}if(32&w){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}k=65535&b,(w&=15)&&(d<w&&(p+=R[r++]<<d,d+=8),k+=p&(1<<w)-1,p>>>=w,d-=w),d<15&&(p+=R[r++]<<d,d+=8,p+=R[r++]<<d,d+=8),b=y[p&m];n:for(;;){if(p>>>=w=b>>>24,d-=w,!(16&(w=b>>>16&255))){if(0==(64&w)){b=y[(65535&b)+(p&(1<<w)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(S=65535&b,d<(w&=15)&&(p+=R[r++]<<d,(d+=8)<w&&(p+=R[r++]<<d,d+=8)),(S+=p&(1<<w)-1)>s){e.msg="invalid distance too far back",n.mode=30;break e}if(p>>>=w,d-=w,S>(w=o-a)){if((w=S-w)>l&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(_=0,O=h,0===f){if(_+=c-w,w<k){k-=w;do{E[o++]=h[_++]}while(--w);_=o-S,O=E}}else if(f<w){if(_+=c+f-w,(w-=f)<k){k-=w;do{E[o++]=h[_++]}while(--w);if(_=0,f<k){k-=w=f;do{E[o++]=h[_++]}while(--w);_=o-S,O=E}}}else if(_+=f-w,w<k){k-=w;do{E[o++]=h[_++]}while(--w);_=o-S,O=E}for(;k>2;)E[o++]=O[_++],E[o++]=O[_++],E[o++]=O[_++],k-=3;k&&(E[o++]=O[_++],k>1&&(E[o++]=O[_++]))}else{_=o-S;do{E[o++]=E[_++],E[o++]=E[_++],E[o++]=E[_++],k-=3}while(k>2);k&&(E[o++]=E[_++],k>1&&(E[o++]=E[_++]))}break}}break}}while(r<i&&o<u);r-=k=d>>3,p&=(1<<(d-=k<<3))-1,e.next_in=r,e.next_out=o,e.avail_in=r<i?i-r+5:5-(r-i),e.avail_out=o<u?u-o+257:257-(o-u),n.hold=p,n.bits=d}},function(e,t,n){"use strict";var r=n(0),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],u=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,n,s,c,l,f,h){var p,d,v,y,g,m,b,w,k,S=h.bits,_=0,O=0,R=0,E=0,x=0,C=0,P=0,T=0,A=0,j=0,M=null,N=0,L=new r.Buf16(16),I=new r.Buf16(16),D=null,F=0;for(_=0;_<=15;_++)L[_]=0;for(O=0;O<s;O++)L[t[n+O]]++;for(x=S,E=15;E>=1&&0===L[E];E--);if(x>E&&(x=E),0===E)return c[l++]=20971520,c[l++]=20971520,h.bits=1,0;for(R=1;R<E&&0===L[R];R++);for(x<R&&(x=R),T=1,_=1;_<=15;_++)if(T<<=1,(T-=L[_])<0)return-1;if(T>0&&(0===e||1!==E))return-1;for(I[1]=0,_=1;_<15;_++)I[_+1]=I[_]+L[_];for(O=0;O<s;O++)0!==t[n+O]&&(f[I[t[n+O]]++]=O);if(0===e?(M=D=f,m=19):1===e?(M=i,N-=257,D=o,F-=257,m=256):(M=a,D=u,m=-1),j=0,O=0,_=R,g=l,C=x,P=0,v=-1,y=(A=1<<x)-1,1===e&&A>852||2===e&&A>592)return 1;for(;;){b=_-P,f[O]<m?(w=0,k=f[O]):f[O]>m?(w=D[F+f[O]],k=M[N+f[O]]):(w=96,k=0),p=1<<_-P,R=d=1<<C;do{c[g+(j>>P)+(d-=p)]=b<<24|w<<16|k|0}while(0!==d);for(p=1<<_-1;j&p;)p>>=1;if(0!==p?(j&=p-1,j+=p):j=0,O++,0==--L[_]){if(_===E)break;_=t[n+f[O]]}if(_>x&&(j&y)!==v){for(0===P&&(P=x),g+=R,T=1<<(C=_-P);C+P<E&&!((T-=L[C+P])<=0);)C++,T<<=1;if(A+=1<<C,1===e&&A>852||2===e&&A>592)return 1;c[v=j&y]=x<<24|C<<16|g-l|0}}return 0!==j&&(c[g+j]=_-P<<24|64<<16|0),h.bits=x,0}},function(e,t,n){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t),n.d(t,"cell",(function(){return Ne}));var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.length=0,this.obj={}}var t,n;return t=e,(n=[{key:"isEmpty",value:function(){return 0==this.length}},{key:"containsKey",value:function(e){return e in this.obj}},{key:"containsValue",value:function(e){for(var t in this.obj)if(this.obj[t]==e)return!0;return!1}},{key:"put",value:function(e,t){this.containsKey(e)||this.length++,this.obj[e]=t}},{key:"get",value:function(e){return this.containsKey(e)?this.obj[e]:null}},{key:"remove",value:function(e){if(this.containsKey(e)){var t=this.obj[e];return delete this.obj[e],this.length--,t}return null}},{key:"values",value:function(){var e=new Array;for(var t in this.obj)e.push(this.obj[t]);return e}},{key:"keySet",value:function(){var e=new Array;for(var t in this.obj)e.push(t);return e}},{key:"size",value:function(){return this.length}},{key:"clear",value:function(){this.length=0,this.obj={}}}])&&r(t.prototype,n),e}();function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.host=t,this.port=n}var t,n;return t=e,(n=[{key:"getHost",value:function(){return this.host}},{key:"getPort",value:function(){return this.port}},{key:"toString",value:function(){return this.host+":"+this.port}}])&&o(t.prototype,n),e}();function s(e){return(s="function"==typeof Symbol&&"symbol"==a(Symbol.iterator)?function(e){return a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":a(e)})(e)}var c={toBytes:function(e){if(void 0!==e){var t=s(e);if("string"==t)return this.stringToBytes(e);if("number"==t)return/^-?\d+$/.test(e.toString())?e>-2147483648&&e<2147483647?this.intToBytes(e):this.longToBytes(e):/^[-\+]?\d+(\.\d+)?$/.test(e.toString())?this.doubleToBytes(e):this.floatToBytes(e);if("boolean"==t)return this.boolToBytes(e);if("object"==t)return this.stringToBytes(JSON.stringify(e))}},intToBytes:function(e){var t=[];return t[0]=this.over127(255&e),t[1]=this.over127((65280&e)>>8),t[2]=this.over127((16711680&e)>>16),t[3]=this.over127((4278190080&e)>>24),t},longToBytes:function(e){var t=[];return t[0]=255&e,t[1]=255&this.toRight(e,8),t[2]=255&this.toRight(e,16),t[3]=255&this.toRight(e,24),t[4]=255&this.toRight(e,32),t[5]=255&this.toRight(e,40),t[6]=255&this.toRight(e,48),t[7]=255&this.toRight(e,56),t},floatToBytes:function(e){for(var t=e.toString(),n=[],r=0;r<t.length;++r)n.push(t.charCodeAt(r));return n},doubleToBytes:function(e){for(var t=e.toString(),n=[],r=0;r<t.length;++r)n.push(t.charCodeAt(r));return n},stringToBytes:function(e){return new TextEncoder("utf-8").encode(e)},boolToBytes:function(e){return[e?1:0]},toArray:function(e){for(var t=new Array,n=0,r=e.length;n<r;++n)t.push(e.charAt(n));return t},toInt:function(e){return 255&e[0]|65280&e[1]<<8|16711680&e[2]<<16|4278190080&e[3]<<24},toLong:function(e){var t=e[0]|e[1]<<8|e[2]<<16|e[3]<<24;return 4294967296*((e[4]|e[5]<<8|e[6]<<16|e[7]<<24)>>>0)+(t>>>0)},toFloat:function(e){for(var t=[],n=0;n<e.length;++n)t.push(String.fromCharCode(e[n]));var r=t.join("");return parseFloat(r)},toDouble:function(e){for(var t=[],n=0;n<e.length;++n)t.push(String.fromCharCode(e[n]));var r=t.join("");return parseFloat(r)},toBool:function(e){return 1==e[0]},toString:function(e){return new TextDecoder("utf-8").decode(new Uint8Array("object"==s(e)?e:[e]))},toRight:function(e,t){try{return parseInt(Array(t+1).join("0")+(t>e.toString(2).length?0:e.toString(2).slice(0,e.toString(2).length-t)),2)}catch(n){console.log(e,t,n)}},over127:function(e){return e>127?e-256:e},floatToIntBits:function(e){if(Math.pow(2,23),e!=e)return 2143289344;var t=e<0||0==e&&1/e<0?-2147483648:0,n=Math.abs(e);if(n==Number.POSITIVE_INFINITY)return 2139095040|t;for(var r=0,i=n;i>=2&&r<=127;)r++,i/=2;for(;i<1&&r>=-126;)r--,i*=2;var o=r+127;return 255==o?2139095040|signBit:(0==o||Math.pow(2,23),Math.pow(2,23),t|o<<23&2139095040|8388607&mantissa)}},l={sMagicNum:Math.round(Date.now()),ALPHABET:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],NUMBERS:[1,2,3,4,5,6,7,8,9,0],randomString:function(e){for(var t=new Array,n=0;n<e;++n){var r=Math.floor(Math.random()*this.ALPHABET.length);t.push(this.ALPHABET[r])}return t.join("")},randomNumberFixedLength:function(e){if(e<0)return 0;var t=new Array,n=Math.floor(Math.random()*(this.NUMBERS.length-1));t.push(this.NUMBERS[n]);for(var r=1;r<e;++r)n=Math.floor(Math.random()*this.NUMBERS.length),t.push(this.NUMBERS[n]);var i=t.join("");return parseInt(i)},randomNumber:function(e,t){return void 0===e&&(e=-32768),void 0===t&&(t=32767),Math.floor(Math.random()*(t-e))+e},randomBytes:function(e){for(var t=new Array,n=0;n<e;++n){var r=Math.floor(128*Math.random());t.push(r)}return t},parseInt32:function(e){var t=parseInt(e);return t<-2147483648?-2147483648:t>2147483647?2147483647:t},parseInt64:function(e){return parseInt(e)},generateSerialNumber:function(){var e=Date.now();return e+=this.randomNumber(),Math.abs(e)},simpleEncrypt:function(e,t){var n=null;if("string"==typeof e){n=[];for(var r=0;r<e.length;++r)n.push(e.charCodeAt(r)-256)}else n=e;var i=null;if("string"==typeof t){i=[];for(var o=0;o<t.length;++o)i.push(t.charCodeAt(o))}else i=t;if(8!=i.length)return null;var a=11+i[0];a-=i[1],a+=i[2],a-=i[3],a+=i[4],a-=i[5],a+=i[6];for(var u=(a-=i[7])%8,s=a%2==0?2:1,c=n.length,l=new Array,f=0;f<c;++f){var h=n[f]^s^u;h<0&&(h+=256),l[f]=h}return l},simpleDecrypt:function(e,t){var n=[];if("string"==typeof e){n=[];for(var r=0;r<e.length;++r)n.push(e.charCodeAt(r)-256)}else n=e;var i=[];if("string"==typeof t)for(var o=0;o<t.length;++o)i.push(t.charCodeAt(o)-256);else i=t;if(8!=i.length)return null;var a=11+i[0];a-=i[1],a+=i[2],a-=i[3],a+=i[4],a-=i[5],a+=i[6];for(var u=(a-=i[7])%8,s=a%2==0?2:1,c=n.length,l=new Array,f=0;f<c;++f){var h=n[f]^u^s;h<0&&(h+=256),l[f]=h}return l},toCharCode:function(e){var t=new Array;if("string"==typeof e)for(var n=0;n<e.length;++n)t.push(e.charCodeAt(n));else for(var r=0;r<e.length;++r)if("string"==typeof e[r])for(var i=e[r],o=0;o<i.length;++o)t.push(i.charCodeAt(o));else t.push(e[r]);return t},fromCharCode:function(e){for(var t=new Array,n=0;n<e.length;++n)t.push(String.fromCharCode(e[n]));return t.join("")}},f={DEBUG:1,INFO:2,WARNING:3,ERROR:4};void 0===window.console?window.console={error:function(){},warn:function(){},info:function(){},log:function(){}}:(void 0===window.console.error&&(window.console.error=window.console.log),void 0===window.console.warn&&(window.console.warn=window.console.log),void 0===window.console.info&&(window.console.info=window.console.log));var h={enabled:!0,level:f.INFO,isDebugLevel:function(){return this.level==f.DEBUG},d:function(e,t){if(this.enabled&&!(this.level>f.DEBUG)){var n=[this._formatTime()," [DEBUG] ",e," - ",t];window.console.log(n.join("")),n=null}},i:function(e,t){if(this.enabled&&!(this.level>f.INFO)){var n=[this._formatTime()," [INFO]  ",e," - ",t];window.console.info(n.join("")),n=null}},w:function(e,t){if(this.enabled&&!(this.level>f.WARNING)){var n=[this._formatTime()," [WARN]  ",e," - ",t];window.console.warn(n.join("")),n=null}},e:function(e,t){if(this.enabled&&!(this.level>f.ERROR)){var n=[this._formatTime()," [ERROR] ",e," - ",t];window.console.error(n.join("")),n=null}},log:function(e,t,n){if(this.enabled)switch(n){case f.DEBUG:this.d(e,t);break;case f.INFO:this.i(e,t);break;case f.WARNING:this.w(e,t);break;case f.ERROR:this.e(e,t);break;default:var r=[this._formatTime()," [LOG] ",e," - ",t];window.console.log(r.join("")),r=null}},_formatTime:function(){var e=new Date,t=[e.getHours(),":",e.getMinutes(),":",e.getSeconds(),".",e.getMilliseconds()];return e=null,t.join("")}};function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var d=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.MAJOR=2,this.MINOR=3,this.REVISION=8,this.NAME="Genie"}var t,n;return t=e,(n=[{key:"getNumbers",value:function(){return[this.MAJOR,".",this.MINOR,".",this.REVISION].join("")}},{key:"toString",value:function(){return[this.MAJOR,".",this.MINOR,".",this.REVISION," (",this.NAME,")"].join("")}}])&&p(t.prototype,n),e}(),v=function(){var e,t="0123456789abcdef".split(""),n=[],r=Math.random;n[8]=n[13]=n[18]=n[23]="-",n[14]="4";for(var i=0;i<36;i++)n[i]||(e=0|16*r(),n[i]=t[19==i?3&e|8:15&e]);return n.join("")};function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var g=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.uuid=void 0!==t?t:v().toString()}var t,n;return t=e,(n=[{key:"reset",value:function(){this.uuid=v().toString()}},{key:"asString",value:function(){return this.uuid}},{key:"toString",value:function(){return this.uuid}}])&&y(t.prototype,n),e}(),m=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.heartbeat=6e4};function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var w=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.timer=0,this.runnable=t,this.scope=void 0===n?null:n}var t,n;return t=e,(n=[{key:"start",value:function(){var e=this;this.timer=setTimeout((function(t){e.runnable.call(e.scope),clearTimeout(e.timer),e.timer=0}),0)}},{key:"delay",value:function(e){var t=this,n=setTimeout((function(){t.start(),clearTimeout(n)}),e)}}])&&b(t.prototype,n),e}();function k(e){return(k="function"==typeof Symbol&&"symbol"==a(Symbol.iterator)?function(e){return a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":a(e)})(e)}function S(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&function(e,t){(Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}(e,t)}function O(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=x(e);if(t){var i=x(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}function R(e,t){return!t||"object"!==k(t)&&"function"!=typeof t?E(e):t}function E(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function x(e){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function P(e){return(P="function"==typeof Symbol&&"symbol"==a(Symbol.iterator)?function(e){return a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":a(e)})(e)}function T(e,t){return(T=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function A(e,t){return!t||"object"!==P(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function j(e){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var M=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&T(e,t)}(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=j(e);if(t){var i=j(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return A(this,n)}}(n);function n(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),t.call(this,e)}return n}(function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.address=t,this.id=l.generateSerialNumber(),this.timestamp=Date.now(),this.secretKey=null}var t,n;return t=e,(n=[{key:"getId",value:function(){return this.id}},{key:"getAddress",value:function(){return this.address}},{key:"setSecretKey",value:function(e){this.secretKey=e}},{key:"getSecretKey",value:function(){return this.secretKey}},{key:"toString",value:function(){return this.address.toString()}}])&&C(t.prototype,n),e}()),N=n(2),L=n.n(N);function I(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var D=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.payload=t,this.context=null,this.compressible=!1,this.verifyCompression()}var t,n,r;return t=e,r=[{key:"pack",value:function(t,n){var r;return(r=null!=n?l.simpleEncrypt(t,n):t).length>e.CompressionThreshold?e.compress(r):r}},{key:"unpack",value:function(t,n){var r;return null==(r=120==t[0]&&156==t[1]?e.uncompress(t):t)?null:null!=n?l.simpleDecrypt(r,n):r}},{key:"compress",value:function(e){return L.a.deflate(e)}},{key:"uncompress",value:function(e){var t=null;try{t=L.a.inflate(e)}catch(e){h.e("Message","Uncompress error: "+e)}return t}}],(n=[{key:"setPayload",value:function(e){this.payload=e}},{key:"setContext",value:function(e){this.context=e}},{key:"getPayload",value:function(){return this.payload}},{key:"getContext",value:function(){return this.context}},{key:"verifyCompression",value:function(){return 120==this.payload[0]&&-100==this.payload[1]||120==this.payload[0]&&156==this.payload[1]?this.compressible=!0:this.compressible=!1,this.compressible}},{key:"needCompressible",value:function(){return this.payload.length>=e.CompressionThreshold}}])&&I(t.prototype,n),r&&I(t,r),e}();function F(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}D.DefaultHead=[32,19,9,8],D.DefaultTail=[25,120,16,4],D.CompressionThreshold=1024;var B=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,(n=[{key:"initializer",value:function(){}},{key:"sessionCreated",value:function(e){}},{key:"sessionDestroyed",value:function(e){}},{key:"sessionOpened",value:function(e){}},{key:"sessionClosed",value:function(e){}},{key:"messageReceived",value:function(e,t){}},{key:"messageSent",value:function(e,t){}},{key:"errorOccurred",value:function(e,t){}}])&&F(t.prototype,n),e}();function z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var G=200;function U(e){return(U="function"==typeof Symbol&&"symbol"==a(Symbol.iterator)?function(e){return a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":a(e)})(e)}function H(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function J(e,t){return(J=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function V(e,t){return!t||"object"!==U(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function W(e){return(W=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var q=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&J(e,t)}(i,e);var t,n,r=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=W(e);if(t){var i=W(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return V(this,n)}}(i);function i(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(e=r.call(this)).writeLimit=32768,e.address=null,e.connectTimeout=1e4,e.connectTimer=0,e.socket=null,e.session=null,e.closed=!0,e.messages=null,e.secure=window.location.protocol.toLowerCase().indexOf("https")>=0,e.receivedBuf=[],e}return t=i,(n=[{key:"getAddress",value:function(){return this.address}},{key:"connect",value:function(e){if(null!=this.socket&&this.socket.readyState==WebSocket.OPEN)return h.w("MessageConnector","Connector has connected to "+e.toString()),!1;if(!this.closed&&null!=this.socket){try{this.socket.close(1e3,"close")}catch(e){}this.destroySocketEvent(),this.socket=null,this.closed=!0}this.connectTimer>0&&(clearTimeout(this.connectTimer),this.connectTimer=0),this.messages=[],this.address=e;var t=this;return this.session=new M(this.address),t.fireSessionCreated(),this.connectTimer=setTimeout((function(){t.fireErrorOccurred(301)}),this.connectTimeout),this.socket=this.createSocket(this.address.getHost(),this.address.getPort()),null!=this.socket||(new w((function(){t.fireSessionDestroyed(),t.connectTimer>0&&(clearTimeout(t.connectTimer),t.connectTimer=0)})).start(),!1)}},{key:"disconnect",value:function(){if(this.connectTimer>0&&(clearTimeout(this.connectTimer),this.connectTimer=0),null!=this.socket)try{this.socket.close(1e3,"disconnect")}catch(e){h.e("MessageConnector","Close socket has exception.")}else this.fireSessionDestroyed();this.destroySocketEvent(),this.socket=null}},{key:"destroySocketEvent",value:function(){null!=this.socket&&(this.socket.onopen=function(e){},this.socket.onclose=function(e){},this.socket.onmessage=function(e){},this.socket.onerror=function(e){})}},{key:"createSocket",value:function(e,t){var n=this;if(void 0===window.WebSocket)return null;var r=null;try{r=this.secure?void 0!==t?new WebSocket("wss://"+e+":"+t+"/cell/","cell"):new WebSocket("wss://"+e+"/cell/","cell"):void 0!==t?new WebSocket("ws://"+e+":"+t+"/cell/","cell"):new WebSocket("ws://"+e+"/cell/","cell")}catch(e){this.fireErrorOccurred(G),console.log("WebSocket: "+e)}return null==r?null:(r.binaryType="arraybuffer",r.onopen=function(e){n.fireSessionOpened(e)},r.onclose=function(e){n.fireSessionClosed(e)},r.onmessage=function(e){n.receive(e)},r.onerror=function(e){n.fireErrorOccurred(G,e)},r)}},{key:"setConnectTimeout",value:function(e){this.connectTimeout=e}},{key:"getConnectTimeout",value:function(){return this.connectTimeout}},{key:"getSession",value:function(){return this.session}},{key:"write",value:function(e){null!=e&&void 0!==e?(this.messages.push(e),this._send()):this.fireErrorOccurred(403)}},{key:"_send",value:function(){if(!this.closed)try{if(this.messages.length>0){var e=this.messages.shift();if(null==e)return;for(var t=e.payload,n=this.session.secretKey,r=D.pack(t,n),i=new Array,o=0;o<r.length;++o)i.push(r[o]);Array.prototype.push.apply(i,D.DefaultTail);var a=new Uint8Array(i);if(this.socket.send(a),null!=this.handler&&this.handler.messageSent(this.session,e),this.messages.length>0){var u=this;new w((function(){u._send()})).delay(10)}}}catch(e){h.log("MessageConnector",e,f.WARNING)}}},{key:"receive",value:function(e){if("string"==typeof e.data)h.w("MessageConnector","Not supported string type");else if(this.receivedBuf=this.receivedBuf.concat(Array.from(new Uint8Array(e.data))),this.receivedBuf.length>4){var t=this.receivedBuf.length-1;if(this.receivedBuf[t-3]==D.DefaultTail[0]&&this.receivedBuf[t-2]==D.DefaultTail[1]&&this.receivedBuf[t-1]==D.DefaultTail[2]&&this.receivedBuf[t]==D.DefaultTail[3]){var n=this.receivedBuf.slice(0,this.receivedBuf.length-4);this.process(D.unpack(n,this.session.secretKey)),this.receivedBuf.length=0,this.receivedBuf=[]}}}},{key:"process",value:function(e){null!=this.handler&&this.handler.messageReceived(this.session,new D(e))}},{key:"fireSessionCreated",value:function(){null!=this.handler&&this.handler.sessionCreated(this.session)}},{key:"fireSessionOpened",value:function(e){this.closed=!1,this.connectTimer>0&&(clearTimeout(this.connectTimer),this.connectTimer=0),null!=this.handler&&this.handler.sessionOpened(this.session)}},{key:"fireSessionClosed",value:function(e){this.connectTimer>0&&(clearTimeout(this.connectTimer),this.connectTimer=0),this.closed||(this.closed=!0,null!=this.handler&&this.handler.sessionClosed(this.session),this.fireSessionDestroyed(this.session)),this.destroySocketEvent()}},{key:"fireSessionDestroyed",value:function(){null!=this.session&&null!=this.handler&&this.handler.sessionDestroyed(this.session),this.destroySocketEvent(),this.session=null,this.socket=null}},{key:"fireErrorOccurred",value:function(e,t){this.connectTimer>0&&(clearTimeout(this.connectTimer),this.connectTimer=0),null!=this.handler&&this.handler.errorOccurred(e,this.session),this.destroySocketEvent(),this.socket=null}}])&&H(t.prototype,n),i}(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.handler=null}var t,n;return t=e,(n=[{key:"setHandler",value:function(e){this.handler=e}},{key:"getHandler",value:function(){return this.handler}}])&&z(t.prototype,n),e}()),K=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.session=t,this.tag=n,this.originateTimestamp=0,this.receiveTimestamp=0,this.transmitTimestamp=0,this.localTimestamp=0};function Z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var $=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,(n=[{key:"initializer",value:function(){}},{key:"onSessionTimeout",value:function(e,t){}}])&&Z(t.prototype,n),e}(),Q={STRING:83,INT:73,LONG:76,FLOAT:102,DOUBLE:100,BOOL:66,JSON:74,BIN:78};function X(e){return(X="function"==typeof Symbol&&"symbol"==a(Symbol.iterator)?function(e){return a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":a(e)})(e)}function Y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ee=function(){function e(t,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),void 0!==t||void 0!==n)if(void 0!==n&&null!=n)switch(this.literal=n,n){case Q.STRING:this.value=c.stringToBytes(t);break;case Q.INT:this.value=c.intToBytes(t);break;case Q.LONG:this.value=c.longToBytes(t);break;case Q.JSON:this.value=c.stringToBytes(JSON.stringify(t));break;case Q.BOOL:this.value=c.boolToBytes(t);break;case Q.FLOAT:this.value=c.floatToBytes(t);break;case Q.DOUBLE:this.value=c.doubleToBytes(t);break;case Q.BIN:this.value=t}else{var r=X(t);"string"==r?(this.value=c.stringToBytes(t),this.literal=Q.STRING):"object"==r?(this.literal=Q.JSON,this.value=c.stringToBytes(JSON.stringify(t))):"number"==r?/^-?\d+$/.test(t.toString())?t>=-2147483648&&t<=2147483647?(this.literal=Q.INT,this.value=c.intToBytes(t)):(this.literal=Q.LONG,this.value=c.longToBytes(t)):/^[-\+]?\d+(\.\d+)?$/.test(t.toString())?(this.literal=Q.DOUBLE,this.value=c.doubleToBytes(t)):(this.literal=Q.FLOAT,this.value=c.floatToBytes(t)):"boolean"==r?(this.literal=Q.BOOL,this.value=c.boolToBytes(t)):(this.literal=Q.BIN,this.value=t)}}var t,n;return t=e,(n=[{key:"restore",value:function(e,t){this.value=e,this.literal=t}},{key:"getLiteralBase",value:function(){return this.literal}},{key:"getValue",value:function(){return this.value}},{key:"getLiteralValue",value:function(){return this.getValueAs(this.literal)}},{key:"getValueAs",value:function(e){switch(e){case Q.STRING:return this.getValueAsString();case Q.INT:return this.getValueAsInt();case Q.LONG:return this.getValueAsLong();case Q.JSON:return this.getValueAsJson();case Q.BOOL:return this.getValueAsBool();case Q.FLOAT:return this.getValueAsFloat();case Q.DOUBLE:return this.getValueAsDouble();case Q.BIN:return this.getValue();default:return this.value}}},{key:"getValueAsString",value:function(){return c.toString(this.value)}},{key:"getValueAsInt",value:function(){return c.toInt(this.value)}},{key:"getValueAsLong",value:function(){return c.toLong(this.value)}},{key:"getValueAsFloat",value:function(){return c.toFloat(this.value)}},{key:"getValueAsDouble",value:function(){return c.toDouble(this.value)}},{key:"getValueAsBool",value:function(){return c.toBool(this.value)}},{key:"getValueAsJson",value:function(){var e=c.toString(this.value);return JSON.parse(e)}},{key:"equals",value:function(t){if(null==t||!(t instanceof e))return!1;if(t.literal!=this.literal||t.value.length!=this.value.length)return!1;for(var n=0,r=t.value.length;n<r;++n)if(t.value[n]!=this.value[n])return!1;return!0}}])&&Y(t.prototype,n),e}();function te(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ne=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sn=void 0!==t?t:l.randomBytes(4),this.stuffList=[]}var t,n;return t=e,(n=[{key:"getSN",value:function(){return this.sn}},{key:"commit",value:function(e){return this.stuffList.push(e),this.stuffList.length-1}},{key:"setStuff",value:function(e,t){this.stuffList[e]=t}},{key:"getStuff",value:function(e){return this.stuffList[e]}},{key:"removeStuff",value:function(e){this.stuffList.splice(e,1)}},{key:"numStuff",value:function(){return this.stuffList.length}},{key:"equals",value:function(e){if(null==e||void 0===e)return!1;if(e.stuffList.length!=this.stuffList.length)return!1;if(e.sn.length!=this.sn.length)return!1;for(var t=0,n=this.sn.length;t<n;++t)if(e.sn[t]!=this.sn[t])return!1;return!0}},{key:"equalsSN",value:function(e){if(e.length!=this.sn.length)return!1;for(var t=0;t<e.length;++t)if(e[t]!=this.sn[t])return!1;return!0}},{key:"clone",value:function(){for(var t=new e(this.sn),n=0;n<this.stuffList.length;++n){var r=this.stuffList[n];switch(r.literal){case Q.STRING:t.commit(new ee(r.getValueAsString(),r.literal));break;case Q.INT:t.commit(new ee(r.getValueAsInt(),r.literal));break;case Q.LONG:t.commit(new ee(r.getValueAsLong(),r.literal));break;case Q.FLOAT:t.commit(new ee(r.getValueAsFloat(),r.literal));break;case Q.DOUBLE:t.commit(new ee(r.getValueAsDouble(),r.literal));break;case Q.BOOL:t.commit(new ee(r.getValueAsBool(),r.literal));break;case Q.JSON:t.commit(new ee(r.getValueAsJson(),r.literal));break;case Q.BIN:default:t.commit(new ee(r.getValue(),r.literal))}}return t}}])&&te(t.prototype,n),e}(),re={Handshake:[72,83],SpeakNoAck:[83,78],SpeakAck:[83,65],Stream:[83,84],StreamControl:[83,67],Ack:[65,67],Heartbeat:[72,66],HeartbeatAck:[72,65],Goodbye:[71,66],Version:1,Reserve:[17,36,17,36],SEPARATE_CHAR:30,ESCAPE_CHAR:92,sGlobalSN:0,recognize:function(e){if(e.length<10)return null;var t=parseInt(e[6]),n=parseInt(e[7]);return t==re.SpeakNoAck[0]&&n==re.SpeakNoAck[1]?re.SpeakNoAck:t==re.SpeakAck[0]&&n==re.SpeakAck[1]?re.SpeakAck:t==re.Stream[0]&&n==re.Stream[1]?re.Stream:t==re.StreamControl[0]&&n==re.StreamControl[1]?re.StreamControl:t==re.Ack[0]&&n==re.Ack[1]?re.Ack:t==re.Heartbeat[0]&&n==re.Heartbeat[1]?re.Heartbeat:t==re.HeartbeatAck[0]&&n==re.HeartbeatAck[1]?re.HeartbeatAck:t==re.Handshake[0]&&n==re.Handshake[1]?re.Handshake:null},serializeHandshake:function(e,t){var n=new Array;return n.push(re.Version),n.push(re.consumeSN()),Array.prototype.push.apply(n,re.Reserve),Array.prototype.push.apply(n,re.Handshake),Array.prototype.push.apply(n,e),n.push(re.SEPARATE_CHAR),Array.prototype.push.apply(n,c.stringToBytes(t)),n},deserializeHandshake:function(e){for(var t={key:null,tag:null},n=new Array,r=0,i=8;i<e.length;++i){do{var o=e[i];if(o==re.SEPARATE_CHAR)break;n.push(String.fromCharCode(o)),++i}while(i<e.length);0==r?(t.key=new Array,Array.prototype.push.apply(t.key,n)):1==r&&(t.tag=n.join("")),n.splice(0,n.length),++r}return t},serializeSpeak:function(e,t,n){var r=new Array;r.push(re.Version),r.push(re.consumeSN()),Array.prototype.push.apply(r,t.getSN()),n?Array.prototype.push.apply(r,re.SpeakAck):Array.prototype.push.apply(r,re.SpeakNoAck),Array.prototype.push.apply(r,c.stringToBytes(e)),r.push(re.SEPARATE_CHAR);for(var i=0,o=t.stuffList;i<o.length;++i){r.push(o[i].literal);for(var a=0,u=o[i].value;a<u.length;++a)(u[a]==re.SEPARATE_CHAR||u[a]==re.ESCAPE_CHAR)&&r.push(re.ESCAPE_CHAR),r.push(u[a]);r.push(re.SEPARATE_CHAR)}return r},deserializeSpeak:function(e){if(e.length<10)return null;for(var t=re.recognize(e),n=e.slice(2,6),r={target:null,primitive:null,ack:t==re.SpeakAck},i=new Array,o=8;o<e.length;++o){var a=e[o];if(a==re.SEPARATE_CHAR)break;i.push(String.fromCharCode(a))}r.target=i.join("");for(var u=8+i.length+1,s=new ne(n),c=u;c<e.length;++c){var l=e[c],f=[];for(++c;c<e.length;){var h=e[c];if(h!=re.ESCAPE_CHAR){if(h==re.SEPARATE_CHAR)break;f.push(h),++c}else h=e[++c],f.push(h),++c}var p=new ee;p.restore(f,l),s.commit(p)}return r.primitive=s,r},serializeAck:function(e,t){var n=new Array;return n.push(re.Version),n.push(re.consumeSN()),Array.prototype.push.apply(n,t.getSN()),Array.prototype.push.apply(n,re.Ack),Array.prototype.push.apply(n,c.stringToBytes(e)),n},deserializeAck:function(e){if(e.length<8)return null;var t={target:null,sn:null};return t.sn=e.slice(2,6),t.target=c.toString(e.slice(8,e.length)),t},serializeHeartbeat:function(e,t){var n=new Array;return n.push(re.Version),n.push(re.consumeSN()),Array.prototype.push.apply(n,re.Reserve),Array.prototype.push.apply(n,re.Heartbeat),Array.prototype.push.apply(n,c.toBytes(e)),n.push(re.SEPARATE_CHAR),Array.prototype.push.apply(n,c.longToBytes(t)),n},deserializeHeartbeat:function(e){for(var t={tag:null,originateTimestamp:0,receiveTimestamp:0,transmitTimestamp:0},n=0,r=8;r<e.length;++r){var i=new Array;do{var o=e[r];if(o==re.SEPARATE_CHAR)break;o==re.ESCAPE_CHAR&&(o=e[r+=1]),i.push(o),++r}while(r<e.length);0==n?t.tag=c.toString(i):1==n&&(t.originateTimestamp=c.toLong(i)),i.splice(0,i.length),++n}return t},serializeHeartbeatAck:function(e,t,n,r){var i=new Array;return i.push(re.Version),i.push(re.consumeSN()),Array.prototype.push.apply(i,re.Reserve),Array.prototype.push.apply(i,re.HeartbeatAck),Array.prototype.push.apply(i,c.toBytes(e)),i.push(re.SEPARATE_CHAR),Array.prototype.push.apply(i,re.escape(c.longToBytes(t))),i.push(re.SEPARATE_CHAR),Array.prototype.push.apply(i,re.escape(c.longToBytes(n))),i.push(re.SEPARATE_CHAR),Array.prototype.push.apply(i,re.escape(c.longToBytes(r))),i},deserializeHeartbeatAck:function(e){for(var t={tag:null,originateTimestamp:0,receiveTimestamp:0,transmitTimestamp:0},n=0,r=8;r<e.length;++r){var i=new Array;do{var o=e[r];if(o==re.SEPARATE_CHAR)break;o==re.ESCAPE_CHAR&&(o=e[r+=1]),i.push(o),++r}while(r<e.length);if(0==n)t.tag=c.toString(i);else if(1==n){var a=i.slice(0,8);t.originateTimestamp=c.toLong(a)}else if(2==n){var u=i.slice(0,8);t.receiveTimestamp=c.toLong(u)}else if(3==n){var s=i.slice(0,8);t.transmitTimestamp=c.toLong(s)}i.splice(0,i.length),++n}return t},serializeGoodbye:function(){var e=new Array;return e.push(re.Version),e.push(re.consumeSN()),Array.prototype.push.apply(e,re.Reserve),Array.prototype.push.apply(e,re.Goodbye),e},consumeSN:function(){var e=re.sGlobalSN;return re.sGlobalSN+=1,re.sGlobalSN>127&&(re.sGlobalSN=0),e},escape:function(e){for(var t=0,n=0;n<e.length;++n)++t,e[n]!=re.SEPARATE_CHAR&&e[n]!=re.ESCAPE_CHAR||++t;if(t==e.length)return e;for(var r=new Array(t),i=0,o=0;i<e.length;++i,++o){var a=e[i];(a==re.SEPARATE_CHAR||a==re.ESCAPE_CHAR)&&(r[o]=re.ESCAPE_CHAR,++o),r[o]=a}return r}};function ie(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var oe=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.connector=t,this.hbInterval=35e3,this.hbDuration=1e4,this.daemon=0,this.contextMap=new i,this.listener=null}var t,n;return t=e,(n=[{key:"startup",value:function(){if(0==this.daemon){var e=this;this.daemon=setInterval((function(){e._daemon()}),this.hbInterval)}}},{key:"shutdown",value:function(){0!=this.daemon&&(clearInterval(this.daemon),this.daemon=0)}},{key:"setHeartbeatInterval",value:function(e){this.hbInterval!=e&&(this.hbInterval=e,this.shutdown(),this.startup())}},{key:"setListener",value:function(e){this.listener=e}},{key:"addSession",value:function(e,t){this.contextMap.containsKey(e.getId())||this.contextMap.put(e.getId(),new K(e,t))}},{key:"removeSession",value:function(e){this.contextMap.remove(e.getId())}},{key:"getContext",value:function(e){return this.contextMap.get(e.getId())}},{key:"processHeartbeat",value:function(e,t,n){if(h.isDebugLevel()&&h.d("HM","Heartbeat from "+e.address.toString()),null!=this.contextMap.get(e.getId())){var r=re.deserializeHeartbeat(t),i=re.serializeHeartbeatAck(r.tag,r.originateTimestamp,n,Date.now()),o=new D(i);this.connector.write(o)}else h.w("HM","No context: "+e.toString())}},{key:"processHeartbeatAck",value:function(e,t){var n=this.contextMap.get(e.getId());if(null!=n){var r=re.deserializeHeartbeatAck(t);r.originateTimestamp==n.originateTimestamp?h.d("HM","Received ack: "+e.toString()):h.d("HM","Can not find context : "+e.toString()),n.receiveTimestamp=r.receiveTimestamp,n.transmitTimestamp=r.transmitTimestamp,n.localTimestamp=Date.now()}else h.e("HM","Can not find session : "+e.toString())}},{key:"_daemon",value:function(){var e=Date.now(),t=this.contextMap.values();h.isDebugLevel()&&h.d("HM","Heartbeat ("+t.length+")");for(var n=0;n<t.length;++n){var r=t[n],i=r.localTimestamp-r.originateTimestamp;i>this.hbDuration&&this.listener.onSessionTimeout(r.session,i),r.originateTimestamp=e;var o=re.serializeHeartbeat(r.tag.toString(),e),a=new D(o);this.connector.write(a)}}}])&&ie(t.prototype,n),e}();function ae(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ue=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.session=t,this.data=new i}var t,n;return t=e,(n=[{key:"addPrimitive",value:function(e,t){var n=this.data.get(e);null==n?this.data.put(e,[t]):this.data.put(e,n.push(t))}},{key:"removePrimitive",value:function(e,t){var n=null,r=this.data.get(e);if(null!=r)for(var i=0;i<r.length;++i){var o=r[i];if(o.equalsSN(t)){n=o,r.splice(i,1);break}}return n}},{key:"clean",value:function(){this.data.clear()}}])&&ae(t.prototype,n),e}();function se(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ce=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.errorCode=t,this.description="Network error"}var t,n,r;return t=e,r=[{key:"transformError",value:function(t){var n=new e(1e3);switch(t){case 300:case 301:n.errorCode=e.NetworkConnectError,n.description="Network connection error";break;case G:case 201:case 202:case 203:n.errorCode=e.NetworkSocketError,n.description="Socket error";break;case 401:case 402:case 403:case 404:case 405:n.errorCode=e.NetworkIOError,n.description="Socket I/O error"}return n}}],(n=[{key:"getErrorCode",value:function(){return this.errorCode}},{key:"getDescription",value:function(){return this.description}}])&&se(t.prototype,n),r&&se(t,r),e}();ce.NetworkError=1e3,ce.NetworkConnectError=1010,ce.NetworkSocketError=1020,ce.NetworkIOError=1030,ce.HeartbeatTimeout=1040,ce.HandshakeError=2e3,ce.HandshakeTimeout=2001;var le=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.target=t,this.primitive=n};function fe(e){return(fe="function"==typeof Symbol&&"symbol"==a(Symbol.iterator)?function(e){return a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":a(e)})(e)}function he(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function pe(e,t){return(pe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function de(e,t){return!t||"object"!==fe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ve(e){return(ve=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ye=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&pe(e,t)}(i,e);var t,n,r=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ve(e);if(t){var i=ve(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return de(this,n)}}(i);function i(e,t,n){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(o=r.call(this)).tag=e,o.address=t,o.listener=n,o.serverTag=null,o.state=1,o.connector=null,o.session=null,o.secretKey=null,o.primitiveCapsule=null,o.reconnectTimer=0,o.reconnectEnabled=!0,o.handshakeTimer=0,o.handshakeTimeout=1e4,o.hm=null,o}return t=i,(n=[{key:"start",value:function(){if(null==this.address)return!1;if(2==this.state||3==this.state)return!0;if(this.state=2,this.reconnectTimer>0&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=0),this.connector=new q,this.connector.setHandler(this),this.hm=new oe(this.connector),this.hm.setListener(this),!this.connector.connect(this.address)){this.state=1,this.connector.setHandler(null),this.connector=null,this.hm.shutdown(),this.hm.setListener(null),this.hm=null;var e=this;this.reconnectTimer=setTimeout((function(){h.i("Speaker","Restart speaker: "+e.address.toString()),e.stop(),e.reconnectEnabled=!0,e.start()}),5e3)}return this.reconnectEnabled=!0,!0}},{key:"stop",value:function(){4!=this.state&&1!=this.state&&(h.i("Speaker","Stop speaker "+this.address.toString()),this.reconnectEnabled=!1,this.state=4,this.reconnectTimer>0&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=0),null!=this.connector&&this.connector.disconnect(),null!=this.hm&&(this.hm.shutdown(),this.hm.setListener(null),this.hm=null),this.handshakeTimer>0&&(clearTimeout(this.handshakeTimer),this.handshakeTimer=0),this.state=1)}},{key:"speak",value:function(e,t,n){if(3!=this.state)return!1;void 0===n&&(n=!1),n&&this.primitiveCapsule.addPrimitive(e,t);var r=re.serializeSpeak(e,t,n),i=new D(r);return i.setContext(new le(e,t)),this.connector.write(i),!0}},{key:"sessionCreated",value:function(e){h.d("Speaker","sessionCreated"),this.session=e,this.primitiveCapsule=new ue(e)}},{key:"sessionDestroyed",value:function(e){if(h.d("Speaker","sessionDestroyed"),null!=this.connector&&this.stop(),null!=this.primitiveCapsule&&(this.primitiveCapsule.clean(),this.primitiveCapsule=null),null!=this.hm&&(this.hm.removeSession(e),this.hm.shutdown(),this.hm=null),this.reconnectEnabled){var t=this;this.reconnectTimer=setTimeout((function(){h.i("Speaker","Reconnect "+t.address.toString()),t.stop(),t.reconnectEnabled=!0,t.start()}),5e3)}}},{key:"sessionOpened",value:function(e){h.d("Speaker","sessionOpened"),this.state=2,this.hm.addSession(e,this.tag.toString()),this.secretKey=null;var t=this;new w((function(){t.handshake()})).start()}},{key:"sessionClosed",value:function(e){h.d("Speaker","sessionClosed"),this.state=1,null!=this.hm&&(this.hm.shutdown(),this.hm.removeSession(e),this.hm.setListener(null),this.hm=null),this.handshakeTimer>0&&(clearTimeout(this.handshakeTimer),this.handshakeTimer=0),this.listener.onQuitted(this)}},{key:"messageReceived",value:function(e,t){var n=this;if(e&&t){var r=re.recognize(t.payload);re.SpeakNoAck==r?n.processSpeak(e,t,!1):re.SpeakAck==r?n.processSpeak(e,t,!0):re.Ack==r?n.processAck(e,t):re.Heartbeat==r?n.processHeartHeat(e,t):re.HeartbeatAck==r?n.processHeartHeatAck(e,t):re.Handshake==r?new w((function(){n.processHandshake(e,t)})).start():h.w("Speaker","Unknown protocol")}}},{key:"messageSent",value:function(e,t){var n=re.recognize(t.getPayload());if(re.SpeakNoAck==n||re.SpeakAck==n){var r=t.getContext();this.listener.onSpoke(this,r.target,r.primitive)}else re.Handshake==n&&this.session.setSecretKey(this.secretKey)}},{key:"errorOccurred",value:function(e,t){this.reconnectTimer>0&&clearTimeout(this.reconnectTimer);var n=this;this.reconnectTimer=setTimeout((function(){h.i("Speaker","Reconnect "+n.address.toString()),n.stop(),n.reconnectEnabled=!0,n.start()}),e==G?5e3:3e3);var r=ce.transformError(e);this.listener.onFailed(this,r)}},{key:"onSessionTimeout",value:function(e,t){var n=new ce(ce.HeartbeatTimeout);this.listener.onFailed(this,n)}},{key:"handshake",value:function(){h.isDebugLevel()&&h.d("Speaker","Handshake : "+this.address.toString()),this.handshakeTimer>0&&clearTimeout(this.handshakeTimer);var e=this;this.handshakeTimer=setTimeout((function(){var t=new ce(ce.HandshakeTimeout);e.listener.onFailed(e,t),clearTimeout(e.handshakeTimer),e.handshakeTimer=0,e.stop()}),this.handshakeTimeout),this.secretKey=l.toCharCode(l.randomString(8));var t=re.serializeHandshake(this.secretKey,this.tag.asString()),n=new D(t);try{this.connector.write(n)}catch(e){h.e("Speaker","Handshake failed: "+e)}}},{key:"processHandshake",value:function(e,t){var n=re.deserializeHandshake(t.payload);if(null!=n.key&&null!=n.tag){if(h.isDebugLevel()&&h.d("Speaker","Handshake Success"),this.handshakeTimer>0&&(clearTimeout(this.handshakeTimer),this.handshakeTimer=0),1==this.state)return;this.hm.startup(),this.serverTag=n.tag.toString(),this.state=3,this.listener.onContacted(this)}else{this.stop();var r=new ce(ce.HandshakeError);this.listener.onFailed(this,r)}}},{key:"processHeartHeat",value:function(e,t){this.hm.processHeartbeat(e,t.payload,Date.now())}},{key:"processHeartHeatAck",value:function(e,t){this.hm.processHeartbeatAck(e,t.payload)}},{key:"processSpeak",value:function(e,t,n){if(3==this.state){var r=re.deserializeSpeak(t.payload);null!=r.target&&null!=r.primitive&&(n&&this.ack(r.target,r.primitive),this.listener.onListened(this,r.target,r.primitive))}}},{key:"processAck",value:function(e,t){var n=re.deserializeAck(t.payload),r=this.primitiveCapsule.removePrimitive(n.target,n.sn);null!=n&&this.listener.onAck(this,n.target,r)}},{key:"ack",value:function(e,t){if(3!=this.state)return!1;if(null!=this.connector){var n=re.serializeAck(e,t),r=new D(n);this.connector.write(r)}return!0}}])&&he(t.prototype,n),i}(function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=function(e){_(r,e);var t=O(r);function r(){var e;S(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return e=t.call.apply(t,[this].concat(o)),n.forEach((function(t){t.prototype.initializer.call(E(e))})),e}return r}(e),o=function(e,t){Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t)).forEach((function(n){n.match(/^(?:constructor|prototype|arguments|caller|name|bind|call|apply|toString|length)$/)||Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))};return n.forEach((function(e){o(i.prototype,e.prototype),o(i,e)})),i}(B,$));function ge(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var me=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,(n=[{key:"ctor",value:function(){}},{key:"initializer",value:function(){}},{key:"onListened",value:function(e,t,n){}},{key:"onSpoke",value:function(e,t,n){}},{key:"onAck",value:function(e,t,n){}},{key:"onSpeakTimeout",value:function(e,t,n){}},{key:"onContacted",value:function(e){}},{key:"onQuitted",value:function(e){}},{key:"onFailed",value:function(e,t){}}])&&ge(t.prototype,n),e}();function be(e){return(be="function"==typeof Symbol&&"symbol"==a(Symbol.iterator)?function(e){return a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":a(e)})(e)}function we(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ke(e,t){return(ke=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Se(e,t){return!t||"object"!==be(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _e(e){return(_e=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Oe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ke(e,t)}(i,e);var t,n,r=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=_e(e);if(t){var i=_e(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Se(this,n)}}(i);function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(t=r.call(this)).service=e,t}return t=i,(n=[{key:"onListened",value:function(e,t,n){if(null!=this.service.allEventListeners)for(var r=0,i=this.service.allEventListeners.length;r<i;++r)this.service.allEventListeners[r].onListened(e,t,n);if(null!=this.service.listeners){var o=this.service.listeners.get(t);null!=o&&o.onListened(e,t,n)}null!=this.service.eventListeners&&this.triggerEvent("onListened",{speaker:e,cellet:t,primitive:n})}},{key:"onSpoke",value:function(e,t,n){if(null!=this.service.allEventListeners)for(var r=0,i=this.service.allEventListeners.length;r<i;++r)this.service.allEventListeners[r].onSpoke(e,t,n);if(null!=this.service.listeners){var o=this.service.listeners.get(t);null!=o&&o.onSpoke(e,t,n)}null!=this.service.eventListeners&&this.triggerEvent("onSpoke",{speaker:e,cellet:t,primitive:n})}},{key:"onAck",value:function(e,t,n){if(null!=this.service.allEventListeners)for(var r=0,i=this.service.allEventListeners.length;r<i;++r)this.service.allEventListeners[r].onAck(e,t,n);if(null!=this.service.listeners){var o=this.service.listeners.get(t);null!=o&&o.onAck(e,t,n)}null!=this.service.eventListeners&&this.triggerEvent("onAck",{speaker:e,cellet:t,primitive:n})}},{key:"onSpeakTimeout",value:function(e,t,n){if(null!=this.service.allEventListeners)for(var r=0,i=this.service.allEventListeners.length;r<i;++r)this.service.allEventListeners[r].onSpeakTimeout(e,t,n);if(null!=this.service.listeners){var o=this.service.listeners.get(t);null!=o&&o.onSpeakTimeout(e,t,n)}null!=this.service.eventListeners&&this.triggerEvent("onSpeakTimeout",{speaker:e,cellet:t,primitive:n})}},{key:"onContacted",value:function(e){if(null!=this.service.eventListeners&&this.triggerEvent("onContacted",{speaker:e}),null!=this.service.allEventListeners)for(var t=0,n=this.service.allEventListeners.length;t<n;++t)this.service.allEventListeners[t].onContacted(e);if(null!=this.service.listeners)for(var r=this.service.listeners.keySet(),i=0;i<r.length;++i){var o=r[i],a=this.service.listeners.get(o),u=this.service.celletSpeakerMap.get(o);null!=u?u==e&&a.onContacted(e):a.onContacted(e)}}},{key:"onQuitted",value:function(e){if(null!=this.service.eventListeners&&this.triggerEvent("onQuitted",{speaker:e}),null!=this.service.allEventListeners)for(var t=0,n=this.service.allEventListeners.length;t<n;++t)this.service.allEventListeners[t].onQuitted(e);if(null!=this.service.listeners)for(var r=this.service.listeners.keySet(),i=0;i<r.length;++i){var o=r[i],a=this.service.listeners.get(o),u=this.service.celletSpeakerMap.get(o);null!=u?u==e&&a.onQuitted(e):a.onQuitted(e)}}},{key:"onFailed",value:function(e,t){if(null!=this.service.allEventListeners)for(var n=0,r=this.service.allEventListeners.length;n<r;++n)this.service.allEventListeners[n].onFailed(e,t);if(null!=this.service.listeners)for(var i=this.service.listeners.values(),o=0;o<i.length;++o)i[o].onFailed(e,t);null!=this.service.eventListeners&&this.triggerEvent("onFailed",{speaker:e,error:t})}},{key:"triggerEvent",value:function(e,t){var n=this.service.eventListeners.get(e);if(null!=n)for(var r=0;r<n.length;++r)n[r].call(null,t);if(null!=(n=this.service.eventListeners.get("*")))for(var i=0;i<n.length;++i)n[i].call(null,t)}}])&&we(t.prototype,n),i}(me);function Re(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ee=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tag=t,this.config=n,this.speakers=new i,this.celletSpeakerMap=new i,this.listenerProxy=new Oe(this),this.listeners=null,this.eventListeners=null,this.allEventListeners=null}var t,n;return t=e,(n=[{key:"hangupAll",value:function(){for(var e=this.speakers.values(),t=0;t<e.length;++t)e[t].stop();new Thread((function(){this.speakers.clear(),this.celletSpeakerMap.clear()}),this).delay(10)}},{key:"setListener",value:function(e,t){null==this.listeners&&(this.listeners=new i),null==t?this.listeners.remove(e):this.listeners.put(e,t)}},{key:"removeListener",value:function(e){null!=this.listeners&&this.listeners.remove(e)}},{key:"isWebSocketSupported",value:function(){return void 0!==window.WebSocket}},{key:"isCalled",value:function(e){if(void 0!==e){var t=this.celletSpeakerMap.get(e);return null!=t&&3==t.state}var n=this.speakers.values();return 0!=n.length&&3==n[0].state}},{key:"call",value:function(e,t){if(!this.isWebSocketSupported())return h.i("Brower",window.navigator.userAgent),h.e("TalkService","This brower can NOT support WebSocket"),null;var n=e.toString(),r=this.speakers.get(n);if(null==r&&(r=new ye(this.tag,e,this.listenerProxy),this.speakers.put(n,r)),!r.start())return this.speakers.remove(n),null;if(void 0!==t)for(var i=0;i<t.length;++i)this.celletSpeakerMap.put(t[i],r);return r}},{key:"hangup",value:function(e){var t=e.toString(),n=this.speakers.get(t);if(null!=n){n.stop();for(var r=this.celletSpeakerMap.keySet(),i=0;i<r.length;++i){var o=r[i];this.celletSpeakerMap.get(o)==n&&this.celletSpeakerMap.remove(o)}}}},{key:"speak",value:function(e,t,n){var r=this.celletSpeakerMap.get(e);if(null==r){var i=this.speakers.values();if(0==i.length)return!1;r=i[0],this.celletSpeakerMap.put(e,r)}return r.speak(e,t,n)}},{key:"addListener",value:function(e,t){if("string"==typeof e){null==this.eventListeners&&(this.eventListeners=new i);var n=this.eventListeners.get(e);null==n?(n=[t],this.eventListeners.put(e,n)):n.push(t)}else null==this.allEventListeners?this.allEventListeners=[e]:this.allEventListeners.indexOf(e)<0&&this.allEventListeners.push(e)}},{key:"removeListener",value:function(e,t){if("string"==typeof e){if(null==this.eventListeners)return;var n=this.eventListeners.get(e);if(null!=n){var r=n.indexOf(t);r>=0&&(n.splice(r,1),0==n.length&&this.eventListeners.remove(e))}}else if(null!=this.allEventListeners){var i=this.allEventListeners.indexOf(e);i>=0&&this.allEventListeners.splice(i,1)}}}])&&Re(t.prototype,n),e}();function xe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ce=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=void 0===t?new m:t,this.version=new d,this.tag=new g,this.talkService=new Ee(this.tag,t),this.talk=this.talkService,h.i("Nucleus","Cell "+this.version.getNumbers()+" (Build JavaScript/Web - "+this.version.NAME+")")}var t,n;return t=e,(n=[{key:"destroy",value:function(){null!=this.talkService&&(this.talkService.hangupAll(),this.talkService=null,this.talk=null),this.config=null,this.version=null,this.tag=null}},{key:"getTag",value:function(){return this.tag}},{key:"getTalkService",value:function(){return this.talkService}}])&&xe(t.prototype,n),e}();function Pe(e){return(Pe="function"==typeof Symbol&&"symbol"==a(Symbol.iterator)?function(e){return a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":a(e)})(e)}function Te(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ae(e,t){return(Ae=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function je(e,t){return!t||"object"!==Pe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Me(e){return(Me=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ne={ByteUtils:c,Utils:l,Logger:h,LogLevel:f,Version:d,FastMap:i,InetAddress:u,Nucleus:Ce,NucleusConfig:m,NucleusTag:g,TalkService:Ee,TalkListener:me,Speaker:ye,Primitive:ne,ActionDialect:function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ae(e,t)}(i,e);var t,n,r=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Me(e);if(t){var i=Me(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return je(this,n)}}(i);function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),t=r.call(this),"string"==typeof e?t.stuffList.push(new ee(e.toString(),Q.STRING)):(t.sn=e.sn,t.stuffList=e.stuffList),t}return t=i,(n=[{key:"setName",value:function(e){this.stuffList[0]=new ee(e,Q.STRING)}},{key:"getName",value:function(){return this.stuffList[0].getValueAsString()}},{key:"numParams",value:function(){return parseInt((this.stuffList.length-1)/2)}},{key:"containsParam",value:function(e){for(var t=1,n=this.stuffList.length;t<n;t+=2)if(this.stuffList[t].getValueAsString()==e)return!0;return!1}},{key:"addParam",value:function(e,t,n){var r=this.keyIndex(e);r>0?this.stuffList[r+1]=new ee(t,n):(this.stuffList.push(new ee(e,Q.STRING)),this.stuffList.push(new ee(t,n)))}},{key:"getParam",value:function(e){var t=this.getValueStuff(e);return null==t?null:t.getLiteralValue()}},{key:"getParamAsString",value:function(e){var t=this.getValueStuff(e);return null==t?null:t.getValueAsString()}},{key:"getParamAsInt",value:function(e){var t=this.getValueStuff(e);return null==t?null:t.getValueAsInt()}},{key:"getParamAsLong",value:function(e){var t=this.getValueStuff(e);return null==t?null:t.getValueAsLong()}},{key:"getParamAsFloat",value:function(e){var t=this.getValueStuff(e);return null==t?null:t.getValueAsFloat()}},{key:"getParamAsDouble",value:function(e){var t=this.getValueStuff(e);return null==t?null:t.getValueAsDouble()}},{key:"getParamAsBool",value:function(e){var t=this.getValueStuff(e);return null==t?null:t.getValueAsBool()}},{key:"getParamAsJson",value:function(e){var t=this.getValueStuff(e);return null==t?null:t.getValueAsJson()}},{key:"getValueStuff",value:function(e){for(var t=1,n=this.stuffList.length;t<n;t+=2)if(this.stuffList[t].getValueAsString()==e)return this.stuffList[t+1];return null}},{key:"keyIndex",value:function(e){for(var t=1,n=this.stuffList.length;t<n;t+=2)if(this.stuffList[t].getValueAsString()==e)return t;return-1}}])&&Te(t.prototype,n),i}(ne),LiteralBase:Q,TalkError:ce};t.default=Ne}])},"object"==a(t)&&"object"==a(e)?e.exports=o():(r=[],void 0===(i="function"==typeof(n=o)?n.apply(t,r):n)||(e.exports=i))}).call(this,n(335)(e))},function(e,t,n){var r=n(5);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){var r=n(49)("wks"),i=n(34),o=n(3).Symbol,a="function"==typeof o;(e.exports=function(e){return r[e]||(r[e]=a&&o[e]||(a?o:i)("Symbol."+e))}).store=r},function(e,t,n){var r=n(22),i=Math.min;e.exports=function(e){return e>0?i(r(e),9007199254740991):0}},function(e,t,n){e.exports=!n(4)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},function(e,t,n){var r=n(2),i=n(96),o=n(24),a=Object.defineProperty;t.f=n(8)?Object.defineProperty:function(e,t,n){if(r(e),t=o(t,!0),r(n),i)try{return a(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){var r=n(25);e.exports=function(e){return Object(r(e))}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,n){var r=n(9),i=n(33);e.exports=n(8)?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){var r=n(3),i=n(12),o=n(15),a=n(34)("src"),u=n(136),s=(""+u).split("toString");n(19).inspectSource=function(e){return u.call(e)},(e.exports=function(e,t,n,u){var c="function"==typeof n;c&&(o(n,"name")||i(n,"name",t)),e[t]!==n&&(c&&(o(n,a)||i(n,a,e[t]?""+e[t]:s.join(String(t)))),e===r?e[t]=n:u?e[t]?e[t]=n:i(e,t,n):(delete e[t],i(e,t,n)))})(Function.prototype,"toString",(function(){return"function"==typeof this&&this[a]||u.call(this)}))},function(e,t,n){var r=n(0),i=n(4),o=n(25),a=/"/g,u=function(e,t,n,r){var i=String(o(e)),u="<"+t;return""!==n&&(u+=" "+n+'="'+String(r).replace(a,"&quot;")+'"'),u+">"+i+"</"+t+">"};e.exports=function(e,t){var n={};n[e]=t(u),r(r.P+r.F*i((function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3})),"String",n)}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,n){var r=n(50),i=n(25);e.exports=function(e){return r(i(e))}},function(e,t,n){var r=n(51),i=n(33),o=n(16),a=n(24),u=n(15),s=n(96),c=Object.getOwnPropertyDescriptor;t.f=n(8)?c:function(e,t){if(e=o(e),t=a(t,!0),s)try{return c(e,t)}catch(e){}if(u(e,t))return i(!r.f.call(e,t),e[t])}},function(e,t,n){var r=n(15),i=n(10),o=n(71)("IE_PROTO"),a=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=i(e),r(e,o)?e[o]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?a:null}},function(e,t){var n=e.exports={version:"2.6.11"};"number"==typeof __e&&(__e=n)},function(e,t,n){var r=n(11);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t){var n=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:n)(e)}},function(e,t,n){"use strict";var r=n(4);e.exports=function(e,t){return!!e&&r((function(){t?e.call(null,(function(){}),1):e.call(null)}))}},function(e,t,n){var r=n(5);e.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,n){var r=n(0),i=n(19),o=n(4);e.exports=function(e,t){var n=(i.Object||{})[e]||Object[e],a={};a[e]=t(n),r(r.S+r.F*o((function(){n(1)})),"Object",a)}},function(e,t,n){var r=n(20),i=n(50),o=n(10),a=n(7),u=n(87);e.exports=function(e,t){var n=1==e,s=2==e,c=3==e,l=4==e,f=6==e,h=5==e||f,p=t||u;return function(t,u,d){for(var v,y,g=o(t),m=i(g),b=r(u,d,3),w=a(m.length),k=0,S=n?p(t,w):s?p(t,0):void 0;w>k;k++)if((h||k in m)&&(y=b(v=m[k],k,g),e))if(n)S[k]=y;else if(y)switch(e){case 3:return!0;case 5:return v;case 6:return k;case 2:S.push(v)}else if(l)return!1;return f?-1:c||l?l:S}}},function(e,t,n){"use strict";if(n(8)){var r=n(30),i=n(3),o=n(4),a=n(0),u=n(64),s=n(95),c=n(20),l=n(40),f=n(33),h=n(12),p=n(42),d=n(22),v=n(7),y=n(124),g=n(36),m=n(24),b=n(15),w=n(45),k=n(5),S=n(10),_=n(84),O=n(37),R=n(18),E=n(38).f,x=n(86),C=n(34),P=n(6),T=n(27),A=n(54),j=n(53),M=n(89),N=n(47),L=n(59),I=n(39),D=n(88),F=n(113),B=n(9),z=n(17),G=B.f,U=z.f,H=i.RangeError,J=i.TypeError,V=i.Uint8Array,W=Array.prototype,q=s.ArrayBuffer,K=s.DataView,Z=T(0),$=T(2),Q=T(3),X=T(4),Y=T(5),ee=T(6),te=A(!0),ne=A(!1),re=M.values,ie=M.keys,oe=M.entries,ae=W.lastIndexOf,ue=W.reduce,se=W.reduceRight,ce=W.join,le=W.sort,fe=W.slice,he=W.toString,pe=W.toLocaleString,de=P("iterator"),ve=P("toStringTag"),ye=C("typed_constructor"),ge=C("def_constructor"),me=u.CONSTR,be=u.TYPED,we=u.VIEW,ke=T(1,(function(e,t){return Ee(j(e,e[ge]),t)})),Se=o((function(){return 1===new V(new Uint16Array([1]).buffer)[0]})),_e=!!V&&!!V.prototype.set&&o((function(){new V(1).set({})})),Oe=function(e,t){var n=d(e);if(n<0||n%t)throw H("Wrong offset!");return n},Re=function(e){if(k(e)&&be in e)return e;throw J(e+" is not a typed array!")},Ee=function(e,t){if(!k(e)||!(ye in e))throw J("It is not a typed array constructor!");return new e(t)},xe=function(e,t){return Ce(j(e,e[ge]),t)},Ce=function(e,t){for(var n=0,r=t.length,i=Ee(e,r);r>n;)i[n]=t[n++];return i},Pe=function(e,t,n){G(e,t,{get:function(){return this._d[n]}})},Te=function(e){var t,n,r,i,o,a,u=S(e),s=arguments.length,l=s>1?arguments[1]:void 0,f=void 0!==l,h=x(u);if(null!=h&&!_(h)){for(a=h.call(u),r=[],t=0;!(o=a.next()).done;t++)r.push(o.value);u=r}for(f&&s>2&&(l=c(l,arguments[2],2)),t=0,n=v(u.length),i=Ee(this,n);n>t;t++)i[t]=f?l(u[t],t):u[t];return i},Ae=function(){for(var e=0,t=arguments.length,n=Ee(this,t);t>e;)n[e]=arguments[e++];return n},je=!!V&&o((function(){pe.call(new V(1))})),Me=function(){return pe.apply(je?fe.call(Re(this)):Re(this),arguments)},Ne={copyWithin:function(e,t){return F.call(Re(this),e,t,arguments.length>2?arguments[2]:void 0)},every:function(e){return X(Re(this),e,arguments.length>1?arguments[1]:void 0)},fill:function(e){return D.apply(Re(this),arguments)},filter:function(e){return xe(this,$(Re(this),e,arguments.length>1?arguments[1]:void 0))},find:function(e){return Y(Re(this),e,arguments.length>1?arguments[1]:void 0)},findIndex:function(e){return ee(Re(this),e,arguments.length>1?arguments[1]:void 0)},forEach:function(e){Z(Re(this),e,arguments.length>1?arguments[1]:void 0)},indexOf:function(e){return ne(Re(this),e,arguments.length>1?arguments[1]:void 0)},includes:function(e){return te(Re(this),e,arguments.length>1?arguments[1]:void 0)},join:function(e){return ce.apply(Re(this),arguments)},lastIndexOf:function(e){return ae.apply(Re(this),arguments)},map:function(e){return ke(Re(this),e,arguments.length>1?arguments[1]:void 0)},reduce:function(e){return ue.apply(Re(this),arguments)},reduceRight:function(e){return se.apply(Re(this),arguments)},reverse:function(){for(var e,t=Re(this).length,n=Math.floor(t/2),r=0;r<n;)e=this[r],this[r++]=this[--t],this[t]=e;return this},some:function(e){return Q(Re(this),e,arguments.length>1?arguments[1]:void 0)},sort:function(e){return le.call(Re(this),e)},subarray:function(e,t){var n=Re(this),r=n.length,i=g(e,r);return new(j(n,n[ge]))(n.buffer,n.byteOffset+i*n.BYTES_PER_ELEMENT,v((void 0===t?r:g(t,r))-i))}},Le=function(e,t){return xe(this,fe.call(Re(this),e,t))},Ie=function(e){Re(this);var t=Oe(arguments[1],1),n=this.length,r=S(e),i=v(r.length),o=0;if(i+t>n)throw H("Wrong length!");for(;o<i;)this[t+o]=r[o++]},De={entries:function(){return oe.call(Re(this))},keys:function(){return ie.call(Re(this))},values:function(){return re.call(Re(this))}},Fe=function(e,t){return k(e)&&e[be]&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},Be=function(e,t){return Fe(e,t=m(t,!0))?f(2,e[t]):U(e,t)},ze=function(e,t,n){return!(Fe(e,t=m(t,!0))&&k(n)&&b(n,"value"))||b(n,"get")||b(n,"set")||n.configurable||b(n,"writable")&&!n.writable||b(n,"enumerable")&&!n.enumerable?G(e,t,n):(e[t]=n.value,e)};me||(z.f=Be,B.f=ze),a(a.S+a.F*!me,"Object",{getOwnPropertyDescriptor:Be,defineProperty:ze}),o((function(){he.call({})}))&&(he=pe=function(){return ce.call(this)});var Ge=p({},Ne);p(Ge,De),h(Ge,de,De.values),p(Ge,{slice:Le,set:Ie,constructor:function(){},toString:he,toLocaleString:Me}),Pe(Ge,"buffer","b"),Pe(Ge,"byteOffset","o"),Pe(Ge,"byteLength","l"),Pe(Ge,"length","e"),G(Ge,ve,{get:function(){return this[be]}}),e.exports=function(e,t,n,s){var c=e+((s=!!s)?"Clamped":"")+"Array",f="get"+e,p="set"+e,d=i[c],g=d||{},m=d&&R(d),b=!d||!u.ABV,S={},_=d&&d.prototype,x=function(e,n){G(e,n,{get:function(){return function(e,n){var r=e._d;return r.v[f](n*t+r.o,Se)}(this,n)},set:function(e){return function(e,n,r){var i=e._d;s&&(r=(r=Math.round(r))<0?0:r>255?255:255&r),i.v[p](n*t+i.o,r,Se)}(this,n,e)},enumerable:!0})};b?(d=n((function(e,n,r,i){l(e,d,c,"_d");var o,a,u,s,f=0,p=0;if(k(n)){if(!(n instanceof q||"ArrayBuffer"==(s=w(n))||"SharedArrayBuffer"==s))return be in n?Ce(d,n):Te.call(d,n);o=n,p=Oe(r,t);var g=n.byteLength;if(void 0===i){if(g%t)throw H("Wrong length!");if((a=g-p)<0)throw H("Wrong length!")}else if((a=v(i)*t)+p>g)throw H("Wrong length!");u=a/t}else u=y(n),o=new q(a=u*t);for(h(e,"_d",{b:o,o:p,l:a,e:u,v:new K(o)});f<u;)x(e,f++)})),_=d.prototype=O(Ge),h(_,"constructor",d)):o((function(){d(1)}))&&o((function(){new d(-1)}))&&L((function(e){new d,new d(null),new d(1.5),new d(e)}),!0)||(d=n((function(e,n,r,i){var o;return l(e,d,c),k(n)?n instanceof q||"ArrayBuffer"==(o=w(n))||"SharedArrayBuffer"==o?void 0!==i?new g(n,Oe(r,t),i):void 0!==r?new g(n,Oe(r,t)):new g(n):be in n?Ce(d,n):Te.call(d,n):new g(y(n))})),Z(m!==Function.prototype?E(g).concat(E(m)):E(g),(function(e){e in d||h(d,e,g[e])})),d.prototype=_,r||(_.constructor=d));var C=_[de],P=!!C&&("values"==C.name||null==C.name),T=De.values;h(d,ye,!0),h(_,be,c),h(_,we,!0),h(_,ge,d),(s?new d(1)[ve]==c:ve in _)||G(_,ve,{get:function(){return c}}),S[c]=d,a(a.G+a.W+a.F*(d!=g),S),a(a.S,c,{BYTES_PER_ELEMENT:t}),a(a.S+a.F*o((function(){g.of.call(d,1)})),c,{from:Te,of:Ae}),"BYTES_PER_ELEMENT"in _||h(_,"BYTES_PER_ELEMENT",t),a(a.P,c,Ne),I(c),a(a.P+a.F*_e,c,{set:Ie}),a(a.P+a.F*!P,c,De),r||_.toString==he||(_.toString=he),a(a.P+a.F*o((function(){new d(1).slice()})),c,{slice:Le}),a(a.P+a.F*(o((function(){return[1,2].toLocaleString()!=new d([1,2]).toLocaleString()}))||!o((function(){_.toLocaleString.call([1,2])}))),c,{toLocaleString:Me}),N[c]=P?C:T,r||P||h(_,de,T)}}else e.exports=function(){}},function(e,t,n){var r=n(119),i=n(0),o=n(49)("metadata"),a=o.store||(o.store=new(n(122))),u=function(e,t,n){var i=a.get(e);if(!i){if(!n)return;a.set(e,i=new r)}var o=i.get(t);if(!o){if(!n)return;i.set(t,o=new r)}return o};e.exports={store:a,map:u,has:function(e,t,n){var r=u(t,n,!1);return void 0!==r&&r.has(e)},get:function(e,t,n){var r=u(t,n,!1);return void 0===r?void 0:r.get(e)},set:function(e,t,n,r){u(n,r,!0).set(e,t)},keys:function(e,t){var n=u(e,t,!1),r=[];return n&&n.forEach((function(e,t){r.push(t)})),r},key:function(e){return void 0===e||"symbol"==typeof e?e:String(e)},exp:function(e){i(i.S,"Reflect",e)}}},function(e,t){e.exports=!1},function(e,t,n){var r=n(34)("meta"),i=n(5),o=n(15),a=n(9).f,u=0,s=Object.isExtensible||function(){return!0},c=!n(4)((function(){return s(Object.preventExtensions({}))})),l=function(e){a(e,r,{value:{i:"O"+ ++u,w:{}}})},f=e.exports={KEY:r,NEED:!1,fastKey:function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!o(e,r)){if(!s(e))return"F";if(!t)return"E";l(e)}return e[r].i},getWeak:function(e,t){if(!o(e,r)){if(!s(e))return!0;if(!t)return!1;l(e)}return e[r].w},onFreeze:function(e){return c&&f.NEED&&s(e)&&!o(e,r)&&l(e),e}}},function(e,t,n){var r=n(6)("unscopables"),i=Array.prototype;null==i[r]&&n(12)(i,r,{}),e.exports=function(e){i[r][e]=!0}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t){var n=0,r=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+r).toString(36))}},function(e,t,n){var r=n(98),i=n(72);e.exports=Object.keys||function(e){return r(e,i)}},function(e,t,n){var r=n(22),i=Math.max,o=Math.min;e.exports=function(e,t){return(e=r(e))<0?i(e+t,0):o(e,t)}},function(e,t,n){var r=n(2),i=n(99),o=n(72),a=n(71)("IE_PROTO"),u=function(){},s=function(){var e,t=n(69)("iframe"),r=o.length;for(t.style.display="none",n(73).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),s=e.F;r--;)delete s.prototype[o[r]];return s()};e.exports=Object.create||function(e,t){var n;return null!==e?(u.prototype=r(e),n=new u,u.prototype=null,n[a]=e):n=s(),void 0===t?n:i(n,t)}},function(e,t,n){var r=n(98),i=n(72).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},function(e,t,n){"use strict";var r=n(3),i=n(9),o=n(8),a=n(6)("species");e.exports=function(e){var t=r[e];o&&t&&!t[a]&&i.f(t,a,{configurable:!0,get:function(){return this}})}},function(e,t){e.exports=function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!");return e}},function(e,t,n){var r=n(20),i=n(111),o=n(84),a=n(2),u=n(7),s=n(86),c={},l={};(t=e.exports=function(e,t,n,f,h){var p,d,v,y,g=h?function(){return e}:s(e),m=r(n,f,t?2:1),b=0;if("function"!=typeof g)throw TypeError(e+" is not iterable!");if(o(g)){for(p=u(e.length);p>b;b++)if((y=t?m(a(d=e[b])[0],d[1]):m(e[b]))===c||y===l)return y}else for(v=g.call(e);!(d=v.next()).done;)if((y=i(v,m,d.value,t))===c||y===l)return y}).BREAK=c,t.RETURN=l},function(e,t,n){var r=n(13);e.exports=function(e,t,n){for(var i in t)r(e,i,t[i],n);return e}},function(e,t,n){var r=n(5);e.exports=function(e,t){if(!r(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},function(e,t,n){var r=n(9).f,i=n(15),o=n(6)("toStringTag");e.exports=function(e,t,n){e&&!i(e=n?e:e.prototype,o)&&r(e,o,{configurable:!0,value:t})}},function(e,t,n){var r=n(21),i=n(6)("toStringTag"),o="Arguments"==r(function(){return arguments}());e.exports=function(e){var t,n,a;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),i))?n:o?r(t):"Object"==(a=r(t))&&"function"==typeof t.callee?"Arguments":a}},function(e,t,n){var r=n(0),i=n(25),o=n(4),a=n(75),u="["+a+"]",s=RegExp("^"+u+u+"*"),c=RegExp(u+u+"*$"),l=function(e,t,n){var i={},u=o((function(){return!!a[e]()||""!=""[e]()})),s=i[e]=u?t(f):a[e];n&&(i[n]=s),r(r.P+r.F*u,"String",i)},f=l.trim=function(e,t){return e=String(i(e)),1&t&&(e=e.replace(s,"")),2&t&&(e=e.replace(c,"")),e};e.exports=l},function(e,t){e.exports={}},function(e,t,n){(function(t){var n;"undefined"!=typeof window?window:void 0!==t||"undefined"!=typeof self&&self,n=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t),n.d(t,"InDB",(function(){return s})),n.d(t,"InDBStore",(function(){return c}));var r=n(1);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}var s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o(this,e);var n=t.name,i=t.version,a=void 0===i?1:i,u=t.stores,s=!n;n||(n="__indb__"),u&&Array.isArray(u)&&u.length||(u=[{name:"__indb__",isKv:!0}]),this.name=n,this.version=a,this.stores=u;var c=indexedDB.open(n,a);if(c.onupgradeneeded=function(e){var t=e.target.result,n=Array.from(t.objectStoreNames),r=[];u.forEach((function(i){var o=null;if(n.indexOf(i.name)>-1)o=e.target.transaction.objectStore(i.name);else{var a=i.isKv?"key":i.keyPath,u=!i.isKv&&i.autoIncrement;o=t.createObjectStore(i.name,{keyPath:a,autoIncrement:u})}var s=o.indexNames;s&&s.length&&Array.from(s).forEach((function(e){return o.deleteIndex(e)})),i.indexes&&i.indexes.length&&i.indexes.forEach((function(e){o.createIndex(e.name,e.keyPath||e.name,{unique:e.unique,multiEntry:Array.isArray(e.keyPath)})})),r.push(i.name)})),n&&n.forEach((function(e){-1===r.indexOf(e)&&t.deleteObjectStore(e)}))},c.onblocked=function(e){console.error(Object(r.a)(new Error("indexedDB "+n+" is blocked")))},this.using={},s)return this.use(n)}return u(e,[{key:"connect",value:function(){var e=this;return new Promise((function(t,n){var i=indexedDB.open(e.name,e.version);i.onerror=function(e){n(Object(r.a)(e))},i.onsuccess=function(e){t(e.target.result)}}))}},{key:"use",value:function(e){var t=this.stores.find((function(t){return t.name===e}));if(!t)throw new Error("[InDB]: store ".concat(e," is not existing."));if(this.using[e])return this.using[e];var n=new c({db:this,store:t});return t.isKv&&(n.key=function(e){return n.keys().then((function(t){return t&&t[e]}))},n.getItem=function(e){return n.get(e).then((function(e){return e&&e.value}))},n.setItem=function(e,t){return n.put({key:e,value:t})},n.removeItem=function(e){return n.delete(e)}),this.using[e]=n,n}},{key:"close",value:function(){return this.using=null,this.stores=null,this.connect().then((function(e){e.close()}))}}]),e}();s.deleteDatabase=function(e){return new Promise((function(t,n){var r=indexedDB.deleteDatabase(e);r.onsuccess=function(){t()},r.onerror=function(e){n(e)}}))},s.databases=function(){return indexedDB.databases()},t.default=s;var c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o(this,e);var n=t.store,r=t.db;if("object"!==i(n)||!n.name||"string"!=typeof n.name)throw new Error("[InDBStore]: options.store should be a store config object.");if(!(r instanceof s))throw new Error("[InDBStore]: options.db should be an instanceof InDB.");this.store=n,this.db=r,this.name=n.name,this.keyPath=n.isKv?"key":n.keyPath}return u(e,[{key:"transaction",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=this.name,r=t?"readwrite":"readonly",i=this.db.connection,o=i?Promise.resolve(i):this.db.connect();return o.then((function(t){e.db.connection=t;var i=t.transaction(n,r),o=function(){e.db.connection=null};return i.oncomplete=o,i.onabort=o,i.onerror=o,i}))}},{key:"objectStore",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.name;return this.transaction(e).then((function(e){return e.objectStore(t)}))}},{key:"cursor",value:function(e){var t=e.index,n=e.range,i=e.direction,o=e.onTouch,a=e.onDone,u=e.onError,s=e.writable,c=void 0!==s&&s;return this.objectStore(c).then((function(e){var s=t?e.index(t):e,c=s.openCursor(n,i);c.onsuccess=function(e){var t=e.target.result;t?o(t,s):a(t,s)},c.onerror=function(e){u(Object(r.a)(e))}}))}},{key:"request",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.writable,o=void 0!==i&&i;return new Promise((function(n,i){t.objectStore(o).then((function(t){var o=e(t);o.onsuccess=function(e){var t=e.target.result;n(t)},o.onerror=function(e){i(Object(r.a)(e))}}))}))}},{key:"iterate",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.index,i=n.range,o=n.writable,a=void 0!==o&&o,u=n.direction,s=void 0===u?"next":u;return new Promise((function(n,o){t.cursor({index:r,range:i,writable:a,direction:s,onTouch:function(t,r){e(t,(function(){return t.continue()}),(function(){r.transaction.commit(),n()}))},onDone:function(){n()},onError:function(e){o(e)}})}))}},{key:"batch",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.writable,o=void 0===i||i;return this.transaction(o).then((function(n){var i=t.name,o=[],a=n.objectStore(i);return e.forEach((function(e){var t=new Promise((function(t,n){var i=e(a);i.onsuccess=function(e){var n=e.target.result;t(n)},i.onerror=function(e){n(Object(r.a)(e))}}));o.push(t)})),Promise.all(o)}))}},{key:"get",value:function(e){if(!Array.isArray(e))return this.request((function(t){return t.get(e)}));var t=e.map((function(e){return function(t){return t.get(e)}}));return this.batch(t,{writable:!1})}},{key:"keys",value:function(){var e=this.keyPath,t=[];return this.each((function(n){var i=Object(r.b)(n,e);t.push(i)})).then((function(){return t}))}},{key:"all",value:function(){var e=[];return this.each((function(t){e.push(t)})).then((function(){return e}))}},{key:"count",value:function(){return this.request((function(e){return e.count()}))}},{key:"each",value:function(e){return this.iterate((function(t,n){var r=t.value;e(r),n()}))}},{key:"reverse",value:function(e){return this.iterate((function(t,n){var r=t.value;e(r),n()}),{direction:"prev"})}},{key:"some",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new Promise((function(r,i){var o,a=[],u=0,s=n,c=n+t;n<0&&(o="prev",t=Math.min(t,-n),c=(s=-(n+t)||0)+t),e.iterate((function(e,t,n){u<s?(u++,t()):u<c?(a.push(e.value),u++,t()):n()}),{direction:o}).then((function(){n<0&&a.reverse(),r(a)})).catch(i)}))}},{key:"first",value:function(){return this.some(1).then((function(e){return e[0]}))}},{key:"last",value:function(){return this.some(1,-1).then((function(e){return e[0]}))}},{key:"find",value:function(e,t){return this.request((function(n){return n.index(e).get(t)}))}},{key:"query",value:function(e,t,n){var i=this,o=function(){switch(n){case">":return IDBKeyRange.lowerBound(t,!0);case">=":return IDBKeyRange.lowerBound(t);case"<":return IDBKeyRange.upperBound(t,!0);case"<=":return IDBKeyRange.upperBound(t);case"%":case"!=":case"in":return;default:return IDBKeyRange.only(t)}}(),a=[];return new Promise((function(u,s){i.cursor({index:e,range:o,onTouch:function(e,i){var o=e.value,u=i.keyPath,s=Object(r.b)(o,u);"!="===n?s!==t&&a.push(o):"%"===n?"string"==typeof s&&s.indexOf(t)>-1&&a.push(o):"in"===n?Array.isArray(t)&&t.indexOf(s)>-1&&a.push(o):a.push(o),e.continue()},onDone:function(){u(a)},onError:function(e){s(e)}})}))}},{key:"select",value:function(e){var t=this.store.indexes||[],n={};t.forEach((function(e){var t=e.name,r=e.keyPath;n[t]=r}));for(var i=[],o=[],a=0,u=e.length;a<u;a++){var s=e[a],c=s.key,l=s.value,f=s.compare,h=s.optional,p=n[c]||c;h?i.push({keyPath:p,value:l,compare:f}):o.push({keyPath:p,value:l,compare:f})}var d=[];return this.each((function(e){(function(e){for(var t=function(e,t,n){if(void 0===e)return!1;switch(n){case">":return e>t;case">=":return e>=t;case"<":return e<t;case"<=":return e<=t;case"!=":return e!==t;case"%":return"string"==typeof e&&e.indexOf(t)>-1;case"in":return Array.isArray(t)&&t.indexOf(e)>-1;default:return e===t}},n=0,a=o.length;n<a;n++){var u=o[n],s=u.keyPath,c=u.value,l=u.compare;if(!t(Object(r.b)(e,s),c,l))return!1}for(var f=0,h=i.length;f<h;f++){var p=i[f],d=p.keyPath,v=p.value,y=p.compare;if(t(Object(r.b)(e,d),v,y))return!0}return!1})(e)&&d.push(e)})).then((function(){return d}))}},{key:"add",value:function(e,t){if(Array.isArray(e)){var n=e;if(n.length<2)return this.add(e[0],t);var r=n.map((function(e){return function(n){return n.add(e,t)}}));return this.batch(r)}return e?this.request((function(n){return n.add(e,t)}),{writable:!0}):Promise.resolve()}},{key:"put",value:function(e,t){if(Array.isArray(e)){var n=e;if(n.length<2)return this.put(n[0],t);var r=n.map((function(e){return function(n){return n.put(e,t)}}));return this.batch(r)}return e?this.request((function(n){return n.put(e,t)}),{writable:!0}):Promise.resolve()}},{key:"delete",value:function(e){if(Array.isArray(e)){var t=e;if(t.length<2)return this.delete(t[0]);var n=t.map((function(e){return function(t){return t.delete(e)}}));return this.batch(n)}return e?this.request((function(t){return t.delete(e)}),{writable:!0}):Promise.resolve()}},{key:"remove",value:function(e){var t=this.keyPath;if(Array.isArray(e)){var n=e;if(n.length<2)return this.remove(n[0]);var i=n.map((function(e){var n=Object(r.b)(e,t);return function(e){return e.delete(n)}}));return this.batch(i)}if(!e)return Promise.resolve();var o=Object(r.b)(e,t);return o?this.delete(o):Promise.resolve()}},{key:"clear",value:function(){return this.request((function(e){return e.clear()}),{writable:!0})}}]),e}()},function(e,t,n){"use strict";function r(e,t){if(!Array.isArray(t)){var n=function(e){return e.toString().split(/\.|\[|\]/).filter((function(e){return!!e}))}(t);if(!n.length)return e;for(var i=e,o=0,a=n.length;o<a;o++){var u=n[o];if(void 0===i[u])return;i=i[u]}return i}for(var s=0,c=t.length;s<c;s++){var l=r(e,t[s]);if(void 0!==l)return l}}function i(e){var t=e.message;return e.message=-1===t.indexOf("[IndexedDB]")?"[IndexedDB]: "+t:t,e}n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return i}))}])},e.exports=n()}).call(this,n(68))},function(e,t,n){var r=n(19),i=n(3),o=i["__core-js_shared__"]||(i["__core-js_shared__"]={});(e.exports=function(e,t){return o[e]||(o[e]=void 0!==t?t:{})})("versions",[]).push({version:r.version,mode:n(30)?"pure":"global",copyright:" 2019 Denis Pushkarev (zloirock.ru)"})},function(e,t,n){var r=n(21);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,n){"use strict";var r=n(2);e.exports=function(){var e=r(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},function(e,t,n){var r=n(2),i=n(11),o=n(6)("species");e.exports=function(e,t){var n,a=r(e).constructor;return void 0===a||null==(n=r(a)[o])?t:i(n)}},function(e,t,n){var r=n(16),i=n(7),o=n(36);e.exports=function(e){return function(t,n,a){var u,s=r(t),c=i(s.length),l=o(a,c);if(e&&n!=n){for(;c>l;)if((u=s[l++])!=u)return!0}else for(;c>l;l++)if((e||l in s)&&s[l]===n)return e||l||0;return!e&&-1}}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,n){var r=n(21);e.exports=Array.isArray||function(e){return"Array"==r(e)}},function(e,t,n){var r=n(22),i=n(25);e.exports=function(e){return function(t,n){var o,a,u=String(i(t)),s=r(n),c=u.length;return s<0||s>=c?e?"":void 0:(o=u.charCodeAt(s))<55296||o>56319||s+1===c||(a=u.charCodeAt(s+1))<56320||a>57343?e?u.charAt(s):o:e?u.slice(s,s+2):a-56320+(o-55296<<10)+65536}}},function(e,t,n){var r=n(5),i=n(21),o=n(6)("match");e.exports=function(e){var t;return r(e)&&(void 0!==(t=e[o])?!!t:"RegExp"==i(e))}},function(e,t,n){var r=n(6)("iterator"),i=!1;try{var o=[7][r]();o.return=function(){i=!0},Array.from(o,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var n=!1;try{var o=[7],a=o[r]();a.next=function(){return{done:n=!0}},o[r]=function(){return a},e(o)}catch(e){}return n}},function(e,t,n){"use strict";var r=n(45),i=RegExp.prototype.exec;e.exports=function(e,t){var n=e.exec;if("function"==typeof n){var o=n.call(e,t);if("object"!=typeof o)throw new TypeError("RegExp exec method returned something other than an Object or null");return o}if("RegExp"!==r(e))throw new TypeError("RegExp#exec called on incompatible receiver");return i.call(e,t)}},function(e,t,n){"use strict";n(115);var r=n(13),i=n(12),o=n(4),a=n(25),u=n(6),s=n(90),c=u("species"),l=!o((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})),f=function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2===n.length&&"a"===n[0]&&"b"===n[1]}();e.exports=function(e,t,n){var h=u(e),p=!o((function(){var t={};return t[h]=function(){return 7},7!=""[e](t)})),d=p?!o((function(){var t=!1,n=/a/;return n.exec=function(){return t=!0,null},"split"===e&&(n.constructor={},n.constructor[c]=function(){return n}),n[h](""),!t})):void 0;if(!p||!d||"replace"===e&&!l||"split"===e&&!f){var v=/./[h],y=n(a,h,""[e],(function(e,t,n,r,i){return t.exec===s?p&&!i?{done:!0,value:v.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}})),g=y[0],m=y[1];r(String.prototype,e,g),i(RegExp.prototype,h,2==t?function(e,t){return m.call(e,this,t)}:function(e){return m.call(e,this)})}}},function(e,t,n){var r=n(3).navigator;e.exports=r&&r.userAgent||""},function(e,t,n){"use strict";var r=n(3),i=n(0),o=n(13),a=n(42),u=n(31),s=n(41),c=n(40),l=n(5),f=n(4),h=n(59),p=n(44),d=n(76);e.exports=function(e,t,n,v,y,g){var m=r[e],b=m,w=y?"set":"add",k=b&&b.prototype,S={},_=function(e){var t=k[e];o(k,e,"delete"==e||"has"==e?function(e){return!(g&&!l(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return g&&!l(e)?void 0:t.call(this,0===e?0:e)}:"add"==e?function(e){return t.call(this,0===e?0:e),this}:function(e,n){return t.call(this,0===e?0:e,n),this})};if("function"==typeof b&&(g||k.forEach&&!f((function(){(new b).entries().next()})))){var O=new b,R=O[w](g?{}:-0,1)!=O,E=f((function(){O.has(1)})),x=h((function(e){new b(e)})),C=!g&&f((function(){for(var e=new b,t=5;t--;)e[w](t,t);return!e.has(-0)}));x||((b=t((function(t,n){c(t,b,e);var r=d(new m,t,b);return null!=n&&s(n,y,r[w],r),r}))).prototype=k,k.constructor=b),(E||C)&&(_("delete"),_("has"),y&&_("get")),(C||R)&&_(w),g&&k.clear&&delete k.clear}else b=v.getConstructor(t,e,y,w),a(b.prototype,n),u.NEED=!0;return p(b,e),S[e]=b,i(i.G+i.W+i.F*(b!=m),S),g||v.setStrong(b,e,y),b}},function(e,t,n){for(var r,i=n(3),o=n(12),a=n(34),u=a("typed_array"),s=a("view"),c=!(!i.ArrayBuffer||!i.DataView),l=c,f=0,h="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");f<9;)(r=i[h[f++]])?(o(r.prototype,u,!0),o(r.prototype,s,!0)):l=!1;e.exports={ABV:c,CONSTR:l,TYPED:u,VIEW:s}},function(e,t,n){"use strict";e.exports=n(30)||!n(4)((function(){var e=Math.random();__defineSetter__.call(null,e,(function(){})),delete n(3)[e]}))},function(e,t,n){"use strict";var r=n(0);e.exports=function(e){r(r.S,e,{of:function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},function(e,t,n){"use strict";var r=n(0),i=n(11),o=n(20),a=n(41);e.exports=function(e){r(r.S,e,{from:function(e){var t,n,r,u,s=arguments[1];return i(this),(t=void 0!==s)&&i(s),null==e?new this:(n=[],t?(r=0,u=o(s,arguments[2],2),a(e,!1,(function(e){n.push(u(e,r++))}))):a(e,!1,n.push,n),new this(n))}})}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var r=n(5),i=n(3).document,o=r(i)&&r(i.createElement);e.exports=function(e){return o?i.createElement(e):{}}},function(e,t,n){var r=n(3),i=n(19),o=n(30),a=n(97),u=n(9).f;e.exports=function(e){var t=i.Symbol||(i.Symbol=o?{}:r.Symbol||{});"_"==e.charAt(0)||e in t||u(t,e,{value:a.f(e)})}},function(e,t,n){var r=n(49)("keys"),i=n(34);e.exports=function(e){return r[e]||(r[e]=i(e))}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,n){var r=n(3).document;e.exports=r&&r.documentElement},function(e,t,n){var r=n(5),i=n(2),o=function(e,t){if(i(e),!r(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,r){try{(r=n(20)(Function.call,n(17).f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,n){return o(e,n),t?e.__proto__=n:r(e,n),e}}({},!1):void 0),check:o}},function(e,t){e.exports="\t\n\v\f\r \u2028\u2029\ufeff"},function(e,t,n){var r=n(5),i=n(74).set;e.exports=function(e,t,n){var o,a=t.constructor;return a!==n&&"function"==typeof a&&(o=a.prototype)!==n.prototype&&r(o)&&i&&i(e,o),e}},function(e,t,n){"use strict";var r=n(22),i=n(25);e.exports=function(e){var t=String(i(this)),n="",o=r(e);if(o<0||o==1/0)throw RangeError("Count can't be negative");for(;o>0;(o>>>=1)&&(t+=t))1&o&&(n+=t);return n}},function(e,t){e.exports=Math.sign||function(e){return 0==(e=+e)||e!=e?e:e<0?-1:1}},function(e,t){var n=Math.expm1;e.exports=!n||n(10)>22025.465794806718||n(10)<22025.465794806718||-2e-17!=n(-2e-17)?function(e){return 0==(e=+e)?e:e>-1e-6&&e<1e-6?e+e*e/2:Math.exp(e)-1}:n},function(e,t,n){"use strict";var r=n(30),i=n(0),o=n(13),a=n(12),u=n(47),s=n(81),c=n(44),l=n(18),f=n(6)("iterator"),h=!([].keys&&"next"in[].keys()),p=function(){return this};e.exports=function(e,t,n,d,v,y,g){s(n,t,d);var m,b,w,k=function(e){if(!h&&e in R)return R[e];switch(e){case"keys":case"values":return function(){return new n(this,e)}}return function(){return new n(this,e)}},S=t+" Iterator",_="values"==v,O=!1,R=e.prototype,E=R[f]||R["@@iterator"]||v&&R[v],x=E||k(v),C=v?_?k("entries"):x:void 0,P="Array"==t&&R.entries||E;if(P&&(w=l(P.call(new e)))!==Object.prototype&&w.next&&(c(w,S,!0),r||"function"==typeof w[f]||a(w,f,p)),_&&E&&"values"!==E.name&&(O=!0,x=function(){return E.call(this)}),r&&!g||!h&&!O&&R[f]||a(R,f,x),u[t]=x,u[S]=p,v)if(m={values:_?x:k("values"),keys:y?x:k("keys"),entries:C},g)for(b in m)b in R||o(R,b,m[b]);else i(i.P+i.F*(h||O),t,m);return m}},function(e,t,n){"use strict";var r=n(37),i=n(33),o=n(44),a={};n(12)(a,n(6)("iterator"),(function(){return this})),e.exports=function(e,t,n){e.prototype=r(a,{next:i(1,n)}),o(e,t+" Iterator")}},function(e,t,n){var r=n(58),i=n(25);e.exports=function(e,t,n){if(r(t))throw TypeError("String#"+n+" doesn't accept regex!");return String(i(e))}},function(e,t,n){var r=n(6)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[r]=!1,!"/./"[e](t)}catch(e){}}return!0}},function(e,t,n){var r=n(47),i=n(6)("iterator"),o=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||o[i]===e)}},function(e,t,n){"use strict";var r=n(9),i=n(33);e.exports=function(e,t,n){t in e?r.f(e,t,i(0,n)):e[t]=n}},function(e,t,n){var r=n(45),i=n(6)("iterator"),o=n(47);e.exports=n(19).getIteratorMethod=function(e){if(null!=e)return e[i]||e["@@iterator"]||o[r(e)]}},function(e,t,n){var r=n(225);e.exports=function(e,t){return new(r(e))(t)}},function(e,t,n){"use strict";var r=n(10),i=n(36),o=n(7);e.exports=function(e){for(var t=r(this),n=o(t.length),a=arguments.length,u=i(a>1?arguments[1]:void 0,n),s=a>2?arguments[2]:void 0,c=void 0===s?n:i(s,n);c>u;)t[u++]=e;return t}},function(e,t,n){"use strict";var r=n(32),i=n(114),o=n(47),a=n(16);e.exports=n(80)(Array,"Array",(function(e,t){this._t=a(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,i(1)):i(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])}),"values"),o.Arguments=o.Array,r("keys"),r("values"),r("entries")},function(e,t,n){"use strict";var r,i,o=n(52),a=RegExp.prototype.exec,u=String.prototype.replace,s=a,c=(r=/a/,i=/b*/g,a.call(r,"a"),a.call(i,"a"),0!==r.lastIndex||0!==i.lastIndex),l=void 0!==/()??/.exec("")[1];(c||l)&&(s=function(e){var t,n,r,i,s=this;return l&&(n=new RegExp("^"+s.source+"$(?!\\s)",o.call(s))),c&&(t=s.lastIndex),r=a.call(s,e),c&&r&&(s.lastIndex=s.global?r.index+r[0].length:t),l&&r&&r.length>1&&u.call(r[0],n,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(r[i]=void 0)})),r}),e.exports=s},function(e,t,n){"use strict";var r=n(57)(!0);e.exports=function(e,t,n){return t+(n?r(e,t).length:1)}},function(e,t,n){var r,i,o,a=n(20),u=n(104),s=n(73),c=n(69),l=n(3),f=l.process,h=l.setImmediate,p=l.clearImmediate,d=l.MessageChannel,v=l.Dispatch,y=0,g={},m=function(){var e=+this;if(g.hasOwnProperty(e)){var t=g[e];delete g[e],t()}},b=function(e){m.call(e.data)};h&&p||(h=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return g[++y]=function(){u("function"==typeof e?e:Function(e),t)},r(y),y},p=function(e){delete g[e]},"process"==n(21)(f)?r=function(e){f.nextTick(a(m,e,1))}:v&&v.now?r=function(e){v.now(a(m,e,1))}:d?(o=(i=new d).port2,i.port1.onmessage=b,r=a(o.postMessage,o,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(r=function(e){l.postMessage(e+"","*")},l.addEventListener("message",b,!1)):r="onreadystatechange"in c("script")?function(e){s.appendChild(c("script")).onreadystatechange=function(){s.removeChild(this),m.call(e)}}:function(e){setTimeout(a(m,e,1),0)}),e.exports={set:h,clear:p}},function(e,t,n){var r=n(3),i=n(92).set,o=r.MutationObserver||r.WebKitMutationObserver,a=r.process,u=r.Promise,s="process"==n(21)(a);e.exports=function(){var e,t,n,c=function(){var r,i;for(s&&(r=a.domain)&&r.exit();e;){i=e.fn,e=e.next;try{i()}catch(r){throw e?n():t=void 0,r}}t=void 0,r&&r.enter()};if(s)n=function(){a.nextTick(c)};else if(!o||r.navigator&&r.navigator.standalone)if(u&&u.resolve){var l=u.resolve(void 0);n=function(){l.then(c)}}else n=function(){i.call(r,c)};else{var f=!0,h=document.createTextNode("");new o(c).observe(h,{characterData:!0}),n=function(){h.data=f=!f}}return function(r){var i={fn:r,next:void 0};t&&(t.next=i),e||(e=i,n()),t=i}}},function(e,t,n){"use strict";var r=n(11);function i(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=r(t),this.reject=r(n)}e.exports.f=function(e){return new i(e)}},function(e,t,n){"use strict";var r=n(3),i=n(8),o=n(30),a=n(64),u=n(12),s=n(42),c=n(4),l=n(40),f=n(22),h=n(7),p=n(124),d=n(38).f,v=n(9).f,y=n(88),g=n(44),m=r.ArrayBuffer,b=r.DataView,w=r.Math,k=r.RangeError,S=r.Infinity,_=m,O=w.abs,R=w.pow,E=w.floor,x=w.log,C=w.LN2,P=i?"_b":"buffer",T=i?"_l":"byteLength",A=i?"_o":"byteOffset";function j(e,t,n){var r,i,o,a=new Array(n),u=8*n-t-1,s=(1<<u)-1,c=s>>1,l=23===t?R(2,-24)-R(2,-77):0,f=0,h=e<0||0===e&&1/e<0?1:0;for((e=O(e))!=e||e===S?(i=e!=e?1:0,r=s):(r=E(x(e)/C),e*(o=R(2,-r))<1&&(r--,o*=2),(e+=r+c>=1?l/o:l*R(2,1-c))*o>=2&&(r++,o/=2),r+c>=s?(i=0,r=s):r+c>=1?(i=(e*o-1)*R(2,t),r+=c):(i=e*R(2,c-1)*R(2,t),r=0));t>=8;a[f++]=255&i,i/=256,t-=8);for(r=r<<t|i,u+=t;u>0;a[f++]=255&r,r/=256,u-=8);return a[--f]|=128*h,a}function M(e,t,n){var r,i=8*n-t-1,o=(1<<i)-1,a=o>>1,u=i-7,s=n-1,c=e[s--],l=127&c;for(c>>=7;u>0;l=256*l+e[s],s--,u-=8);for(r=l&(1<<-u)-1,l>>=-u,u+=t;u>0;r=256*r+e[s],s--,u-=8);if(0===l)l=1-a;else{if(l===o)return r?NaN:c?-S:S;r+=R(2,t),l-=a}return(c?-1:1)*r*R(2,l-t)}function N(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]}function L(e){return[255&e]}function I(e){return[255&e,e>>8&255]}function D(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]}function F(e){return j(e,52,8)}function B(e){return j(e,23,4)}function z(e,t,n){v(e.prototype,t,{get:function(){return this[n]}})}function G(e,t,n,r){var i=p(+n);if(i+t>e[T])throw k("Wrong index!");var o=e[P]._b,a=i+e[A],u=o.slice(a,a+t);return r?u:u.reverse()}function U(e,t,n,r,i,o){var a=p(+n);if(a+t>e[T])throw k("Wrong index!");for(var u=e[P]._b,s=a+e[A],c=r(+i),l=0;l<t;l++)u[s+l]=c[o?l:t-l-1]}if(a.ABV){if(!c((function(){m(1)}))||!c((function(){new m(-1)}))||c((function(){return new m,new m(1.5),new m(NaN),"ArrayBuffer"!=m.name}))){for(var H,J=(m=function(e){return l(this,m),new _(p(e))}).prototype=_.prototype,V=d(_),W=0;V.length>W;)(H=V[W++])in m||u(m,H,_[H]);o||(J.constructor=m)}var q=new b(new m(2)),K=b.prototype.setInt8;q.setInt8(0,2147483648),q.setInt8(1,2147483649),!q.getInt8(0)&&q.getInt8(1)||s(b.prototype,{setInt8:function(e,t){K.call(this,e,t<<24>>24)},setUint8:function(e,t){K.call(this,e,t<<24>>24)}},!0)}else m=function(e){l(this,m,"ArrayBuffer");var t=p(e);this._b=y.call(new Array(t),0),this[T]=t},b=function(e,t,n){l(this,b,"DataView"),l(e,m,"DataView");var r=e[T],i=f(t);if(i<0||i>r)throw k("Wrong offset!");if(i+(n=void 0===n?r-i:h(n))>r)throw k("Wrong length!");this[P]=e,this[A]=i,this[T]=n},i&&(z(m,"byteLength","_l"),z(b,"buffer","_b"),z(b,"byteLength","_l"),z(b,"byteOffset","_o")),s(b.prototype,{getInt8:function(e){return G(this,1,e)[0]<<24>>24},getUint8:function(e){return G(this,1,e)[0]},getInt16:function(e){var t=G(this,2,e,arguments[1]);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=G(this,2,e,arguments[1]);return t[1]<<8|t[0]},getInt32:function(e){return N(G(this,4,e,arguments[1]))},getUint32:function(e){return N(G(this,4,e,arguments[1]))>>>0},getFloat32:function(e){return M(G(this,4,e,arguments[1]),23,4)},getFloat64:function(e){return M(G(this,8,e,arguments[1]),52,8)},setInt8:function(e,t){U(this,1,e,L,t)},setUint8:function(e,t){U(this,1,e,L,t)},setInt16:function(e,t){U(this,2,e,I,t,arguments[2])},setUint16:function(e,t){U(this,2,e,I,t,arguments[2])},setInt32:function(e,t){U(this,4,e,D,t,arguments[2])},setUint32:function(e,t){U(this,4,e,D,t,arguments[2])},setFloat32:function(e,t){U(this,4,e,B,t,arguments[2])},setFloat64:function(e,t){U(this,8,e,F,t,arguments[2])}});g(m,"ArrayBuffer"),g(b,"DataView"),u(b.prototype,a.VIEW,!0),t.ArrayBuffer=m,t.DataView=b},function(e,t,n){e.exports=!n(8)&&!n(4)((function(){return 7!=Object.defineProperty(n(69)("div"),"a",{get:function(){return 7}}).a}))},function(e,t,n){t.f=n(6)},function(e,t,n){var r=n(15),i=n(16),o=n(54)(!1),a=n(71)("IE_PROTO");e.exports=function(e,t){var n,u=i(e),s=0,c=[];for(n in u)n!=a&&r(u,n)&&c.push(n);for(;t.length>s;)r(u,n=t[s++])&&(~o(c,n)||c.push(n));return c}},function(e,t,n){var r=n(9),i=n(2),o=n(35);e.exports=n(8)?Object.defineProperties:function(e,t){i(e);for(var n,a=o(t),u=a.length,s=0;u>s;)r.f(e,n=a[s++],t[n]);return e}},function(e,t,n){var r=n(16),i=n(38).f,o={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return a&&"[object Window]"==o.call(e)?function(e){try{return i(e)}catch(e){return a.slice()}}(e):i(r(e))}},function(e,t,n){"use strict";var r=n(8),i=n(35),o=n(55),a=n(51),u=n(10),s=n(50),c=Object.assign;e.exports=!c||n(4)((function(){var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach((function(e){t[e]=e})),7!=c({},e)[n]||Object.keys(c({},t)).join("")!=r}))?function(e,t){for(var n=u(e),c=arguments.length,l=1,f=o.f,h=a.f;c>l;)for(var p,d=s(arguments[l++]),v=f?i(d).concat(f(d)):i(d),y=v.length,g=0;y>g;)p=v[g++],r&&!h.call(d,p)||(n[p]=d[p]);return n}:c},function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}},function(e,t,n){"use strict";var r=n(11),i=n(5),o=n(104),a=[].slice,u={},s=function(e,t,n){if(!(t in u)){for(var r=[],i=0;i<t;i++)r[i]="a["+i+"]";u[t]=Function("F,a","return new F("+r.join(",")+")")}return u[t](e,n)};e.exports=Function.bind||function(e){var t=r(this),n=a.call(arguments,1),u=function(){var r=n.concat(a.call(arguments));return this instanceof u?s(t,r.length,r):o(t,r,e)};return i(t.prototype)&&(u.prototype=t.prototype),u}},function(e,t){e.exports=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},function(e,t,n){var r=n(3).parseInt,i=n(46).trim,o=n(75),a=/^[-+]?0[xX]/;e.exports=8!==r(o+"08")||22!==r(o+"0x16")?function(e,t){var n=i(String(e),3);return r(n,t>>>0||(a.test(n)?16:10))}:r},function(e,t,n){var r=n(3).parseFloat,i=n(46).trim;e.exports=1/r(n(75)+"-0")!=-1/0?function(e){var t=i(String(e),3),n=r(t);return 0===n&&"-"==t.charAt(0)?-0:n}:r},function(e,t,n){var r=n(21);e.exports=function(e,t){if("number"!=typeof e&&"Number"!=r(e))throw TypeError(t);return+e}},function(e,t,n){var r=n(5),i=Math.floor;e.exports=function(e){return!r(e)&&isFinite(e)&&i(e)===e}},function(e,t){e.exports=Math.log1p||function(e){return(e=+e)>-1e-8&&e<1e-8?e-e*e/2:Math.log(1+e)}},function(e,t,n){var r=n(78),i=Math.pow,o=i(2,-52),a=i(2,-23),u=i(2,127)*(2-a),s=i(2,-126);e.exports=Math.fround||function(e){var t,n,i=Math.abs(e),c=r(e);return i<s?c*(i/s/a+1/o-1/o)*s*a:(n=(t=(1+a/o)*i)-(t-i))>u||n!=n?c*(1/0):c*n}},function(e,t,n){var r=n(2);e.exports=function(e,t,n,i){try{return i?t(r(n)[0],n[1]):t(n)}catch(t){var o=e.return;throw void 0!==o&&r(o.call(e)),t}}},function(e,t,n){var r=n(11),i=n(10),o=n(50),a=n(7);e.exports=function(e,t,n,u,s){r(t);var c=i(e),l=o(c),f=a(c.length),h=s?f-1:0,p=s?-1:1;if(n<2)for(;;){if(h in l){u=l[h],h+=p;break}if(h+=p,s?h<0:f<=h)throw TypeError("Reduce of empty array with no initial value")}for(;s?h>=0:f>h;h+=p)h in l&&(u=t(u,l[h],h,c));return u}},function(e,t,n){"use strict";var r=n(10),i=n(36),o=n(7);e.exports=[].copyWithin||function(e,t){var n=r(this),a=o(n.length),u=i(e,a),s=i(t,a),c=arguments.length>2?arguments[2]:void 0,l=Math.min((void 0===c?a:i(c,a))-s,a-u),f=1;for(s<u&&u<s+l&&(f=-1,s+=l-1,u+=l-1);l-- >0;)s in n?n[u]=n[s]:delete n[u],u+=f,s+=f;return n}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,n){"use strict";var r=n(90);n(0)({target:"RegExp",proto:!0,forced:r!==/./.exec},{exec:r})},function(e,t,n){n(8)&&"g"!=/./g.flags&&n(9).f(RegExp.prototype,"flags",{configurable:!0,get:n(52)})},function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},function(e,t,n){var r=n(2),i=n(5),o=n(94);e.exports=function(e,t){if(r(e),i(t)&&t.constructor===e)return t;var n=o.f(e);return(0,n.resolve)(t),n.promise}},function(e,t,n){"use strict";var r=n(120),i=n(43);e.exports=n(63)("Map",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(e){var t=r.getEntry(i(this,"Map"),e);return t&&t.v},set:function(e,t){return r.def(i(this,"Map"),0===e?0:e,t)}},r,!0)},function(e,t,n){"use strict";var r=n(9).f,i=n(37),o=n(42),a=n(20),u=n(40),s=n(41),c=n(80),l=n(114),f=n(39),h=n(8),p=n(31).fastKey,d=n(43),v=h?"_s":"size",y=function(e,t){var n,r=p(t);if("F"!==r)return e._i[r];for(n=e._f;n;n=n.n)if(n.k==t)return n};e.exports={getConstructor:function(e,t,n,c){var l=e((function(e,r){u(e,l,t,"_i"),e._t=t,e._i=i(null),e._f=void 0,e._l=void 0,e[v]=0,null!=r&&s(r,n,e[c],e)}));return o(l.prototype,{clear:function(){for(var e=d(this,t),n=e._i,r=e._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];e._f=e._l=void 0,e[v]=0},delete:function(e){var n=d(this,t),r=y(n,e);if(r){var i=r.n,o=r.p;delete n._i[r.i],r.r=!0,o&&(o.n=i),i&&(i.p=o),n._f==r&&(n._f=i),n._l==r&&(n._l=o),n[v]--}return!!r},forEach:function(e){d(this,t);for(var n,r=a(e,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(e){return!!y(d(this,t),e)}}),h&&r(l.prototype,"size",{get:function(){return d(this,t)[v]}}),l},def:function(e,t,n){var r,i,o=y(e,t);return o?o.v=n:(e._l=o={i:i=p(t,!0),k:t,v:n,p:r=e._l,n:void 0,r:!1},e._f||(e._f=o),r&&(r.n=o),e[v]++,"F"!==i&&(e._i[i]=o)),e},getEntry:y,setStrong:function(e,t,n){c(e,t,(function(e,n){this._t=d(e,t),this._k=n,this._l=void 0}),(function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?l(0,"keys"==e?t.k:"values"==e?t.v:[t.k,t.v]):(this._t=void 0,l(1))}),n?"entries":"values",!n,!0),f(t)}}},function(e,t,n){"use strict";var r=n(120),i=n(43);e.exports=n(63)("Set",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(e){return r.def(i(this,"Set"),e=0===e?0:e,e)}},r)},function(e,t,n){"use strict";var r,i=n(3),o=n(27)(0),a=n(13),u=n(31),s=n(101),c=n(123),l=n(5),f=n(43),h=n(43),p=!i.ActiveXObject&&"ActiveXObject"in i,d=u.getWeak,v=Object.isExtensible,y=c.ufstore,g=function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},m={get:function(e){if(l(e)){var t=d(e);return!0===t?y(f(this,"WeakMap")).get(e):t?t[this._i]:void 0}},set:function(e,t){return c.def(f(this,"WeakMap"),e,t)}},b=e.exports=n(63)("WeakMap",g,m,c,!0,!0);h&&p&&(s((r=c.getConstructor(g,"WeakMap")).prototype,m),u.NEED=!0,o(["delete","has","get","set"],(function(e){var t=b.prototype,n=t[e];a(t,e,(function(t,i){if(l(t)&&!v(t)){this._f||(this._f=new r);var o=this._f[e](t,i);return"set"==e?this:o}return n.call(this,t,i)}))})))},function(e,t,n){"use strict";var r=n(42),i=n(31).getWeak,o=n(2),a=n(5),u=n(40),s=n(41),c=n(27),l=n(15),f=n(43),h=c(5),p=c(6),d=0,v=function(e){return e._l||(e._l=new y)},y=function(){this.a=[]},g=function(e,t){return h(e.a,(function(e){return e[0]===t}))};y.prototype={get:function(e){var t=g(this,e);if(t)return t[1]},has:function(e){return!!g(this,e)},set:function(e,t){var n=g(this,e);n?n[1]=t:this.a.push([e,t])},delete:function(e){var t=p(this.a,(function(t){return t[0]===e}));return~t&&this.a.splice(t,1),!!~t}},e.exports={getConstructor:function(e,t,n,o){var c=e((function(e,r){u(e,c,t,"_i"),e._t=t,e._i=d++,e._l=void 0,null!=r&&s(r,n,e[o],e)}));return r(c.prototype,{delete:function(e){if(!a(e))return!1;var n=i(e);return!0===n?v(f(this,t)).delete(e):n&&l(n,this._i)&&delete n[this._i]},has:function(e){if(!a(e))return!1;var n=i(e);return!0===n?v(f(this,t)).has(e):n&&l(n,this._i)}}),c},def:function(e,t,n){var r=i(o(t),!0);return!0===r?v(e).set(t,n):r[e._i]=n,e},ufstore:v}},function(e,t,n){var r=n(22),i=n(7);e.exports=function(e){if(void 0===e)return 0;var t=r(e),n=i(t);if(t!==n)throw RangeError("Wrong length!");return n}},function(e,t,n){var r=n(38),i=n(55),o=n(2),a=n(3).Reflect;e.exports=a&&a.ownKeys||function(e){var t=r.f(o(e)),n=i.f;return n?t.concat(n(e)):t}},function(e,t,n){"use strict";var r=n(56),i=n(5),o=n(7),a=n(20),u=n(6)("isConcatSpreadable");e.exports=function e(t,n,s,c,l,f,h,p){for(var d,v,y=l,g=0,m=!!h&&a(h,p,3);g<c;){if(g in s){if(d=m?m(s[g],g,n):s[g],v=!1,i(d)&&(v=void 0!==(v=d[u])?!!v:r(d)),v&&f>0)y=e(t,n,d,o(d.length),y,f-1)-1;else{if(y>=9007199254740991)throw TypeError();t[y]=d}y++}g++}return y}},function(e,t,n){var r=n(7),i=n(77),o=n(25);e.exports=function(e,t,n,a){var u=String(o(e)),s=u.length,c=void 0===n?" ":String(n),l=r(t);if(l<=s||""==c)return u;var f=l-s,h=i.call(c,Math.ceil(f/c.length));return h.length>f&&(h=h.slice(0,f)),a?h+u:u+h}},function(e,t,n){var r=n(8),i=n(35),o=n(16),a=n(51).f;e.exports=function(e){return function(t){for(var n,u=o(t),s=i(u),c=s.length,l=0,f=[];c>l;)n=s[l++],r&&!a.call(u,n)||f.push(e?[n,u[n]]:u[n]);return f}}},function(e,t,n){var r=n(45),i=n(130);e.exports=function(e){return function(){if(r(this)!=e)throw TypeError(e+"#toJSON isn't generic");return i(this)}}},function(e,t,n){var r=n(41);e.exports=function(e,t){var n=[];return r(e,!1,n.push,n,t),n}},function(e,t){e.exports=Math.scale||function(e,t,n,r,i){return 0===arguments.length||e!=e||t!=t||n!=n||r!=r||i!=i?NaN:e===1/0||e===-1/0?e:(e-t)*(i-r)/(n-t)+r}},function(e,t,n){n(133),e.exports=n(336)},function(e,t,n){"use strict";(function(e){if(n(134),n(331),n(332),e._babelPolyfill)throw new Error("only one instance of babel-polyfill is allowed");e._babelPolyfill=!0;function t(e,t,n){e[t]||Object.defineProperty(e,t,{writable:!0,configurable:!0,value:n})}t(String.prototype,"padLeft","".padStart),t(String.prototype,"padRight","".padEnd),"pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach((function(e){[][e]&&t(Array,e,Function.call.bind([][e]))}))}).call(this,n(68))},function(e,t,n){n(135),n(138),n(139),n(140),n(141),n(142),n(143),n(144),n(145),n(146),n(147),n(148),n(149),n(150),n(151),n(152),n(153),n(154),n(155),n(156),n(157),n(158),n(159),n(160),n(161),n(162),n(163),n(164),n(165),n(166),n(167),n(168),n(169),n(170),n(171),n(172),n(173),n(174),n(175),n(176),n(177),n(178),n(179),n(180),n(181),n(182),n(183),n(184),n(185),n(186),n(187),n(188),n(189),n(190),n(191),n(192),n(193),n(194),n(195),n(196),n(197),n(198),n(199),n(200),n(201),n(202),n(203),n(204),n(205),n(206),n(207),n(208),n(209),n(210),n(211),n(212),n(213),n(215),n(216),n(218),n(219),n(220),n(221),n(222),n(223),n(224),n(226),n(227),n(228),n(229),n(230),n(231),n(232),n(233),n(234),n(235),n(236),n(237),n(238),n(89),n(239),n(115),n(240),n(116),n(241),n(242),n(243),n(244),n(245),n(119),n(121),n(122),n(246),n(247),n(248),n(249),n(250),n(251),n(252),n(253),n(254),n(255),n(256),n(257),n(258),n(259),n(260),n(261),n(262),n(263),n(264),n(265),n(266),n(267),n(268),n(269),n(270),n(271),n(272),n(273),n(274),n(275),n(276),n(277),n(278),n(279),n(280),n(281),n(282),n(283),n(284),n(285),n(286),n(287),n(288),n(289),n(290),n(291),n(292),n(293),n(294),n(295),n(296),n(297),n(298),n(299),n(300),n(301),n(302),n(303),n(304),n(305),n(306),n(307),n(308),n(309),n(310),n(311),n(312),n(313),n(314),n(315),n(316),n(317),n(318),n(319),n(320),n(321),n(322),n(323),n(324),n(325),n(326),n(327),n(328),n(329),n(330),e.exports=n(19)},function(e,t,n){"use strict";var r=n(3),i=n(15),o=n(8),a=n(0),u=n(13),s=n(31).KEY,c=n(4),l=n(49),f=n(44),h=n(34),p=n(6),d=n(97),v=n(70),y=n(137),g=n(56),m=n(2),b=n(5),w=n(10),k=n(16),S=n(24),_=n(33),O=n(37),R=n(100),E=n(17),x=n(55),C=n(9),P=n(35),T=E.f,A=C.f,j=R.f,M=r.Symbol,N=r.JSON,L=N&&N.stringify,I=p("_hidden"),D=p("toPrimitive"),F={}.propertyIsEnumerable,B=l("symbol-registry"),z=l("symbols"),G=l("op-symbols"),U=Object.prototype,H="function"==typeof M&&!!x.f,J=r.QObject,V=!J||!J.prototype||!J.prototype.findChild,W=o&&c((function(){return 7!=O(A({},"a",{get:function(){return A(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=T(U,t);r&&delete U[t],A(e,t,n),r&&e!==U&&A(U,t,r)}:A,q=function(e){var t=z[e]=O(M.prototype);return t._k=e,t},K=H&&"symbol"==typeof M.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof M},Z=function(e,t,n){return e===U&&Z(G,t,n),m(e),t=S(t,!0),m(n),i(z,t)?(n.enumerable?(i(e,I)&&e[I][t]&&(e[I][t]=!1),n=O(n,{enumerable:_(0,!1)})):(i(e,I)||A(e,I,_(1,{})),e[I][t]=!0),W(e,t,n)):A(e,t,n)},$=function(e,t){m(e);for(var n,r=y(t=k(t)),i=0,o=r.length;o>i;)Z(e,n=r[i++],t[n]);return e},Q=function(e){var t=F.call(this,e=S(e,!0));return!(this===U&&i(z,e)&&!i(G,e))&&(!(t||!i(this,e)||!i(z,e)||i(this,I)&&this[I][e])||t)},X=function(e,t){if(e=k(e),t=S(t,!0),e!==U||!i(z,t)||i(G,t)){var n=T(e,t);return!n||!i(z,t)||i(e,I)&&e[I][t]||(n.enumerable=!0),n}},Y=function(e){for(var t,n=j(k(e)),r=[],o=0;n.length>o;)i(z,t=n[o++])||t==I||t==s||r.push(t);return r},ee=function(e){for(var t,n=e===U,r=j(n?G:k(e)),o=[],a=0;r.length>a;)!i(z,t=r[a++])||n&&!i(U,t)||o.push(z[t]);return o};H||(u((M=function(){if(this instanceof M)throw TypeError("Symbol is not a constructor!");var e=h(arguments.length>0?arguments[0]:void 0),t=function(n){this===U&&t.call(G,n),i(this,I)&&i(this[I],e)&&(this[I][e]=!1),W(this,e,_(1,n))};return o&&V&&W(U,e,{configurable:!0,set:t}),q(e)}).prototype,"toString",(function(){return this._k})),E.f=X,C.f=Z,n(38).f=R.f=Y,n(51).f=Q,x.f=ee,o&&!n(30)&&u(U,"propertyIsEnumerable",Q,!0),d.f=function(e){return q(p(e))}),a(a.G+a.W+a.F*!H,{Symbol:M});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ne=0;te.length>ne;)p(te[ne++]);for(var re=P(p.store),ie=0;re.length>ie;)v(re[ie++]);a(a.S+a.F*!H,"Symbol",{for:function(e){return i(B,e+="")?B[e]:B[e]=M(e)},keyFor:function(e){if(!K(e))throw TypeError(e+" is not a symbol!");for(var t in B)if(B[t]===e)return t},useSetter:function(){V=!0},useSimple:function(){V=!1}}),a(a.S+a.F*!H,"Object",{create:function(e,t){return void 0===t?O(e):$(O(e),t)},defineProperty:Z,defineProperties:$,getOwnPropertyDescriptor:X,getOwnPropertyNames:Y,getOwnPropertySymbols:ee});var oe=c((function(){x.f(1)}));a(a.S+a.F*oe,"Object",{getOwnPropertySymbols:function(e){return x.f(w(e))}}),N&&a(a.S+a.F*(!H||c((function(){var e=M();return"[null]"!=L([e])||"{}"!=L({a:e})||"{}"!=L(Object(e))}))),"JSON",{stringify:function(e){for(var t,n,r=[e],i=1;arguments.length>i;)r.push(arguments[i++]);if(n=t=r[1],(b(t)||void 0!==e)&&!K(e))return g(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!K(t))return t}),r[1]=t,L.apply(N,r)}}),M.prototype[D]||n(12)(M.prototype,D,M.prototype.valueOf),f(M,"Symbol"),f(Math,"Math",!0),f(r.JSON,"JSON",!0)},function(e,t,n){e.exports=n(49)("native-function-to-string",Function.toString)},function(e,t,n){var r=n(35),i=n(55),o=n(51);e.exports=function(e){var t=r(e),n=i.f;if(n)for(var a,u=n(e),s=o.f,c=0;u.length>c;)s.call(e,a=u[c++])&&t.push(a);return t}},function(e,t,n){var r=n(0);r(r.S,"Object",{create:n(37)})},function(e,t,n){var r=n(0);r(r.S+r.F*!n(8),"Object",{defineProperty:n(9).f})},function(e,t,n){var r=n(0);r(r.S+r.F*!n(8),"Object",{defineProperties:n(99)})},function(e,t,n){var r=n(16),i=n(17).f;n(26)("getOwnPropertyDescriptor",(function(){return function(e,t){return i(r(e),t)}}))},function(e,t,n){var r=n(10),i=n(18);n(26)("getPrototypeOf",(function(){return function(e){return i(r(e))}}))},function(e,t,n){var r=n(10),i=n(35);n(26)("keys",(function(){return function(e){return i(r(e))}}))},function(e,t,n){n(26)("getOwnPropertyNames",(function(){return n(100).f}))},function(e,t,n){var r=n(5),i=n(31).onFreeze;n(26)("freeze",(function(e){return function(t){return e&&r(t)?e(i(t)):t}}))},function(e,t,n){var r=n(5),i=n(31).onFreeze;n(26)("seal",(function(e){return function(t){return e&&r(t)?e(i(t)):t}}))},function(e,t,n){var r=n(5),i=n(31).onFreeze;n(26)("preventExtensions",(function(e){return function(t){return e&&r(t)?e(i(t)):t}}))},function(e,t,n){var r=n(5);n(26)("isFrozen",(function(e){return function(t){return!r(t)||!!e&&e(t)}}))},function(e,t,n){var r=n(5);n(26)("isSealed",(function(e){return function(t){return!r(t)||!!e&&e(t)}}))},function(e,t,n){var r=n(5);n(26)("isExtensible",(function(e){return function(t){return!!r(t)&&(!e||e(t))}}))},function(e,t,n){var r=n(0);r(r.S+r.F,"Object",{assign:n(101)})},function(e,t,n){var r=n(0);r(r.S,"Object",{is:n(102)})},function(e,t,n){var r=n(0);r(r.S,"Object",{setPrototypeOf:n(74).set})},function(e,t,n){"use strict";var r=n(45),i={};i[n(6)("toStringTag")]="z",i+""!="[object z]"&&n(13)(Object.prototype,"toString",(function(){return"[object "+r(this)+"]"}),!0)},function(e,t,n){var r=n(0);r(r.P,"Function",{bind:n(103)})},function(e,t,n){var r=n(9).f,i=Function.prototype,o=/^\s*function ([^ (]*)/;"name"in i||n(8)&&r(i,"name",{configurable:!0,get:function(){try{return(""+this).match(o)[1]}catch(e){return""}}})},function(e,t,n){"use strict";var r=n(5),i=n(18),o=n(6)("hasInstance"),a=Function.prototype;o in a||n(9).f(a,o,{value:function(e){if("function"!=typeof this||!r(e))return!1;if(!r(this.prototype))return e instanceof this;for(;e=i(e);)if(this.prototype===e)return!0;return!1}})},function(e,t,n){var r=n(0),i=n(105);r(r.G+r.F*(parseInt!=i),{parseInt:i})},function(e,t,n){var r=n(0),i=n(106);r(r.G+r.F*(parseFloat!=i),{parseFloat:i})},function(e,t,n){"use strict";var r=n(3),i=n(15),o=n(21),a=n(76),u=n(24),s=n(4),c=n(38).f,l=n(17).f,f=n(9).f,h=n(46).trim,p=r.Number,d=p,v=p.prototype,y="Number"==o(n(37)(v)),g="trim"in String.prototype,m=function(e){var t=u(e,!1);if("string"==typeof t&&t.length>2){var n,r,i,o=(t=g?t.trim():h(t,3)).charCodeAt(0);if(43===o||45===o){if(88===(n=t.charCodeAt(2))||120===n)return NaN}else if(48===o){switch(t.charCodeAt(1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+t}for(var a,s=t.slice(2),c=0,l=s.length;c<l;c++)if((a=s.charCodeAt(c))<48||a>i)return NaN;return parseInt(s,r)}}return+t};if(!p(" 0o1")||!p("0b1")||p("+0x1")){p=function(e){var t=arguments.length<1?0:e,n=this;return n instanceof p&&(y?s((function(){v.valueOf.call(n)})):"Number"!=o(n))?a(new d(m(t)),n,p):m(t)};for(var b,w=n(8)?c(d):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),k=0;w.length>k;k++)i(d,b=w[k])&&!i(p,b)&&f(p,b,l(d,b));p.prototype=v,v.constructor=p,n(13)(r,"Number",p)}},function(e,t,n){"use strict";var r=n(0),i=n(22),o=n(107),a=n(77),u=1..toFixed,s=Math.floor,c=[0,0,0,0,0,0],l="Number.toFixed: incorrect invocation!",f=function(e,t){for(var n=-1,r=t;++n<6;)r+=e*c[n],c[n]=r%1e7,r=s(r/1e7)},h=function(e){for(var t=6,n=0;--t>=0;)n+=c[t],c[t]=s(n/e),n=n%e*1e7},p=function(){for(var e=6,t="";--e>=0;)if(""!==t||0===e||0!==c[e]){var n=String(c[e]);t=""===t?n:t+a.call("0",7-n.length)+n}return t},d=function(e,t,n){return 0===t?n:t%2==1?d(e,t-1,n*e):d(e*e,t/2,n)};r(r.P+r.F*(!!u&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!n(4)((function(){u.call({})}))),"Number",{toFixed:function(e){var t,n,r,u,s=o(this,l),c=i(e),v="",y="0";if(c<0||c>20)throw RangeError(l);if(s!=s)return"NaN";if(s<=-1e21||s>=1e21)return String(s);if(s<0&&(v="-",s=-s),s>1e-21)if(n=(t=function(e){for(var t=0,n=e;n>=4096;)t+=12,n/=4096;for(;n>=2;)t+=1,n/=2;return t}(s*d(2,69,1))-69)<0?s*d(2,-t,1):s/d(2,t,1),n*=4503599627370496,(t=52-t)>0){for(f(0,n),r=c;r>=7;)f(1e7,0),r-=7;for(f(d(10,r,1),0),r=t-1;r>=23;)h(1<<23),r-=23;h(1<<r),f(1,1),h(2),y=p()}else f(0,n),f(1<<-t,0),y=p()+a.call("0",c);return y=c>0?v+((u=y.length)<=c?"0."+a.call("0",c-u)+y:y.slice(0,u-c)+"."+y.slice(u-c)):v+y}})},function(e,t,n){"use strict";var r=n(0),i=n(4),o=n(107),a=1..toPrecision;r(r.P+r.F*(i((function(){return"1"!==a.call(1,void 0)}))||!i((function(){a.call({})}))),"Number",{toPrecision:function(e){var t=o(this,"Number#toPrecision: incorrect invocation!");return void 0===e?a.call(t):a.call(t,e)}})},function(e,t,n){var r=n(0);r(r.S,"Number",{EPSILON:Math.pow(2,-52)})},function(e,t,n){var r=n(0),i=n(3).isFinite;r(r.S,"Number",{isFinite:function(e){return"number"==typeof e&&i(e)}})},function(e,t,n){var r=n(0);r(r.S,"Number",{isInteger:n(108)})},function(e,t,n){var r=n(0);r(r.S,"Number",{isNaN:function(e){return e!=e}})},function(e,t,n){var r=n(0),i=n(108),o=Math.abs;r(r.S,"Number",{isSafeInteger:function(e){return i(e)&&o(e)<=9007199254740991}})},function(e,t,n){var r=n(0);r(r.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(e,t,n){var r=n(0);r(r.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(e,t,n){var r=n(0),i=n(106);r(r.S+r.F*(Number.parseFloat!=i),"Number",{parseFloat:i})},function(e,t,n){var r=n(0),i=n(105);r(r.S+r.F*(Number.parseInt!=i),"Number",{parseInt:i})},function(e,t,n){var r=n(0),i=n(109),o=Math.sqrt,a=Math.acosh;r(r.S+r.F*!(a&&710==Math.floor(a(Number.MAX_VALUE))&&a(1/0)==1/0),"Math",{acosh:function(e){return(e=+e)<1?NaN:e>94906265.62425156?Math.log(e)+Math.LN2:i(e-1+o(e-1)*o(e+1))}})},function(e,t,n){var r=n(0),i=Math.asinh;r(r.S+r.F*!(i&&1/i(0)>0),"Math",{asinh:function e(t){return isFinite(t=+t)&&0!=t?t<0?-e(-t):Math.log(t+Math.sqrt(t*t+1)):t}})},function(e,t,n){var r=n(0),i=Math.atanh;r(r.S+r.F*!(i&&1/i(-0)<0),"Math",{atanh:function(e){return 0==(e=+e)?e:Math.log((1+e)/(1-e))/2}})},function(e,t,n){var r=n(0),i=n(78);r(r.S,"Math",{cbrt:function(e){return i(e=+e)*Math.pow(Math.abs(e),1/3)}})},function(e,t,n){var r=n(0);r(r.S,"Math",{clz32:function(e){return(e>>>=0)?31-Math.floor(Math.log(e+.5)*Math.LOG2E):32}})},function(e,t,n){var r=n(0),i=Math.exp;r(r.S,"Math",{cosh:function(e){return(i(e=+e)+i(-e))/2}})},function(e,t,n){var r=n(0),i=n(79);r(r.S+r.F*(i!=Math.expm1),"Math",{expm1:i})},function(e,t,n){var r=n(0);r(r.S,"Math",{fround:n(110)})},function(e,t,n){var r=n(0),i=Math.abs;r(r.S,"Math",{hypot:function(e,t){for(var n,r,o=0,a=0,u=arguments.length,s=0;a<u;)s<(n=i(arguments[a++]))?(o=o*(r=s/n)*r+1,s=n):o+=n>0?(r=n/s)*r:n;return s===1/0?1/0:s*Math.sqrt(o)}})},function(e,t,n){var r=n(0),i=Math.imul;r(r.S+r.F*n(4)((function(){return-5!=i(4294967295,5)||2!=i.length})),"Math",{imul:function(e,t){var n=+e,r=+t,i=65535&n,o=65535&r;return 0|i*o+((65535&n>>>16)*o+i*(65535&r>>>16)<<16>>>0)}})},function(e,t,n){var r=n(0);r(r.S,"Math",{log10:function(e){return Math.log(e)*Math.LOG10E}})},function(e,t,n){var r=n(0);r(r.S,"Math",{log1p:n(109)})},function(e,t,n){var r=n(0);r(r.S,"Math",{log2:function(e){return Math.log(e)/Math.LN2}})},function(e,t,n){var r=n(0);r(r.S,"Math",{sign:n(78)})},function(e,t,n){var r=n(0),i=n(79),o=Math.exp;r(r.S+r.F*n(4)((function(){return-2e-17!=!Math.sinh(-2e-17)})),"Math",{sinh:function(e){return Math.abs(e=+e)<1?(i(e)-i(-e))/2:(o(e-1)-o(-e-1))*(Math.E/2)}})},function(e,t,n){var r=n(0),i=n(79),o=Math.exp;r(r.S,"Math",{tanh:function(e){var t=i(e=+e),n=i(-e);return t==1/0?1:n==1/0?-1:(t-n)/(o(e)+o(-e))}})},function(e,t,n){var r=n(0);r(r.S,"Math",{trunc:function(e){return(e>0?Math.floor:Math.ceil)(e)}})},function(e,t,n){var r=n(0),i=n(36),o=String.fromCharCode,a=String.fromCodePoint;r(r.S+r.F*(!!a&&1!=a.length),"String",{fromCodePoint:function(e){for(var t,n=[],r=arguments.length,a=0;r>a;){if(t=+arguments[a++],i(t,1114111)!==t)throw RangeError(t+" is not a valid code point");n.push(t<65536?o(t):o(55296+((t-=65536)>>10),t%1024+56320))}return n.join("")}})},function(e,t,n){var r=n(0),i=n(16),o=n(7);r(r.S,"String",{raw:function(e){for(var t=i(e.raw),n=o(t.length),r=arguments.length,a=[],u=0;n>u;)a.push(String(t[u++])),u<r&&a.push(String(arguments[u]));return a.join("")}})},function(e,t,n){"use strict";n(46)("trim",(function(e){return function(){return e(this,3)}}))},function(e,t,n){"use strict";var r=n(57)(!0);n(80)(String,"String",(function(e){this._t=String(e),this._i=0}),(function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})}))},function(e,t,n){"use strict";var r=n(0),i=n(57)(!1);r(r.P,"String",{codePointAt:function(e){return i(this,e)}})},function(e,t,n){"use strict";var r=n(0),i=n(7),o=n(82),a="".endsWith;r(r.P+r.F*n(83)("endsWith"),"String",{endsWith:function(e){var t=o(this,e,"endsWith"),n=arguments.length>1?arguments[1]:void 0,r=i(t.length),u=void 0===n?r:Math.min(i(n),r),s=String(e);return a?a.call(t,s,u):t.slice(u-s.length,u)===s}})},function(e,t,n){"use strict";var r=n(0),i=n(82);r(r.P+r.F*n(83)("includes"),"String",{includes:function(e){return!!~i(this,e,"includes").indexOf(e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,n){var r=n(0);r(r.P,"String",{repeat:n(77)})},function(e,t,n){"use strict";var r=n(0),i=n(7),o=n(82),a="".startsWith;r(r.P+r.F*n(83)("startsWith"),"String",{startsWith:function(e){var t=o(this,e,"startsWith"),n=i(Math.min(arguments.length>1?arguments[1]:void 0,t.length)),r=String(e);return a?a.call(t,r,n):t.slice(n,n+r.length)===r}})},function(e,t,n){"use strict";n(14)("anchor",(function(e){return function(t){return e(this,"a","name",t)}}))},function(e,t,n){"use strict";n(14)("big",(function(e){return function(){return e(this,"big","","")}}))},function(e,t,n){"use strict";n(14)("blink",(function(e){return function(){return e(this,"blink","","")}}))},function(e,t,n){"use strict";n(14)("bold",(function(e){return function(){return e(this,"b","","")}}))},function(e,t,n){"use strict";n(14)("fixed",(function(e){return function(){return e(this,"tt","","")}}))},function(e,t,n){"use strict";n(14)("fontcolor",(function(e){return function(t){return e(this,"font","color",t)}}))},function(e,t,n){"use strict";n(14)("fontsize",(function(e){return function(t){return e(this,"font","size",t)}}))},function(e,t,n){"use strict";n(14)("italics",(function(e){return function(){return e(this,"i","","")}}))},function(e,t,n){"use strict";n(14)("link",(function(e){return function(t){return e(this,"a","href",t)}}))},function(e,t,n){"use strict";n(14)("small",(function(e){return function(){return e(this,"small","","")}}))},function(e,t,n){"use strict";n(14)("strike",(function(e){return function(){return e(this,"strike","","")}}))},function(e,t,n){"use strict";n(14)("sub",(function(e){return function(){return e(this,"sub","","")}}))},function(e,t,n){"use strict";n(14)("sup",(function(e){return function(){return e(this,"sup","","")}}))},function(e,t,n){var r=n(0);r(r.S,"Date",{now:function(){return(new Date).getTime()}})},function(e,t,n){"use strict";var r=n(0),i=n(10),o=n(24);r(r.P+r.F*n(4)((function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})})),"Date",{toJSON:function(e){var t=i(this),n=o(t);return"number"!=typeof n||isFinite(n)?t.toISOString():null}})},function(e,t,n){var r=n(0),i=n(214);r(r.P+r.F*(Date.prototype.toISOString!==i),"Date",{toISOString:i})},function(e,t,n){"use strict";var r=n(4),i=Date.prototype.getTime,o=Date.prototype.toISOString,a=function(e){return e>9?e:"0"+e};e.exports=r((function(){return"0385-07-25T07:06:39.999Z"!=o.call(new Date(-50000000000001))}))||!r((function(){o.call(new Date(NaN))}))?function(){if(!isFinite(i.call(this)))throw RangeError("Invalid time value");var e=this,t=e.getUTCFullYear(),n=e.getUTCMilliseconds(),r=t<0?"-":t>9999?"+":"";return r+("00000"+Math.abs(t)).slice(r?-6:-4)+"-"+a(e.getUTCMonth()+1)+"-"+a(e.getUTCDate())+"T"+a(e.getUTCHours())+":"+a(e.getUTCMinutes())+":"+a(e.getUTCSeconds())+"."+(n>99?n:"0"+a(n))+"Z"}:o},function(e,t,n){var r=Date.prototype,i=r.toString,o=r.getTime;new Date(NaN)+""!="Invalid Date"&&n(13)(r,"toString",(function(){var e=o.call(this);return e==e?i.call(this):"Invalid Date"}))},function(e,t,n){var r=n(6)("toPrimitive"),i=Date.prototype;r in i||n(12)(i,r,n(217))},function(e,t,n){"use strict";var r=n(2),i=n(24);e.exports=function(e){if("string"!==e&&"number"!==e&&"default"!==e)throw TypeError("Incorrect hint");return i(r(this),"number"!=e)}},function(e,t,n){var r=n(0);r(r.S,"Array",{isArray:n(56)})},function(e,t,n){"use strict";var r=n(20),i=n(0),o=n(10),a=n(111),u=n(84),s=n(7),c=n(85),l=n(86);i(i.S+i.F*!n(59)((function(e){Array.from(e)})),"Array",{from:function(e){var t,n,i,f,h=o(e),p="function"==typeof this?this:Array,d=arguments.length,v=d>1?arguments[1]:void 0,y=void 0!==v,g=0,m=l(h);if(y&&(v=r(v,d>2?arguments[2]:void 0,2)),null==m||p==Array&&u(m))for(n=new p(t=s(h.length));t>g;g++)c(n,g,y?v(h[g],g):h[g]);else for(f=m.call(h),n=new p;!(i=f.next()).done;g++)c(n,g,y?a(f,v,[i.value,g],!0):i.value);return n.length=g,n}})},function(e,t,n){"use strict";var r=n(0),i=n(85);r(r.S+r.F*n(4)((function(){function e(){}return!(Array.of.call(e)instanceof e)})),"Array",{of:function(){for(var e=0,t=arguments.length,n=new("function"==typeof this?this:Array)(t);t>e;)i(n,e,arguments[e++]);return n.length=t,n}})},function(e,t,n){"use strict";var r=n(0),i=n(16),o=[].join;r(r.P+r.F*(n(50)!=Object||!n(23)(o)),"Array",{join:function(e){return o.call(i(this),void 0===e?",":e)}})},function(e,t,n){"use strict";var r=n(0),i=n(73),o=n(21),a=n(36),u=n(7),s=[].slice;r(r.P+r.F*n(4)((function(){i&&s.call(i)})),"Array",{slice:function(e,t){var n=u(this.length),r=o(this);if(t=void 0===t?n:t,"Array"==r)return s.call(this,e,t);for(var i=a(e,n),c=a(t,n),l=u(c-i),f=new Array(l),h=0;h<l;h++)f[h]="String"==r?this.charAt(i+h):this[i+h];return f}})},function(e,t,n){"use strict";var r=n(0),i=n(11),o=n(10),a=n(4),u=[].sort,s=[1,2,3];r(r.P+r.F*(a((function(){s.sort(void 0)}))||!a((function(){s.sort(null)}))||!n(23)(u)),"Array",{sort:function(e){return void 0===e?u.call(o(this)):u.call(o(this),i(e))}})},function(e,t,n){"use strict";var r=n(0),i=n(27)(0),o=n(23)([].forEach,!0);r(r.P+r.F*!o,"Array",{forEach:function(e){return i(this,e,arguments[1])}})},function(e,t,n){var r=n(5),i=n(56),o=n(6)("species");e.exports=function(e){var t;return i(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!i(t.prototype)||(t=void 0),r(t)&&null===(t=t[o])&&(t=void 0)),void 0===t?Array:t}},function(e,t,n){"use strict";var r=n(0),i=n(27)(1);r(r.P+r.F*!n(23)([].map,!0),"Array",{map:function(e){return i(this,e,arguments[1])}})},function(e,t,n){"use strict";var r=n(0),i=n(27)(2);r(r.P+r.F*!n(23)([].filter,!0),"Array",{filter:function(e){return i(this,e,arguments[1])}})},function(e,t,n){"use strict";var r=n(0),i=n(27)(3);r(r.P+r.F*!n(23)([].some,!0),"Array",{some:function(e){return i(this,e,arguments[1])}})},function(e,t,n){"use strict";var r=n(0),i=n(27)(4);r(r.P+r.F*!n(23)([].every,!0),"Array",{every:function(e){return i(this,e,arguments[1])}})},function(e,t,n){"use strict";var r=n(0),i=n(112);r(r.P+r.F*!n(23)([].reduce,!0),"Array",{reduce:function(e){return i(this,e,arguments.length,arguments[1],!1)}})},function(e,t,n){"use strict";var r=n(0),i=n(112);r(r.P+r.F*!n(23)([].reduceRight,!0),"Array",{reduceRight:function(e){return i(this,e,arguments.length,arguments[1],!0)}})},function(e,t,n){"use strict";var r=n(0),i=n(54)(!1),o=[].indexOf,a=!!o&&1/[1].indexOf(1,-0)<0;r(r.P+r.F*(a||!n(23)(o)),"Array",{indexOf:function(e){return a?o.apply(this,arguments)||0:i(this,e,arguments[1])}})},function(e,t,n){"use strict";var r=n(0),i=n(16),o=n(22),a=n(7),u=[].lastIndexOf,s=!!u&&1/[1].lastIndexOf(1,-0)<0;r(r.P+r.F*(s||!n(23)(u)),"Array",{lastIndexOf:function(e){if(s)return u.apply(this,arguments)||0;var t=i(this),n=a(t.length),r=n-1;for(arguments.length>1&&(r=Math.min(r,o(arguments[1]))),r<0&&(r=n+r);r>=0;r--)if(r in t&&t[r]===e)return r||0;return-1}})},function(e,t,n){var r=n(0);r(r.P,"Array",{copyWithin:n(113)}),n(32)("copyWithin")},function(e,t,n){var r=n(0);r(r.P,"Array",{fill:n(88)}),n(32)("fill")},function(e,t,n){"use strict";var r=n(0),i=n(27)(5),o=!0;"find"in[]&&Array(1).find((function(){o=!1})),r(r.P+r.F*o,"Array",{find:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),n(32)("find")},function(e,t,n){"use strict";var r=n(0),i=n(27)(6),o="findIndex",a=!0;o in[]&&Array(1)[o]((function(){a=!1})),r(r.P+r.F*a,"Array",{findIndex:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),n(32)(o)},function(e,t,n){n(39)("Array")},function(e,t,n){var r=n(3),i=n(76),o=n(9).f,a=n(38).f,u=n(58),s=n(52),c=r.RegExp,l=c,f=c.prototype,h=/a/g,p=/a/g,d=new c(h)!==h;if(n(8)&&(!d||n(4)((function(){return p[n(6)("match")]=!1,c(h)!=h||c(p)==p||"/a/i"!=c(h,"i")})))){c=function(e,t){var n=this instanceof c,r=u(e),o=void 0===t;return!n&&r&&e.constructor===c&&o?e:i(d?new l(r&&!o?e.source:e,t):l((r=e instanceof c)?e.source:e,r&&o?s.call(e):t),n?this:f,c)};for(var v=function(e){e in c||o(c,e,{configurable:!0,get:function(){return l[e]},set:function(t){l[e]=t}})},y=a(l),g=0;y.length>g;)v(y[g++]);f.constructor=c,c.prototype=f,n(13)(r,"RegExp",c)}n(39)("RegExp")},function(e,t,n){"use strict";n(116);var r=n(2),i=n(52),o=n(8),a=/./.toString,u=function(e){n(13)(RegExp.prototype,"toString",e,!0)};n(4)((function(){return"/a/b"!=a.call({source:"a",flags:"b"})}))?u((function(){var e=r(this);return"/".concat(e.source,"/","flags"in e?e.flags:!o&&e instanceof RegExp?i.call(e):void 0)})):"toString"!=a.name&&u((function(){return a.call(this)}))},function(e,t,n){"use strict";var r=n(2),i=n(7),o=n(91),a=n(60);n(61)("match",1,(function(e,t,n,u){return[function(n){var r=e(this),i=null==n?void 0:n[t];return void 0!==i?i.call(n,r):new RegExp(n)[t](String(r))},function(e){var t=u(n,e,this);if(t.done)return t.value;var s=r(e),c=String(this);if(!s.global)return a(s,c);var l=s.unicode;s.lastIndex=0;for(var f,h=[],p=0;null!==(f=a(s,c));){var d=String(f[0]);h[p]=d,""===d&&(s.lastIndex=o(c,i(s.lastIndex),l)),p++}return 0===p?null:h}]}))},function(e,t,n){"use strict";var r=n(2),i=n(10),o=n(7),a=n(22),u=n(91),s=n(60),c=Math.max,l=Math.min,f=Math.floor,h=/\$([$&`']|\d\d?|<[^>]*>)/g,p=/\$([$&`']|\d\d?)/g;n(61)("replace",2,(function(e,t,n,d){return[function(r,i){var o=e(this),a=null==r?void 0:r[t];return void 0!==a?a.call(r,o,i):n.call(String(o),r,i)},function(e,t){var i=d(n,e,this,t);if(i.done)return i.value;var f=r(e),h=String(this),p="function"==typeof t;p||(t=String(t));var y=f.global;if(y){var g=f.unicode;f.lastIndex=0}for(var m=[];;){var b=s(f,h);if(null===b)break;if(m.push(b),!y)break;""===String(b[0])&&(f.lastIndex=u(h,o(f.lastIndex),g))}for(var w,k="",S=0,_=0;_<m.length;_++){b=m[_];for(var O=String(b[0]),R=c(l(a(b.index),h.length),0),E=[],x=1;x<b.length;x++)E.push(void 0===(w=b[x])?w:String(w));var C=b.groups;if(p){var P=[O].concat(E,R,h);void 0!==C&&P.push(C);var T=String(t.apply(void 0,P))}else T=v(O,h,R,E,C,t);R>=S&&(k+=h.slice(S,R)+T,S=R+O.length)}return k+h.slice(S)}];function v(e,t,r,o,a,u){var s=r+e.length,c=o.length,l=p;return void 0!==a&&(a=i(a),l=h),n.call(u,l,(function(n,i){var u;switch(i.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,r);case"'":return t.slice(s);case"<":u=a[i.slice(1,-1)];break;default:var l=+i;if(0===l)return n;if(l>c){var h=f(l/10);return 0===h?n:h<=c?void 0===o[h-1]?i.charAt(1):o[h-1]+i.charAt(1):n}u=o[l-1]}return void 0===u?"":u}))}}))},function(e,t,n){"use strict";var r=n(2),i=n(102),o=n(60);n(61)("search",1,(function(e,t,n,a){return[function(n){var r=e(this),i=null==n?void 0:n[t];return void 0!==i?i.call(n,r):new RegExp(n)[t](String(r))},function(e){var t=a(n,e,this);if(t.done)return t.value;var u=r(e),s=String(this),c=u.lastIndex;i(c,0)||(u.lastIndex=0);var l=o(u,s);return i(u.lastIndex,c)||(u.lastIndex=c),null===l?-1:l.index}]}))},function(e,t,n){"use strict";var r=n(58),i=n(2),o=n(53),a=n(91),u=n(7),s=n(60),c=n(90),l=n(4),f=Math.min,h=[].push,p="length",d=!l((function(){RegExp(4294967295,"y")}));n(61)("split",2,(function(e,t,n,l){var v;return v="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1)[p]||2!="ab".split(/(?:ab)*/)[p]||4!=".".split(/(.?)(.?)/)[p]||".".split(/()()/)[p]>1||"".split(/.?/)[p]?function(e,t){var i=String(this);if(void 0===e&&0===t)return[];if(!r(e))return n.call(i,e,t);for(var o,a,u,s=[],l=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),f=0,d=void 0===t?4294967295:t>>>0,v=new RegExp(e.source,l+"g");(o=c.call(v,i))&&!((a=v.lastIndex)>f&&(s.push(i.slice(f,o.index)),o[p]>1&&o.index<i[p]&&h.apply(s,o.slice(1)),u=o[0][p],f=a,s[p]>=d));)v.lastIndex===o.index&&v.lastIndex++;return f===i[p]?!u&&v.test("")||s.push(""):s.push(i.slice(f)),s[p]>d?s.slice(0,d):s}:"0".split(void 0,0)[p]?function(e,t){return void 0===e&&0===t?[]:n.call(this,e,t)}:n,[function(n,r){var i=e(this),o=null==n?void 0:n[t];return void 0!==o?o.call(n,i,r):v.call(String(i),n,r)},function(e,t){var r=l(v,e,this,t,v!==n);if(r.done)return r.value;var c=i(e),h=String(this),p=o(c,RegExp),y=c.unicode,g=(c.ignoreCase?"i":"")+(c.multiline?"m":"")+(c.unicode?"u":"")+(d?"y":"g"),m=new p(d?c:"^(?:"+c.source+")",g),b=void 0===t?4294967295:t>>>0;if(0===b)return[];if(0===h.length)return null===s(m,h)?[h]:[];for(var w=0,k=0,S=[];k<h.length;){m.lastIndex=d?k:0;var _,O=s(m,d?h:h.slice(k));if(null===O||(_=f(u(m.lastIndex+(d?0:k)),h.length))===w)k=a(h,k,y);else{if(S.push(h.slice(w,k)),S.length===b)return S;for(var R=1;R<=O.length-1;R++)if(S.push(O[R]),S.length===b)return S;k=w=_}}return S.push(h.slice(w)),S}]}))},function(e,t,n){"use strict";var r,i,o,a,u=n(30),s=n(3),c=n(20),l=n(45),f=n(0),h=n(5),p=n(11),d=n(40),v=n(41),y=n(53),g=n(92).set,m=n(93)(),b=n(94),w=n(117),k=n(62),S=n(118),_=s.TypeError,O=s.process,R=O&&O.versions,E=R&&R.v8||"",x=s.Promise,C="process"==l(O),P=function(){},T=i=b.f,A=!!function(){try{var e=x.resolve(1),t=(e.constructor={})[n(6)("species")]=function(e){e(P,P)};return(C||"function"==typeof PromiseRejectionEvent)&&e.then(P)instanceof t&&0!==E.indexOf("6.6")&&-1===k.indexOf("Chrome/66")}catch(e){}}(),j=function(e){var t;return!(!h(e)||"function"!=typeof(t=e.then))&&t},M=function(e,t){if(!e._n){e._n=!0;var n=e._c;m((function(){for(var r=e._v,i=1==e._s,o=0,a=function(t){var n,o,a,u=i?t.ok:t.fail,s=t.resolve,c=t.reject,l=t.domain;try{u?(i||(2==e._h&&I(e),e._h=1),!0===u?n=r:(l&&l.enter(),n=u(r),l&&(l.exit(),a=!0)),n===t.promise?c(_("Promise-chain cycle")):(o=j(n))?o.call(n,s,c):s(n)):c(r)}catch(e){l&&!a&&l.exit(),c(e)}};n.length>o;)a(n[o++]);e._c=[],e._n=!1,t&&!e._h&&N(e)}))}},N=function(e){g.call(s,(function(){var t,n,r,i=e._v,o=L(e);if(o&&(t=w((function(){C?O.emit("unhandledRejection",i,e):(n=s.onunhandledrejection)?n({promise:e,reason:i}):(r=s.console)&&r.error&&r.error("Unhandled promise rejection",i)})),e._h=C||L(e)?2:1),e._a=void 0,o&&t.e)throw t.v}))},L=function(e){return 1!==e._h&&0===(e._a||e._c).length},I=function(e){g.call(s,(function(){var t;C?O.emit("rejectionHandled",e):(t=s.onrejectionhandled)&&t({promise:e,reason:e._v})}))},D=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),M(t,!0))},F=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw _("Promise can't be resolved itself");(t=j(e))?m((function(){var r={_w:n,_d:!1};try{t.call(e,c(F,r,1),c(D,r,1))}catch(e){D.call(r,e)}})):(n._v=e,n._s=1,M(n,!1))}catch(e){D.call({_w:n,_d:!1},e)}}};A||(x=function(e){d(this,x,"Promise","_h"),p(e),r.call(this);try{e(c(F,this,1),c(D,this,1))}catch(e){D.call(this,e)}},(r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=n(42)(x.prototype,{then:function(e,t){var n=T(y(this,x));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=C?O.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&M(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),o=function(){var e=new r;this.promise=e,this.resolve=c(F,e,1),this.reject=c(D,e,1)},b.f=T=function(e){return e===x||e===a?new o(e):i(e)}),f(f.G+f.W+f.F*!A,{Promise:x}),n(44)(x,"Promise"),n(39)("Promise"),a=n(19).Promise,f(f.S+f.F*!A,"Promise",{reject:function(e){var t=T(this);return(0,t.reject)(e),t.promise}}),f(f.S+f.F*(u||!A),"Promise",{resolve:function(e){return S(u&&this===a?x:this,e)}}),f(f.S+f.F*!(A&&n(59)((function(e){x.all(e).catch(P)}))),"Promise",{all:function(e){var t=this,n=T(t),r=n.resolve,i=n.reject,o=w((function(){var n=[],o=0,a=1;v(e,!1,(function(e){var u=o++,s=!1;n.push(void 0),a++,t.resolve(e).then((function(e){s||(s=!0,n[u]=e,--a||r(n))}),i)})),--a||r(n)}));return o.e&&i(o.v),n.promise},race:function(e){var t=this,n=T(t),r=n.reject,i=w((function(){v(e,!1,(function(e){t.resolve(e).then(n.resolve,r)}))}));return i.e&&r(i.v),n.promise}})},function(e,t,n){"use strict";var r=n(123),i=n(43);n(63)("WeakSet",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(e){return r.def(i(this,"WeakSet"),e,!0)}},r,!1,!0)},function(e,t,n){"use strict";var r=n(0),i=n(64),o=n(95),a=n(2),u=n(36),s=n(7),c=n(5),l=n(3).ArrayBuffer,f=n(53),h=o.ArrayBuffer,p=o.DataView,d=i.ABV&&l.isView,v=h.prototype.slice,y=i.VIEW;r(r.G+r.W+r.F*(l!==h),{ArrayBuffer:h}),r(r.S+r.F*!i.CONSTR,"ArrayBuffer",{isView:function(e){return d&&d(e)||c(e)&&y in e}}),r(r.P+r.U+r.F*n(4)((function(){return!new h(2).slice(1,void 0).byteLength})),"ArrayBuffer",{slice:function(e,t){if(void 0!==v&&void 0===t)return v.call(a(this),e);for(var n=a(this).byteLength,r=u(e,n),i=u(void 0===t?n:t,n),o=new(f(this,h))(s(i-r)),c=new p(this),l=new p(o),d=0;r<i;)l.setUint8(d++,c.getUint8(r++));return o}}),n(39)("ArrayBuffer")},function(e,t,n){var r=n(0);r(r.G+r.W+r.F*!n(64).ABV,{DataView:n(95).DataView})},function(e,t,n){n(28)("Int8",1,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},function(e,t,n){n(28)("Uint8",1,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},function(e,t,n){n(28)("Uint8",1,(function(e){return function(t,n,r){return e(this,t,n,r)}}),!0)},function(e,t,n){n(28)("Int16",2,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},function(e,t,n){n(28)("Uint16",2,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},function(e,t,n){n(28)("Int32",4,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},function(e,t,n){n(28)("Uint32",4,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},function(e,t,n){n(28)("Float32",4,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},function(e,t,n){n(28)("Float64",8,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},function(e,t,n){var r=n(0),i=n(11),o=n(2),a=(n(3).Reflect||{}).apply,u=Function.apply;r(r.S+r.F*!n(4)((function(){a((function(){}))})),"Reflect",{apply:function(e,t,n){var r=i(e),s=o(n);return a?a(r,t,s):u.call(r,t,s)}})},function(e,t,n){var r=n(0),i=n(37),o=n(11),a=n(2),u=n(5),s=n(4),c=n(103),l=(n(3).Reflect||{}).construct,f=s((function(){function e(){}return!(l((function(){}),[],e)instanceof e)})),h=!s((function(){l((function(){}))}));r(r.S+r.F*(f||h),"Reflect",{construct:function(e,t){o(e),a(t);var n=arguments.length<3?e:o(arguments[2]);if(h&&!f)return l(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var r=[null];return r.push.apply(r,t),new(c.apply(e,r))}var s=n.prototype,p=i(u(s)?s:Object.prototype),d=Function.apply.call(e,p,t);return u(d)?d:p}})},function(e,t,n){var r=n(9),i=n(0),o=n(2),a=n(24);i(i.S+i.F*n(4)((function(){Reflect.defineProperty(r.f({},1,{value:1}),1,{value:2})})),"Reflect",{defineProperty:function(e,t,n){o(e),t=a(t,!0),o(n);try{return r.f(e,t,n),!0}catch(e){return!1}}})},function(e,t,n){var r=n(0),i=n(17).f,o=n(2);r(r.S,"Reflect",{deleteProperty:function(e,t){var n=i(o(e),t);return!(n&&!n.configurable)&&delete e[t]}})},function(e,t,n){"use strict";var r=n(0),i=n(2),o=function(e){this._t=i(e),this._i=0;var t,n=this._k=[];for(t in e)n.push(t)};n(81)(o,"Object",(function(){var e,t=this._k;do{if(this._i>=t.length)return{value:void 0,done:!0}}while(!((e=t[this._i++])in this._t));return{value:e,done:!1}})),r(r.S,"Reflect",{enumerate:function(e){return new o(e)}})},function(e,t,n){var r=n(17),i=n(18),o=n(15),a=n(0),u=n(5),s=n(2);a(a.S,"Reflect",{get:function e(t,n){var a,c,l=arguments.length<3?t:arguments[2];return s(t)===l?t[n]:(a=r.f(t,n))?o(a,"value")?a.value:void 0!==a.get?a.get.call(l):void 0:u(c=i(t))?e(c,n,l):void 0}})},function(e,t,n){var r=n(17),i=n(0),o=n(2);i(i.S,"Reflect",{getOwnPropertyDescriptor:function(e,t){return r.f(o(e),t)}})},function(e,t,n){var r=n(0),i=n(18),o=n(2);r(r.S,"Reflect",{getPrototypeOf:function(e){return i(o(e))}})},function(e,t,n){var r=n(0);r(r.S,"Reflect",{has:function(e,t){return t in e}})},function(e,t,n){var r=n(0),i=n(2),o=Object.isExtensible;r(r.S,"Reflect",{isExtensible:function(e){return i(e),!o||o(e)}})},function(e,t,n){var r=n(0);r(r.S,"Reflect",{ownKeys:n(125)})},function(e,t,n){var r=n(0),i=n(2),o=Object.preventExtensions;r(r.S,"Reflect",{preventExtensions:function(e){i(e);try{return o&&o(e),!0}catch(e){return!1}}})},function(e,t,n){var r=n(9),i=n(17),o=n(18),a=n(15),u=n(0),s=n(33),c=n(2),l=n(5);u(u.S,"Reflect",{set:function e(t,n,u){var f,h,p=arguments.length<4?t:arguments[3],d=i.f(c(t),n);if(!d){if(l(h=o(t)))return e(h,n,u,p);d=s(0)}if(a(d,"value")){if(!1===d.writable||!l(p))return!1;if(f=i.f(p,n)){if(f.get||f.set||!1===f.writable)return!1;f.value=u,r.f(p,n,f)}else r.f(p,n,s(0,u));return!0}return void 0!==d.set&&(d.set.call(p,u),!0)}})},function(e,t,n){var r=n(0),i=n(74);i&&r(r.S,"Reflect",{setPrototypeOf:function(e,t){i.check(e,t);try{return i.set(e,t),!0}catch(e){return!1}}})},function(e,t,n){"use strict";var r=n(0),i=n(54)(!0);r(r.P,"Array",{includes:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),n(32)("includes")},function(e,t,n){"use strict";var r=n(0),i=n(126),o=n(10),a=n(7),u=n(11),s=n(87);r(r.P,"Array",{flatMap:function(e){var t,n,r=o(this);return u(e),t=a(r.length),n=s(r,0),i(n,r,r,t,0,1,e,arguments[1]),n}}),n(32)("flatMap")},function(e,t,n){"use strict";var r=n(0),i=n(126),o=n(10),a=n(7),u=n(22),s=n(87);r(r.P,"Array",{flatten:function(){var e=arguments[0],t=o(this),n=a(t.length),r=s(t,0);return i(r,t,t,n,0,void 0===e?1:u(e)),r}}),n(32)("flatten")},function(e,t,n){"use strict";var r=n(0),i=n(57)(!0);r(r.P,"String",{at:function(e){return i(this,e)}})},function(e,t,n){"use strict";var r=n(0),i=n(127),o=n(62),a=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(o);r(r.P+r.F*a,"String",{padStart:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0,!0)}})},function(e,t,n){"use strict";var r=n(0),i=n(127),o=n(62),a=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(o);r(r.P+r.F*a,"String",{padEnd:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0,!1)}})},function(e,t,n){"use strict";n(46)("trimLeft",(function(e){return function(){return e(this,1)}}),"trimStart")},function(e,t,n){"use strict";n(46)("trimRight",(function(e){return function(){return e(this,2)}}),"trimEnd")},function(e,t,n){"use strict";var r=n(0),i=n(25),o=n(7),a=n(58),u=n(52),s=RegExp.prototype,c=function(e,t){this._r=e,this._s=t};n(81)(c,"RegExp String",(function(){var e=this._r.exec(this._s);return{value:e,done:null===e}})),r(r.P,"String",{matchAll:function(e){if(i(this),!a(e))throw TypeError(e+" is not a regexp!");var t=String(this),n="flags"in s?String(e.flags):u.call(e),r=new RegExp(e.source,~n.indexOf("g")?n:"g"+n);return r.lastIndex=o(e.lastIndex),new c(r,t)}})},function(e,t,n){n(70)("asyncIterator")},function(e,t,n){n(70)("observable")},function(e,t,n){var r=n(0),i=n(125),o=n(16),a=n(17),u=n(85);r(r.S,"Object",{getOwnPropertyDescriptors:function(e){for(var t,n,r=o(e),s=a.f,c=i(r),l={},f=0;c.length>f;)void 0!==(n=s(r,t=c[f++]))&&u(l,t,n);return l}})},function(e,t,n){var r=n(0),i=n(128)(!1);r(r.S,"Object",{values:function(e){return i(e)}})},function(e,t,n){var r=n(0),i=n(128)(!0);r(r.S,"Object",{entries:function(e){return i(e)}})},function(e,t,n){"use strict";var r=n(0),i=n(10),o=n(11),a=n(9);n(8)&&r(r.P+n(65),"Object",{__defineGetter__:function(e,t){a.f(i(this),e,{get:o(t),enumerable:!0,configurable:!0})}})},function(e,t,n){"use strict";var r=n(0),i=n(10),o=n(11),a=n(9);n(8)&&r(r.P+n(65),"Object",{__defineSetter__:function(e,t){a.f(i(this),e,{set:o(t),enumerable:!0,configurable:!0})}})},function(e,t,n){"use strict";var r=n(0),i=n(10),o=n(24),a=n(18),u=n(17).f;n(8)&&r(r.P+n(65),"Object",{__lookupGetter__:function(e){var t,n=i(this),r=o(e,!0);do{if(t=u(n,r))return t.get}while(n=a(n))}})},function(e,t,n){"use strict";var r=n(0),i=n(10),o=n(24),a=n(18),u=n(17).f;n(8)&&r(r.P+n(65),"Object",{__lookupSetter__:function(e){var t,n=i(this),r=o(e,!0);do{if(t=u(n,r))return t.set}while(n=a(n))}})},function(e,t,n){var r=n(0);r(r.P+r.R,"Map",{toJSON:n(129)("Map")})},function(e,t,n){var r=n(0);r(r.P+r.R,"Set",{toJSON:n(129)("Set")})},function(e,t,n){n(66)("Map")},function(e,t,n){n(66)("Set")},function(e,t,n){n(66)("WeakMap")},function(e,t,n){n(66)("WeakSet")},function(e,t,n){n(67)("Map")},function(e,t,n){n(67)("Set")},function(e,t,n){n(67)("WeakMap")},function(e,t,n){n(67)("WeakSet")},function(e,t,n){var r=n(0);r(r.G,{global:n(3)})},function(e,t,n){var r=n(0);r(r.S,"System",{global:n(3)})},function(e,t,n){var r=n(0),i=n(21);r(r.S,"Error",{isError:function(e){return"Error"===i(e)}})},function(e,t,n){var r=n(0);r(r.S,"Math",{clamp:function(e,t,n){return Math.min(n,Math.max(t,e))}})},function(e,t,n){var r=n(0);r(r.S,"Math",{DEG_PER_RAD:Math.PI/180})},function(e,t,n){var r=n(0),i=180/Math.PI;r(r.S,"Math",{degrees:function(e){return e*i}})},function(e,t,n){var r=n(0),i=n(131),o=n(110);r(r.S,"Math",{fscale:function(e,t,n,r,a){return o(i(e,t,n,r,a))}})},function(e,t,n){var r=n(0);r(r.S,"Math",{iaddh:function(e,t,n,r){var i=e>>>0,o=n>>>0;return(t>>>0)+(r>>>0)+((i&o|(i|o)&~(i+o>>>0))>>>31)|0}})},function(e,t,n){var r=n(0);r(r.S,"Math",{isubh:function(e,t,n,r){var i=e>>>0,o=n>>>0;return(t>>>0)-(r>>>0)-((~i&o|~(i^o)&i-o>>>0)>>>31)|0}})},function(e,t,n){var r=n(0);r(r.S,"Math",{imulh:function(e,t){var n=+e,r=+t,i=65535&n,o=65535&r,a=n>>16,u=r>>16,s=(a*o>>>0)+(i*o>>>16);return a*u+(s>>16)+((i*u>>>0)+(65535&s)>>16)}})},function(e,t,n){var r=n(0);r(r.S,"Math",{RAD_PER_DEG:180/Math.PI})},function(e,t,n){var r=n(0),i=Math.PI/180;r(r.S,"Math",{radians:function(e){return e*i}})},function(e,t,n){var r=n(0);r(r.S,"Math",{scale:n(131)})},function(e,t,n){var r=n(0);r(r.S,"Math",{umulh:function(e,t){var n=+e,r=+t,i=65535&n,o=65535&r,a=n>>>16,u=r>>>16,s=(a*o>>>0)+(i*o>>>16);return a*u+(s>>>16)+((i*u>>>0)+(65535&s)>>>16)}})},function(e,t,n){var r=n(0);r(r.S,"Math",{signbit:function(e){return(e=+e)!=e?e:0==e?1/e==1/0:e>0}})},function(e,t,n){"use strict";var r=n(0),i=n(19),o=n(3),a=n(53),u=n(118);r(r.P+r.R,"Promise",{finally:function(e){var t=a(this,i.Promise||o.Promise),n="function"==typeof e;return this.then(n?function(n){return u(t,e()).then((function(){return n}))}:e,n?function(n){return u(t,e()).then((function(){throw n}))}:e)}})},function(e,t,n){"use strict";var r=n(0),i=n(94),o=n(117);r(r.S,"Promise",{try:function(e){var t=i.f(this),n=o(e);return(n.e?t.reject:t.resolve)(n.v),t.promise}})},function(e,t,n){var r=n(29),i=n(2),o=r.key,a=r.set;r.exp({defineMetadata:function(e,t,n,r){a(e,t,i(n),o(r))}})},function(e,t,n){var r=n(29),i=n(2),o=r.key,a=r.map,u=r.store;r.exp({deleteMetadata:function(e,t){var n=arguments.length<3?void 0:o(arguments[2]),r=a(i(t),n,!1);if(void 0===r||!r.delete(e))return!1;if(r.size)return!0;var s=u.get(t);return s.delete(n),!!s.size||u.delete(t)}})},function(e,t,n){var r=n(29),i=n(2),o=n(18),a=r.has,u=r.get,s=r.key,c=function(e,t,n){if(a(e,t,n))return u(e,t,n);var r=o(t);return null!==r?c(e,r,n):void 0};r.exp({getMetadata:function(e,t){return c(e,i(t),arguments.length<3?void 0:s(arguments[2]))}})},function(e,t,n){var r=n(121),i=n(130),o=n(29),a=n(2),u=n(18),s=o.keys,c=o.key,l=function(e,t){var n=s(e,t),o=u(e);if(null===o)return n;var a=l(o,t);return a.length?n.length?i(new r(n.concat(a))):a:n};o.exp({getMetadataKeys:function(e){return l(a(e),arguments.length<2?void 0:c(arguments[1]))}})},function(e,t,n){var r=n(29),i=n(2),o=r.get,a=r.key;r.exp({getOwnMetadata:function(e,t){return o(e,i(t),arguments.length<3?void 0:a(arguments[2]))}})},function(e,t,n){var r=n(29),i=n(2),o=r.keys,a=r.key;r.exp({getOwnMetadataKeys:function(e){return o(i(e),arguments.length<2?void 0:a(arguments[1]))}})},function(e,t,n){var r=n(29),i=n(2),o=n(18),a=r.has,u=r.key,s=function(e,t,n){if(a(e,t,n))return!0;var r=o(t);return null!==r&&s(e,r,n)};r.exp({hasMetadata:function(e,t){return s(e,i(t),arguments.length<3?void 0:u(arguments[2]))}})},function(e,t,n){var r=n(29),i=n(2),o=r.has,a=r.key;r.exp({hasOwnMetadata:function(e,t){return o(e,i(t),arguments.length<3?void 0:a(arguments[2]))}})},function(e,t,n){var r=n(29),i=n(2),o=n(11),a=r.key,u=r.set;r.exp({metadata:function(e,t){return function(n,r){u(e,t,(void 0!==r?i:o)(n),a(r))}}})},function(e,t,n){var r=n(0),i=n(93)(),o=n(3).process,a="process"==n(21)(o);r(r.G,{asap:function(e){var t=a&&o.domain;i(t?t.bind(e):e)}})},function(e,t,n){"use strict";var r=n(0),i=n(3),o=n(19),a=n(93)(),u=n(6)("observable"),s=n(11),c=n(2),l=n(40),f=n(42),h=n(12),p=n(41),d=p.RETURN,v=function(e){return null==e?void 0:s(e)},y=function(e){var t=e._c;t&&(e._c=void 0,t())},g=function(e){return void 0===e._o},m=function(e){g(e)||(e._o=void 0,y(e))},b=function(e,t){c(e),this._c=void 0,this._o=e,e=new w(this);try{var n=t(e),r=n;null!=n&&("function"==typeof n.unsubscribe?n=function(){r.unsubscribe()}:s(n),this._c=n)}catch(t){return void e.error(t)}g(this)&&y(this)};b.prototype=f({},{unsubscribe:function(){m(this)}});var w=function(e){this._s=e};w.prototype=f({},{next:function(e){var t=this._s;if(!g(t)){var n=t._o;try{var r=v(n.next);if(r)return r.call(n,e)}catch(e){try{m(t)}finally{throw e}}}},error:function(e){var t=this._s;if(g(t))throw e;var n=t._o;t._o=void 0;try{var r=v(n.error);if(!r)throw e;e=r.call(n,e)}catch(e){try{y(t)}finally{throw e}}return y(t),e},complete:function(e){var t=this._s;if(!g(t)){var n=t._o;t._o=void 0;try{var r=v(n.complete);e=r?r.call(n,e):void 0}catch(e){try{y(t)}finally{throw e}}return y(t),e}}});var k=function(e){l(this,k,"Observable","_f")._f=s(e)};f(k.prototype,{subscribe:function(e){return new b(e,this._f)},forEach:function(e){var t=this;return new(o.Promise||i.Promise)((function(n,r){s(e);var i=t.subscribe({next:function(t){try{return e(t)}catch(e){r(e),i.unsubscribe()}},error:r,complete:n})}))}}),f(k,{from:function(e){var t="function"==typeof this?this:k,n=v(c(e)[u]);if(n){var r=c(n.call(e));return r.constructor===t?r:new t((function(e){return r.subscribe(e)}))}return new t((function(t){var n=!1;return a((function(){if(!n){try{if(p(e,!1,(function(e){if(t.next(e),n)return d}))===d)return}catch(e){if(n)throw e;return void t.error(e)}t.complete()}})),function(){n=!0}}))},of:function(){for(var e=0,t=arguments.length,n=new Array(t);e<t;)n[e]=arguments[e++];return new("function"==typeof this?this:k)((function(e){var t=!1;return a((function(){if(!t){for(var r=0;r<n.length;++r)if(e.next(n[r]),t)return;e.complete()}})),function(){t=!0}}))}}),h(k.prototype,u,(function(){return this})),r(r.G,{Observable:k}),n(39)("Observable")},function(e,t,n){var r=n(3),i=n(0),o=n(62),a=[].slice,u=/MSIE .\./.test(o),s=function(e){return function(t,n){var r=arguments.length>2,i=!!r&&a.call(arguments,2);return e(r?function(){("function"==typeof t?t:Function(t)).apply(this,i)}:t,n)}};i(i.G+i.B+i.F*u,{setTimeout:s(r.setTimeout),setInterval:s(r.setInterval)})},function(e,t,n){var r=n(0),i=n(92);r(r.G+r.B,{setImmediate:i.set,clearImmediate:i.clear})},function(e,t,n){for(var r=n(89),i=n(35),o=n(13),a=n(3),u=n(12),s=n(47),c=n(6),l=c("iterator"),f=c("toStringTag"),h=s.Array,p={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},d=i(p),v=0;v<d.length;v++){var y,g=d[v],m=p[g],b=a[g],w=b&&b.prototype;if(w&&(w[l]||u(w,l,h),w[f]||u(w,f,g),s[g]=h,m))for(y in r)w[y]||o(w,y,r[y],!0)}},function(e,t,n){(function(t){!function(t){"use strict";var n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag",s="object"==typeof e,c=t.regeneratorRuntime;if(c)s&&(e.exports=c);else{(c=t.regeneratorRuntime=s?e.exports:{}).wrap=v;var l={},f={};f[o]=function(){return this};var h=Object.getPrototypeOf,p=h&&h(h(E([])));p&&p!==n&&r.call(p,o)&&(f=p);var d=b.prototype=g.prototype=Object.create(f);m.prototype=d.constructor=b,b.constructor=m,b[u]=m.displayName="GeneratorFunction",c.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},c.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u in e||(e[u]="GeneratorFunction")),e.prototype=Object.create(d),e},c.awrap=function(e){return{__await:e}},w(k.prototype),k.prototype[a]=function(){return this},c.AsyncIterator=k,c.async=function(e,t,n,r){var i=new k(v(e,t,n,r));return c.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},w(d),d[u]="Generator",d[o]=function(){return this},d.toString=function(){return"[object Generator]"},c.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},c.values=E,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var u=r.call(o,"catchLoc"),s=r.call(o,"finallyLoc");if(u&&s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),O(n),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;O(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:E(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}}}function v(e,t,n,r){var i=t&&t.prototype instanceof g?t:g,o=Object.create(i.prototype),a=new R(r||[]);return o._invoke=function(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return x()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var u=S(a,n);if(u){if(u===l)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=y(e,t,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===l)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}(e,n,a),o}function y(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function g(){}function m(){}function b(){}function w(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function k(e){function n(t,i,o,a){var u=y(e[t],e,i);if("throw"!==u.type){var s=u.arg,c=s.value;return c&&"object"==typeof c&&r.call(c,"__await")?Promise.resolve(c.__await).then((function(e){n("next",e,o,a)}),(function(e){n("throw",e,o,a)})):Promise.resolve(c).then((function(e){s.value=e,o(s)}),a)}a(u.arg)}var i;"object"==typeof t.process&&t.process.domain&&(n=t.process.domain.bind(n)),this._invoke=function(e,t){function r(){return new Promise((function(r,i){n(e,t,r,i)}))}return i=i?i.then(r,r):r()}}function S(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=y(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,l;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function R(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function E(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:x}}function x(){return{value:void 0,done:!0}}}("object"==typeof t?t:"object"==typeof window?window:"object"==typeof self?self:this)}).call(this,n(68))},function(e,t,n){n(333),e.exports=n(19).RegExp.escape},function(e,t,n){var r=n(0),i=n(334)(/[\\^$*+?.()|[\]{}]/g,"\\$&");r(r.S,"RegExp",{escape:function(e){return i(e)}})},function(e,t){e.exports=function(e,t){var n=t===Object(t)?function(e){return t[e]}:t;return function(t){return String(t).replace(e,n)}}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";n.r(t);var r=n(1),i=n.n(r);function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t,this.data=void 0!==n?n:null,this.subject=null}var t,n,r;return t=e,(n=[{key:"getName",value:function(){return this.name}},{key:"getData",value:function(){return this.data}},{key:"toString",value:function(){return null==this.data?this.name:this.name+" "+this.data.toString()}}])&&o(t.prototype,n),r&&o(t,r),e}();function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"update",value:function(e){}}])&&u(t.prototype,n),r&&u(t,r),e}();function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.length=0,this.obj=new Object}var t,n,r;return t=e,(n=[{key:"isEmpty",value:function(){return 0==this.length}},{key:"containsKey",value:function(e){return e in this.obj}},{key:"containsValue",value:function(e){for(var t in this.obj)if(this.obj[t]==e)return!0;return!1}},{key:"put",value:function(e,t){this.containsKey(e)||this.length++,this.obj[e]=t}},{key:"get",value:function(e){return this.containsKey(e)?this.obj[e]:null}},{key:"remove",value:function(e){if(this.containsKey(e)){var t=this.obj[e];return delete this.obj[e],this.length--,t}return null}},{key:"values",value:function(){var e=new Array;for(var t in this.obj)e.push(this.obj[t]);return e}},{key:"keys",value:function(){var e=new Array;for(var t in this.obj)e.push(t);return e}},{key:"keySet",value:function(){var e=new Array;for(var t in this.obj)e.push(t);return e}},{key:"size",value:function(){return this.length}},{key:"clear",value:function(){this.length=0,this.obj=new Object}}])&&c(t.prototype,n),r&&c(t,r),e}();function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var h=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.observers=[],this.functions=[],this.namedObservers=null,this.namedFunctions=null}var t,n,r;return t=e,(n=[{key:"attach",value:function(e){var t=null;(t="function"==typeof e?this.functions:this.observers).indexOf(e)>=0||t.push(e)}},{key:"attachWithName",value:function(e,t){var n=null;"function"==typeof t?(null==this.namedFunctions&&(this.namedFunctions=new l),n=this.namedFunctions):(null==this.namedObservers&&(this.namedObservers=new l),n=this.namedObservers);var r=n.get(e);null==r?n.put(e,[t]):r.push(t)}},{key:"detach",value:function(e){var t=null,n=(t="function"==typeof e?this.functions:this.observers).indexOf(e);n>=0&&t.splice(n,1)}},{key:"detachWithName",value:function(e,t){var n=null;if("function"==typeof t){if(null==this.namedFunctions)return;n=this.namedFunctions}else{if(null==this.namedObservers)return;n=this.namedObservers}var r=n.get(e);if(null!=r){var i=r.indexOf(t);i>=0&&r.splice(i,1)}}},{key:"notifyObservers",value:function(e){e.subject=this;for(var t=0;t<this.functions.length;++t)(0,this.functions[t])(e);for(var n=0;n<this.observers.length;++n)this.observers[n].update(e);if(null!=this.namedFunctions){var r=this.namedFunctions.get(e.name);if(null!=r)for(var i=0;i<r.length;++i)r[i](e)}if(null!=this.namedObservers){var o=this.namedObservers.get(e.name);if(null!=o)for(var a=0;a<o.length;++a)o[a].update(e)}}}])&&f(t.prototype,n),r&&f(t,r),e}();function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var d=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"initializer",value:function(){}},{key:"toJSON",value:function(){return{}}},{key:"toCompactJSON",value:function(){return{}}}])&&p(t.prototype,n),r&&p(t,r),e}();function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var y=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t,this.data=n,this.sn=void 0===r?i.a.Utils.generateSerialNumber():r,this.state=null,this.context=null,this.responseType="json"}var t,n,r;return t=e,r=[{key:"create",value:function(t){return new e(t.name,t.data,t.sn)}}],(n=[{key:"getStateCode",value:function(){return null!=this.state?this.state.code:-1}},{key:"getPayload",value:function(){return this.data}}])&&v(t.prototype,n),r&&v(t,r),e}();function g(e){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e,t){return!t||"object"!==g(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function w(e){var t="function"==typeof Map?new Map:void 0;return(w=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return k(e,arguments,O(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),_(r,e)})(e)}function k(e,t,n){return(k=S()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&_(i,n.prototype),i}).apply(null,arguments)}function S(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var R=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}(u,e);var t,n,r,i,o,a=(t=u,n=S(),function(){var e,r=O(t);if(n){var i=O(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return b(this,e)});function u(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=a.call(this)).name="KernelError",t.message=e,t}return r=u,(i=[{key:"toString",value:function(){return this.name+" "+this.message}}])&&m(r.prototype,i),o&&m(r,o),u}(w(Error));function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function x(e,t){return(x=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function C(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=T(e);if(t){var i=T(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return P(this,n)}}function P(e,t){return!t||"object"!==E(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var A=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&x(e,t)}(n,e);var t=C(n);function n(e,r){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(i=t.call(this,e)).code=r,i.name="PipelineError",i}return n}(R);function j(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var M=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"onReceived",value:function(e,t,n){}},{key:"onOpened",value:function(e){}},{key:"onClosed",value:function(e){}},{key:"onFailed",value:function(e,t){}}])&&j(t.prototype,n),r&&j(t,r),e}();function N(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var L=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t,this.kernel=null,this.listenerMap=new l,this.stateListenerList=[],this.address=null,this.port=7070,window.location.protocol.toLowerCase().indexOf("https")>=0&&(this.port=7077),this.opened=!1,this.tokenCode=null}var t,n,r;return t=e,(n=[{key:"getName",value:function(){return this.name}},{key:"setRemoteAddress",value:function(e,t){if(void 0!==t){if(this.port==t&&this.address==e)return}else if(this.address==e)return;var n=this.opened;n&&this.close(),this.address=e,void 0!==t&&(this.port=t),n&&this.open()}},{key:"setTokenCode",value:function(e){this.tokenCode=e}},{key:"open",value:function(){this.opened=!0}},{key:"close",value:function(){this.opened=!1}},{key:"isReady",value:function(){return!0}},{key:"addStateListener",value:function(e){this.stateListenerList.indexOf(e)>=0||this.stateListenerList.push(e)}},{key:"removeStateListener",value:function(e){var t=this.stateListenerList.indexOf(e);t>=0&&this.stateListenerList.splice(t,1)}},{key:"triggerState",value:function(e,t){for(var n=[],r=this.listenerMap.values(),i=0;i<r.length;++i)for(var o=r[i],a=0;a<o.length;++a)n.push(o[a]);if(n=n.concat(this.stateListenerList),"open"===e)for(var u=0;u<n.length;++u){var s=n[u];"function"==typeof s?s({name:e,pipeline:this}):s.onOpened&&s.onOpened(this)}else if("failed"===e)for(var c=0;c<n.length;++c){var l=n[c];"function"==typeof l?l({name:e,pipeline:this,error:t}):l.onFailed&&l.onFailed(this,t)}else if("close"===e)for(var f=0;f<n.length;++f){var h=n[f];"function"==typeof h?h({name:e,pipeline:this}):h&&h.onClosed&&h.onClosed(this)}}},{key:"send",value:function(e,t,n){}},{key:"addListener",value:function(e,t){var n=this.listenerMap.get(e);null==n?this.listenerMap.put(e,[t]):n.indexOf(t)<0&&n.push(t)}},{key:"removeListener",value:function(e,t){var n=this.listenerMap.get(e);if(null!=n){var r=n.indexOf(t);r>=0&&n.splice(r,1)}}},{key:"getListeners",value:function(e){return this.listenerMap.get(e)}},{key:"triggerListeners",value:function(e,t){var n=this.listenerMap.get(e);if(null!=n)for(var r=0;r<n.length;++r){var i=n[r];"function"==typeof i?i(this,e,t):i.onReceived(this,e,t)}}},{key:"touchCallback",value:function(e,t,n){n(this,e,t)}}])&&N(t.prototype,n),r&&N(t,r),e}();function I(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var D=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._keys=[],this._values=[]}var t,n,r;return t=e,(n=[{key:"isEmpty",value:function(){return 0==this._keys.length}},{key:"containsKey",value:function(e){return this._keys.indexOf(e)>=0}},{key:"containsValue",value:function(e){return this._values.indexOf(e)>=0}},{key:"put",value:function(e,t){var n=this._keys.indexOf(e);n>=0?this._values[n]=t:(this._keys.push(e),this._values.push(t))}},{key:"get",value:function(e){var t=this._keys.indexOf(e);return t>=0?this._values[t]:null}},{key:"remove",value:function(e){var t=this._keys.indexOf(e);if(t>=0){var n=this._values[t];return this._keys.splice(t,1),this._values.splice(t,1),n}return null}},{key:"values",value:function(){var e=new Array;return Array.prototype.push.apply(e,this._values),e}},{key:"keys",value:function(){var e=new Array;return Array.prototype.push.apply(e,this._keys),e}},{key:"keySet",value:function(){var e=new Array;return Array.prototype.push.apply(e,this._keys),e}},{key:"size",value:function(){return this._keys.length}},{key:"clear",value:function(){this._keys.length=0,this._values.length=0,this._keys=[],this._values=[]}}])&&I(t.prototype,n),r&&I(t,r),e}();function F(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var B=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t,this.system=null}var t,n,r;return t=e,(n=[{key:"getName",value:function(){return this.name}},{key:"apply",value:function(e){return this.system.syncApply(this.name,e)}}])&&F(t.prototype,n),r&&F(t,r),e}();function z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var G=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"onEvent",value:function(e,t){return t}}])&&z(t.prototype,n),r&&z(t,r),e}();function U(e){return(U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function H(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function J(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function V(e,t,n){return t&&J(e.prototype,t),n&&J(e,n),e}function W(e,t){return(W=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function q(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Z(e);if(t){var i=Z(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return K(this,n)}}function K(e,t){return!t||"object"!==U(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Z(e){return(Z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var $=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&W(e,t)}(n,e);var t=q(n);function n(){return H(this,n),t.call(this,"CubeDummyHook")}return V(n,[{key:"apply",value:function(e){return e}}]),n}(B),Q=function(){function e(){H(this,e),this.hooks=new D,this.plugins=new D}return V(e,[{key:"addHook",value:function(e){e.system=this,this.hooks.put(e.getName(),e)}},{key:"removeHook",value:function(e){this.hooks.remove(e.getName()),e.system=null}},{key:"getHook",value:function(e){var t=this.hooks.get(e);return null==t?new $:t}},{key:"register",value:function(e,t){var n=this.plugins.get(e);null==n&&(n=new Array,this.plugins.put(e,n)),n.push(t)}},{key:"deregister",value:function(e,t){var n=this.plugins.get(e);if(null!=n){var r=n.indexOf(t);r>=0&&n.splice(r,1)}}},{key:"syncApply",value:function(e,t){var n=this.plugins.get(e);if(null==n)return t;for(var r=t,i=0;i<n.length;++i){r=n[i].onEvent(e,r)}return r}}]),e}();function X(e){return(X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ee(e,t,n){return(ee="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ie(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function te(e,t){return(te=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ne(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ie(e);if(t){var i=ie(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return re(this,n)}}function re(e,t){return!t||"object"!==X(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ie(e){return(ie=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var oe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&te(e,t)}(o,e);var t,n,r,i=ne(o);function o(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(n=i.call(this)).address=e,n.primaryContent=t,n}return t=o,r=[{key:"create",value:function(e){return new o(e.address,e.primaryContent)}}],(n=[{key:"getAddress",value:function(){return this.address}},{key:"getPrimaryContent",value:function(){return this.primaryContent}},{key:"toJSON",value:function(){var e=ee(ie(o.prototype),"toJSON",this).call(this);return e.address=this.address,e.primaryContent=this.primaryContent,e}}])&&Y(t.prototype,n),r&&Y(t,r),o}(d);function ae(e){return(ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ue(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function se(e,t,n){return(se="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=he(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function ce(e,t){return(ce=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function le(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=he(e);if(t){var i=he(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return fe(this,n)}}function fe(e,t){return!t||"object"!==ae(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function he(e){return(he=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var pe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ce(e,t)}(o,e);var t,n,r,i=le(o);function o(e,t,n,r,a,u,s){var c;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(c=i.call(this)).code=e,c.domain=t,c.appKey=n,c.cid=r,c.issues=a,c.expiry=u,c.description=s,c}return t=o,r=[{key:"create",value:function(e){return new o(e.code,e.domain,e.appKey,e.cid,e.issues,e.expiry,oe.create(e.description))}}],(n=[{key:"isValid",value:function(){return Date.now()<this.expiry}},{key:"getDescription",value:function(){return this.description}},{key:"toJSON",value:function(){var e=se(he(o.prototype),"toJSON",this).call(this);return e.code=this.code,e.domain=this.domain,e.appKey=this.appKey,e.cid=this.cid,e.issues=this.issues,e.expiry=this.expiry,e.description=this.description.toJSON(),e}}])&&ue(t.prototype,n),r&&ue(t,r),o}(d);function de(e){return(de="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ve(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ye(e,t){return(ye=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ge(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=be(e);if(t){var i=be(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return me(this,n)}}function me(e,t){return!t||"object"!==de(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function be(e){return(be=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var we=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ye(e,t)}(o,e);var t,n,r,i=ge(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this)).name=e,t.kernel=null,t.pipeline=null,t.started=!1,t.dependencies=[],t.deps=[],t.pluginSystem=new Q,t.defaultRetrospect=2592e6,t}return t=o,(n=[{key:"getName",value:function(){return this.name}},{key:"getAuthToken",value:function(){return this.kernel.getAuthToken()}},{key:"require",value:function(e){this.dependencies.indexOf(e)>=0||this.dependencies.push(e)}},{key:"requireFile",value:function(e){this.deps.indexOf(e)>=0||this.deps.push(e)}},{key:"hasStarted",value:function(){return this.started}},{key:"start",value:function(){if(!this.kernel.working)return!1;if(this.started)return!1;for(var e=0;e<this.dependencies.length;++e){var t=this.kernel.getModule(this.dependencies[e]);null!=t&&t.start()}return this.started=!0,!0}},{key:"stop",value:function(){this.started=!1}},{key:"suspend",value:function(){}},{key:"resume",value:function(){}},{key:"config",value:function(e){}},{key:"on",value:function(e,t){"string"==typeof e?this.attachWithName(e,t):"function"==typeof e&&this.attach(e)}},{key:"getPluginSystem",value:function(){return this.pluginSystem}}])&&ve(t.prototype,n),r&&ve(t,r),o}(h),ke="applyToken",Se="getToken";function _e(e){return(_e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Oe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Re(e,t){return(Re=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ee(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Ce(e);if(t){var i=Ce(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return xe(this,n)}}function xe(e,t){return!t||"object"!==_e(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ce(e){return(Ce=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Pe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Re(e,t)}(o,e);var t,n,r,i=Ee(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this)).authService=e,t}return t=o,(n=[{key:"onReceived",value:function(e,t,n){}}])&&Oe(t.prototype,n),r&&Oe(t,r),o}(M),Te=1e3,Ae=function(e){return e.containsParam("state")?e.getParamAsJson("state"):null},je="InvalidToken",Me=function(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=[],r=atob(t),i=0;i<r.length;++i)n[i]=r.charCodeAt(i);return n},Ne=function(e){for(var t=[],n=0;n<e.length;++n)t.push(String.fromCharCode(e[n]));return btoa(t.join(""))};function Le(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ie=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"loadCandidate",value:function(){return this.load("token")}},{key:"saveCandidate",value:function(e){this.save("token",e)}},{key:"raise",value:function(e){var t=this.loadCandidate();return null!=t&&(this.save(e,t),this.remove("token"),!0)}},{key:"load",value:function(e){var t=window.localStorage.getItem("_cube_"+e+"_");if(t){var n=Me(t),r=i.a.Utils.simpleDecrypt(n,["S","X","c","u","b","e","3","0"]),o=i.a.Utils.fromCharCode(r);return pe.create(JSON.parse(o))}return null}},{key:"save",value:function(e,t){var n=JSON.stringify(t.toJSON()),r=i.a.Utils.simpleEncrypt(n,["S","X","c","u","b","e","3","0"]),o=Ne(r);window.localStorage.setItem("_cube_"+e+"_",o)}},{key:"remove",value:function(e){window.localStorage.removeItem("_cube_"+e+"_")}},{key:"removeAll",value:function(){window.localStorage.clear()}}])&&Le(t.prototype,n),r&&Le(t,r),e}();function De(e){return(De="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Fe(e,t,n,r,i,o,a){try{var u=e[o](a),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,i)}function Be(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){Fe(o,r,i,a,u,"next",e)}function u(e){Fe(o,r,i,a,u,"throw",e)}a(void 0)}))}}function ze(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ge(e,t,n){return(Ge="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=We(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Ue(e,t){return(Ue=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function He(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=We(e);if(t){var i=We(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Je(this,n)}}function Je(e,t){return!t||"object"!==De(t)&&"function"!=typeof t?Ve(e):t}function Ve(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function We(e){return(We=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function qe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ke=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ue(e,t)}(s,e);var t,n,r,o,u=He(s);function s(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(e=u.call(this,"Auth")).domain=null,e.appKey=null,e.token=null,e.pipelineListener=new Pe(Ve(e)),e.checkTimer=0,e}return t=s,(n=[{key:"start",value:function(){return!!Ge(We(s.prototype),"start",this).call(this)&&(this.pipeline.addListener(s.NAME,this.pipelineListener),!0)}},{key:"stop",value:function(){Ge(We(s.prototype),"stop",this).call(this),null!=this.pipeline&&(this.checkTimer>0&&(clearTimeout(this.checkTimer),this.checkTimer=0),this.pipeline.removeListener(s.NAME,this.pipelineListener))}},{key:"getToken",value:function(){return this.token}},{key:"allocToken",value:function(e,t){var n=this,r=new Ie,i=r.load(e);if(null!=i)return this.token=i,this.token.cid=e,void t(this.token);null!=this.token?(r.raise(e)||(this.token.cid=e,r.save(e,this.token)),Be(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.applyToken(n.token.domain,n.token.appKey);case 2:null!=(t=e.sent)&&r.saveCandidate(t);case 4:case"end":return e.stop()}}),e)})))(),t(this.token)):Be(regeneratorRuntime.mark((function i(){var o;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,n.applyToken(n.domain,n.appKey);case 2:null!=(o=i.sent)?(r.save(e,o),n.token=o,n.token.cid=e,t(n.token)):t(null);case 4:case"end":return i.stop()}}),i)})))()}},{key:"check",value:(o=Be(regeneratorRuntime.mark((function e(t,n,r){var i,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s.DOMAIN=t,this.domain=t,this.appKey=n,i=new Ie,window.localStorage&&(this.token=i.loadCandidate()),null==this.token||!this.token.isValid()){e.next=10;break}return this.checkTimer>0&&clearTimeout(this.checkTimer),this.checkTimer=setTimeout((function(){clearTimeout(o.checkTimer),o.checkTimer=0,o.checkToken()}),2e3),s.TOKEN=this.token.code,e.abrupt("return",this.token);case 10:return void 0!==r&&this.pipeline.setRemoteAddress(r),this.pipeline.open(),e.next=14,this.applyToken(t,n);case 14:return this.token=e.sent,null!=this.token&&(s.TOKEN=this.token.code,window.localStorage&&i.saveCandidate(this.token)),e.abrupt("return",this.token);case 17:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return o.apply(this,arguments)})},{key:"applyToken",value:function(e,t){var n=this;return new Promise((function(r,o){var a=0,u=setInterval((function(){if(++a>50)return clearInterval(u),void r(null);if(n.pipeline.isReady()){clearInterval(u);var o=new y(ke,{domain:e,appKey:t});n.pipeline.send(s.NAME,o,(function(e,t,n){if(null!=n){var o=n.getStateCode();if(o==Te)if(0==n.data.code){var a=pe.create(n.data.data);r(a)}else i.a.Logger.w("AuthService","Apply auth token failed: "+n.data.code),r(null);else i.a.Logger.w("AuthService","Pipeline error: "+o),r(null)}else r(null)}))}}),100)}))}},{key:"checkToken",value:function(){var e=this;if(null!=this.token){var t=this.token.code,n=new y(Se,{code:t});this.pipeline.send(s.NAME,n,(function(n,r,o){if(null!=o)if(o.getStateCode()==Te&&0==o.data.code)i.a.Logger.d("AuthService",'Token "'+t+'" is valid');else{var u=new a(je,e.token);e.notifyObservers(u),window.localStorage&&(new Ie).remove(e.token.cid),e.token=null,e._autoApply()}}))}}},{key:"cleanToken",value:function(){var e=new Ie;e.removeAll(),e=null}},{key:"_autoApply",value:function(){var e=this;i.a.Logger.d("AuthService","Auto apply token @ "+this.domain),this.applyToken(this.domain,this.appKey).then((function(t){null!=t?(e.token=t,null!=e.token&&window.localStorage&&(new Ie).saveCandidate(t)):e.checkTimer=setTimeout((function(t){clearTimeout(e.checkTimer),e.checkTimer=0,e._autoApply()}),5e3)})).catch((function(){}))}}])&&ze(t.prototype,n),r&&ze(t,r),s}(we);function Ze(e,t,n,r,i,o,a){try{var u=e[o](a),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,i)}function $e(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){Ze(o,r,i,a,u,"next",e)}function u(e){Ze(o,r,i,a,u,"throw",e)}a(void 0)}))}}function Qe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Xe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}qe(Ke,"NAME","Auth"),qe(Ke,"DOMAIN",""),qe(Ke,"TOKEN","");var Ye=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=null,this.working=!1,this.depsPath="libs/",this.pipelines=new l,this.modules=new l,e.gsInstance=this}var t,n,r,o;return t=e,(n=[{key:"startup",value:(o=$e(regeneratorRuntime.mark((function e(t,n,r){var o,a,u=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===t.log?i.a.Logger.level=i.a.LogLevel.DEBUG:i.a.Logger.level=t.log,void 0===t.address&&(t.address="127.0.0.1"),this.working=!0,this.config=t,this.bundleDefault(),e.next=7,this.checkAuth(t);case 7:if(null!=(o=e.sent)&&o.isValid()){e.next=11;break}return r(new R("Invalid token config data")),e.abrupt("return");case 11:this.configModules(t,o),a=function(){var e=$e(regeneratorRuntime.mark((function e(i){var o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(o=u.pipelines.values(),a=0;a<o.length;++a)o[a].open();if(void 0===t.pipelineReady||!t.pipelineReady){e.next=5;break}return e.next=5,u.waitPipelineReady(1e4);case 5:i?n():r(new R("Load module deps failed"));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.loadModuleDeps((function(e,t){a(!0)}),(function(e,t){a(!1)}));case 14:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return o.apply(this,arguments)})},{key:"shutdown",value:function(){this.working=!1;for(var e=this.pipelines.values(),t=0;t<e.length;++t)e[t].close();for(var n=this.modules.values(),r=0;r<n.length;++r)n[r].stop()}},{key:"suspend",value:function(){}},{key:"resume",value:function(){}},{key:"installPipeline",value:function(e){e.kernel=this,this.pipelines.put(e.getName(),e)}},{key:"uninstallPipeline",value:function(e){this.pipelines.remove(e.getName())}},{key:"getPipeline",value:function(e){return this.pipelines.get(e)}},{key:"installModule",value:function(e){e.kernel=this,this.modules.put(e.getName(),e)}},{key:"uninstallModule",value:function(e){this.modules.remove(e.getName())}},{key:"getModule",value:function(e){return this.modules.get(e)}},{key:"getAuthToken",value:function(){return this.getModule(Ke.NAME).getToken()}},{key:"activeToken",value:function(e){var t=this;return new Promise((function(n,r){t.getModule(Ke.NAME).allocToken(e,(function(e){if(null!=e){for(var r=t.pipelines.values(),i=0;i<r.length;++i)r[i].setTokenCode(e.code);n(e)}else n(null)}))}))}},{key:"waitPipelineReady",value:function(e){var t=this;return new Promise((function(n,r){var i=0,o=setTimeout((function(e){clearInterval(i),clearTimeout(o),n()}),e),a=t.pipelines.get("Cell");i=setInterval((function(e){a.isReady()&&(clearInterval(i),clearTimeout(o),n())}),100)}))}},{key:"checkAuth",value:function(e){var t=this;return new Promise((function(n,r){var o=t.getModule(Ke.NAME);if(null==o)return i.a.Logger.w("Kernel","Can NOT find auth module"),void n(null);if(void 0===e.domain||void 0===e.appKey)return i.a.Logger.w("Kernel","Auth config error"),void n(null);var a=o.check(e.domain,e.appKey,e.address);if(null==a)return i.a.Logger.w("Kernel","Auth token is invalid"),void n(null);n(a)}))}},{key:"bundle",value:function(e,t){}},{key:"bundleDefault",value:function(){for(var e=this.pipelines.get("Cell"),t=this.modules.values(),n=0;n<t.length;++n){var r=t[n];null==r.pipeline&&(r.pipeline=e)}}},{key:"configModules",value:function(e,t){if(null==t)return!1;for(var n=this.pipelines.values(),r=0;r<n.length;++r){var o=n[r];o.setRemoteAddress(t.getDescription().getAddress()),o.setTokenCode(t.code)}for(var a=this.modules.values(),u=0;u<a.length;++u){for(var s=a[u],c=0;c<s.dependencies.length;++c){var l=s.dependencies[c];this.modules.containsKey(l)||i.a.Logger.e("Kernel",'Module "'+l+'" is not installed, which module "'+s.name+'" depends.')}if(t.description.primaryContent.hasOwnProperty(s.name)){var f=t.description.primaryContent[s.name];s.config(f)}}return!0}},{key:"loadModuleDeps",value:function(e,t){for(var n=this,r=[],o=this.modules.values(),a=0;a<o.length;++a)for(var u=o[a],s=0;s<u.deps.length;++s)r.push(u.deps[s]);var c=[],l=[];0!=r.length?new Promise((function(e,t){!function e(){var t=null;r.length>0&&(t=r.splice(0,1),n.loadDepsJS(t).then((function(t){c.push(t),e()})).catch((function(t){l.push(t),i.a.Logger.i("Kernel","Startup error: can not load file: "+t),e()})))}();var o=0,a=setInterval((function(n){if(++o>=50)return clearInterval(a),void t();0==r.length&&(clearInterval(a),l.length>0?t():e())}),100)})).then((function(t){i.a.Logger.d("Kernel","Module deps files loaded: "+c.length),e.call(null,c,l)})).catch((function(e){t.call(null,c,l)})):e(c,l)}},{key:"loadDepsJS",value:function(e){var t=this.depsPath;return new Promise((function(n,r){var i=document.createElement("script");i.type="text/javascript",i.readyState?i.onreadystatechange=function(){"loaded"!=i.readyState&&"complete"!=i.readyState||(i.onreadystatechange=null,n(e))}:(i.onload=function(t){n(e)},i.onerror=function(t){r(e)}),i.src=t+e,document.getElementsByTagName("body")[0].appendChild(i)}))}}])&&Qe(t.prototype,n),r&&Qe(t,r),e}();Xe(Ye,"VERSION","1.0.0"),Xe(Ye,"gsInstance",null);var et="broadcastEntity";function tt(e){return(tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function nt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function rt(e,t,n){return(rt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ut(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function it(e,t){return(it=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ot(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ut(e);if(t){var i=ut(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return at(this,n)}}function at(e,t){return!t||"object"!==tt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ut(e){return(ut=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var st=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&it(e,t)}(o,e);var t,n,r,i=ot(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this)).id=0,t.timestamp=Date.now(),t.expiry=t.timestamp+(void 0!==e)?e:6e5,t.context=null,t.moduleName=null,t}return t=o,(n=[{key:"getId",value:function(){return this.id}},{key:"getTimestamp",value:function(){return this.timestamp}},{key:"getExpiry",value:function(){return this.expiry}},{key:"setContext",value:function(e){this.context=e}},{key:"getContext",value:function(){return this.context}},{key:"overdue",value:function(){return this.expiry>Date.now()}},{key:"broadcast",value:function(e){if(null==this.moduleName)return!1;var t=this.id,n=Ye.gsInstance.getPipeline("Cell");if(null==n)return!1;var r=new y(et,{id:t,data:e});return n.send(this.moduleName,r),!0}},{key:"toJSON",value:function(){return rt(ut(o.prototype),"toJSON",this).call(this)}},{key:"toCompactJSON",value:function(){return rt(ut(o.prototype),"toCompactJSON",this).call(this)}}])&&nt(t.prototype,n),r&&nt(t,r),o}(d);function ct(e){return(ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function lt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ft(e,t){return(ft=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ht(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=dt(e);if(t){var i=dt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return pt(this,n)}}function pt(e,t){return!t||"object"!==ct(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function dt(e){return(dt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var vt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ft(e,t)}(a,e);var t,n,r,o=ht(a);function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=o.call(this)).pipeline=e,t}return t=a,(n=[{key:"onListened",value:function(e,t,n){this.pipeline.triggerListened(e,t,n)}},{key:"onSpoke",value:function(e,t,n){}},{key:"onAck",value:function(e,t,n){}},{key:"onSpeakTimeout",value:function(e,t,n){}},{key:"onContacted",value:function(e){i.a.Logger.d("CellTalkListener","onContacted"),this.pipeline.triggerState("open")}},{key:"onQuitted",value:function(e){i.a.Logger.d("CellTalkListener","onQuitted"),this.pipeline.triggerState("close")}},{key:"onFailed",value:function(e,t){this.pipeline.triggerState("failed",new A(t.getDescription(),t.getErrorCode()))}}])&&lt(t.prototype,n),r&&lt(t,r),a}(i.a.TalkListener);function yt(e){return(yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function gt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function mt(e,t,n){return(mt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_t(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function bt(e,t){return(bt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function wt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=_t(e);if(t){var i=_t(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return kt(this,n)}}function kt(e,t){return!t||"object"!==yt(t)&&"function"!=typeof t?St(e):t}function St(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _t(e){return(_t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ot,Rt,Et,xt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&bt(e,t)}(a,e);var t,n,r,o=wt(a);function a(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(e=o.call(this,"Cell")).talkListener=new vt(St(e)),e.nucleus=new i.a.Nucleus,e.nucleus.talk.addListener(e.talkListener),e.responseMap=new D,e.responseTimer=0,e.responseTimeout=15e3,e.timerPeriod=1e3,e}return t=a,(n=[{key:"open",value:function(){this.opened||(mt(_t(a.prototype),"open",this).call(this),null!=this.address&&0!=this.port?this.nucleus.talk.call(new i.a.InetAddress(this.address,this.port)):i.a.Logger.w("CellPipeline","Not configured address and port"))}},{key:"close",value:function(){mt(_t(a.prototype),"close",this).call(this),null!=this.address&&0!=this.port?this.nucleus.talk.hangup(new i.a.InetAddress(this.address,this.port)):i.a.Logger.w("CellPipeline","Not configured address and port")}},{key:"isReady",value:function(){return this.nucleus.talk.isCalled()}},{key:"send",value:function(e,t,n){var r=this;if(void 0!==n&&(this.responseMap.put(t.sn,{destination:e,handle:n,timestamp:Date.now()}),0==this.responseTimer)){var i=this;this.responseTimer=setInterval((function(){if(0==i.responseMap.size())return clearInterval(i.responseTimer),void(i.responseTimer=0);for(var e=Date.now(),t=i.responseMap.keys(),n=0;n<t.length;++n){var o=t[n],u=i.responseMap.get(o);e-u.timestamp>=i.responseTimeout&&(i.responseMap.remove(o),mt(_t(a.prototype),"touchCallback",r).call(r,u.destination,null,u.handle))}}),this.timerPeriod)}var o=this.convertPacketToPrimitive(t);this.nucleus.talkService.speak(e,o)}},{key:"triggerListened",value:function(e,t,n){var r=this.convertPrimitiveToPacket(n),i=this.responseMap.remove(r.sn);null!=i&&mt(_t(a.prototype),"touchCallback",this).call(this,t,r,i.handle),mt(_t(a.prototype),"triggerListeners",this).call(this,t,r)}},{key:"convertPacketToPrimitive",value:function(e){var t=new i.a.ActionDialect(e.name);return t.addParam("sn",e.sn,i.a.LiteralBase.LONG),t.addParam("data",e.data,i.a.LiteralBase.JSON),null!=this.tokenCode&&t.addParam("token",this.tokenCode,i.a.LiteralBase.STRING),t}},{key:"convertPrimitiveToPacket",value:function(e){var t=new i.a.ActionDialect(e),n=new y(t.getName(),t.getParamAsJson("data"),t.getParamAsLong("sn"));return n.state=Ae(t),n}}])&&gt(t.prototype,n),r&&gt(t,r),a}(L);function Ct(e){return(Ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Pt(e,t){return(Pt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Tt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=jt(e);if(t){var i=jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return At(this,n)}}function At(e,t){return!t||"object"!==Ct(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function jt(e){return(jt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}Et="Cell",(Rt="NAME")in(Ot=xt)?Object.defineProperty(Ot,Rt,{value:Et,enumerable:!0,configurable:!0,writable:!0}):Ot[Rt]=Et;var Mt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Pt(e,t)}(n,e);var t=Tt(n);function n(e,r,i,o,a,u,s,c){var l;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),l=t.call(this,"FileChunk",null,c);var f=new FormData;return f.append("cid",e),f.append("domain",r),f.append("fileSize",o),f.append("cursor",u),f.append("size",s),f.append("file",a,i),l.data=f,l}return n}(y);function Nt(e,t,n){return(Nt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ft(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Lt(e,t){return(Lt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function It(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Ft(e);if(t){var i=Ft(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Dt(this,n)}}function Dt(e,t){return!t||"object"!==Bt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ft(e){return(Ft=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Bt(e){return(Bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function zt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Gt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ut(e,t,n){return t&&Gt(e.prototype,t),n&&Gt(e,n),e}var Ht=function(){function e(t,n){zt(this,e),this.xhr=t,this.url=n,this.method="GET",this.headers=null,this.params=null,this.data=null,this.dataType="json",this.responseType="json"}return Ut(e,[{key:"setMethod",value:function(e){return this.method=e,this}},{key:"setHeader",value:function(e,t){return null==this.headers&&(this.headers=new l),this.headers.put(e,t),this}},{key:"setParams",value:function(e){return this.params=e,this}},{key:"setResponseType",value:function(e){this.responseType=e}},{key:"setData",value:function(e,t){return this.data=e,void 0!==t&&(this.dataType=t),this}},{key:"send",value:function(e){this.xhr.responseType=this.responseType;var t=null;if(null!=this.params){if("object"===Bt(this.params))for(var n in this.params)null==t?t=n+"="+encodeURIComponent(this.params[n]):t+="&"+n+"="+encodeURIComponent(this.params[n]);else t=this.params;t=this.url.indexOf("?")>0?"&"+t:"?"+t}if(void 0!==e){var r=this.xhr;r.onreadystatechange=function(){r.readyState===XMLHttpRequest.DONE&&e.call(null,r.status,r.response)}}var i=null==t?this.url:this.url+t;if(this.xhr.open(this.method,i,!0),null!=this.headers)for(var o=this.headers.keySet(),a=0;a<o.length;++a){var u=o[a],s=this.headers.get(u);this.xhr.setRequestHeader(u,s)}null!=this.data&&(this.data instanceof FormData?this.xhr.setRequestHeader("Content-Type","multipart/form-data"):this.xhr.setRequestHeader("Content-Type","application/json")),null!=this.data?this.xhr.send(this.data):this.xhr.send()}},{key:"getResponseHeader",value:function(e){return this.xhr.getResponseHeader(e)}}]),e}(),Jt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Lt(e,t)}(n,e);var t=It(n);function n(){return zt(this,n),t.call(this,"Ajax")}return Ut(n,[{key:"open",value:function(){Nt(Ft(n.prototype),"open",this).call(this)}},{key:"close",value:function(){Nt(Ft(n.prototype),"close",this).call(this)}},{key:"isReady",value:function(){return!0}},{key:"send",value:function(e,t,r){var i=this,o=this.tokenCode.toString(),a=this.newRequest(e);if(t instanceof Mt)a.setMethod("POST").setParams({token:o,sn:t.sn}).setData(t.data),a.send((function(t,o){if(200==t){var a=y.create(o);a.state={code:Te,desc:"Ok"},void 0!==r&&r(i,e,a),Nt(Ft(n.prototype),"triggerListeners",i).call(i,e,a)}else void 0!==r&&r(i,e,null),Nt(Ft(n.prototype),"triggerListeners",i).call(i,e,null)}));else if(t instanceof y){if("GET"==t.name.toUpperCase()){var u={token:o,sn:t.sn};if(t.data)for(var s in t.data)u[s]=t.data[s];a.setMethod(t.name).setParams(u)}else a.setMethod(t.name).setParams({token:o,sn:t.sn}).setData(t.data);a.setResponseType(t.responseType),a.send((function(o,u){if(200==o){var s=null;(s=a.getResponseHeader("Content-Type").indexOf("octet-stream")>=0?new y(t.name,u,t.sn):y.create(u)).state={code:Te,desc:"Ok"},void 0!==r&&r(i,e,s),Nt(Ft(n.prototype),"triggerListeners",i).call(i,e,s)}else void 0!==r&&r(i,e,null),Nt(Ft(n.prototype),"triggerListeners",i).call(i,e,null)}))}}},{key:"newRequest",value:function(e){var t=null;return t=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),new Ht(t,e)}}]),n}(L);function Vt(e){return(Vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Wt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function qt(e,t){return!t||"object"!==Vt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Kt(e){var t="function"==typeof Map?new Map:void 0;return(Kt=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return Zt(e,arguments,Xt(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Qt(r,e)})(e)}function Zt(e,t,n){return(Zt=$t()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&Qt(i,n.prototype),i}).apply(null,arguments)}function $t(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function Qt(e,t){return(Qt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Xt(e){return(Xt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(Jt,"NAME","Ajax");var Yt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Qt(e,t)}(u,e);var t,n,r,i,o,a=(t=u,n=$t(),function(){var e,r=Xt(t);if(n){var i=Xt(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return qt(this,e)});function u(e,t,n,r){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(i=a.call(this)).module=e,i.code=t,i.data=n,i.desc=r,i}return r=u,(i=[{key:"toString",value:function(){return"ModuleError ["+this.module+"] : "+this.code+(this.desc?" - "+this.desc.toString():"")}}])&&Wt(r.prototype,i),o&&Wt(r,o),u}(Kt(Error)),en="signIn",tn="signOut",nn="comeback",rn="getContact",on="getContactList",an="getGroup",un="listGroups",sn="createGroup",cn="dissolveGroup",ln="addGroupMember",fn="removeGroupMember",hn="modifyGroup",pn="modifyGroupMember";function dn(e){return(dn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function vn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function yn(e,t,n){return(yn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=wn(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function gn(e,t){return(gn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function mn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wn(e);if(t){var i=wn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return bn(this,n)}}function bn(e,t){return!t||"object"!==dn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function wn(e){return(wn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var kn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&gn(e,t)}(a,e);var t,n,r,o=mn(a);function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=o.call(this)).contactService=e,t}return t=a,(n=[{key:"onReceived",value:function(e,t,n){yn(wn(a.prototype),"onReceived",this).call(this,e,t,n),n.getStateCode()==Te?n.name==en?this.contactService.triggerSignIn(n.data):n.name==un?this.contactService.triggerListGroups(n.data):n.name==hn?this.contactService.triggerModifyGroup(n.data,n.context):n.name==pn?this.contactService.triggerModifyGroupMember(n.data,n.context):n.name==sn?this.contactService.triggerCreateGroup(n.data,n.context):n.name==cn?this.contactService.triggerDissolveGroup(n.data,n.context):n.name==fn?this.contactService.triggerRemoveMember(n.data,n.context):n.name==ln?this.contactService.triggerAddMember(n.data,n.context):n.name==tn&&this.contactService.triggerSignOut(n.data):i.a.Logger.w("ContactPipelineListener","Pipeline error: "+n.name+" - "+n.getStateCode())}},{key:"onOpened",value:function(e){var t=this;if(yn(wn(a.prototype),"onOpened",this).call(this,e),null!=this.contactService.self)if(this.contactService.selfReady)var n=setTimeout((function(){clearTimeout(n),t.contactService.comeback()}),100);else{i.a.Logger.d("ContactPipelineListener",'Call "SignIn" in "onOpened": '+this.contactService.self.getId());var r=setTimeout((function(){clearTimeout(r),t.contactService.signIn(t.contactService.self)}),100)}}},{key:"onClosed",value:function(e){yn(wn(a.prototype),"onClosed",this).call(this,e)}},{key:"onFailed",value:function(e,t){yn(wn(a.prototype),"onFailed",this).call(this,e,t)}}])&&vn(t.prototype,n),r&&vn(t,r),a}(M),Sn={browserName:null,browserVersion:null,system:null,getBrowserName:function(){return null==Sn.browserName&&Sn.parseBrowser(),Sn.browserName},getBrowserVersion:function(){return null==Sn.browserVersion&&Sn.parseBrowser(),Sn.browserVersion},getSystem:function(){return null==Sn.system&&Sn.parseSystem(),Sn.system},parseBrowser:function(){var e,t=navigator.userAgent.toLowerCase(),n="",r="";if(t.indexOf("msie")>0){n="IE",r=""+t.match(/msie [\d.]+;/gi)}else if(t.indexOf("firefox")>0){n="Firefox",r=""+t.match(/firefox\/[\d.]+/gi)}else if(t.indexOf("chrome")>0){n="chrome",r=""+t.match(/chrome\/[\d.]+/gi)}else if(t.indexOf("safari")>0&&t.indexOf("chrome")<0){n="safari",r=""+t.match(/version\/[\d.]+/gi)}else if(t.indexOf("opera")>=0){n="opera",r=""+t.match(/version\/[\d.]+/gi)}else{if("Netscape"==navigator.appName)r=t.split(";")[7].replace(/[ ]/g,"").match(/[\d\.]/g).toString().replace(/[,]/g,""),n="IE"}e=r.replace(/[^0-9.]/gi,""),Sn.browserVersion=e,Sn.browserName=n},parseSystem:function(){var e={win:!1,mac:!1,x11:!1,iphone:!1,ipoad:!1,ipad:!1,ios:!1,android:!1,nokiaN:!1,winMobile:!1,wii:!1,ps:!1},t=navigator.userAgent,n=navigator.platform;if(e.win=0==n.indexOf("Window"),e.mac=0==n.indexOf("Mac"),e.x11=0==n.indexOf("X11")||0==n.indexOf("Linux"),e.win){if(/Win(?:dows )?([^do]{2})\s?(\d+\.\d+)?/.test(t))if("NT"==RegExp.$1)switch(RegExp.$2){case"5.0":e.win="2000";break;case"5.1":e.win="XP";break;case"6.0":e.win="Vista";break;case"6.1":e.win="7";break;case"6.2":e.win="8";break;case"10":case"10.0":e.win="10";break;default:e.win="NT"}else"9x"==RegExp.$1?e.win="ME":e.win=RegExp.$1}else e.mac&&/Mac OS X (\d+\.\d+)?/.test(t)&&(e.mac=RegExp.$1.trim());e.iphone=t.indexOf("iPhone")>-1,e.ipod=t.indexOf("iPod")>-1,e.ipad=t.indexOf("iPad")>-1,e.nokiaN=t.indexOf("nokiaN")>-1,"CE"==e.win?e.winMobile=e.win:"Ph"==e.win&&/Windows Phone OS (\d+.\d)/i.test(t)&&(e.win="Phone",e.winMobile=parseFloat(RegExp.$1)),e.mac&&t.indexOf("Mobile")>-1&&(/CPU (?:iPhone )?OS (\d+_\d+)/i.test(t)?e.ios=parseFloat(RegExp.$1.replace("_",".")):e.ios=2),/Android (\d+\.\d+)/i.test(t)&&(e.android=parseFloat(RegExp.$1)),e.wii=t.indexOf("Wii")>-1,e.ps=/PlayStation/i.test(t),e.win?Sn.system="Windows "+e.win:e.mac?Sn.system="Mac OS X "+e.mac:e.x11?Sn.system="Linux":Sn.system=""}};function _n(e){return(_n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function On(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Rn(e,t,n){return(Rn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Pn(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function En(e,t){return(En=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function xn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Pn(e);if(t){var i=Pn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Cn(this,n)}}function Cn(e,t){return!t||"object"!==_n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Pn(e){return(Pn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Tn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&En(e,t)}(o,e);var t,n,r,i=xn(o);function o(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(n=i.call(this)).name=e,n.platform=null,n.platform=void 0===t?Sn.getBrowserName()+"/"+Sn.getSystem():t,n}return t=o,r=[{key:"create",value:function(e){return new o(e.name,e.platform)}}],(n=[{key:"getName",value:function(){return this.name}},{key:"getPlatform",value:function(){return this.platform}},{key:"setPlatform",value:function(e){this.platform=e}},{key:"toJSON",value:function(){var e=Rn(Pn(o.prototype),"toJSON",this).call(this);return e.name=this.name,e.platform=this.platform,e}},{key:"toCompactJSON",value:function(){return this.toJSON()}}])&&On(t.prototype,n),r&&On(t,r),o}(d);function An(e){return(An="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function jn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Mn(e,t,n){return(Mn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Dn(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Nn(e,t){return(Nn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ln(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Dn(e);if(t){var i=Dn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return In(this,n)}}function In(e,t){return!t||"object"!==An(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Dn(e){return(Dn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Fn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Nn(e,t)}(o,e);var t,n,r,i=Ln(o);function o(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(r=i.call(this,o.Lifespan)).id="string"==typeof e?parseInt(e):e,r.name=void 0===t?"Cube-"+e:t,r.domain=void 0===n?Ke.DOMAIN:n,r.devices=[],r}return t=o,r=[{key:"create",value:function(e,t){for(var n=e.id,r=e.name,i=void 0!==t?t:e.domain,a=e.devices?e.devices:[],u=new o(n,r,i),s=0;s<a.length;++s){var c=a[s],l=new Tn(c.name,c.platform);u.devices.push(l)}return void 0!==e.context&&(u.context=e.context),u}}],(n=[{key:"getId",value:function(){return this.id}},{key:"getDomain",value:function(){return this.domain}},{key:"setName",value:function(e){this.name=e}},{key:"getName",value:function(){return this.name}},{key:"addDevice",value:function(e){this.devices.indexOf(e)>=0||this.devices.push(e)}},{key:"removeDevice",value:function(e){var t=this.devices.indexOf(e);t>=0&&this.devices.splice(t,1)}},{key:"getDevices",value:function(){return this.devices}},{key:"getDevice",value:function(){return 0==this.devices.length?new Tn("Unknown","null"):this.devices[this.devices.length-1]}},{key:"equals",value:function(e){return(e instanceof o||void 0!==e.id&&void 0!==e.domain)&&e.id==this.id&&e.domain==this.domain}},{key:"toJSON",value:function(){var e=Mn(Dn(o.prototype),"toJSON",this).call(this);e.id=this.id,e.name=this.name,e.domain=this.domain;for(var t=[],n=0;n<this.devices.length;++n)t.push(this.devices[n].toJSON());return e.devices=t,null!=this.context&&(e.context=this.context instanceof JSONable?this.context.toJSON():this.context),e}},{key:"toCompactJSON",value:function(){var e=Mn(Dn(o.prototype),"toCompactJSON",this).call(this);return e.id=this.id,e.name=this.name,null!=this.context&&(e.context=this.context instanceof JSONable?this.context.toJSON():this.context),e}}])&&jn(t.prototype,n),r&&jn(t,r),o}(st);function Bn(e){return(Bn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function zn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Gn(e,t,n){return(Gn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Vn(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Un(e,t){return(Un=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Hn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Vn(e);if(t){var i=Vn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Jn(this,n)}}function Jn(e,t){return!t||"object"!==Bn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Vn(e){return(Vn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(Fn,"Lifespan",6e5);var Wn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Un(e,t)}(o,e);var t,n,r,i=Hn(o);function o(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(n=i.call(this,e,t,Ke.DOMAIN)).device=new Tn("Web"),n.addDevice(n.device),n}return t=o,(n=[{key:"getDevice",value:function(){return this.device}},{key:"toJSON",value:function(){var e=Gn(Vn(o.prototype),"toJSON",this).call(this);return e.device=this.device.toJSON(),e}},{key:"toCompactJSON",value:function(){var e=Gn(Vn(o.prototype),"toCompactJSON",this).call(this);return e.device=this.device.toCompactJSON(),e}}])&&zn(t.prototype,n),r&&zn(t,r),o}(Fn),qn={SignIn:"SignIn",SignOut:"SignOut",Comeback:"Comeback",GroupUpdated:"GroupUpdated",GroupCreated:"GroupCreated",GroupDissolved:"GroupDissolved",GroupMemberAdded:"GroupMemberAdded",GroupMemberRemoved:"GroupMemberRemoved",Unknown:"Unknown"},Kn=n(48),Zn=n.n(Kn),$n={Normal:0,Dismissed:1,Forbidden:2,HighRisk:3,Disabled:9,Unknown:-1};function Qn(e){return(Qn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Xn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Yn(e,t,n){return(Yn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=rr(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function er(e,t){return(er=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function tr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=rr(e);if(t){var i=rr(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return nr(this,n)}}function nr(e,t){return!t||"object"!==Qn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function rr(e){return(rr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ir=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&er(e,t)}(a,e);var t,n,r,o=tr(a);function a(e,t,n,r,u){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(s=o.call(this,void 0===n?i.a.Utils.generateSerialNumber():n,r,void 0===u?Ke.DOMAIN:u)).service=e,s.owner=t,s.creationTime=0,s.lastActiveTime=0,s.memberList=[t],s.state=$n.Normal,s}return t=a,r=[{key:"create",value:function(e,t,n){void 0===n&&(n=new Fn.create(t.owner,t.domain));var r=new a(e,n,t.id,t.name,t.domain);if(r.creationTime=t.creation,r.lastActiveTime=t.lastActive,r.state=t.state,void 0!==t.members)for(var i=0;i<t.members.length;++i){var o=Fn.create(t.members[i],t.domain);r.hasMember(o)||r.memberList.push(o)}return void 0!==t.context&&(r.context=t.context),r}}],(n=[{key:"changeOwner",value:function(e,t,n){return e instanceof Fn?this.service.modifyGroup(this,e,null,null,t,n):(n&&n(this),!1)}},{key:"modifyName",value:function(e,t,n){return e==this.name?(n&&n(this),!1):this.service.modifyGroup(this,null,e,null,t,n)}},{key:"modifyContext",value:function(e,t,n){return this.service.modifyGroup(this,null,null,e,t,n)}},{key:"getOwner",value:function(){return this.owner}},{key:"isOwner",value:function(e){return(e instanceof Fn||e instanceof Wn?e.getId():e)==this.owner.id}},{key:"getCreationTime",value:function(){return this.creationTime}},{key:"getLastActiveTime",value:function(){return this.lastActiveTime}},{key:"getState",value:function(){return this.state}},{key:"numMembers",value:function(){return this.memberList.length}},{key:"getMembers",value:function(){return this.memberList.concat()}},{key:"addMembers",value:function(e,t,n){return this.service.addGroupMembers(this,e,t,n)}},{key:"removeMembers",value:function(e,t,n){return this.service.removeGroupMembers(this,e,t,n)}},{key:"hasMember",value:function(e){var t=0;t=e instanceof Fn?e.getId():parseInt(e);for(var n=0;n<this.memberList.length;++n)if(this.memberList[n].getId()==t)return!0;return!1}},{key:"_removeMember",value:function(e){for(var t=e.getId(),n=0;n<this.memberList.length;++n)if(this.memberList[n].getId()==t)return void this.memberList.splice(n,1)}},{key:"_replaceMember",value:function(e){this._removeMember(e),this.memberList.push(e),this.owner.getId()==e.getId()&&(this.owner=e)}},{key:"toJSON",value:function(){var e=Yn(rr(a.prototype),"toJSON",this).call(this);delete e.devices,e.owner=this.owner.toCompactJSON(),e.creation=this.creationTime,e.lastActive=this.lastActiveTime,e.state=this.state,e.members=[];for(var t=0;t<this.memberList.length;++t)e.members.push(this.memberList[t].toCompactJSON());return e}},{key:"toCompactJSON",value:function(){var e=Yn(rr(a.prototype),"toCompactJSON",this).call(this);return e.domain=this.domain,e.owner=this.owner.toCompactJSON(),e.creation=this.creationTime,e.lastActive=this.lastActiveTime,e.state=this.state,e}}])&&Xn(t.prototype,n),r&&Xn(t,r),a}(Fn);function or(e,t,n,r,i,o,a){try{var u=e[o](a),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,i)}function ar(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){or(o,r,i,a,u,"next",e)}function u(e){or(o,r,i,a,u,"throw",e)}a(void 0)}))}}function ur(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var sr=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.service=t,this.domain=null,this.db=null,this.groupStore=null,this.contactStore=null}var t,n,r;return t=e,(n=[{key:"open",value:function(e){if(null==this.db){i.a.Logger.d("ContactStorage","Open contact storage : "+e),this.domain=e;var t={name:"CubeContact-"+e,version:1,stores:[{name:"group",keyPath:"id",indexes:[{name:"id",keyPath:"id",unique:!0},{name:"lastActive",keyPath:"lastActive",unique:!1},{name:"creation",keyPath:"creation",unique:!1},{name:"state",keyPath:"state",unique:!1}]},{name:"contact",keyPath:"id",indexes:[{name:"id",keyPath:"id",unique:!0}]},{name:"config",keyPath:"item",indexes:[{name:"item",keyPath:"item",unique:!0}]}]};this.db=new Zn.a(t),this.groupStore=this.db.use("group"),this.contactStore=this.db.use("contact")}}},{key:"close",value:function(){null!=this.db&&(i.a.Logger.d("MessagingStorage","Close contact storage : "+this.domain),this.db.close(),this.db=null)}},{key:"containsGroup",value:function(e,t){var n=this;return null!=this.db&&(ar(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.groupStore.query("id",e);case 2:r.sent.length>0?t(e,!0):t(e,!1);case 4:case"end":return r.stop()}}),r)})))(),!0)}},{key:"readGroups",value:function(e,t,n,r){var i=this;return null!=this.db&&(ar(regeneratorRuntime.mark((function o(){var a,u,s,c,l,f,h;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(a=null,void 0!==r){o.next=7;break}return o.next=4,i.groupStore.select([{key:"lastActive",value:e,compare:">"},{key:"lastActive",value:t,compare:"<=",optional:!0}]);case 4:a=o.sent,o.next=12;break;case 7:for(u=[{key:"lastActive",value:e,compare:">"},{key:"lastActive",value:t,compare:"<=",optional:!0}],s=0;s<r.length;++s)u.push({key:"state",value:r[s],options:!0});return o.next=11,i.groupStore.select(u);case 11:a=o.sent;case 12:c=[],l=0;case 14:if(!(l<a.length)){o.next=26;break}if(!((f=a[l]).lastActive>e&&f.lastActive<=t)){o.next=23;break}if(void 0===r){o.next=20;break}if(!(r.indexOf(f.state)<0)){o.next=20;break}return o.abrupt("continue",23);case 20:f.domain=i.domain,h=ir.create(i.service,f),c.push(h);case 23:++l,o.next=14;break;case 26:n(e,t,c);case 27:case"end":return o.stop()}}),o)})))(),!0)}},{key:"readGroup",value:function(e,t){var n=this;return null!=this.db&&(ar(regeneratorRuntime.mark((function r(){var i,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.groupStore.query("id",e);case 2:(i=r.sent).length>0?(o=i[0],t(e,ir.create(n.service,o))):t(e,null);case 4:case"end":return r.stop()}}),r)})))(),!0)}},{key:"writeGroup",value:function(e){var t=this;return null!=this.db&&(ar(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return delete(r=e.toJSON()).domain,n.next=4,t.groupStore.put(r);case 4:case"end":return n.stop()}}),n)})))(),!0)}}])&&ur(t.prototype,n),r&&ur(t,r),e}();function cr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var lr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.group=null,this.modified=[],this.operator=null,this.includeSelf=!1}var t,n,r;return t=e,r=[{key:"create",value:function(t,n){var r=new e;r.group=ir.create(t,n.group);for(var i=n.modified,o=0;o<i.length;++o){var a=i[o],u=Fn.create(a,r.group.getDomain());r.modified.push(u),u.getId()==t.self.getId()&&(r.includeSelf=!0)}return void 0!==n.operator&&(r.operator=Fn.create(n.operator,r.group.getDomain())),r}}],(n=null)&&cr(t.prototype,n),r&&cr(t,r),e}();function fr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var hr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.depositedMapList=[],this.depositedArrayList=[],this.listener=null,this.timer=0}var t,n,r;return t=e,(n=[{key:"start",value:function(){var e=this;this.timer=setInterval((function(t){e._onTick()}),1e4)}},{key:"stop",value:function(){clearInterval(this.timer)}},{key:"depositMap",value:function(e){this.depositedMapList.push(e)}},{key:"depositArray",value:function(e){this.depositedArrayList.push(e)}},{key:"setListener",value:function(e){this.listener=e}},{key:"_onTick",value:function(){for(var e=Date.now(),t=0;t<this.depositedMapList.length;++t)for(var n=this.depositedMapList[t],r=n.keys(),i=0;i<r.length;++i){var o=r[i],a=n.get(o);a instanceof st&&a.expiry>e&&(n.remove(o),null!=this.listener&&this.listener(a))}for(var u=0;u<this.depositedArrayList.length;++u)for(var s=this.depositedArrayList[u],c=0;c<s.length;++c){var l=s[c];l instanceof st&&l.expiry>e&&(s.splice(c,1),null!=this.listener&&this.listener(l),--c)}}}])&&fr(t.prototype,n),r&&fr(t,r),e}();function pr(e){return(pr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function dr(e,t,n,r,i,o,a){try{var u=e[o](a),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,i)}function vr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function yr(e,t,n){return(yr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=kr(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function gr(e,t){return(gr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function mr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=kr(e);if(t){var i=kr(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return br(this,n)}}function br(e,t){return!t||"object"!==pr(t)&&"function"!=typeof t?wr(e):t}function wr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function kr(e){return(kr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Sr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&gr(e,t)}(u,e);var t,n,r,o=mr(u);function u(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(e=o.call(this,"Contact")).self=null,e.selfReady=!1,e.contacts=new D,e.groups=new D,e.inspector=new hr,e.inspector.depositMap(e.contacts),e.inspector.depositMap(e.groups),e.pipelineListener=new kn(wr(e)),e.storage=new sr(wr(e)),e.listGroupsContext=null,e}return t=u,(n=[{key:"start",value:function(){return!!yr(kr(u.prototype),"start",this).call(this)&&(this.storage.open(Ke.DOMAIN),this.inspector.start(),this.pipeline.addListener(u.NAME,this.pipelineListener),!0)}},{key:"stop",value:function(){yr(kr(u.prototype),"stop",this).call(this),null!=this.pipeline&&(this.pipeline.removeListener(u.NAME,this.pipelineListener),this.inspector.stop(),this.storage.close())}},{key:"getSelf",value:function(){return this.self}},{key:"hasSignedIn",value:function(){return this.selfReady}},{key:"signIn",value:function(e,t,n){var r,o=this;return this.started||this.start(),e instanceof Wn?(this.self=e,this.self.domain=Ke.DOMAIN):this.self=new Wn(parseInt(e)),void 0!==t&&this.self.setName(t),void 0!==n&&this.self.setContext(n),this.pipeline.isReady()?((r=regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.kernel.activeToken(o.self.getId());case 2:if(null!=(t=e.sent)){e.next=6;break}return i.a.Logger.w("ContactService","Error auth token"),e.abrupt("return");case 6:n={self:o.self.toJSON(),token:t.toJSON()},r=new y(en,n),o.pipeline.send(u.NAME,r);case 9:case"end":return e.stop()}}),e)})),function(){var e=this,t=arguments;return new Promise((function(n,i){var o=r.apply(e,t);function a(e){dr(o,n,i,a,u,"next",e)}function u(e){dr(o,n,i,a,u,"throw",e)}a(void 0)}))})(),!0):(i.a.Logger.d("ContactService",'Pipeline "'+this.pipeline.getName()+'" is no ready'),!1)}},{key:"signOut",value:function(e){if(!this.selfReady||null==this.self)return!1;if(!this.pipeline.isReady())return i.a.Logger.w("ContactService",'Pipeline "'+this.pipeline.getName()+'" is no ready'),!1;var t=this.self,n=new y(tn,this.self.toJSON());return this.pipeline.send(u.NAME,n,void 0!==e?function(n,r,i){null!=i&&i.getStateCode()==Te&&0==i.data.code&&e(t)}:void 0),!0}},{key:"comeback",value:function(){var e=this;if(null!=this.self){var t=new y(nn,this.self.toJSON());this.pipeline.send(u.NAME,t,(function(t,n,r){null!=r&&r.getStateCode()==Te&&0==r.data.code&&(i.a.Logger.d("ContactService","Self comeback OK"),e.notifyObservers(new a(qn.Comeback,e.self)))}))}}},{key:"triggerSignIn",value:function(e){if(0==e.code){var t=Date.now();this.listGroups(t-this.defaultRetrospect,t,(function(e){i.a.Logger.i("ContactService","List groups number: "+e.length)}));var n=e.data;null==this.self&&(this.self=new Wn(n.id)),i.a.Logger.d("ContactService","Trigger SignIn: "+this.self.getId()),this.self.name=n.name;for(var r=n.devices,o=0;o<r.length;++o)this.self.devices[o]=Tn.create(r[o]);void 0!==n.context&&this.self.setContext(n.context),this.selfReady=!0,this.notifyObservers(new a(qn.SignIn,this.self))}else i.a.Logger.e("ContactService","SignIn failed: "+e.code)}},{key:"triggerSignOut",value:function(e){if(0==e.code){i.a.Logger.d("ContactService","Trigger SignOut: "+this.self.getId());var t=this.self;this.self=null,this.selfReady=!1,this.notifyObservers(new a(qn.SignOut,t))}else i.a.Logger.e("ContactService","SignOut failed: "+e.code)}},{key:"getContact",value:function(e,t,n){var r=this;"string"==typeof e&&(e=parseInt(e));var i=new Promise((function(t,n){var i=r.contacts.get(e);if(null==i){var o=new y(rn,{id:e,domain:Ke.DOMAIN});r.pipeline.send(u.NAME,o,(function(o,a,s){null!=s?s.getStateCode()==Te&&0==s.data.code?(i=Fn.create(s.data.data),r.contacts.put(i.getId(),i),t(i)):n(new Yt(u.NAME,s.getStateCode(),e)):n(new Yt(u.NAME,101,e))}))}else t(i)}));if(t&&n)i.then((function(e){t(e)})).catch((function(e){n(e)}));else{if(!t)return i;i.then((function(e){t(e)})).catch((function(){}))}}},{key:"getContactList",value:function(e,t,n){var r=this,i=new Promise((function(t,n){var i=new y(on,{list:e,domain:Ke.DOMAIN});r.pipeline.send(u.NAME,i,(function(e,i,o){if(null!=o)if(o.getStateCode()==Te&&0==o.data.code){for(var a=o.data.data,u=[],s=0;s<a.length;++s){var c=Fn.create(a[s]);u.push(c),r.contacts.put(c.getId(),c)}t(u)}else n();else n()}))}));if(t&&n)i.then((function(e){t(e)})).catch((function(){n(e)}));else{if(!t)return i;i.then((function(e){t(e)})).catch((function(){}))}}},{key:"getGroup",value:function(e,t,n){var r=this;"string"==typeof e&&(e=parseInt(e));var i=new Promise((function(t,n){var i=r.groups.get(e);null==i?r.storage.readGroup(e,(function(e,i){if(null==i){var o=new y(an,{id:e,domain:Ke.DOMAIN});r.pipeline.send(u.NAME,o,(function(i,o,a){if(null!=a)if(a.getStateCode()==Te&&0==a.data.code){var u=ir.create(r,a.data.data);r.groups.put(u.getId(),u),r.storage.writeGroup(u),t(u)}else n(e);else n(e)}))}else t(i)})):t(i)}));if(t&&n)i.then((function(e){t(e)})).catch((function(){n(e)}));else{if(!t)return i;i.then((function(e){t(e)})).catch((function(){}))}}},{key:"updateGroupActiveTime",value:function(e,t){var n=this,r=this.groups.get(e);null!=r&&t>r.lastActiveTime&&(r.lastActiveTime=t),this.storage.readGroup(e,(function(e,r){null!=r&&t>r.lastActiveTime&&(r.lastActiveTime=t,n.storage.writeGroup(r))}))}},{key:"sortGroup",value:function(e,t){var n=e.lastActiveTime,r=t.lastActiveTime;return n<r?1:n>r?-1:0}},{key:"queryGroups",value:function(e,t,n,r){var i=this;"function"==typeof e?(n=e,r=t,e=0,t=Date.now()):"function"==typeof t&&(r=n=t,t=Date.now()),this.storage.readGroups(e,t,(function(e,t,r){for(var o=r.sort((function(e,t){return i.sortGroup(e,t)})),a=0;a<o.length;++a){var u=o[a];i.groups.put(u.getId(),u)}n(o)}),r)||n([])}},{key:"listGroups",value:function(e,t,n){var r=this;if(void 0===e||null!=this.listGroupsContext)return!1;if("function"==typeof e?(n=e,e=0,t=0):"function"==typeof t&&(n=t,t=Date.now()),e>t)return!1;this.listGroupsContext={total:-1,list:[],timer:0,handler:n},this.listGroupsContext.timer=setTimeout((function(){clearTimeout(r.listGroupsContext.timer),r.listGroupsContext.handler([]),r.listGroupsContext=null}),1e4);var i=new y(un,{beginning:e,ending:t});return this.pipeline.send(u.NAME,i),!0}},{key:"triggerListGroups",value:function(e){var t=this,n=e.data,r=n.list,i=n.total;this.listGroupsContext.total<0&&(this.listGroupsContext.total=i);for(var o=new D,u=function(e){var n=ir.create(t,r[e]);o.put(n.getId(),n),n.getOwner().equals(t.self)&&(n.owner=t.self),t.storage.readGroup(n.getId(),(function(e,r){if(null!=r)r.lastActiveTime!=n.lastActiveTime&&t.notifyObservers(new a(qn.GroupUpdated,o.get(r.getId())));else{var i=o.get(e);i.getState()!=$n.Normal&&i.getState()!=$n.Dismissed||t.notifyObservers(new a(qn.GroupUpdated,i))}t.storage.writeGroup(o.get(e))})),n.getState()==$n.Normal&&t.groups.put(n.getId(),n),t.listGroupsContext.list.push(n)},s=0;s<r.length;++s)u(s);this.listGroupsContext.list.length==i&&(clearTimeout(this.listGroupsContext.timer),this.listGroupsContext.handler(this.listGroupsContext.list),this.listGroupsContext=null)}},{key:"createGroup",value:function(e,t,n,r){var o=this;if(0==e.length||null==t)return 0;var a=this.self,s=new ir(this,a);s.setName(e);for(var c=[],l=0;l<t.length;++l){var f=t[l];f instanceof Fn?c.push(f.toCompactJSON()):"number"==typeof f?c.push({id:f,name:"Cube-"+f}):"string"==typeof f?c.push({id:parseInt(f),name:"Cube-"+f}):void 0!==f.id&&void 0!==f.name&&c.push({id:parseInt(f.id),name:f.name})}var h={group:s.toJSON(),members:c},p=new y(sn,h);return this.pipeline.send(u.NAME,p,(function(e,t,u){if(null==u)return i.a.Logger.w("ContactService","Create group failed: response packet is null"),void(r&&r(s.getId(),s.getName()));if(u.getStateCode()!=Te)return i.a.Logger.w("ContactService","Create group failed: "+u.getStateCode()),void(r&&r(s.getId(),s.getName()));if(0!=u.getPayload().code)return i.a.Logger.w("ContactService","Create group failed, state code: "+u.getPayload().code),void(r&&r(s.getId(),s.getName()));var c=u.getPayload().data,l=ir.create(o,c,a);u.context=l,o.groups.put(l.getId(),l),o.storage.writeGroup(l),n(l)})),s.getId()}},{key:"triggerCreateGroup",value:function(e,t){if(0==e.code){var n=null==t?ir.create(this,e.data):t;if(n.getOwner().equals(this.self))n=this.groups.get(n.getId());else{for(var r=n.getMembers(),i=0;i<r.length;++i)if(r[i].equals(this.self)){r[i]=this.self;break}this.groups.put(n.getId(),n),this.storage.writeGroup(n)}this.notifyObservers(new a(qn.GroupCreated,n))}}},{key:"dissolveGroup",value:function(e,t,n){var r=this;if(e.getOwner().getId()!=this.self.getId())return n&&n(e),!1;var o=new y(cn,e.toCompactJSON());return this.pipeline.send(u.NAME,o,(function(o,a,u){if(null==u||u.getStateCode()!=Te)return i.a.Logger.w("ContactService","Dissolve group failed"),void(n&&n(e));if(0!=u.getPayload().code)return i.a.Logger.w("ContactService","Dissolve group failed, state code: "+u.getPayload().code),void(n&&n(e));var s=ir.create(r,u.getPayload().data,r.self);u.context=s,r.storage.writeGroup(s),r.groups.put(s.getId(),s),t&&t(s)})),!0}},{key:"triggerDissolveGroup",value:function(e,t){if(0==e.code){var n=null==t?ir.create(this,e.data):t;n.getOwner().equals(this.self)?n=this.groups.get(n.getId()):(this.groups.put(n.getId(),n),this.storage.writeGroup(n)),this.notifyObservers(new a(qn.GroupDissolved,n))}}},{key:"quitGroup",value:function(e,t,n){var r=this,i=this.self.getId();if(!e.hasMember(this.self))return n&&n(e),!1;if(e.getOwner().getId()==i)return n&&n(e),!1;var o=this.self.toCompactJSON(),a=new y(fn,{groupId:e.getId(),memberIdList:[i],operator:o});return this.pipeline.send(u.NAME,a,(function(i,o,a){if(null!=a&&a.getStateCode()==Te)if(0==a.getPayload().code){var u=lr.create(r,a.getPayload().data);u.includeSelf&&(u.group.state=$n.Disabled,e.state=$n.Disabled);for(var s=u.modified,c=0;c<s.length;++c)e._removeMember(s[c]);a.context=u,t&&t(u.group)}else n&&n(e);else n&&n(e)})),!0}},{key:"removeGroupMembers",value:function(e,t,n,r){for(var i=this,o=[],a=e.getOwner().getId(),s=0;s<t.length;++s){var c=t[s];if(c instanceof Fn){if(c.getId()==a)continue;e.hasMember(c)&&o.push(c.getId())}else{if(c==a)continue;e.hasMember(c)&&o.push(c)}}if(0==o.length)return r&&r(e,t,this.self),!1;var l=this.self,f=new y(fn,{groupId:e.getId(),memberIdList:o,operator:l.toCompactJSON()});return this.pipeline.send(u.NAME,f,(function(o,a,u){if(null!=u&&u.getStateCode()==Te)if(0==u.getPayload().code){var s=lr.create(i,u.getPayload().data);s.includeSelf&&(s.group.state=$n.Disabled,e.state=$n.Disabled);for(var c=s.modified,f=0;f<c.length;++f)e._removeMember(c[f]);u.context=s,n&&n(s.group,s.modified,s.operator)}else r&&r(e,t,l);else r&&r(e,t,l)})),!0}},{key:"triggerRemoveMember",value:function(e,t){if(0==e.code){var n=null==t?lr.create(this,e.data):t,r=n.group;n.includeSelf?(this.groups.remove(r.getId()),r.state=$n.Disabled):this.groups.put(r.getId(),r),this.storage.writeGroup(r),this.notifyObservers(new a(qn.GroupMemberRemoved,{group:r,modified:n.modified,operator:n.operator}))}}},{key:"addGroupMembers",value:function(e,t,n,r){var i=this,o=null,a=null;t[0]instanceof Fn?a=[]:o=[];for(var s=0;s<t.length;++s){var c=t[s];e.hasMember(c)||(null!=a?a.push(c.toCompactJSON()):o.push(c))}if(null!=a&&0==a.length)return r&&r(e,t,this.self),!1;if(null!=o&&0==o.length)return r&&r(e,t,this.self),!1;var l=this.self,f=null;return f=new y(ln,null!=a?{groupId:e.getId(),memberList:a,operator:l.toCompactJSON()}:{groupId:e.getId(),memberIdList:o,operator:l.toCompactJSON()}),this.pipeline.send(u.NAME,f,(function(o,a,u){if(null!=u&&u.getStateCode()==Te)if(0==u.getPayload().code){for(var s=lr.create(i,u.getPayload().data),c=s.modified,f=0;f<c.length;++f)e.memberList.push(c[f]);u.context=s,n&&n(s.group,s.modified,s.operator)}else r&&r(e,t,l);else r&&r(e,t,l)})),!0}},{key:"triggerAddMember",value:function(e,t){if(0==e.code){var n=null==t?lr.create(this,e.data):t,r=n.group;this.groups.put(r.getId(),r),this.storage.writeGroup(r),n.includeSelf?this.notifyObservers(new a(qn.GroupUpdated,r)):this.notifyObservers(new a(qn.GroupMemberAdded,{group:r,modified:n.modified,operator:n.operator}))}}},{key:"modifyGroup",value:function(e,t,n,r,i,o){var a=this;if(null==t&&null==n&&null==r)return o&&o(e),!1;var s={groupId:e.getId()};null!=t&&t instanceof Fn&&e.isOwner(this.self)&&e.hasMember(t)&&(s.owner=t.toCompactJSON()),null!=n&&"string"==typeof n&&(s.name=n),null!=r&&(s.context=r);var c=new y(hn,s);return this.pipeline.send(u.NAME,c,(function(t,n,r){if(null!=r&&r.getStateCode()==Te)if(0==r.getPayload().code){var u=ir.create(a,r.getPayload().data);e.owner=u.owner,e.name=u.name,e.context=u.context,e.lastActiveTime=u.lastActiveTime,r.context=u,i&&i(e)}else o&&o(e);else o&&o(e)})),!0}},{key:"triggerModifyGroup",value:function(e,t){if(0==e.code){var n=null==t?ir.create(this,e.data):t;this.groups.put(n.getId(),n),this.storage.writeGroup(n),this.notifyObservers(new a(qn.GroupUpdated,n))}}},{key:"modifyGroupMember",value:function(e,t,n,r){var i=this;if(!e.hasMember(t))return!1;var o={groupId:e.getId(),member:t.toCompactJSON()},a=new y(pn,o);return this.pipeline.send(u.NAME,a,(function(o,a,u){if(null!=u&&u.getStateCode()==Te)if(0==u.getPayload().code){var s=lr.create(i,u.getPayload().data);u.context=s;var c=s.modified[0];e.lastActiveTime=s.group.lastActiveTime,e._replaceMember(c),n&&n(e,c)}else r&&r(e,t);else r&&r(e,t)})),!0}},{key:"triggerModifyGroupMember",value:function(e,t){var n=this;if(0==e.code){var r=null==t?lr.create(this,e.data):t,i=r.group,o=r.modified[0],a=this.groups.get(i.getId());null!=a?(a.lastActiveTime=i.lastActiveTime,a._replaceMember(o),this.storage.writeGroup(a)):this.storage.readGroup(group.getId(),(function(e,t){null!=t&&(t.lastActiveTime=i.lastActiveTime,t._replaceMember(o),n.storage.writeGroup(t))}))}}}])&&vr(t.prototype,n),r&&vr(t,r),u}(we);function _r(e){return(_r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Or(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Rr(e,t,n){return(Rr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Pr(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Er(e,t){return(Er=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function xr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Pr(e);if(t){var i=Pr(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Cr(this,n)}}function Cr(e,t){return!t||"object"!==_r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Pr(e){return(Pr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(Sr,"NAME","Contact");var Tr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Er(e,t)}(o,e);var t,n,r,i=xr(o);function o(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(e=i.call(this)).position=0,e.fileName=null,e.fileSize=null,e.fileCode=null,e.success=!1,e}return t=o,r=[{key:"create",value:function(e){var t=new o;return t.fileName=e.fileName,t.fileSize=e.fileSize,t.fileCode=e.fileCode,t.position=e.position,t}}],(n=[{key:"getExtension",value:function(){var e=this.fileName.lastIndexOf(".");return e<=0?"":this.fileName.substring(e+1)}},{key:"toJSON",value:function(){var e=Rr(Pr(o.prototype),"toJSON",this).call(this);return e.fileName=this.fileName,e.fileSize=this.fileSize,e.fileCode=null!=this.fileCode?this.fileCode:"",e.position=this.position,e}},{key:"toCompactJSON",value:function(){return this.toJSON()}},{key:"toString",value:function(){return this.position.toString()}}])&&Or(t.prototype,n),r&&Or(t,r),o}(d);function Ar(e){return(Ar="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function jr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Mr(e,t,n){return(Mr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Dr(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Nr(e,t){return(Nr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Lr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Dr(e);if(t){var i=Dr(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ir(this,n)}}function Ir(e,t){return!t||"object"!==Ar(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Dr(e){return(Dr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Fr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Nr(e,t)}(o,e);var t,n,r,i=Lr(o);function o(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(n=i.call(this)).id=e,n.domain=t,n.ownerId=0,n.fileName=null,n.fileSize=0,n.completedTime=0,n.expiryTime=0,n.fileCode=null,n.fileType="unknown",n.md5Code=null,n.sha1Code=null,n.fileURL=null,n.fileSecureURL=null,n}return t=o,r=[{key:"create",value:function(e){var t=new o(e.id,e.domain);return t.fileCode=e.fileCode,t.ownerId=e.ownerId,t.fileName=e.fileName,t.fileSize=e.fileSize,t.completedTime=e.completed,t.expiryTime=e.expiry,t.fileType=e.fileType,t.md5Code=void 0!==e.md5?e.md5:null,t.sha1Code=void 0!==e.sha1?e.sha1:null,t.fileURL=void 0!==e.fileURL?e.fileURL:null,t.fileSecureURL=void 0!==e.fileSecureURL?e.fileSecureURL:null,t}}],(n=[{key:"getDomain",value:function(){return this.domain}},{key:"getOwnderId",value:function(){return this.ownerId}},{key:"getFileName",value:function(){return this.fileName}},{key:"getFileSize",value:function(){return this.fileSize}},{key:"getFileCode",value:function(){return this.fileCode}},{key:"getCompletedTime",value:function(){return this.completedTime}},{key:"getExpiryTime",value:function(){return this.expiryTime}},{key:"getFileType",value:function(){return this.fileType}},{key:"getMD5Code",value:function(){return this.md5Code}},{key:"getSHA1Code",value:function(){return this.sha1Code}},{key:"getFileURL",value:function(){return this.fileURL}},{key:"getFileSecureURL",value:function(){return this.fileSecureURL}},{key:"toJSON",value:function(){var e=Mr(Dr(o.prototype),"toJSON",this).call(this);return e.id=this.id,e.domain=this.domain,e.fileCode=this.fileCode,e.ownerId=this.ownerId,e.fileName=this.fileName,e.fileSize=this.fileSize,e.completed=this.completedTime,e.expiry=this.expiryTime,e.fileType=this.fileType,null!=this.md5Code&&(e.md5=this.md5Code),null!=this.sha1Code&&(e.sha1=this.sha1Code),null!=this.fileURL&&(e.fileURL=this.fileURL),null!=this.fileSecureURL&&(e.fileSecureURL=this.fileSecureURL),e}},{key:"toCompactJSON",value:function(){return this.toJSON()}}])&&jr(t.prototype,n),r&&jr(t,r),o}(st),Br={Uploading:"Uploading",UploadCompleted:"UploadCompleted",UploadFailed:"UploadFailed",Downloading:"Downloading",DownloadCompleted:"DownloadCompleted",FileUpdated:"FileUpdated"},zr="putFile";function Gr(e){return(Gr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ur(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Hr(e,t,n){return(Hr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=qr(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Jr(e,t){return(Jr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Vr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=qr(e);if(t){var i=qr(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Wr(this,n)}}function Wr(e,t){return!t||"object"!==Gr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function qr(e){return(qr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Kr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Jr(e,t)}(a,e);var t,n,r,o=Vr(a);function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=o.call(this)).fileStorage=e,t}return t=a,(n=[{key:"onReceived",value:function(e,t,n){Hr(qr(a.prototype),"onReceived",this).call(this,e,t,n),n.getStateCode()==Te?n.name==zr&&this.fileStorage.triggerPutFile(n.data,n.context):i.a.Logger.w("FileStoragePipeListener","Pipeline error: "+n.name+" - "+n.getStateCode())}}])&&Ur(t.prototype,n),r&&Ur(t,r),a}(M);function Zr(e,t,n,r,i,o,a){try{var u=e[o](a),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,i)}function $r(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){Zr(o,r,i,a,u,"next",e)}function u(e){Zr(o,r,i,a,u,"throw",e)}a(void 0)}))}}function Qr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Xr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.domain=null,this.db=null,this.labelStore=null}var t,n,r;return t=e,(n=[{key:"open",value:function(e){if(null==this.db){i.a.Logger.d("FileStructStorage","Open file struct storage : "+e),this.domain=e;var t={name:"CubeFileStorage-"+e,version:1,stores:[{name:"label",keyPath:"fileCode",indexes:[{name:"fileCode",keyPath:"fileCode",unique:!0},{name:"id",keyPath:"id",unique:!0},{name:"ownerId",keyPath:"ownerId",unique:!1},{name:"fileName",keyPath:"fileName",unique:!1},{name:"expiryTime",keyPath:"expiryTime",unique:!1},{name:"fileType",keyPath:"fileType",unique:!1}]},{name:"config",keyPath:"item",indexes:[{name:"item",keyPath:"item",unique:!0}]}]};this.db=new Zn.a(t),this.labelStore=this.db.use("label")}}},{key:"close",value:function(){null!=this.db&&(i.a.Logger.d("FileStructStorage","Close file struct storage : "+this.domain),this.db.close(),this.db=null)}},{key:"readFileLabel",value:function(e,t){var n=this;return null!=this.db&&($r(regeneratorRuntime.mark((function r(){var i,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.labelStore.query("fileCode",e);case 2:(i=r.sent).length>0?(i[0].domain=n.domain,o=Fr.create(i[0]),t(e,o)):t(e,null);case 4:case"end":return r.stop()}}),r)})))(),!0)}},{key:"writeFileLabel",value:function(e){var t=this;return null!=this.db&&($r(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return delete(r=e.toJSON()).domain,n.next=4,t.labelStore.put(r);case 4:case"end":return n.stop()}}),n)})))(),!0)}}])&&Qr(t.prototype,n),r&&Qr(t,r),e}(),Yr=102;function ei(e){return(ei="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ti(e,t,n,r,i,o,a){try{var u=e[o](a),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,i)}function ni(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ri(e,t,n){return(ri="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=si(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function ii(e,t){return(ii=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function oi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=si(e);if(t){var i=si(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ai(this,n)}}function ai(e,t){return!t||"object"!==ei(t)&&"function"!=typeof t?ui(e):t}function ui(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function si(e){return(si=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ci=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ii(e,t)}(u,e);var t,n,r,o=oi(u);function u(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(e=o.call(this,"FileStorage")).require(Sr.NAME),e.contactService=null,e.fileLabels=new D,e.secure=window.location.protocol.toLowerCase().indexOf("https")>=0,e.fileURL="https://cube.shixincube.com/filestorage/file/",e.block=131072,e.pipelineListener=new Kr(ui(e)),e.filePipeline=null,e.storage=new Xr,e}return t=u,(n=[{key:"start",value:function(){var e=this;return!!ri(si(u.prototype),"start",this).call(this)&&(this.filePipeline=this.kernel.getPipeline(Jt.NAME),this.pipeline.addListener(u.NAME,this.pipelineListener),this.contactService=this.kernel.getModule(Sr.NAME),this.contactService.attach((function(t){e._fireContactEvent(t)})),this.storage.open(Ke.DOMAIN),!0)}},{key:"stop",value:function(){ri(si(u.prototype),"stop",this).call(this),null!=this.pipeline&&(this.pipeline.removeListener(u.NAME,this.pipelineListener),this.storage.close())}},{key:"config",value:function(e){this.secure?e.fileSecureURL&&(this.fileURL=e.fileSecureURL):e.fileURL&&(this.fileURL=e.fileURL)}},{key:"uploadFile",value:function(e,t,n,r){var o=this,s=e.size,c=new Tr,l=new FileReader;l.onload=function(t){c.position+=t.total,i.a.Logger.d(u.NAME,"Read: "+c+"/"+s),c.position<s||i.a.Logger.d(u.NAME,"Read completed: "+e.name)},c.fileName=e.name,c.fileSize=e.size,this._serialReadAndUpload(l,e,c,s,(function(e){if(null==e){c.fileCode=null,c.success=!1;var t=new Yt(u.NAME,Yr,c);r&&r(t);var i=new a(Br.UploadFailed,t);o.notifyObservers(i)}else{c.fileName=e.fileName,c.fileSize=e.fileSize,c.fileCode=e.fileCode,c.success=!0;var s=new a(Br.UploadCompleted,c);o.notifyObservers(s),n&&n(c)}}),(function(e){t&&t(e)}))}},{key:"downloadFile",value:function(e){var t=e instanceof Fr?e:this.fileLabels.get(e),n=new y("GET",null);n.responseType="blob",this.notifyObservers(new a(Br.Downloading,t));var r=this.secure?t.getFileSecureURL():t.getFileURL();this.filePipeline.send(r,n,(function(e,n,r){var i=r.data,o=new FileReader;o.readAsDataURL(i),o.onload=function(e){this.notifyObservers(new a(Br.DownloadCompleted,t));var n=document.createElement("a");n.style.display="inline",n.style.position="absolute",n.style.cssFloat="left",n.style.visibility="hidden",n.download=t.getFileName(),n.href=e.target.result,document.body.appendChild(n),n.click(),n.parentElement.removeChild(n)}}))}},{key:"getFileURL",value:function(e,t){var n=this,r=this.fileLabels.get(e);if(null!=r){var i=[r.getFileURL(),"&token=",this.filePipeline.tokenCode,"&type=",r.fileType],o=[r.getFileSecureURL(),"&token=",this.filePipeline.tokenCode,"&type=",r.fileType];t(e,i.join(""),o.json(""))}else this.storage.readFileLabel(e,(function(e,r){if(null!=r){var i=[r.getFileURL(),"&token=",n.filePipeline.tokenCode,"&type=",r.fileType],o=[r.getFileSecureURL(),"&token=",n.filePipeline.tokenCode,"&type=",r.fileType];t(e,i.join(""),o.json(""))}else t(e,null,null)}))}},{key:"_serialReadAndUpload",value:function(e,t,n,r,o,s){var c,l=this;(c=regeneratorRuntime.mark((function c(){var f;return regeneratorRuntime.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,l._readFileBlock(e,t,n);case 2:if(null!=(f=c.sent)){c.next=6;break}return o(null),c.abrupt("return");case 6:s(n),l._submit(f,(function(c){if(null==c)return i.a.Logger.e(u.NAME,"Upload failed: "+t.name),void o(null);var f=c.getPayload();if(0==f.code){i.a.Logger.d(u.NAME,"File cursor: "+n+"/"+r);var h=Tr.create(f.data),p=new a(Br.Uploading,h);l.notifyObservers(p),n.position<r?l._serialReadAndUpload(e,t,n,r,o,s):o(h)}else i.a.Logger.w(u.NAME,"Packet state code: "+f.code),o(null)}));case 8:case"end":return c.stop()}}),c)})),function(){var e=this,t=arguments;return new Promise((function(n,r){var i=c.apply(e,t);function o(e){ti(i,n,r,o,a,"next",e)}function a(e){ti(i,n,r,o,a,"throw",e)}o(void 0)}))})()}},{key:"_readFileBlock",value:function(e,t,n){var r=this;return new Promise((function(i,o){var a=null,u=n.position+r.block+1;t.slice?a=t.slice(n.position,u):t.webkitSlice?a=t.webkitSlice(n.position,u):t.mozSlice&&(a=t.mozSlice(n.position,u)),e.readAsBinaryString(a),i(new Mt(r.contactService.getSelf().getId(),r.getAuthToken().domain,t.name,t.size,a,n.position,a.size))}))}},{key:"_submit",value:function(e,t){this.filePipeline.send(this.fileURL,e,(function(e,n,r){t(r)}))}},{key:"triggerPutFile",value:function(e,t){if(0==e.code){var n=null==t?Fr.create(e.data):t;this.secure?i.a.Logger.d("FileStorage",'File "'+n.getFileName()+'" URL : '+n.getFileSecureURL()):i.a.Logger.d("FileStorage",'File "'+n.getFileName()+'" URL : '+n.getFileURL()),this.fileLabels.put(n.getFileCode(),n),this.storage.writeFileLabel(n),this.notifyObservers(new a(Br.FileUpdated,n))}}},{key:"_fireContactEvent",value:function(e){if(e.name==qn.SignIn){var t=e.data;this.cid=t.getId()}}}])&&ni(t.prototype,n),r&&ni(t,r),u}(we);!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(ci,"NAME","FileStorage");var li={Unknown:0,Unsent:5,Sending:9,Sent:10,Read:20,Recalled:30,Deleted:40,Fault:1};function fi(e){return(fi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function hi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function pi(e,t){return(pi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function di(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=yi(e);if(t){var i=yi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return vi(this,n)}}function vi(e,t){return!t||"object"!==fi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function yi(e){return(yi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var gi=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&pi(e,t)}(o,e);var t,n,r,i=di(o);function o(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(e=i.call(this)).domain=null,e.fileLabel=null,e.width=0,e.height=0,e.sourceFileCode=null,e.sourceWidth=0,e.sourceHeight=0,e.quality=1,e.token="cube",e}return t=o,r=[{key:"create",value:function(e){var t=new o;return t.id=e.id,t.domain=e.domain,t.fileLabel=Fr.create(e.fileLabel),t.width=e.width,t.height=e.height,t.sourceFileCode=e.sourceFileCode,t.sourceWidth=e.sourceWidth,t.sourceHeight=e.sourceHeight,t.quality=e.quality,t}}],(n=[{key:"getFileURL",value:function(e){return(void 0!==e?[e?this.fileLabel.getFileSecureURL():this.fileLabel.getFileURL(),"&token=",this.token,"&type=",this.fileLabel.fileType]:[this.fileLabel.getFileURL(),"&token=",this.token,"&type=",this.fileLabel.fileType]).join("")}}])&&hi(t.prototype,n),r&&hi(t,r),o}(st);function mi(e){return(mi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function bi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function wi(e,t,n){return(wi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Oi(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function ki(e,t){return(ki=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Si(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Oi(e);if(t){var i=Oi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return _i(this,n)}}function _i(e,t){return!t||"object"!==mi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Oi(e){return(Oi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ri=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ki(e,t)}(o,e);var t,n,r,i=Si(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this)).file=e,t.anchor=null,t.label=null,t.thumbConfig=null,t.thumbs=null,t.token=null,t}return t=o,r=[{key:"create",value:function(e){var t=new o(null);if(void 0!==e.anchor&&(t.anchor=Tr.create(e.anchor)),void 0!==e.label&&(t.label=Fr.create(e.label)),void 0!==e.thumbConfig&&(t.thumbConfig=e.thumbConfig),void 0!==e.thumbs){t.thumbs=[];for(var n=0;n<e.thumbs.length;++n){var r=gi.create(e.thumbs[n]);t.thumbs.push(r)}}return t}}],(n=[{key:"getFileCode",value:function(){return null!=this.anchor?this.anchor.fileCode:null!=this.label?this.label.fileCode:null}},{key:"getFileName",value:function(){return null!=this.label?this.label.fileName:null!=this.anchor?this.anchor.fileName:null}},{key:"getFileSize",value:function(){return null!=this.label?this.label.fileSize:null!=this.anchor?this.anchor.fileSize:0}},{key:"getFileType",value:function(){return null!=this.label?this.label.fileType:null!=this.anchor?this.anchor.getExtension().toLowerCase():"unknown"}},{key:"getFileURL",value:function(e){return null==this.label?null:(void 0!==e?[e?this.label.getFileSecureURL():this.label.getFileURL(),"&token=",this.token,"&type=",this.label.fileType]:[this.label.getFileURL(),"&token=",this.token,"&type=",this.label.fileType]).join("")}},{key:"enableThumb",value:function(e){this.thumbConfig=void 0===e?{size:480,quality:.7}:e}},{key:"getDefaultThumb",value:function(){if(null==this.thumbs)return null;var e=this.thumbs[0];return e.token=this.token,e}},{key:"getDefaultThumbURL",value:function(e){if(null==this.thumbs)return null;var t=this.thumbs[0];return t.token=this.token,t.getFileURL(e)}},{key:"toJSON",value:function(){var e=wi(Oi(o.prototype),"toJSON",this).call(this);if(null!=this.anchor&&(e.anchor=this.anchor.toJSON()),null!=this.label&&(e.label=this.label.toJSON()),null!=this.thumbConfig&&(e.thumbConfig=this.thumbConfig),null!=this.thumbs){e.thumbs=[];for(var t=0;t<this.thumbs.length;++t)e.thumbs.push(this.thumbs[t].toJSON())}return e}}])&&bi(t.prototype,n),r&&bi(t,r),o}(d);function Ei(e){return(Ei="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function xi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ci(e,t,n){return(Ci="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ji(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Pi(e,t){return(Pi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ti(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ji(e);if(t){var i=ji(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ai(this,n)}}function Ai(e,t){return!t||"object"!==Ei(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ji(e){return(ji=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Mi=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Pi(e,t)}(a,e);var t,n,r,o=Ti(a);function a(e,t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a);var r=void 0!==e&&e instanceof a;return(n=o.call(this)).id=r?e.id:i.a.Utils.generateSerialNumber(),n.domain=r?e.domain:Ke.DOMAIN,n.payload=null,r?n.payload=e.payload:void 0===e||null==e||e instanceof File?n.payload={}:n.payload=e,n.from=r?e.from:0,n.to=r?e.to:0,n.source=r?e.source:0,n.owner=r?e.owner:0,n.localTS=r?e.localTS:0,n.remoteTS=r?e.remoteTS:0,n.attachment=null,r?n.attachment=e.attachment:e instanceof File?n.attachment=new Ri(e):void 0!==t&&null!=t&&t instanceof File&&(n.attachment=new Ri(t)),n.state=r?e.state:li.Unknown,n}return t=a,r=[{key:"create",value:function(e){var t=new a;return t.id=e.id,t.domain=e.domain,t.from=e.from,t.to=e.to,t.source=e.source,t.owner=e.owner,t.localTS=e.lts,t.remoteTS=e.rts,t.state=e.state,void 0!==e.payload&&(t.payload=e.payload),void 0!==e.attachment&&(t.attachment=Ri.create(e.attachment)),t}}],(n=[{key:"getDomain",value:function(){return this.domain}},{key:"getFrom",value:function(){return this.from}},{key:"getTo",value:function(){return this.to}},{key:"getSource",value:function(){return this.source}},{key:"getPayload",value:function(){return this.payload}},{key:"setPayload",value:function(e){this.payload=e}},{key:"getLocalTimestamp",value:function(){return this.localTS}},{key:"getRemoteTimestamp",value:function(){return this.remoteTS}},{key:"getState",value:function(){return this.state}},{key:"setAttachment",value:function(e){e instanceof File?this.attachment=new Ri(e):e instanceof Ri&&(this.attachment=e)}},{key:"getAttachment",value:function(){return this.attachment}},{key:"hasAttachment",value:function(){return null!=this.attachment}},{key:"isFromGroup",value:function(){return this.source>0}},{key:"getGroupId",value:function(){return this.source}},{key:"clone",value:function(e){this.id=e.id,this.domain=e.domain,this.from=e.from,this.to=e.to,this.source=e.source,this.owner=e.owner,this.localTS=e.localTS,this.remoteTS=e.remoteTS,this.state=e.state,this.payload=e.payload,this.attachment=e.attachment}},{key:"toJSON",value:function(){var e=Ci(ji(a.prototype),"toJSON",this).call(this);return e.id=this.id,e.domain=this.domain,e.from=this.from,e.to=this.to,e.source=this.source,e.owner=this.owner,e.lts=this.localTS,e.rts=this.remoteTS,e.state=this.state,e.payload=this.payload,null!=this.attachment&&(e.attachment=this.attachment.toJSON()),e}}])&&xi(t.prototype,n),r&&xi(t,r),a}(st),Ni="push",Li="pull",Ii="notify",Di="recall",Fi="delete",Bi="read";function zi(e){return(zi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Gi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ui(e,t,n){return(Ui="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Wi(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Hi(e,t){return(Hi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ji(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Wi(e);if(t){var i=Wi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Vi(this,n)}}function Vi(e,t){return!t||"object"!==zi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Wi(e){return(Wi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var qi=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Hi(e,t)}(a,e);var t,n,r,o=Ji(a);function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=o.call(this)).messagingService=e,t}return t=a,(n=[{key:"onReceived",value:function(e,t,n){Ui(Wi(a.prototype),"onReceived",this).call(this,e,t,n),n.getStateCode()==Te?n.name==Ii?this.messagingService.triggerNotify(n.data):n.name==Li?this.messagingService.triggerPull(n.data):n.name==Bi?this.messagingService.triggerRead(n.data):n.name==Di&&this.messagingService.triggerRecall(n.data):i.a.Logger.w("MessagingPipelineListener","Pipeline error: "+n.name+" - "+n.getStateCode())}},{key:"onOpened",value:function(e){Ui(Wi(a.prototype),"onOpened",this).call(this,e)}}])&&Gi(t.prototype,n),r&&Gi(t,r),a}(M),Ki={Notify:"Notify",Sent:"Sent",Sending:"Sending",Recall:"Recall",Delete:"Delete",Read:"Read",Fault:"Fault",Unknown:"Unknown"},Zi=1,$i=0,Qi=9,Xi=101;function Yi(e,t,n,r,i,o,a){try{var u=e[o](a),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,i)}function eo(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){Yi(o,r,i,a,u,"next",e)}function u(e){Yi(o,r,i,a,u,"throw",e)}a(void 0)}))}}function to(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var no=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.domain=null,this.db=null,this.configStore=null,this.messageStore=null}var t,n,r;return t=e,(n=[{key:"open",value:function(e,t){if(null==this.db){i.a.Logger.d("MessagingStorage","Open messaging storage : "+t),this.domain=t;var n={name:"CubeMessaging-"+t+"-"+e,version:1,stores:[{name:"message",keyPath:"id",indexes:[{name:"id",keyPath:"id",unique:!0},{name:"from",keyPath:"from",unique:!1},{name:"to",keyPath:"to",unique:!1},{name:"source",keyPath:"source",unique:!1},{name:"rts",keyPath:"rts",unique:!1}]},{name:"config",keyPath:"item",indexes:[{name:"item",keyPath:"item",unique:!0}]}]};this.db=new Zn.a(n),this.configStore=this.db.use("config"),this.messageStore=this.db.use("message")}}},{key:"close",value:function(){null!=this.db&&(i.a.Logger.d("MessagingStorage","Close messaging storage : "+this.domain),this.db.close(),this.db=null)}},{key:"updateLastMessageTime",value:function(e){var t=this;return null!=this.db&&(eo(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r={item:"lastMessageTime",value:e},n.next=3,t.configStore.put(r);case 3:case"end":return n.stop()}}),n)})))(),!0)}},{key:"queryLastMessageTime",value:function(e){var t=this;return null!=this.db&&(eo(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.configStore.get("lastMessageTime");case 2:void 0===(r=n.sent)&&(r={value:0}),e(r.value);case 5:case"end":return n.stop()}}),n)})))(),!0)}},{key:"containsMessage",value:function(e,t){var n=this;if(null==this.db)return!1;var r=e;return eo(regeneratorRuntime.mark((function e(){var i,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=!0,e.next=3,n.messageStore.get(r.getId());case 3:void 0!==(o=e.sent)&&null!=o?0==o.owner&&(i=!1):i=!1,t(r,i);case 6:case"end":return e.stop()}}),e)})))(),!0}},{key:"writeMessage",value:function(e){var t=this;return null!=this.db&&(eo(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return delete(r=e.toJSON()).domain,n.next=4,t.messageStore.put(r);case 4:case"end":return n.stop()}}),n)})))(),!0)}},{key:"readMessage",value:function(e,t){var n=this;return null!=this.db&&(eo(regeneratorRuntime.mark((function r(){var i,o,a,u;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.messageStore.select([{key:"rts",value:e,compare:">"}]);case 2:i=r.sent,o=[],a=0;case 5:if(!(a<i.length)){r.next=14;break}if(i[a].domain=n.domain,(u=Mi.create(i[a])).state!=li.Deleted&&u.state!=li.Recalled){r.next=10;break}return r.abrupt("continue",11);case 10:o.push(u);case 11:++a,r.next=5;break;case 14:t(e,o);case 15:case"end":return r.stop()}}),r)})))(),!0)}},{key:"readMessageById",value:function(e,t){var n=this;return null!=this.db&&(eo(regeneratorRuntime.mark((function r(){var i,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.messageStore.get(e);case 2:if(null!=(i=r.sent)){r.next=6;break}return t(null),r.abrupt("return");case 6:i.domain=n.domain,o=Mi.create(i),t(o);case 9:case"end":return r.stop()}}),r)})))(),!0)}},{key:"readMessageWithContact",value:function(e,t,n){var r=this;return null!=this.db&&(eo(regeneratorRuntime.mark((function i(){var o,a,u,s;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,r.messageStore.select([{key:"rts",value:t,compare:">"},{key:"source",value:0,compare:"="},{key:"from",value:e,optional:!0},{key:"to",value:e,optional:!0}]);case 2:o=i.sent,a=[],u=0;case 5:if(!(u<o.length)){i.next=14;break}if(o[u].domain=r.domain,(s=Mi.create(o[u])).state!=li.Deleted&&s.state!=li.Recalled){i.next=10;break}return i.abrupt("continue",11);case 10:a.push(s);case 11:++u,i.next=5;break;case 14:n(e,t,a);case 15:case"end":return i.stop()}}),i)})))(),!0)}},{key:"readMessageWithGroup",value:function(e,t,n){var r=this;return null!=this.db&&(eo(regeneratorRuntime.mark((function i(){var o,a,u,s;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,r.messageStore.select([{key:"rts",value:t,compare:">"},{key:"source",value:e,optional:!0}]);case 2:o=i.sent,a=[],u=0;case 5:if(!(u<o.length)){i.next=14;break}if(o[u].domain=r.domain,(s=Mi.create(o[u])).state!=li.Deleted&&s.state!=li.Recalled){i.next=10;break}return i.abrupt("continue",11);case 10:a.push(s);case 11:++u,i.next=5;break;case 14:n(e,t,a);case 15:case"end":return i.stop()}}),i)})))(),!0)}},{key:"readLastMessageWtihContact",value:function(e,t){var n=this;return null!=this.db&&(eo(regeneratorRuntime.mark((function r(){var i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=null,r.next=3,n.messageStore.iterate((function(t,r,o){var a=t.value;if(a.from!=e&&a.to!=e||0!=a.source||a.state!=li.Read&&a.state!=li.Sent)r();else{a.domain=n.domain;var u=Mi.create(a);i=u,o()}}),{writable:!1,direction:"prev"});case 3:t(i);case 4:case"end":return r.stop()}}),r)})))(),!0)}},{key:"readLastMessageWtihGroup",value:function(e,t){var n=this;return null!=this.db&&(eo(regeneratorRuntime.mark((function r(){var i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=null,r.next=3,n.messageStore.iterate((function(t,r,o){var a=t.value;if(a.source!=e||a.state!=li.Read&&a.state!=li.Sent)r();else{a.domain=n.domain;var u=Mi.create(a);i=u,o()}}),{writable:!1,direction:"prev"});case 3:t(i);case 4:case"end":return r.stop()}}),r)})))(),!0)}},{key:"readLastMessage",value:function(e){var t=this;return null!=this.db&&(eo(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=null,n.next=3,t.messageStore.iterate((function(e,n,i){var o=e.value;if(o.state==li.Read||o.state==li.Sent){o.domain=t.domain;var a=Mi.create(o);r=a,i()}else n()}),{writable:!1,direction:"prev"});case 3:e(r);case 4:case"end":return n.stop()}}),n)})))(),!0)}},{key:"updateMessage",value:function(e){var t=this;return null!=this.db&&(eo(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return delete(r=e.toJSON()).domain,n.next=4,t.messageStore.put(r);case 4:case"end":return n.stop()}}),n)})))(),!0)}}])&&to(t.prototype,n),r&&to(t,r),e}();function ro(e){return(ro="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function io(e,t){return(io=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function oo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=uo(e);if(t){var i=uo(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ao(this,n)}}function ao(e,t){return!t||"object"!==ro(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function uo(e){return(uo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var so=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&io(e,t)}(n,e);var t=oo(n);function n(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),t.call(this,n.NAME)}return n}(B);function co(e){return(co="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function lo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function fo(e,t){return(fo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ho(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=vo(e);if(t){var i=vo(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return po(this,n)}}function po(e,t){return!t||"object"!==co(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function vo(e){return(vo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(so,"NAME","Instantiate");var yo=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&fo(e,t)}(o,e);var t,n,r,i=ho(o);function o(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),i.call(this)}return t=o,(n=[{key:"onEvent",value:function(e,t){return e==so.NAME?this.onInstantiate(t):t}},{key:"onInstantiate",value:function(e){return e}}])&&lo(t.prototype,n),r&&lo(t,r),o}(G);function go(e){return(go="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function mo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function bo(e,t){return(bo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function wo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Oo(e);if(t){var i=Oo(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ko(this,n)}}function ko(e,t){return!t||"object"!==go(t)&&"function"!=typeof t?So(e):t}function So(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _o(e,t,n){return(_o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Oo(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Oo(e){return(Oo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ro=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&bo(e,t)}(u,e);var t,n,r,o=wo(u);function u(){var e,t,n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),_o((e=So(n=o.call(this,"Messaging")),Oo(u.prototype)),"require",e).call(e,Sr.NAME),_o((t=So(n),Oo(u.prototype)),"require",t).call(t,ci.NAME),n.contactService=null,n.contactEventFun=null,n.fileStorageEventFun=null,n.pushQueue=[],n.sendingMap=new D,n.timer=0,n.pipelineListener=new qi(So(n)),n.storage=new no,n.lastMessageTime=0,n.lastQueryTime=0,n}return t=u,(n=[{key:"start",value:function(){var e=this;if(!_o(Oo(u.prototype),"start",this).call(this))return!1;this.assemble(),this.contactService=this.kernel.getModule(Sr.NAME);var t=function(t){e._fireContactEvent(t)};this.contactService.attach(t),this.contactEventFun=t,t=function(t){e._fireFileStorageEvent(t)},this.kernel.getModule(ci.NAME).attach(t),this.fileStorageEventFun=t,this.pipeline.addListener(u.NAME,this.pipelineListener),this.timer>0&&clearInterval(this.timer),this.timer=setInterval((function(t){e._processQueue()}),100);var n=this.contactService.getSelf();return null!=n&&(this.storage.open(n.getId(),Ke.DOMAIN),this.storage.queryLastMessageTime((function(t){e.lastMessageTime=0==t?Date.now()-e.defaultRetrospect:t})),this.lastMessageTime>0?this.queryRemoteMessage():setTimeout((function(){if(e.lastMessageTime>0)e.queryRemoteMessage();else{var t=Date.now();e.queryRemoteMessage(t-e.defaultRetrospect,t)}}),500)),!0}},{key:"stop",value:function(){if(_o(Oo(u.prototype),"stop",this).call(this),null!=this.pipeline){if(0!=this.timer&&(clearInterval(this.timer),this.timer=0),this.pipeline.removeListener(u.NAME,this.pipelineListener),null!=this.contactService){var e=this.contactEventFun;this.contactService.detach(e),this.contactEventFun=null}var t=this.kernel.getModule(ci.NAME);if(null!=t){var n=this.fileStorageEventFun;t.detach(n),this.fileStorageEventFun=null}this.storage.close()}}},{key:"assemble",value:function(){return this.pluginSystem.addHook(new so),this.pluginSystem}},{key:"isSender",value:function(e){var t=this.contactService.getSelf();return null!=t&&e.from==t.getId()}},{key:"sendTo",value:function(e,t,n){return e instanceof ir?this.sendToGroup(e,t,n):e instanceof Fn?this.sendToContact(e,t,n):null}},{key:"sendToContact",value:function(e,t,n){var r=this;this.started||this.start();var i=this.contactService.getSelf();if(null==i)return null;var o=t;t instanceof Mi||(o=new Mi(t,n));var u=0;if(e instanceof Fn)u=e.getId();else if("string"==typeof e)u=parseInt(e);else{if("number"!=typeof e)return null;u=e}return o.state=li.Sending,o.from=i.getId(),o.to=u,o.localTS=Date.now(),o.remoteTS=o.localTS,new Promise((function(e,t){r.storage.writeMessage(o),r.notifyObservers(new a(Ki.Sending,o)),e(o)})).then((function(e){r.pushQueue.push(e)})),o}},{key:"sendToGroup",value:function(e,t,n){var r=this;this.started||this.start();var i=this.contactService.getSelf();if(null==i)return null;var o=t;t instanceof Mi||(o=new Mi(t,n));var u=0;if(e instanceof ir)u=e.getId();else if("string"==typeof e)u=parseInt(e);else{if("number"!=typeof e)return null;u=e}return o.from=i.getId(),o.source=u,o.localTS=Date.now(),o.remoteTS=o.localTS,new Promise((function(e,t){r.storage.writeMessage(o),r.notifyObservers(new a(Ki.Sending,o)),e(o)})).then((function(e){r.pushQueue.push(e)})),o}},{key:"markRead",value:function(e,t,n){var r=this;this.started||this.start();var i=this.contactService.getSelf();if(null==i)return!1;var o=0;if(e instanceof Mi){if(o=e.getId(),e.getTo()!=i.getId()){var s=new Yt(u.NAME,Xi,e);return n&&n(s),!1}}else o=e;var c={contactId:i.getId(),messageId:o},l=new y(Bi,c);return this.pipeline.send(u.NAME,l,(function(e,i,s){null!=s&&s.getStateCode()==Te?0==s.data.code?r.storage.readMessageById(o,(function(e){e.state=li.Read,r.storage.updateMessage(e),null!=e.attachment&&(e.attachment.token=r.getAuthToken().code),e=r.pluginSystem.getHook(so.NAME).apply(e),t&&t(e),r.notifyObservers(new a(Ki.Read,e))})):r.storage.readMessageById(o,(function(e){var t=new Yt(u.NAME,s.data.code,e);n&&n(t)})):r.storage.readMessageById(o,(function(e){var t=new Yt(u.NAME,Qi,e);n&&n(t)}))})),!0}},{key:"deleteMessage",value:function(e,t,n){var r=this;this.started||this.start();var i=this.contactService.getSelf();if(null==i)return!1;var o=e instanceof Mi?e.getId():e,s={contactId:i.getId(),messageId:o},c=new y(Fi,s);return this.pipeline.send(u.NAME,c,(function(e,i,u){null!=u&&u.getStateCode()==Te&&0==u.data.code?r.storage.readMessageById(o,(function(e){e.state=li.Deleted,r.storage.updateMessage(e),null!=e.attachment&&(e.attachment.token=r.getAuthToken().code),e=r.pluginSystem.getHook(so.NAME).apply(e),t&&t(e),r.notifyObservers(new a(Ki.Delete,e))})):r.storage.readMessageById(o,(function(e){n&&n(e)}))})),!0}},{key:"recallMessage",value:function(e,t,n){var r=this;this.started||this.start();var i=this.contactService.getSelf();if(null==i)return!1;var o=e instanceof Mi?e.getId():parseInt(e);return this.storage.readMessageById(o,(function(e){if(e.getFrom()==i.getId())if(Date.now()-e.getRemoteTimestamp()>12e4)n&&n(e);else{var a={contactId:i.getId(),messageId:o},s=new y(Di,a);r.pipeline.send(u.NAME,s),t&&t(e)}else n&&n(e)})),!0}},{key:"updateAttachment",value:function(){}},{key:"queryMessage",value:function(e,t){var n=this;this.started||this.start();var r=this.storage.readMessage(e,(function(e,r){for(var i=r.sort((function(e,t){return e.remoteTS<t.remoteTS?-1:e.remoteTS>t.remoteTS?1:0})),o=[],a=0;a<i.length;++a){var u=i[a];null!=u.attachment&&(u.attachment.token=n.getAuthToken().code);var s=n.pluginSystem.getHook(so.NAME);o.push(s.apply(u))}t(e,o)}));return r||t(e,[]),r}},{key:"queryMessageWithContact",value:function(e,t,n){var r=this;this.started||this.start();var i=e;e instanceof Fn?i=e.getId():void 0!==e.id&&(i=parseInt(e.id));var o=this.storage.readMessageWithContact(i,t,(function(e,t,i){for(var o=i.sort((function(e,t){return e.remoteTS<t.remoteTS?-1:e.remoteTS>t.remoteTS?1:0})),a=[],u=0;u<o.length;++u){var s=o[u];null!=s.attachment&&(s.attachment.token=r.getAuthToken().code);var c=r.pluginSystem.getHook(so.NAME);a.push(c.apply(s))}n(e,t,a)}));return o||n(i,t,[]),o}},{key:"queryMessageWithGroup",value:function(e,t,n){var r=this;this.started||this.start();var i=e;e instanceof ir?i=e.getId():void 0!==e.id&&(i=parseInt(e.id));var o=this.storage.readMessageWithGroup(i,t,(function(e,t,i){for(var o=i.sort((function(e,t){return e.remoteTS<t.remoteTS?-1:e.remoteTS>t.remoteTS?1:0})),a=[],u=0;u<o.length;++u){var s=o[u];null!=s.attachment&&(s.attachment.token=r.getAuthToken().code);var c=r.pluginSystem.getHook(so.NAME);a.push(c.apply(s))}n(e,t,a)}));return o||n(i,t,[]),o}},{key:"queryLastMessageWithContact",value:function(e,t){var n=this;this.started||this.start();var r=e;e instanceof Fn?r=e.getId():void 0!==e.id&&(r=parseInt(e.id)),this.storage.readLastMessageWtihContact(r,(function(e){if(null!=e){null!=e.attachment&&(e.attachment.token=n.getAuthToken().code);var r=n.pluginSystem.getHook(so.NAME).apply(e);t(r)}else t(null)}))}},{key:"queryLastMessageWithGroup",value:function(e,t){var n=this;this.started||this.start();var r=e;e instanceof ir?r=e.getId():void 0!==e.id&&(r=parseInt(e.id)),this.storage.readLastMessageWtihGroup(r,(function(e){if(null!=e){null!=e.attachment&&(e.attachment.token=n.getAuthToken().code);var r=n.pluginSystem.getHook(so.NAME).apply(e);t(r)}else t(null)}))}},{key:"queryRemoteMessage",value:function(e,t){if(!this.contactService.selfReady)return!1;var n=Date.now();if(n-this.lastQueryTime<2e3)return!1;this.lastQueryTime=n;var r=void 0===e?this.lastMessageTime+1:e,o=void 0===t?n:t,a=this.contactService.getSelf(),s={id:a.getId(),domain:a.getDomain(),device:a.getDevice().toJSON(),beginning:r,ending:o};i.a.Logger.d("MessagingService","Pull message @ "+r+" - "+o);var c=new y(Li,s);return this.pipeline.send(u.NAME,c),!0}},{key:"register",value:function(e){e instanceof yo&&this.pluginSystem.register(so.NAME,e)}},{key:"deregister",value:function(e){e instanceof yo&&this.pluginSystem.deregister(so.NAME,e)}},{key:"triggerNotify",value:function(e){var t=this,n=void 0===e.code&&void 0===e.data?e:e.data,r=Mi.create(n);r.state=li.Sent,this.refreshLastMessageTime(r.getRemoteTimestamp()),new Promise((function(e,n){r.getSource()>0&&t.contactService.updateGroupActiveTime(r.getSource(),r.getRemoteTimestamp()),t.storage.containsMessage(r,(function(n,r){t.storage.writeMessage(n),e(r)}))})).then((function(e){if(!e){null!=r.attachment&&(r.attachment.token=t.getAuthToken().code);var n=t.pluginSystem.getHook(so.NAME);r=n.apply(r),t.notifyObservers(new a(Ki.Notify,r))}}))}},{key:"triggerPull",value:function(e){if(0==e.code){var t=e.data,n=t.total,r=t.beginning,o=t.ending,a=t.messages;i.a.Logger.d("MessagingService","Query/Pull messages total: "+n+" - "+r+" - "+o);for(var u=0,s=a.length;u<s;++u)this.triggerNotify(a[u])}else this.triggerFail(Li,e)}},{key:"triggerRead",value:function(e){var t=this;if(e.code==$i){var n=Mi.create(e.data);n.getFrom()==this.contactService.getSelf().getId()&&this.storage.readMessageById(n.getId(),(function(e){null!=e&&(e.state=li.Read,t.storage.updateMessage(e),null!=e.attachment&&(e.attachment.token=t.getAuthToken().code),e=t.pluginSystem.getHook(so.NAME).apply(e),t.notifyObservers(new a(Ki.Read,e)))}))}}},{key:"triggerRecall",value:function(e){if(e.code==$i){var t=Mi.create(e.data);this.storage.updateMessage(t),i.a.Logger.d("MessagingService","Recall message: "+t.getId()),null!=t.attachment&&(t.attachment.token=this.getAuthToken().code),t=this.pluginSystem.getHook(so.NAME).apply(t),this.notifyObservers(new a(Ki.Recall,t))}else this.triggerFail(Di,e)}},{key:"triggerFail",value:function(e,t){i.a.Logger.w("MessagingService","Failed #"+e+" : "+t.code)}},{key:"refreshLastMessageTime",value:function(e){e>this.lastMessageTime&&(this.lastMessageTime=e,this.storage.updateLastMessageTime(e))}},{key:"_processQueue",value:function(){var e=this;if(this.pushQueue.length>0&&this.pipeline.isReady()){var t=this.pushQueue.shift();if(this.sendingMap.put(t.getId(),t),null!=t.attachment)this._processAttachment(t);else{var n=new y(Ni,t.toJSON());this.pipeline.send(u.NAME,n,(function(n,r,o){if(null!=o&&o.getStateCode()==Te){var s=e.sendingMap.remove(o.data.data.id);if(null==s)return void i.a.Logger.e("MessagingService","Can NOT find message in cache: "+o.data.data.id);if(s.remoteTS=o.data.data.rts,e.refreshLastMessageTime(s.remoteTS),0==o.data.code){s.state=li.Sent;var c=new a(Ki.Sent,s);e.notifyObservers(c)}else{i.a.Logger.w("MessagingService","Sent failed: "+o.data.code),s.state=li.Fault;var l=new Yt(u.NAME,o.data.code,s);e.notifyObservers(new a(Ki.Fault,l))}e.storage.updateMessage(s)}else{i.a.Logger.e("MessagingService","Pipeline error : "+Ni+" - "+o.getStateCode()),e.sendingMap.remove(t.getId()),t.state=li.Fault;var f=new Yt(u.NAME,Zi,t);e.notifyObservers(new a(Ki.Fault,f))}}))}}}},{key:"_processAttachment",value:function(e){var t=this,n=this.kernel.getModule(ci.NAME);n.start(),n.uploadFile(e.attachment.file,(function(n){e.attachment.anchor=n;var r=new a(Ki.Sending,e);t.notifyObservers(r)}),(function(n){e.attachment.anchor=n;var r=new y(Ni,e.toJSON());t.pipeline.send(u.NAME,r,(function(n,r,i){if(null!=i&&i.getStateCode()==Te)if(0==i.data.code){var o=Mi.create(i.data.data);t.sendingMap.remove(o.id),e.state=li.Sent,o.attachment.token=t.getAuthToken().code,e.setAttachment(o.attachment),e.remoteTS=o.remoteTS,t.refreshLastMessageTime(e.remoteTS),t.storage.updateMessage(e);var s=new a(Ki.Sent,e);t.notifyObservers(s)}else{t.sendingMap.remove(e.getId()),e.state=li.Fault;var c=new Yt(u.NAME,i.data.code,e);t.notifyObservers(new a(Ki.Fault,c))}else{t.sendingMap.remove(e.getId()),e.state=li.Fault;var l=new Yt(u.NAME,li.Fault,e);t.notifyObservers(new a(Ki.Fault,l))}}))}),(function(e){}))}},{key:"_fireContactEvent",value:function(e){var t=this;if(this.started)if(e.name==qn.SignIn||e.name==qn.Comeback){var n=e.data;this.storage.open(n.getId(),n.getDomain()),this.storage.queryLastMessageTime((function(e){t.lastMessageTime=0==e?Date.now()-t.defaultRetrospect:e})),this.lastMessageTime>0?this.queryRemoteMessage():setTimeout((function(){if(t.lastMessageTime>0)t.queryRemoteMessage();else{var e=Date.now();t.queryRemoteMessage(e-t.defaultRetrospect,e)}}),500)}else e.name==qn.SignOut&&this.storage.close()}},{key:"_fireFileStorageEvent",value:function(e){this.started&&e.getName()}}])&&mo(t.prototype,n),r&&mo(t,r),u}(we);function Eo(e){return(Eo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function xo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Co(e,t,n){return(Co="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=jo(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Po(e,t){return(Po=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function To(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=jo(e);if(t){var i=jo(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ao(this,n)}}function Ao(e,t){return!t||"object"!==Eo(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function jo(e){return(jo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(Ro,"NAME","Messaging");var Mo=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Po(e,t)}(o,e);var t,n,r,i=To(o);function o(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),i.call(this,"FileProcessor")}return t=o,(n=[{key:"start",value:function(){return!!Co(jo(o.prototype),"start",this).call(this)}},{key:"stop",value:function(){}},{key:"makeThumb",value:function(e,t,n){}}])&&xo(t.prototype,n),r&&xo(t,r),o}(we);function No(e){return(No="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Lo(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Io(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Do(e,t)}function Do(e,t){return(Do=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Fo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Go(e);if(t){var i=Go(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Bo(this,n)}}function Bo(e,t){return!t||"object"!==No(t)&&"function"!=typeof t?zo(e):t}function zo(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Go(e){return(Go=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(Mo,"NAME","FileProcessor");function Uo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ho=0,Jo=28,Vo=29,Wo=101,qo=103,Ko=110,Zo=112,$o=121,Qo=122,Xo=125,Yo=126,ea=200,ta=function(e){for(var t=0,n=0,r=e.length;n<r;++n){t+=3*e.charCodeAt(n)+3*t}return Math.abs(t)};function na(e){return(na="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ra(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ia(e,t,n){return(ia="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=sa(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function oa(e,t){return(oa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function aa(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=sa(e);if(t){var i=sa(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ua(this,n)}}function ua(e,t){return!t||"object"!==na(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function sa(e){return(sa=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ca=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&oa(e,t)}(o,e);var t,n,r,i=aa(o);function o(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(r=i.call(this)).name=[t.getId(),"_",t.getDomain(),"_",n.getName(),"_",n.getPlatform()].join(""),r.id=null!=e?e:ta(r.name),r.contact=t,r.device=n,r.field=null,r.state=Ho,r.videoEnabled=!1,r.videoStreamEnabled=!1,r.audioEnabled=!1,r.audioStreamEnabled=!1,r.videoUpstreamBandwidth=0,r.videoDownstreamBandwidth=0,r.audioUpstreamBandwidth=0,r.audioDownstreamBandwidth=0,r.sessionDescription=null,r}return t=o,r=[{key:"create",value:function(e){var t=new o(e.id,Fn.create(e.contact,e.domain),Tn.create(e.device));return t.state=e.state,t.name=e.name,t.videoEnabled=e.video.enabled,t.videoStreamEnabled=e.video.streamEnabled,t.audioEnabled=e.audio.enabled,t.audioStreamEnabled=e.audio.streamEnabled,t}}],(n=[{key:"getContact",value:function(){return this.contact}},{key:"getDevice",value:function(){return this.device}},{key:"isVideoMuted",value:function(){return this.videoStreamEnabled}},{key:"muteVideo",value:function(){this.videoStreamEnabled=!1}},{key:"unmuteVideo",value:function(){this.videoStreamEnabled=!0}},{key:"isAudioMuted",value:function(){return this.audioStreamEnabled}},{key:"muteAudio",value:function(){this.audioStreamEnabled=!1}},{key:"unmuteAudio",value:function(){this.audioStreamEnabled=!0}},{key:"toJSON",value:function(){var e=ia(sa(o.prototype),"toJSON",this).call(this);return e.id=this.id,e.domain=this.contact.getDomain(),e.contact=this.contact.toJSON(),e.device=this.device.toJSON(),e.state=this.state,e.name=this.name,e.video={enabled:this.videoEnabled,streamEnabled:this.videoStreamEnabled},e.audio={enabled:this.audioEnabled,streamEnabled:this.audioStreamEnabled},e}},{key:"toCompactJSON",value:function(){var e=ia(sa(o.prototype),"toCompactJSON",this).call(this);return e.id=this.id,e.domain=this.contact.getDomain(),e.contact=this.contact.toCompactJSON(),e.device=this.device.toCompactJSON(),e.state=this.state,e.name=this.name,e}}])&&ra(t.prototype,n),r&&ra(t,r),o}(function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=function(e){Io(r,e);var t=Fo(r);function r(){var e;Lo(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return e=t.call.apply(t,[this].concat(o)),n.forEach((function(t){t.prototype.initializer.call(zo(e))})),e}return r}(e),o=function(e,t){Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t)).forEach((function(n){n.match(/^(?:constructor|prototype|arguments|caller|name|bind|call|apply|toString|length)$/)||Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))};return n.forEach((function(e){o(i.prototype,e.prototype),o(i,e)})),i}(st,function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=null,void 0!==t&&(this.name=t),this.address=null,this.port=0}var t,n,r;return t=e,(n=[{key:"initializer",value:function(){}},{key:"getName",value:function(){return this.name}}])&&Uo(t.prototype,n),r&&Uo(t,r),e}())),la={QVGA:{width:320,height:240,constraints:{video:{width:{exact:320},height:{exact:240}}}},VGA:{width:640,height:480,constraints:{video:{width:{exact:640},height:{exact:480}}}},SVGA:{width:800,height:600,constraints:{video:{width:{exact:800},height:{exact:600}}}},HD:{width:1280,height:720,constraints:{video:{width:{exact:1280},height:{exact:720}}}},FullHD:{width:1920,height:1080,constraints:{video:{width:{exact:1920},height:{exact:1080}}}},FourK:{width:4096,height:2160,constraints:{video:{width:{exact:4096},height:{exact:2160}}}},EightK:{width:7680,height:4320,constraints:{video:{width:{exact:7680},height:{exact:4320}}}}};function fa(e){return(fa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ha(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function pa(e,t,n){return(pa="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ga(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function da(e,t){return(da=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function va(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ga(e);if(t){var i=ga(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ya(this,n)}}function ya(e,t){return!t||"object"!==fa(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ga(e){return(ga=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ma=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&da(e,t)}(o,e);var t,n,r,i=va(o);function o(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(n=i.call(this)).videoEnabled=e,n.audioEnabled=t,n.dimension=la.VGA,n}return t=o,r=[{key:"create",value:function(e){var t=new o(e.video,e.audio);return t.dimension=e.dimension,t}}],(n=[{key:"setVideoDimension",value:function(e){this.dimension=e}},{key:"getVideoDimension",value:function(){return this.dimension}},{key:"getConstraints",value:function(){var e={};return e.audio=this.audioEnabled,this.videoEnabled?e.video=this.dimension.constraints:e.video=!1,e}},{key:"toJSON",value:function(){var e=pa(ga(o.prototype),"toJSON",this).call(this);return e.audio=this.audioEnabled,e.video=this.videoEnabled,e.dimension=this.dimension,e}}])&&ha(t.prototype,n),r&&ha(t,r),o}(d);function ba(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return wa(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return wa(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}function wa(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ka(e,t,n,r,i,o,a){try{var u=e[o](a),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,i)}function Sa(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){ka(o,r,i,a,u,"next",e)}function u(e){ka(o,r,i,a,u,"throw",e)}a(void 0)}))}}function _a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Oa=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sn=i.a.Utils.generateSerialNumber(),this.contact=t,this.device=n,this.target=null,this.mediaConstraint=null,this.configuration=null,this.pc=null,this.candidates=[],this.localVideoElem=null,this.remoteVideoElem=null,this.outboundStream=null,this.inboundStream=null,this.started=!1,this.ready=!1}var t,n,r;return t=e,(n=[{key:"getContact",value:function(){return this.contact}},{key:"getDevice",value:function(){return this.device}},{key:"outboundVideoEnabled",value:function(){return this.streamEnabled(this.outboundStream,"video")}},{key:"outboundAudioEnabled",value:function(){return this.streamEnabled(this.outboundStream,"audio")}},{key:"inboundVideoEnabled",value:function(){return this.streamEnabled(this.inboundStream,"video")}},{key:"inboundAudioEnabled",value:function(){return this.streamEnabled(this.inboundStream,"audio")}},{key:"streamEnabled",value:function(e,t){if(null==e)return!1;var n=!1;return e.getTracks.some((function(e){if(e.kind==t)return n=e.enabled,!0})),n}},{key:"enableOutboundVideo",value:function(e){return this.enableStream(this.outboundStream,"video",e)}},{key:"enableOutboundAudio",value:function(e){return this.enableStream(this.outboundStream,"audio",e)}},{key:"enableInboundVideo",value:function(e){return this.enableStream(this.inboundStream,"video",e)}},{key:"enableInboundAudio",value:function(e){return this.enableStream(this.inboundStream,"audio",e)}},{key:"enableStream",value:function(e,t,n){if(null==e)return!1;var r=!1;return e.getTracks.some((function(e){if(e.kind==t)return e.enabled=n,r=!0,!0})),r}},{key:"isWorking",value:function(){return null!=this.pc}},{key:"enableICE",value:function(e){null!=e&&(this.configuration={iceServers:e})}},{key:"disableICE",value:function(){this.configuration=null}},{key:"onIceCandidate",value:function(e){}},{key:"openOffer",value:function(e,t,n){var r=this;null==this.pc?(this.mediaConstraint=e,this.pc=null!=this.configuration?new RTCPeerConnection(this.configuration):new RTCPeerConnection,this.pc.ontrack=function(e){r.fireOnTrack(e)},this.pc.onicecandidate=function(e){r.fireOnIceCandidate(e)},Sa(regeneratorRuntime.mark((function i(){var o,a,u,s,c;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(null==e){i.next=13;break}return o=e.getConstraints(),i.next=4,r.getUserMedia(o);case 4:if(null!=(a=i.sent)){i.next=9;break}return n(new Yt(uu.NAME,Ko,r)),r.close(),i.abrupt("return");case 9:null!=r.localVideoElem&&(r.localVideoElem.autoplay=!0,r.localVideoElem.srcObject=a),r.outboundStream=a,u=ba(a.getTracks());try{for(u.s();!(s=u.n()).done;)c=s.value,r.pc.addTrack(c)}catch(e){u.e(e)}finally{u.f()}case 13:r.pc.createOffer().then((function(e){r.pc.setLocalDescription(new RTCSessionDescription(e)).then((function(){t(r.pc.localDescription)})).catch((function(e){n(new Yt(uu.NAME,Xo,r,e)),r.close()}))})).catch((function(e){n(new Yt(uu.NAME,$o,r,e)),r.close()})),r.started=!0;case 15:case"end":return i.stop()}}),i)})))()):n(new Yt(uu.NAME,qo,this))}},{key:"doAnswer",value:function(e,t,n){var r=this;this.pc.setRemoteDescription(new RTCSessionDescription(e)).then((function(){t(),r.doReady()})).catch((function(e){n(new Yt(uu.NAME,Yo,r,e)),r.close()}))}},{key:"openAnswer",value:function(e,t,n,r){var i=this;null==this.pc?(this.mediaConstraint=t,this.pc=null!=this.configuration?new RTCPeerConnection(this.configuration):new RTCPeerConnection,this.pc.ontrack=function(e){i.fireOnTrack(e)},this.pc.onicecandidate=function(e){i.fireOnIceCandidate(e)},this.pc.setRemoteDescription(new RTCSessionDescription(e)).then((function(){Sa(regeneratorRuntime.mark((function e(){var o,a,u,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==t){e.next=13;break}return o=t.getConstraints(),e.next=4,i.getUserMedia(o);case 4:if(null!=(a=e.sent)){e.next=9;break}return r(new Yt(uu.NAME,Ko,i)),i.close(),e.abrupt("return");case 9:null!=i.localVideoElem&&(i.localVideoElem.autoplay=!0,i.localVideoElem.srcObject=a),i.outboundStream=a,u=ba(a.getTracks());try{for(u.s();!(s=u.n()).done;)c=s.value,i.pc.addTrack(c)}catch(e){u.e(e)}finally{u.f()}case 13:i.pc.createAnswer().then((function(e){i.pc.setLocalDescription(new RTCSessionDescription(e)).then((function(){n(i.pc.localDescription),i.doReady()})).catch((function(e){r(new Yt(uu.NAME,Xo,i,e)),i.close()}))})).catch((function(e){r(new Yt(uu.NAME,Qo,i,e)),i.close()})),i.started=!0;case 15:case"end":return e.stop()}}),e)})))()})).catch((function(e){r(new Yt(uu.NAME,Yo,i,e)),i.close()}))):r(new Yt(uu.NAME,qo,this))}},{key:"doCandidate",value:function(e){if(null!=this.pc)if(this.ready){if(this.candidates.length>0){for(var t=0;t<this.candidates.length;++t){var n=this.candidates[t],r=new RTCIceCandidate(n);this.pc.addIceCandidate(r).catch((function(e){i.a.Logger.e("RTCDevice","Ice Candidate error: "+e)})),i.a.Logger.d("RTCDevice","#doCandidate add candidate: "+n.sdpMid)}this.candidates.splice(0,this.candidates.length)}var o=new RTCIceCandidate(e);this.pc.addIceCandidate(o).catch((function(e){i.a.Logger.e("RTCDevice","Ice Candidate error: "+e)})),i.a.Logger.d("RTCDevice","#doCandidate add candidate: "+e.sdpMid)}else this.candidates.push(e)}},{key:"doReady",value:function(){this.ready=!0;for(var e=0;e<this.candidates.length;++e){var t=this.candidates[e],n=new RTCIceCandidate(t);this.pc.addIceCandidate(n).catch((function(e){i.a.Logger.e("RTCDevice","Ice Candidate error: "+e)})),i.a.Logger.d("RTCDevice","#doReady add candidate: "+t.sdpMid)}this.candidates.splice(0,this.candidates.length)}},{key:"close",value:function(){if(this.started=!1,this.candidates=[],null!=this.inboundStream){var e=[];this.inboundStream.getTracks().forEach((function(t){t.stop(),e.push(t)}));for(var t=0;t<e.length;++t)this.inboundStream.removeTrack(e[t]);this.inboundStream=null}if(null!=this.outboundStream){var n=[];this.outboundStream.getTracks().forEach((function(e){e.stop(),n.push(e)}));for(var r=0;r<n.length;++r)this.outboundStream.removeTrack(n[r]);this.outboundStream=null}null!=this.pc&&(this.pc.close(),this.pc=null),this.disableICE(),null!=this.localVideoElem&&this.localVideoElem.pause(),null!=this.remoteVideoElem&&this.remoteVideoElem.pause(),this.ready=!1}},{key:"fireOnTrack",value:function(e){e.streams&&e.streams[0]?(this.inboundStream=e.streams[0],null!=this.remoteVideoElem&&(this.remoteVideoElem.autoplay=!0,this.remoteVideoElem.srcObject=this.inboundStream)):(null==this.inboundStream&&(this.inboundStream=new MediaStream,null!=this.remoteVideoElem&&(this.remoteVideoElem.autoplay=!0,this.remoteVideoElem.srcObject=this.inboundStream)),this.inboundStream.addTrack(e.track))}},{key:"fireOnIceCandidate",value:function(e){e.candidate&&this.onIceCandidate(e.candidate)}},{key:"getUserMedia",value:function(e,t,n){return navigator.mediaDevices.getUserMedia(e)}}])&&_a(t.prototype,n),r&&_a(t,r),e}(),Ra={Offer:"offer",Answer:"answer",Bye:"bye",Follow:"follow",Revoke:"revoke",Busy:"busy",Candidate:"candidate",ApplyCall:"applyCall",ApplyEnter:"applyEnter"};function Ea(e){return(Ea="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function xa(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ca(e,t,n){return(Ca="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ja(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Pa(e,t){return(Pa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ta(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ja(e);if(t){var i=ja(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Aa(this,n)}}function Aa(e,t){return!t||"object"!==Ea(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ja(e){return(ja=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ma=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Pa(e,t)}(o,e);var t,n,r,i=Ta(o);function o(e,t,n,r,a){var u;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(u=i.call(this)).name=e,u.field=t,u.contact=n,u.device=r,u.rtcSN=a,u.target=null,u.sessionDescription=null,u.candidate=null,u.candidates=null,u.mediaConstraint=null,u.caller=null,u.callee=null,u}return t=o,r=[{key:"create",value:function(e,t){var n=new o(e.name,Ga.create(e.field,t),Fn.create(e.contact),Tn.create(e.device),e.rtcSN);return e.description&&(n.sessionDescription=e.description),e.target&&(n.target=ca.create(e.target)),e.candidate&&(n.candidate=e.candidate),e.candidates&&(n.candidates=e.candidates),e.constraint&&(n.mediaConstraint=ma.create(e.constraint)),e.caller&&(n.caller=Fn.create(e.caller)),e.callee&&(n.callee=Fn.create(e.callee)),n}}],(n=[{key:"toJSON",value:function(){var e=Ca(ja(o.prototype),"toJSON",this).call(this);return e.name=this.name,e.field=this.field.toCompactJSON(),e.contact=this.contact.toCompactJSON(),e.device=this.device.toCompactJSON(),e.rtcSN=this.rtcSN,null!=this.sessionDescription&&(e.description=this.sessionDescription),null!=this.target&&(e.target=target.toCompactJSON()),null!=this.candidate&&(e.candidate=this.candidate),null!=this.mediaConstraint&&(e.constraint=this.mediaConstraint.toJSON()),e}},{key:"toCompactJSON",value:function(){return this.toJSON()}}])&&xa(t.prototype,n),r&&xa(t,r),o}(d);function Na(e){return(Na="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function La(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ia(e,t,n){return(Ia="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=za(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Da(e,t){return(Da=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Fa(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=za(e);if(t){var i=za(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ba(this,n)}}function Ba(e,t){return!t||"object"!==Na(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function za(e){return(za=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ga=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Da(e,t)}(o,e);var t,n,r,i=Fa(o);function o(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(r=i.call(this,6048e5)).id=e,r.founder=t,r.pipeline=n,r.rtcDevices=[],r.outboundRTC=null,r.inboundRTC=null,r.endpoints=[],r.device=null,r.caller=null,r.callee=null,r}return t=o,r=[{key:"create",value:function(e,t){var n=new o(e.id,Fn.create(e.founder,e.domain),t);if(void 0!==e.endpoints)for(var r=e.endpoints,i=0;i<r.length;++i){var a=ca.create(r[i]);a.field=n,n.endpoints.put(a.getId(),a)}return n}}],(n=[{key:"getFounder",value:function(){return this.founder}},{key:"getDevice",value:function(){return this.device}},{key:"isPrivate",value:function(){return this.id==this.founder.getId()}},{key:"launchCaller",value:function(e,t,n,r){var i=this;this.rtcDevices.push(e),e.onIceCandidate=function(t){i.onIceCandidate(t,e)},e.openOffer(t,(function(o){var a=new Ma(Ra.Offer,i,e.getContact(),e.getDevice(),e.sn);a.sessionDescription=o,a.mediaConstraint=t,i.sendSignaling(a,n,r)}),(function(e){r(e)}))}},{key:"launchCallee",value:function(e,t,n,r,i){var o=this;this.rtcDevices.push(e),e.onIceCandidate=function(t){o.onIceCandidate(t,e)},e.openAnswer(t,n,(function(t){var a=new Ma(Ra.Answer,o,e.getContact(),e.getDevice(),e.sn);a.sessionDescription=t,a.mediaConstraint=n,o.sendSignaling(a,r,i)}),(function(e){i(e)}))}},{key:"launchFollow",value:function(e,t,n,r){var i=this;t.target=e,this.rtcDevices.push(t),t.onIceCandidate=function(e){i.onIceCandidate(e,t)},t.openOffer(null,(function(o){var a=new Ma(Ra.Follow,i,t.getContact(),t.getDevice(),t.sn);a.sessionDescription=o,a.target=e,i.sendSignaling(a,n,r)}),(function(e){r(e)}))}},{key:"applyCall",value:function(e,t,n,r){var i=this,o=new y(Ra.ApplyCall,{field:this.toCompactJSON(),proposer:e.toCompactJSON(),target:t.toCompactJSON()});this.pipeline.send(uu.NAME,o,(function(o,a,u){if(null!=u&&u.getStateCode()==Te)if(u.data.code==Ho)u.data.data,n(i,e,t);else{var s=new Yt(uu.NAME,u.data.code,{field:i,proposer:e,target:t});r(s)}else{var c=new Yt(uu.NAME,null!=u?u.getStateCode():ea,{field:i,proposer:e,target:t});r(c)}}))}},{key:"applyEnter",value:function(e,t,n,r){var i=this,o=new y(Ra.ApplyEnter,{field:this.toCompactJSON(),contact:e.toCompactJSON(),device:t.toCompactJSON()});this.pipeline.send(uu.NAME,o,(function(o,a,u){if(null!=u&&u.getStateCode()==Te)if(u.data.code==Ho)u.data.data,n(i,e,t);else{var s=new Yt(uu.NAME,u.data.code,{field:i,contact:e,device:t});r(s)}else{var c=new Yt(uu.NAME,null!=u?u.getStateCode():ea,{field:i,contact:e,device:t});r(c)}}))}},{key:"getEndpoint",value:function(e){for(var t=0;t<this.endpoints.length;++t){var n=this.endpoints[t];if(n.getId()==e.getId())return n}}},{key:"numRTCDevices",value:function(){return this.rtcDevices.length}},{key:"getRTCDeviceBySN",value:function(e){for(var t=0;t<this.rtcDevices.length;++t){var n=this.rtcDevices[t];if(n.sn==e)return n}return null}},{key:"getRTCDevice",value:function(e){if(void 0===e)return this.rtcDevices.length>0?this.rtcDevices[0]:null;for(var t=0;t<this.rtcDevices.length;++t){var n=this.rtcDevices[t];if(null!=n.target&&n.target.getId()==e.getId())return n}return null}},{key:"closeRTCDevice",value:function(e){if(e instanceof Oa)for(var t=0;t<this.rtcDevices.length;++t){var n=this.rtcDevices[t];if(n==e){this.outboundRTC==n&&(this.outboundRTC=null),this.inboundRTC==n&&(this.inboundRTC=null),n.close(),this.rtcDevices.splice(t,1);break}}else for(var r=0;r<this.rtcDevices.length;++r){var i=this.rtcDevices[r];if(null!=i.target&&i.target.getId()==endpoint.getId()){i.close(),this.outboundRTC==i&&(this.outboundRTC=null),this.inboundRTC==i&&(this.inboundRTC=null),this.rtcDevices.splice(r,1);break}}}},{key:"closeRTCDevices",value:function(){0!=this.rtcDevices.length&&(this.rtcDevices.forEach((function(e,t,n){e.close()})),this.rtcDevices.splice(0,this.rtcDevices.length),this.outboundRTC=null,this.inboundRTC=null)}},{key:"sendSignaling",value:function(e,t,n){var r=this;this.pipeline.send(uu.NAME,new y(e.name,e.toJSON()),(function(e,i,o){if(null!=o&&o.getStateCode()==Te)if(o.data.code==Ho){var a=o.data.data,u=Ma.create(a,r.pipeline);o.context=u,t&&t(u)}else n&&n(new Yt(uu.NAME,o.data.code,r));else n&&n(new Yt(uu.NAME,ea,r))}))}},{key:"onIceCandidate",value:function(e,t){var n=new Ma(Ra.Candidate,this,t.getContact(),t.getDevice(),t.sn);n.candidate=e,this.sendSignaling(n)}},{key:"toJSON",value:function(){var e=Ia(za(o.prototype),"toJSON",this).call(this);e.id=this.id,e.domain=this.founder.getDomain(),e.founder=this.founder.toCompactJSON(),e.endpoints=[];for(var t=0;t<this.endpoints.length;++t)e.endpoints.push(this.endpoints[t].toJSON());return e}},{key:"toCompactJSON",value:function(){var e=Ia(za(o.prototype),"toCompactJSON",this).call(this);return e.id=this.id,e.domain=this.founder.getDomain(),e.founder=this.founder.toCompactJSON(),e}}])&&La(t.prototype,n),r&&La(t,r),o}(st);function Ua(e){return(Ua="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ha(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ja(e,t,n){return(Ja="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ka(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Va(e,t){return(Va=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Wa(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Ka(e);if(t){var i=Ka(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return qa(this,n)}}function qa(e,t){return!t||"object"!==Ua(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ka(e){return(Ka=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Za=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Va(e,t)}(a,e);var t,n,r,o=Wa(a);function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=o.call(this)).multipointComm=e,t}return t=a,(n=[{key:"onReceived",value:function(e,t,n){Ja(Ka(a.prototype),"onReceived",this).call(this,e,t,n),n.getStateCode()==Te?n.name==Ra.Offer?this.multipointComm.triggerOffer(n.data,n.context):n.name==Ra.Answer?this.multipointComm.triggerAnswer(n.data,n.context):n.name==Ra.Bye?this.multipointComm.triggerBye(n.data,n.context):n.name==Ra.Busy?this.multipointComm.triggerBusy(n.data,n.context):n.name==Ra.Candidate&&this.multipointComm.triggerCandidate(n.data,n.context):i.a.Logger.w("CommPipelineListener","Pipeline error: "+n.name+" - "+n.getStateCode())}}])&&Ha(t.prototype,n),r&&Ha(t,r),a}(M),$a={NewCall:"NewCall",InProgress:"InProgress",Ringing:"Ringing",Connected:"Connected",Busy:"Busy",Bye:"Bye",Timeout:"Timeout",CallFailed:"CallFailed"};function Qa(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Xa=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.self=t,this.startTime=Date.now(),this.answerTime=0,this.endTime=0,this.field=null,this.currentFieldEndpoint=null,this.callerMediaConstraint=null,this.calleeMediaConstraint=null,this.lastError=null}var t,n,r;return t=e,(n=[{key:"isActive",value:function(){return null!=this.field&&this.field.numRTCDevices()>0}},{key:"getCaller",value:function(){return this.field.caller}},{key:"getCallee",value:function(){return this.field.callee}},{key:"getPeer",value:function(){return this.self.getId()==this.field.caller.getId()?this.field.callee:this.field.caller}}])&&Qa(t.prototype,n),r&&Qa(t,r),e}();function Ya(e){return(Ya="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function eu(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function tu(e,t,n){return(tu="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=au(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function nu(e,t){return(nu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ru(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=au(e);if(t){var i=au(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return iu(this,n)}}function iu(e,t){return!t||"object"!==Ya(t)&&"function"!=typeof t?ou(e):t}function ou(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function au(e){return(au=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var uu=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&nu(e,t)}(u,e);var t,n,r,o=ru(u);function u(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(e=o.call(this,u.NAME)).pipelineListener=new Za(ou(e)),e.iceServers=null,e.privateField=null,e.fields=new D,e.offerSignaling=null,e.answerSignaling=null,e.activeCall=null,e.videoElem={local:null,remote:null},e.callTimer=0,e.callTimeout=3e4,e}return t=u,(n=[{key:"start",value:function(){var e=this;if(!tu(au(u.prototype),"start",this).call(this))return!1;this.pipeline.addListener(u.NAME,this.pipelineListener);var t=this.kernel.getModule(Sr.NAME);t.attachWithName(qn.SignIn,(function(t){if(null==e.privateField){var n=t.data;e.privateField=new Ga(n.getId(),n,e.pipeline),e.privateField.device=n.getDevice()}}));var n=t.getSelf();return null!=n&&(this.privateField=new Ga(n.getId(),n,this.pipeline),this.privateField.device=n.getDevice()),!0}},{key:"stop",value:function(){var e=this;tu(au(u.prototype),"stop",this).call(this),null!=this.pipeline&&(null!=this.privateField&&this.privateField.closeRTCDevices(),null!=this.activeCall&&this.activeCall.isActive()?this.hangupCall((function(){e.activeCall=null,e.pipeline.removeListener(u.NAME,e.pipelineListener)}),(function(){e.activeCall=null,e.pipeline.removeListener(u.NAME,e.pipelineListener)})):this.pipeline.removeListener(u.NAME,this.pipelineListener))}},{key:"config",value:function(e){e.iceServers&&(this.iceServers=e.iceServers)}},{key:"getLocalVideoElement",value:function(){return this.videoElem.local}},{key:"setLocalVideoElement",value:function(e){this.videoElem.local=e}},{key:"getRemoteVideoElement",value:function(){return this.videoElem.remote}},{key:"setRemoteVideoElement",value:function(e){this.videoElem.remote=e}},{key:"createRTCDevice",value:function(e,t){var n=this.kernel.getModule(Sr.NAME).getSelf();if(null==n)return null;var r=new Oa(n,n.getDevice());return e&&(e.volume=0,e.setAttribute("muted","muted"),r.localVideoElem=e),t&&(r.remoteVideoElem=t),r}},{key:"makeCall",value:function(e,t,n,r){var i=this;if(null==this.privateField){var o=new Yt(u.NAME,Wo,e);return r&&r(o),this.notifyObservers(new a($a.CallFailed,o)),!1}var s=function(e){n&&n(i.activeCall),e.field.isPrivate()&&i.notifyObservers(new a($a.Ringing,i.activeCall))},c=function(e){i.callTimer>0&&(clearTimeout(i.callTimer),i.callTimer=0),i.activeCall.lastError=e,r&&r(e),i.notifyObservers(new a($a.CallFailed,e)),i.activeCall.field.isPrivate()&&i.hangupCall()};if(e instanceof Fn){if(null!=this.activeCall&&this.activeCall.isActive()){var l=new Yt(u.NAME,Jo,e);return r&&r(l),this.notifyObservers(new a($a.CallFailed,l)),!1}new Promise((function(e,t){i.callTimer=setTimeout((function(){i.fireCallTimeout()}),i.callTimeout),e()})).then((function(){i.notifyObservers(new a($a.InProgress,e))})),this.activeCall=new Xa(this.privateField.getFounder());var f=this.createRTCDevice(this.videoElem.local,this.videoElem.remote);this.privateField.applyCall(this.privateField.getFounder(),e,(function(e,n,r){i.privateField.caller=i.privateField.getFounder(),i.privateField.callee=r,i.activeCall.field=i.privateField,i.activeCall.callerMediaConstraint=t,f.enableICE(i.iceServers),i.privateField.launchCaller(f,t,s,c)}),(function(e){c(e)}))}else{if(!(e instanceof Ga))return!1;if(null!=this.activeCall){if(this.activeCall.field.getId()!=e.getId())return!1;if(null!=this.activeCall.field.outboundRTC){var h=new Yt(u.NAME,Jo,e);return r&&r(h),this.notifyObservers(new a($a.CallFailed,h)),!1}}else this.activeCall=new Xa(this.privateField.getFounder()),this.activeCall.field=e;new Promise((function(e,t){e()})).then((function(){i.notifyObservers(new a($a.InProgress,e))}));var p=this.createRTCDevice();e.launchCaller(p,t,s,c),e.outboundRTC=p}return!0}},{key:"followCall",value:function(e,t,n){var r=this;if(null==this.privateField){var i=new Yt(u.NAME,Wo,e);return n&&n(i),this.notifyObservers(new a($a.CallFailed,i)),!1}var o=function(e){t&&t(r.activeCall)},s=function(t){r.activeCall.lastError=t,n&&n(t),r.notifyObservers(new a($a.CallFailed,t)),e instanceof Ga?r.activeCall.field.closeRTCDevices():e instanceof ca&&r.activeCall.field.closeRTCDevice(e)};if(e instanceof Ga){if(null!=this.activeCall){if(this.activeCall.field.getId()!=e.getId())return!1;if(null!=this.activeCall.field.inboundRTC){var c=new Yt(u.NAME,Jo,e);return n&&n(c),this.notifyObservers(new a($a.CallFailed,c)),!1}}else this.activeCall=new Xa(this.privateField.getFounder()),this.activeCall.field=e;new Promise((function(e,t){e()})).then((function(){r.notifyObservers(new a($a.InProgress,e))}));var l=this.createRTCDevice();e.launchCaller(l,null,o,s),e.inboundRTC=l}else{if(!(e instanceof ca))return!1;if(null!=this.activeCall){if(this.activeCall.field.getId()!=e.field.getId())return!1}else this.activeCall=new Xa(this.privateField.getFounder()),this.activeCall.field=e.field;new Promise((function(e,t){e()})).then((function(){r.notifyObservers(new a($a.InProgress,e))}));var f=this.createRTCDevice();e.field.launchFollow(e,f,o,s)}return!0}},{key:"answerCall",value:function(e,t,n,r){var o=this;if(null==e||void 0===e)return!1;if(null==this.offerSignaling)return i.a.Logger.w(u.NAME,"#answerCall offer signaling is null"),!1;"function"==typeof t?(r=n,n=t,t=this.offerSignaling.field.isPrivate()?this.offerSignaling.contact:this.offerSignaling.field):void 0===t&&(t=this.offerSignaling.field.isPrivate()?this.offerSignaling.contact:this.offerSignaling.field),this.callTimer>0&&(clearTimeout(this.callTimer),this.callTimer=0);var s=function(e){n&&n(o.activeCall),o.notifyObservers(new a($a.Connected,o.activeCall))},c=function(e){o.activeCall.lastError=e,r&&r(e),o.notifyObservers(new a($a.CallFailed,e)),o.activeCall.field.isPrivate()&&o.hangupCall()};if(new Promise((function(e,t){e()})).then((function(){o.notifyObservers(new a($a.InProgress,t))})),t instanceof Fn){if(null!=this.activeCall&&this.activeCall.isActive()){var l=new Yt(u.NAME,Vo,t);return r&&r(l),this.notifyObservers(new a($a.CallFailed,l)),!1}if(null==this.videoElem.local&&null==this.videoElem.remote){var f=new Yt(u.NAME,Zo,t);return r&&r(f),this.notifyObservers(new a($a.CallFailed,f)),!1}this.activeCall.answerTime=Date.now();var h=this.createRTCDevice(this.videoElem.local,this.videoElem.remote);this.privateField.applyEnter(h.getContact(),h.getDevice(),(function(n,r){o.privateField.caller=t,o.privateField.callee=o.privateField.getFounder(),o.activeCall.field=o.privateField,o.activeCall.calleeMediaConstraint=e,h.enableICE(o.iceServers),o.privateField.launchCallee(h,o.offerSignaling.sessionDescription,e,s,c)}),(function(e){c(e)}))}else{if(!(t instanceof Ga))return!1;var p=this.createRTCDevice();t.launchCallee(p,this.offerSignaling.sessionDescription,e,s,c)}return!0}},{key:"hangupCall",value:function(e,t,n){var r=this;if(null==this.activeCall||!this.activeCall.isActive())return!1;var i=this.activeCall.field,o=null;if(void 0!==e)if("function"==typeof e)n=t,t=e;else if(e instanceof Ga){if(this.activeCall.field.getId()!=e.getId())return!1}else e instanceof ca&&(o=e);var s=function(e,o,s){var c=r.activeCall;if(i.isPrivate()&&(i.closeRTCDevices(),r.offerSignaling=null,r.answerSignaling=null,r.activeCall=null),null!=s&&s.getStateCode()==Te)if(s.data.code==Ho){var l=Ma.create(s.data.data,r.pipeline);l.field.isPrivate()?c.endTime=Date.now():null!=l.target?(i.closeRTCDevice(l.target),c.currentFieldEndpoint=i.getEndpoint(l.target)):i.closeRTCDevice(i.outboundRTC),t&&t(c),r.notifyObservers(new a($a.Bye,c)),0==c.field.numRTCDevices()&&(r.activeCall=null)}else{var f=new Yt(u.NAME,s.data.code,c);c.lastError=f,n&&n(f),r.notifyObservers(new a($a.CallFailed,f))}else{var h=new Yt(u.NAME,s.getStateCode(),c);c.lastError=h,n&&n(h),r.notifyObservers(new a($a.CallFailed,h))}};if(i.isPrivate()){var c=null;if(null!=this.offerSignaling)c=this.offerSignaling.callee;else{if(null==this.answerSignaling){var l=new Ma(Ra.Bye,i,this.privateField.founder,this.privateField.founder.getDevice(),null!=i.getRTCDevice()?i.getRTCDevice().sn:0),f=new y(Ra.Bye,l.toJSON());return this.pipeline.send(u.NAME,f,s),!0}c=this.answerSignaling.callee}if(null!=c&&c.getId()==this.privateField.founder.getId()&&this.privateField.getRTCDevice().ready){var h=new Ma(Ra.Busy,i,this.privateField.founder,this.privateField.founder.getDevice(),null!=i.getRTCDevice()?i.getRTCDevice().sn:0),p=new y(Ra.Busy,h.toJSON());this.pipeline.send(u.NAME,p)}else{var d=new Ma(Ra.Bye,i,this.privateField.founder,this.privateField.founder.getDevice(),null!=i.getRTCDevice()?i.getRTCDevice().sn:0),v=new y(Ra.Bye,d.toJSON());this.pipeline.send(u.NAME,v,s)}}else{if(null==i.outboundRTC)return!1;var g=new Ma(Ra.Bye,i,this.privateField.founder,this.privateField.founder.getDevice(),i.outboundRTC.sn);g.target=o;var m=new y(Ra.Bye,g.toJSON());this.pipeline.send(u.NAME,m,s)}return!0}},{key:"revokeCall",value:function(e,t,n){var r=this;if(null==this.activeCall||!this.activeCall.isActive())return!1;if(this.activeCall.field.isPrivate())return!1;var i=this.activeCall.field,o=null;if(e instanceof Fn)return!1;if(e instanceof Ga){if(i.getId()!=e.getId())return!1;if(null==i.inboundRTC)return!1}else e instanceof ca&&(o=e);var s=new Ma(Ra.Revoke,i,this.privateField.founder,this.privateField.founder.getDevice(),i.getRTCDevice(o).sn);s.target=o;var c=new y(Ra.Revoke,s.toJSON());return this.pipeline.send(u.NAME,c,(function(e,o,s){var c=r.activeCall;if(null!=s&&s.getStateCode()==Te)if(s.data.code==Ho){var l=Ma.create(s.data.data,r.pipeline);null!=l.target?(i.closeRTCDevice(l.target),c.currentFieldEndpoint=i.getEndpoint(l.target)):i.closeRTCDevice(i.inboundRTC),t&&t(c),r.notifyObservers(new a($a.Bye,c)),0==i.numRTCDevices()&&(r.activeCall=null)}else{var f=new Yt(u.NAME,s.data.code,c);c.lastError=f,n&&n(f),r.notifyObservers(new a($a.CallFailed,f))}else{var h=new Yt(u.NAME,s.getStateCode(),c);c.lastError=h,n&&n(h),r.notifyObservers(new a($a.CallFailed,h))}})),!0}},{key:"getField",value:function(e,t,n){var r=this.fields.get(e);if(null==r){var i=new y(Ra.GetField,{id:e});this.pipeline.send(u.NAME,i,(function(e,t,n){}))}else handleSuccess(r)}},{key:"getActiveField",value:function(){return null==this.activeCall?null:this.activeCall.field}},{key:"fireCallTimeout",value:function(){this.callTimer>0&&(clearTimeout(this.callTimer),this.callTimer=0),this.notifyObservers(new a($a.Timeout,this.activeCall)),this.hangupCall()}},{key:"triggerOffer",value:function(e,t){var n=this;if(null==t){var r=e.data;if(this.offerSignaling=Ma.create(r,this.pipeline),null!=this.activeCall&&this.activeCall.isActive()){var i=new Ma(Ra.Busy,this.offerSignaling.field,this.privateField.getFounder(),this.privateField.getDevice(),0),o=new y(Ra.Busy,i.toJSON());return this.pipeline.send(u.NAME,o),void(this.offerSignaling=null)}this.callTimer=setTimeout((function(){n.fireCallTimeout()}),this.callTimeout-5e3),this.activeCall=new Xa(this.privateField.getFounder()),this.activeCall.field=this.offerSignaling.field,this.offerSignaling.field.isPrivate()&&(this.activeCall.field.caller=this.offerSignaling.caller,this.activeCall.field.callee=this.offerSignaling.callee,this.activeCall.callerMediaConstraint=this.offerSignaling.mediaConstraint),this.notifyObservers(new a($a.NewCall,this.activeCall))}}},{key:"triggerAnswer",value:function(e,t){var n=this;if(null==t)if(null!=this.activeCall&&this.activeCall.isActive()){this.callTimer>0&&(clearTimeout(this.callTimer),this.callTimer=0),this.activeCall.answerTime=Date.now();var r=e.data;this.answerSignaling=Ma.create(r,this.pipeline);var o=null;this.activeCall.field.isPrivate()?(this.activeCall.calleeMediaConstraint=this.answerSignaling.mediaConstraint,o=this.activeCall.field.getRTCDevice()):o=null!=this.answerSignaling.target?this.activeCall.field.getRTCDevice(this.answerSignaling.target):null!=this.answerSignaling.mediaConstraint?this.activeCall.field.inboundRTC:this.activeCall.field.outboundRTC,o.doAnswer(this.answerSignaling.sessionDescription,(function(){n.notifyObservers(new a($a.Connected,n.activeCall))}),(function(e){n.activeCall.lastError=e,n.notifyObservers(new a($a.CallFailed,e))}))}else i.a.Logger.e(u.NAME,"#triggerAnswer no active call record")}},{key:"triggerCandidate",value:function(e,t){console.log("xjw 1");var n=Ma.create(e.data,this.pipeline);console.log("xjw 2");var r=this.activeCall.field.getRTCDeviceBySN(n.rtcSN);if(null!=r){if(console.log("xjw 3"),null!=n.candidate&&r.doCandidate(n.candidate),null!=n.candidates)for(var o=n.candidates,a=0;a<o.length;++a)r.doCandidate(o[a])}else i.a.Logger.e("MultipointComm","Can NOT find rtc device: "+n.rtcSN)}},{key:"triggerBusy",value:function(e,t){if(e.code==Ho){var n=Ma.create(e.data,this.pipeline);n.field.isPrivate()?n.callee.getId()==this.privateField.getId()?(this.activeCall.endTime=Date.now(),this.notifyObservers(new a($a.Bye,this.activeCall))):(this.notifyObservers(new a($a.Busy,this.activeCall)),this.hangupCall()):this.notifyObservers(new a($a.Busy,n.field))}else{var r=new Yt(u.NAME,e.code,this);this.notifyObservers(new a(Ra.CallFailed,r))}}},{key:"triggerBye",value:function(e,t){var n=Ma.create(e.data,this.pipeline);n.field.isPrivate()?this.hangupCall():this.hangupCall(n.field)}}])&&eu(t.prototype,n),r&&eu(t,r),u}(we);function su(e){return(su="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function cu(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function lu(e,t,n){return(lu="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=du(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function fu(e,t){return(fu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function hu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=du(e);if(t){var i=du(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return pu(this,n)}}function pu(e,t){return!t||"object"!==su(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function du(e){return(du=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(uu,"NAME","MultipointComm");var vu=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&fu(e,t)}(o,e);var t,n,r,i=hu(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this)).service=e,t}return t=o,(n=[{key:"onReceived",value:function(e,t,n){lu(du(o.prototype),"onReceived",this).call(this,e,t,n)}}])&&cu(t.prototype,n),r&&cu(t,r),o}(M);function yu(e){return(yu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function gu(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function mu(e,t,n){return(mu="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_u(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function bu(e,t){return(bu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function wu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=_u(e);if(t){var i=_u(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ku(this,n)}}function ku(e,t){return!t||"object"!==yu(t)&&"function"!=typeof t?Su(e):t}function Su(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _u(e){return(_u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ou=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&bu(e,t)}(o,e);var t,n,r,i=wu(o);function o(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(e=i.call(this,o.NAME)).pipelineListener=new vu(Su(e)),e}return t=o,(n=[{key:"start",value:function(){return!!mu(_u(o.prototype),"start",this).call(this)&&(this.pipeline.addListener(this.pipelineListener),!0)}},{key:"stop",value:function(){mu(_u(o.prototype),"stop",this).call(this),null!=this.pipeline&&this.pipeline.removeListener(this.pipelineListener)}}])&&gu(t.prototype,n),r&&gu(t,r),o}(we);function Ru(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(Ou,"NAME","Whiteboard");var Eu=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.kernel=new Ye,this.kernel.installPipeline(new xt),this.kernel.installPipeline(new Jt),this.kernel.installModule(new Ke),this.kernel.installModule(new Sr),this.kernel.installModule(new ci),this.kernel.installModule(new Ro),this.kernel.installModule(new Mo),this.kernel.installModule(new uu),this.kernel.installModule(new Ou),this.selectFileHandle=null}var t,n,r;return t=e,(n=[{key:"start",value:function(e,t,n){var r=this,i=t||function(){},o=n||function(){};this.kernel.startup(e,(function(){i(r)}),(function(e){o(e)}))}},{key:"stop",value:function(){this.kernel.shutdown()}},{key:"suspend",value:function(){this.kernel.suspend()}},{key:"resume",value:function(){this.kernel.resume()}},{key:"getMainPipeline",value:function(){return this.kernel.getPipeline(xt.NAME)}},{key:"getModule",value:function(e){return this.kernel.getModule(e)}},{key:"getContactService",value:function(){return this.kernel.getModule(Sr.NAME)}},{key:"getFileStorage",value:function(){return this.kernel.getModule(ci.NAME)}},{key:"getMessagingService",value:function(){return this.kernel.getModule(Ro.NAME)}},{key:"getFileProcessor",value:function(){return this.kernel.getModule(Mo.NAME)}},{key:"getMultipointComm",value:function(){return this.kernel.getModule(uu.NAME)}},{key:"launchFileSelector",value:function(e,t){var n=this;void 0===t&&(t="*.*");var r=document.querySelector("div#_cube_file_selector");if(null==r){(r=document.createElement("div")).setAttribute("id","_cube_file_selector"),r.style.position="absolute",r.style.float="left",r.style.top="0",r.style.zIndex=-99,r.style.visibility="hidden";var i=['<label for="_cube_file_input"></label>','<input type="file" id="_cube_file_input" name="_cube_file_input" accept="',t,'"></input>'];r.innerHTML=i.join(""),document.body.appendChild(r),document.getElementById("_cube_file_input").onchange=function(e){n._onFileInputChanged(e)}}this.selectFileHandle=e;var o=document.getElementById("_cube_file_input");o.setAttribute("accept",t),o.click()}},{key:"_onFileInputChanged",value:function(e){this.selectFileHandle(e)}}])&&Ru(t.prototype,n),r&&Ru(t,r),e}();function xu(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Cu=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.engine=new Eu,this.contact=this.engine.getContactService(),this.fileStorage=this.engine.getFileStorage(),this.messaging=this.engine.getMessagingService(),this.fileProcessor=this.engine.getFileProcessor(),this.mpComm=this.engine.getMultipointComm()}var t,n,r;return t=e,(n=[{key:"start",value:function(e,t,n){void 0===e.pipelineReady&&(e.pipelineReady=!0),this.engine.start(e,t,n)}},{key:"stop",value:function(){this.engine.stop()}},{key:"on",value:function(e,t){"network"!=e&&"pipeline"!=e||this.engine.getMainPipeline().addStateListener(t)}},{key:"signIn",value:function(e,t,n){this.engine.getContactService().signIn(e,t,n)}},{key:"signOut",value:function(){return this.engine.getContactService.signOut()}},{key:"launchFileSelector",value:function(e,t){this.engine.launchFileSelector(e,t)}}])&&xu(t.prototype,n),r&&xu(t,r),e}(),Pu=$a;function Tu(e){return(Tu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Au(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ju(e,t,n){return(ju="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Iu(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Mu(e,t){return(Mu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Nu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Iu(e);if(t){var i=Iu(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Lu(this,n)}}function Lu(e,t){return!t||"object"!==Tu(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Iu(e){return(Iu=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Du=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Mu(e,t)}(i,e);var t,n,r;Nu(i);function i(e,t){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(void 0).invitee=e,(void 0).displayName=t,Lu(void 0)}return t=i,(n=[{key:"toJSON",value:function(){var e=ju(Iu(i.prototype),"toJSON",this).call(this);return e.invitee=this.invitee,e.displayName=this.displayName,e}}])&&Au(t.prototype,n),r&&Au(t,r),i}(d);function Fu(e){return(Fu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Bu(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function zu(e,t,n){return(zu="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ju(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Gu(e,t){return(Gu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Uu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Ju(e);if(t){var i=Ju(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Hu(this,n)}}function Hu(e,t){return!t||"object"!==Fu(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ju(e){return(Ju=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Vu=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Gu(e,t)}(o,e);var t,n,r,i=Uu(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this)).service=e,t.id=0,t.title=null,t.password=null,t.access=null,t.appointmentTime=0,t.estimatedDurationInMinutes=0,t.founder=null,t.presenter=null,t.invitees=new D,t.room=null,t.participants=[],t}return t=o,r=[{key:"create",value:function(e,t){var n=new o(e);return n.id=t.id,n}}],(n=[{key:"getId",value:function(){return this.id}},{key:"getFounder",value:function(){return this.founder}},{key:"getPresenter",value:function(){return this.presenter}},{key:"getRoom",value:function(){return this.room}},{key:"setAppointmentTime",value:function(e){this.appointmentTime=e,this.service.updateAppointment(this)}},{key:"sendOutInvitation",value:function(e,t){this.invitees.put(e,new Du(e,t))}},{key:"join",value:function(){}},{key:"getParticipants",value:function(){return this.participants}},{key:"toJSON",value:function(){var e=zu(Ju(o.prototype),"toJSON",this).call(this);e.id=this.id,e.title=this.title,null!=this.password&&(e.password=this.password),e.founder=this.founder.toCompactJSON(),e.access=this.access,null!=this.presenter&&(e.presenter=this.presenter.toCompactJSON());for(var t=[],n=this.invitees.values(),r=0;r<n.length;++r){var i=n[r];t.push(i.toJSON())}return e.invitees=t,e}},{key:"toCompactJSON",value:function(){return this.toJSON()}}])&&Bu(t.prototype,n),r&&Bu(t,r),o}(st),Wu=0;function qu(e){return(qu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ku(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Zu(e,t){return(Zu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function $u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Xu(e);if(t){var i=Xu(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qu(this,n)}}function Qu(e,t){return!t||"object"!==qu(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Xu(e){return(Xu=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Yu=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Zu(e,t)}(o,e);var t,n,r,i=$u(o);function o(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),i.call(this)}return t=o,(n=[{key:"onReceived",value:function(e,t,n){}}])&&Ku(t.prototype,n),r&&Ku(t,r),o}(M),es="create",ts="Created";function ns(e){return(ns="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function rs(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function is(e,t){return(is=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function os(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=cs(e);if(t){var i=cs(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return as(this,n)}}function as(e,t){return!t||"object"!==ns(t)&&"function"!=typeof t?us(e):t}function us(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ss(e,t,n){return(ss="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=cs(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function cs(e){return(cs=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ls(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&is(e,t)}(o,e);var t,n,r,i=os(o);function o(){var e,t,n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),ss((e=us(n=i.call(this,"Conference")),cs(o.prototype)),"require",e).call(e,Sr.NAME),ss((t=us(n),cs(o.prototype)),"require",t).call(t,uu.NAME),n.confs=[],n.pipelineListener=new Yu,n.contact=null,n.mpcomm=null,n}return t=o,(n=[{key:"start",value:function(){return!!ss(cs(o.prototype),"start",this).call(this)&&(this.contact=this.kernel.getModule(Sr.NAME),this.mpcomm=this.kernel.getModule(uu.NAME),this.pipeline.addListener(o.NAME,this.pipelineListener),!0)}},{key:"stop",value:function(){ss(cs(o.prototype),"stop",this).call(this),null!=this.pipeline&&this.pipeline.removeListener(o.NAME,this.pipelineListener)}},{key:"createConference",value:function(e,t,n,r){var i=this,u=new y(es,{title:e,password:null==t?"":t,founder:this.contact.getSelf().toCompactJSON()});this.pipeline.send(o.NAME,u,(function(t,o,u){if(null!=u)if(u.getStateCode()==Te)if(u.data.code==Wu){var s=Vu.create(i,u.data.data);n&&n(s),i.notifyObservers(new a(ts,s))}else r&&r(e);else r&&r(e);else r&&r(e)}))}},{key:"updateAppointment",value:function(e){}}])&&rs(t.prototype,n),r&&rs(t,r),o}(we),"NAME","Conference");var fs,hs=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.count=0,this.total=t,this.timeout=n,this.timer=setTimeout((function(e){clearTimeout(r.timer),r._fireTimeout()}),n),this.announceDataMap=new D,this.audienceList=[]}var t,n,r;return t=e,(n=[{key:"getTotal",value:function(){return this.total}},{key:"announce",value:function(e,t){var n=this;void 0!==e&&(void 0===t&&(t=e),this.announceDataMap.containsKey(e)?this.announceDataMap.put(e,t):(this.announceDataMap.put(e,t),++this.count,this.count==this.total&&(clearTimeout(this.timer),new Promise((function(e,t){e()})).then((function(){for(var e=0;e<n.audienceList.length;++e)(0,n.audienceList[e])(n.count,n.announceDataMap)})))))}},{key:"addAudience",value:function(e){this.audienceList.indexOf(e)>=0||this.audienceList.push(e)}},{key:"_fireTimeout",value:function(){for(var e=0;e<this.audienceList.length;++e)(0,this.audienceList[e])(this.count,this.announceDataMap)}}])&&ls(t.prototype,n),r&&ls(t,r),e}();(fs=window).Subject=h,fs.Observer=s,fs.ObservableState=a,fs.JSONable=d,fs.Entity=st,fs.CubeEngine=Eu,fs.Kernel=Ye,fs.Plugin=G,fs.CellPipeline=xt,fs.AuthToken=pe,fs.AuthService=Ke,fs.PrimaryDescription=oe,fs.ContactService=Sr,fs.ContactEvent=qn,fs.Contact=Fn,fs.Self=Wn,fs.Group=ir,fs.GroupState=$n,fs.MessagingService=Ro,fs.MessagingEvent=Ki,fs.Message=Mi,fs.MessageState=li,fs.MessagePlugin=yo,fs.FileStorage=ci,fs.FileAnchor=Tr,fs.FileLabel=Fr,fs.FileAttachment=Ri,fs.FileStorageEvent=Br,fs.FileProcessor=Mo,fs.FileThumbnail=gi,fs.MultipointComm=uu,fs.VideoDimension=la,fs.MediaConstraint=ma,fs.MultipointCommEvent=$a,fs.CallRecord=Xa,fs.CallEvent=Pu,fs.Announcer=hs,fs.cell=i.a,fs._cube_=null,fs.cube=function(){return void 0!==fs._cube_&&null!=fs._cube_||(fs._cube_=new Cu),fs._cube_}}]);
//# sourceMappingURL=cube-3.0.0.js.map