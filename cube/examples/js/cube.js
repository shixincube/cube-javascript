!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=195)}([function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function a(e){var t="function"==typeof Map?new Map:void 0;return(a=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return u(e,arguments,l(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),s(r,e)})(e)}function u(e,t,n){return(u=c()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&s(i,n.prototype),i}).apply(null,arguments)}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}n.d(t,"a",(function(){return f}));var f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(h,e);var t,n,r,a,u,f=(t=h,n=c(),function(){var e,r=l(t);if(n){var i=l(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return o(this,e)});function h(e,t,n,r){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),(i=f.call(this)).module=e,i.code=t,i.data=void 0!==n?n:null,i.desc=void 0!==r?r:null,i}return r=h,(a=[{key:"toString",value:function(){return"ModuleError ["+this.module+"] : "+this.code+(this.desc?" - "+this.desc.toString():"")}}])&&i(r.prototype,a),u&&i(r,u),h}(a(Error))},function(e,t,n){(function(e){var n,r,i,o;function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}window,o=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==a(e)&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=16)}([function(e,t,n){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=a(n))throw new TypeError(n+"must be non-object");for(var r in n)i(n,r)&&(e[r]=n[r])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var o={arraySet:function(e,t,n,r,i){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+r),i);else for(var o=0;o<r;o++)e[i+o]=t[n+o]},flattenChunks:function(e){var t,n,r,i,o,a;for(r=0,t=0,n=e.length;t<n;t++)r+=e[t].length;for(a=new Uint8Array(r),i=0,t=0,n=e.length;t<n;t++)o=e[t],a.set(o,i),i+=o.length;return a}},u={arraySet:function(e,t,n,r,i){for(var o=0;o<r;o++)e[i+o]=t[n+o]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,o)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,u))},t.setTyped(r)},function(e,t,n){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t,n){"use strict";var r={};(0,n(0).assign)(r,n(8),n(11),n(7)),e.exports=r},function(e,t,n){"use strict";e.exports=function(e,t,n,r){for(var i=65535&e|0,o=e>>>16&65535|0,a=0;0!==n;){n-=a=n>2e3?2e3:n;do{o=o+(i=i+t[r++]|0)|0}while(--a);i%=65521,o%=65521}return i|o<<16|0}},function(e,t,n){"use strict";var r=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();e.exports=function(e,t,n,i){var o=r,a=i+n;e^=-1;for(var u=i;u<a;u++)e=e>>>8^o[255&(e^t[u])];return-1^e}},function(e,t,n){"use strict";var r=n(0),i=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(e){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){o=!1}for(var a=new r.Buf8(256),u=0;u<256;u++)a[u]=u>=252?6:u>=248?5:u>=240?4:u>=224?3:u>=192?2:1;function c(e,t){if(t<65534&&(e.subarray&&o||!e.subarray&&i))return String.fromCharCode.apply(null,r.shrinkBuf(e,t));for(var n="",a=0;a<t;a++)n+=String.fromCharCode(e[a]);return n}a[254]=a[254]=1,t.string2buf=function(e){var t,n,i,o,a,u=e.length,c=0;for(o=0;o<u;o++)55296==(64512&(n=e.charCodeAt(o)))&&o+1<u&&56320==(64512&(i=e.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),c+=n<128?1:n<2048?2:n<65536?3:4;for(t=new r.Buf8(c),a=0,o=0;a<c;o++)55296==(64512&(n=e.charCodeAt(o)))&&o+1<u&&56320==(64512&(i=e.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|63&n):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},t.buf2binstring=function(e){return c(e,e.length)},t.binstring2buf=function(e){for(var t=new r.Buf8(e.length),n=0,i=t.length;n<i;n++)t[n]=e.charCodeAt(n);return t},t.buf2string=function(e,t){var n,r,i,o,u=t||e.length,s=new Array(2*u);for(r=0,n=0;n<u;)if((i=e[n++])<128)s[r++]=i;else if((o=a[i])>4)s[r++]=65533,n+=o-1;else{for(i&=2===o?31:3===o?15:7;o>1&&n<u;)i=i<<6|63&e[n++],o--;o>1?s[r++]=65533:i<65536?s[r++]=i:(i-=65536,s[r++]=55296|i>>10&1023,s[r++]=56320|1023&i)}return c(s,r)},t.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+a[e[n]]>t?n:t}},function(e,t,n){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t,n){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t,n){"use strict";var r=n(9),i=n(0),o=n(5),a=n(1),u=n(6),c=Object.prototype.toString;function s(e){if(!(this instanceof s))return new s(e);this.options=i.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var n=r.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(0!==n)throw new Error(a[n]);if(t.header&&r.deflateSetHeader(this.strm,t.header),t.dictionary){var l;if(l="string"==typeof t.dictionary?o.string2buf(t.dictionary):"[object ArrayBuffer]"===c.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,0!==(n=r.deflateSetDictionary(this.strm,l)))throw new Error(a[n]);this._dict_set=!0}}function l(e,t){var n=new s(t);if(n.push(e,!0),n.err)throw n.msg||a[n.err];return n.result}s.prototype.push=function(e,t){var n,a,u=this.strm,s=this.options.chunkSize;if(this.ended)return!1;a=t===~~t?t:!0===t?4:0,"string"==typeof e?u.input=o.string2buf(e):"[object ArrayBuffer]"===c.call(e)?u.input=new Uint8Array(e):u.input=e,u.next_in=0,u.avail_in=u.input.length;do{if(0===u.avail_out&&(u.output=new i.Buf8(s),u.next_out=0,u.avail_out=s),1!==(n=r.deflate(u,a))&&0!==n)return this.onEnd(n),this.ended=!0,!1;0!==u.avail_out&&(0!==u.avail_in||4!==a&&2!==a)||("string"===this.options.to?this.onData(o.buf2binstring(i.shrinkBuf(u.output,u.next_out))):this.onData(i.shrinkBuf(u.output,u.next_out)))}while((u.avail_in>0||0===u.avail_out)&&1!==n);return 4===a?(n=r.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,0===n):2!==a||(this.onEnd(0),u.avail_out=0,!0)},s.prototype.onData=function(e){this.chunks.push(e)},s.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Deflate=s,t.deflate=l,t.deflateRaw=function(e,t){return(t=t||{}).raw=!0,l(e,t)},t.gzip=function(e,t){return(t=t||{}).gzip=!0,l(e,t)}},function(e,t,n){"use strict";var r,i=n(0),o=n(10),a=n(3),u=n(4),c=n(1);function s(e,t){return e.msg=c[t],t}function l(e){return(e<<1)-(e>4?9:0)}function f(e){for(var t=e.length;--t>=0;)e[t]=0}function h(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(i.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function p(e,t){o._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,h(e.strm)}function d(e,t){e.pending_buf[e.pending++]=t}function v(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function y(e,t){var n,r,i=e.max_chain_length,o=e.strstart,a=e.prev_length,u=e.nice_match,c=e.strstart>e.w_size-262?e.strstart-(e.w_size-262):0,s=e.window,l=e.w_mask,f=e.prev,h=e.strstart+258,p=s[o+a-1],d=s[o+a];e.prev_length>=e.good_match&&(i>>=2),u>e.lookahead&&(u=e.lookahead);do{if(s[(n=t)+a]===d&&s[n+a-1]===p&&s[n]===s[o]&&s[++n]===s[o+1]){o+=2,n++;do{}while(s[++o]===s[++n]&&s[++o]===s[++n]&&s[++o]===s[++n]&&s[++o]===s[++n]&&s[++o]===s[++n]&&s[++o]===s[++n]&&s[++o]===s[++n]&&s[++o]===s[++n]&&o<h);if(r=258-(h-o),o=h-258,r>a){if(e.match_start=t,a=r,r>=u)break;p=s[o+a-1],d=s[o+a]}}}while((t=f[t&l])>c&&0!=--i);return a<=e.lookahead?a:e.lookahead}function g(e){var t,n,r,o,c,s,l,f,h,p,d=e.w_size;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=d+(d-262)){i.arraySet(e.window,e.window,d,d,0),e.match_start-=d,e.strstart-=d,e.block_start-=d,t=n=e.hash_size;do{r=e.head[--t],e.head[t]=r>=d?r-d:0}while(--n);t=n=d;do{r=e.prev[--t],e.prev[t]=r>=d?r-d:0}while(--n);o+=d}if(0===e.strm.avail_in)break;if(s=e.strm,l=e.window,f=e.strstart+e.lookahead,h=o,p=void 0,(p=s.avail_in)>h&&(p=h),n=0===p?0:(s.avail_in-=p,i.arraySet(l,s.input,s.next_in,p,f),1===s.state.wrap?s.adler=a(s.adler,l,p,f):2===s.state.wrap&&(s.adler=u(s.adler,l,p,f)),s.next_in+=p,s.total_in+=p,p),e.lookahead+=n,e.lookahead+e.insert>=3)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=(e.ins_h<<e.hash_shift^e.window[c+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[c+3-1])&e.hash_mask,e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<262&&0!==e.strm.avail_in)}function m(e,t){for(var n,r;;){if(e.lookahead<262){if(g(e),e.lookahead<262&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-262&&(e.match_length=y(e,n)),e.match_length>=3)if(r=o._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(p(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(p(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(p(e,!1),0===e.strm.avail_out)?1:2}function b(e,t){for(var n,r,i;;){if(e.lookahead<262){if(g(e),e.lookahead<262&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-262&&(e.match_length=y(e,n),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=o._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(p(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((r=o._tr_tally(e,0,e.window[e.strstart-1]))&&p(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=o._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(p(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(p(e,!1),0===e.strm.avail_out)?1:2}function w(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}function k(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(1146),this.dyn_dtree=new i.Buf16(122),this.bl_tree=new i.Buf16(78),f(this.dyn_ltree),f(this.dyn_dtree),f(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(16),this.heap=new i.Buf16(573),f(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(573),f(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function S(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:113,e.adler=2===t.wrap?0:1,t.last_flush=0,o._tr_init(t),0):s(e,-2)}function O(e){var t,n=S(e);return 0===n&&((t=e.state).window_size=2*t.w_size,f(t.head),t.max_lazy_match=r[t.level].max_lazy,t.good_match=r[t.level].good_length,t.nice_match=r[t.level].nice_length,t.max_chain_length=r[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),n}function _(e,t,n,r,o,a){if(!e)return-2;var u=1;if(-1===t&&(t=6),r<0?(u=0,r=-r):r>15&&(u=2,r-=16),o<1||o>9||8!==n||r<8||r>15||t<0||t>9||a<0||a>4)return s(e,-2);8===r&&(r=9);var c=new k;return e.state=c,c.strm=e,c.wrap=u,c.gzhead=null,c.w_bits=r,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=o+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+3-1)/3),c.window=new i.Buf8(2*c.w_size),c.head=new i.Buf16(c.hash_size),c.prev=new i.Buf16(c.w_size),c.lit_bufsize=1<<o+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new i.Buf8(c.pending_buf_size),c.d_buf=1*c.lit_bufsize,c.l_buf=3*c.lit_bufsize,c.level=t,c.strategy=a,c.method=n,O(e)}r=[new w(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(g(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,p(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-262&&(p(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(p(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(p(e,!1),e.strm.avail_out),1)})),new w(4,4,8,4,m),new w(4,5,16,8,m),new w(4,6,32,32,m),new w(4,4,16,16,b),new w(8,16,32,32,b),new w(8,16,128,128,b),new w(8,32,128,256,b),new w(32,128,258,1024,b),new w(32,258,258,4096,b)],t.deflateInit=function(e,t){return _(e,t,8,15,8,0)},t.deflateInit2=_,t.deflateReset=O,t.deflateResetKeep=S,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?-2:(e.state.gzhead=t,0):-2},t.deflate=function(e,t){var n,i,a,c;if(!e||!e.state||t>5||t<0)return e?s(e,-2):-2;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||666===i.status&&4!==t)return s(e,0===e.avail_out?-5:-2);if(i.strm=e,n=i.last_flush,i.last_flush=t,42===i.status)if(2===i.wrap)e.adler=0,d(i,31),d(i,139),d(i,8),i.gzhead?(d(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),d(i,255&i.gzhead.time),d(i,i.gzhead.time>>8&255),d(i,i.gzhead.time>>16&255),d(i,i.gzhead.time>>24&255),d(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),d(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(d(i,255&i.gzhead.extra.length),d(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=u(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(d(i,0),d(i,0),d(i,0),d(i,0),d(i,0),d(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),d(i,3),i.status=113);else{var y=8+(i.w_bits-8<<4)<<8;y|=(i.strategy>=2||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(y|=32),y+=31-y%31,i.status=113,v(i,y),0!==i.strstart&&(v(i,e.adler>>>16),v(i,65535&e.adler)),e.adler=1}if(69===i.status)if(i.gzhead.extra){for(a=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>a&&(e.adler=u(e.adler,i.pending_buf,i.pending-a,a)),h(e),a=i.pending,i.pending!==i.pending_buf_size));)d(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>a&&(e.adler=u(e.adler,i.pending_buf,i.pending-a,a)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(e.adler=u(e.adler,i.pending_buf,i.pending-a,a)),h(e),a=i.pending,i.pending===i.pending_buf_size)){c=1;break}c=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,d(i,c)}while(0!==c);i.gzhead.hcrc&&i.pending>a&&(e.adler=u(e.adler,i.pending_buf,i.pending-a,a)),0===c&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(e.adler=u(e.adler,i.pending_buf,i.pending-a,a)),h(e),a=i.pending,i.pending===i.pending_buf_size)){c=1;break}c=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,d(i,c)}while(0!==c);i.gzhead.hcrc&&i.pending>a&&(e.adler=u(e.adler,i.pending_buf,i.pending-a,a)),0===c&&(i.status=103)}else i.status=103;if(103===i.status&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&h(e),i.pending+2<=i.pending_buf_size&&(d(i,255&e.adler),d(i,e.adler>>8&255),e.adler=0,i.status=113)):i.status=113),0!==i.pending){if(h(e),0===e.avail_out)return i.last_flush=-1,0}else if(0===e.avail_in&&l(t)<=l(n)&&4!==t)return s(e,-5);if(666===i.status&&0!==e.avail_in)return s(e,-5);if(0!==e.avail_in||0!==i.lookahead||0!==t&&666!==i.status){var m=2===i.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(g(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,n=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(p(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(p(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(p(e,!1),0===e.strm.avail_out)?1:2}(i,t):3===i.strategy?function(e,t){for(var n,r,i,a,u=e.window;;){if(e.lookahead<=258){if(g(e),e.lookahead<=258&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(r=u[i=e.strstart-1])===u[++i]&&r===u[++i]&&r===u[++i]){a=e.strstart+258;do{}while(r===u[++i]&&r===u[++i]&&r===u[++i]&&r===u[++i]&&r===u[++i]&&r===u[++i]&&r===u[++i]&&r===u[++i]&&i<a);e.match_length=258-(a-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=o._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(p(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(p(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(p(e,!1),0===e.strm.avail_out)?1:2}(i,t):r[i.level].func(i,t);if(3!==m&&4!==m||(i.status=666),1===m||3===m)return 0===e.avail_out&&(i.last_flush=-1),0;if(2===m&&(1===t?o._tr_align(i):5!==t&&(o._tr_stored_block(i,0,0,!1),3===t&&(f(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),h(e),0===e.avail_out))return i.last_flush=-1,0}return 4!==t?0:i.wrap<=0?1:(2===i.wrap?(d(i,255&e.adler),d(i,e.adler>>8&255),d(i,e.adler>>16&255),d(i,e.adler>>24&255),d(i,255&e.total_in),d(i,e.total_in>>8&255),d(i,e.total_in>>16&255),d(i,e.total_in>>24&255)):(v(i,e.adler>>>16),v(i,65535&e.adler)),h(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?0:1)},t.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&103!==t&&113!==t&&666!==t?s(e,-2):(e.state=null,113===t?s(e,-3):0):-2},t.deflateSetDictionary=function(e,t){var n,r,o,u,c,s,l,h,p=t.length;if(!e||!e.state)return-2;if(2===(u=(n=e.state).wrap)||1===u&&42!==n.status||n.lookahead)return-2;for(1===u&&(e.adler=a(e.adler,t,p,0)),n.wrap=0,p>=n.w_size&&(0===u&&(f(n.head),n.strstart=0,n.block_start=0,n.insert=0),h=new i.Buf8(n.w_size),i.arraySet(h,t,p-n.w_size,n.w_size,0),t=h,p=n.w_size),c=e.avail_in,s=e.next_in,l=e.input,e.avail_in=p,e.next_in=0,e.input=t,g(n);n.lookahead>=3;){r=n.strstart,o=n.lookahead-2;do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+3-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++}while(--o);n.strstart=r,n.lookahead=2,g(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=s,e.input=l,e.avail_in=c,n.wrap=u,0},t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t,n){"use strict";var r=n(0);function i(e){for(var t=e.length;--t>=0;)e[t]=0}var o=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],a=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],c=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],s=new Array(576);i(s);var l=new Array(60);i(l);var f=new Array(512);i(f);var h=new Array(256);i(h);var p=new Array(29);i(p);var d,v,y,g=new Array(30);function m(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}function b(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function w(e){return e<256?f[e]:f[256+(e>>>7)]}function k(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function S(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,k(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function O(e,t,n){S(e,n[2*t],n[2*t+1])}function _(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function C(e,t,n){var r,i,o=new Array(16),a=0;for(r=1;r<=15;r++)o[r]=a=a+n[r-1]<<1;for(i=0;i<=t;i++){var u=e[2*i+1];0!==u&&(e[2*i]=_(o[u]++,u))}}function E(e){var t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function R(e){e.bi_valid>8?k(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function x(e,t,n,r){var i=2*t,o=2*n;return e[i]<e[o]||e[i]===e[o]&&r[t]<=r[n]}function P(e,t,n){for(var r=e.heap[n],i=n<<1;i<=e.heap_len&&(i<e.heap_len&&x(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!x(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r}function T(e,t,n){var r,i,u,c,s=0;if(0!==e.last_lit)do{r=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],i=e.pending_buf[e.l_buf+s],s++,0===r?O(e,i,t):(O(e,(u=h[i])+256+1,t),0!==(c=o[u])&&S(e,i-=p[u],c),O(e,u=w(--r),n),0!==(c=a[u])&&S(e,r-=g[u],c))}while(s<e.last_lit);O(e,256,t)}function M(e,t){var n,r,i,o=t.dyn_tree,a=t.stat_desc.static_tree,u=t.stat_desc.has_stree,c=t.stat_desc.elems,s=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<c;n++)0!==o[2*n]?(e.heap[++e.heap_len]=s=n,e.depth[n]=0):o[2*n+1]=0;for(;e.heap_len<2;)o[2*(i=e.heap[++e.heap_len]=s<2?++s:0)]=1,e.depth[i]=0,e.opt_len--,u&&(e.static_len-=a[2*i+1]);for(t.max_code=s,n=e.heap_len>>1;n>=1;n--)P(e,o,n);i=c;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],P(e,o,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,o[2*i]=o[2*n]+o[2*r],e.depth[i]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,o[2*n+1]=o[2*r+1]=i,e.heap[1]=i++,P(e,o,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,r,i,o,a,u,c=t.dyn_tree,s=t.max_code,l=t.stat_desc.static_tree,f=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,d=t.stat_desc.max_length,v=0;for(o=0;o<=15;o++)e.bl_count[o]=0;for(c[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(o=c[2*c[2*(r=e.heap[n])+1]+1]+1)>d&&(o=d,v++),c[2*r+1]=o,r>s||(e.bl_count[o]++,a=0,r>=p&&(a=h[r-p]),u=c[2*r],e.opt_len+=u*(o+a),f&&(e.static_len+=u*(l[2*r+1]+a)));if(0!==v){do{for(o=d-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[d]--,v-=2}while(v>0);for(o=d;0!==o;o--)for(r=e.bl_count[o];0!==r;)(i=e.heap[--n])>s||(c[2*i+1]!==o&&(e.opt_len+=(o-c[2*i+1])*c[2*i],c[2*i+1]=o),r--)}}(e,t),C(o,s,e.bl_count)}function A(e,t,n){var r,i,o=-1,a=t[1],u=0,c=7,s=4;for(0===a&&(c=138,s=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=a,a=t[2*(r+1)+1],++u<c&&i===a||(u<s?e.bl_tree[2*i]+=u:0!==i?(i!==o&&e.bl_tree[2*i]++,e.bl_tree[32]++):u<=10?e.bl_tree[34]++:e.bl_tree[36]++,u=0,o=i,0===a?(c=138,s=3):i===a?(c=6,s=3):(c=7,s=4))}function N(e,t,n){var r,i,o=-1,a=t[1],u=0,c=7,s=4;for(0===a&&(c=138,s=3),r=0;r<=n;r++)if(i=a,a=t[2*(r+1)+1],!(++u<c&&i===a)){if(u<s)do{O(e,i,e.bl_tree)}while(0!=--u);else 0!==i?(i!==o&&(O(e,i,e.bl_tree),u--),O(e,16,e.bl_tree),S(e,u-3,2)):u<=10?(O(e,17,e.bl_tree),S(e,u-3,3)):(O(e,18,e.bl_tree),S(e,u-11,7));u=0,o=i,0===a?(c=138,s=3):i===a?(c=6,s=3):(c=7,s=4)}}i(g);var j=!1;function I(e,t,n,i){S(e,0+(i?1:0),3),function(e,t,n,i){R(e),k(e,n),k(e,~n),r.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n)}t._tr_init=function(e){j||(function(){var e,t,n,r,i,c=new Array(16);for(n=0,r=0;r<28;r++)for(p[r]=n,e=0;e<1<<o[r];e++)h[n++]=r;for(h[n-1]=r,i=0,r=0;r<16;r++)for(g[r]=i,e=0;e<1<<a[r];e++)f[i++]=r;for(i>>=7;r<30;r++)for(g[r]=i<<7,e=0;e<1<<a[r]-7;e++)f[256+i++]=r;for(t=0;t<=15;t++)c[t]=0;for(e=0;e<=143;)s[2*e+1]=8,e++,c[8]++;for(;e<=255;)s[2*e+1]=9,e++,c[9]++;for(;e<=279;)s[2*e+1]=7,e++,c[7]++;for(;e<=287;)s[2*e+1]=8,e++,c[8]++;for(C(s,287,c),e=0;e<30;e++)l[2*e+1]=5,l[2*e]=_(e,5);d=new m(s,o,257,286,15),v=new m(l,a,0,30,15),y=new m(new Array(0),u,0,19,7)}(),j=!0),e.l_desc=new b(e.dyn_ltree,d),e.d_desc=new b(e.dyn_dtree,v),e.bl_desc=new b(e.bl_tree,y),e.bi_buf=0,e.bi_valid=0,E(e)},t._tr_stored_block=I,t._tr_flush_block=function(e,t,n,r){var i,o,a=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),M(e,e.l_desc),M(e,e.d_desc),a=function(e){var t;for(A(e,e.dyn_ltree,e.l_desc.max_code),A(e,e.dyn_dtree,e.d_desc.max_code),M(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*c[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(o=e.static_len+3+7>>>3)<=i&&(i=o)):i=o=n+5,n+4<=i&&-1!==t?I(e,t,n,r):4===e.strategy||o===i?(S(e,2+(r?1:0),3),T(e,s,l)):(S(e,4+(r?1:0),3),function(e,t,n,r){var i;for(S(e,t-257,5),S(e,n-1,5),S(e,r-4,4),i=0;i<r;i++)S(e,e.bl_tree[2*c[i]+1],3);N(e,e.dyn_ltree,t-1),N(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),T(e,e.dyn_ltree,e.dyn_dtree)),E(e),r&&R(e)},t._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(h[n]+256+1)]++,e.dyn_dtree[2*w(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){S(e,2,3),O(e,256,s),function(e){16===e.bi_valid?(k(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},function(e,t,n){"use strict";var r=n(12),i=n(0),o=n(5),a=n(7),u=n(1),c=n(6),s=n(15),l=Object.prototype.toString;function f(e){if(!(this instanceof f))return new f(e);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var n=r.inflateInit2(this.strm,t.windowBits);if(n!==a.Z_OK)throw new Error(u[n]);if(this.header=new s,r.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=o.string2buf(t.dictionary):"[object ArrayBuffer]"===l.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=r.inflateSetDictionary(this.strm,t.dictionary))!==a.Z_OK))throw new Error(u[n])}function h(e,t){var n=new f(t);if(n.push(e,!0),n.err)throw n.msg||u[n.err];return n.result}f.prototype.push=function(e,t){var n,u,c,s,f,h=this.strm,p=this.options.chunkSize,d=this.options.dictionary,v=!1;if(this.ended)return!1;u=t===~~t?t:!0===t?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof e?h.input=o.binstring2buf(e):"[object ArrayBuffer]"===l.call(e)?h.input=new Uint8Array(e):h.input=e,h.next_in=0,h.avail_in=h.input.length;do{if(0===h.avail_out&&(h.output=new i.Buf8(p),h.next_out=0,h.avail_out=p),(n=r.inflate(h,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&d&&(n=r.inflateSetDictionary(this.strm,d)),n===a.Z_BUF_ERROR&&!0===v&&(n=a.Z_OK,v=!1),n!==a.Z_STREAM_END&&n!==a.Z_OK)return this.onEnd(n),this.ended=!0,!1;h.next_out&&(0!==h.avail_out&&n!==a.Z_STREAM_END&&(0!==h.avail_in||u!==a.Z_FINISH&&u!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(c=o.utf8border(h.output,h.next_out),s=h.next_out-c,f=o.buf2string(h.output,c),h.next_out=s,h.avail_out=p-s,s&&i.arraySet(h.output,h.output,c,s,0),this.onData(f)):this.onData(i.shrinkBuf(h.output,h.next_out)))),0===h.avail_in&&0===h.avail_out&&(v=!0)}while((h.avail_in>0||0===h.avail_out)&&n!==a.Z_STREAM_END);return n===a.Z_STREAM_END&&(u=a.Z_FINISH),u===a.Z_FINISH?(n=r.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===a.Z_OK):u!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),h.avail_out=0,!0)},f.prototype.onData=function(e){this.chunks.push(e)},f.prototype.onEnd=function(e){e===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Inflate=f,t.inflate=h,t.inflateRaw=function(e,t){return(t=t||{}).raw=!0,h(e,t)},t.ungzip=h},function(e,t,n){"use strict";var r=n(0),i=n(3),o=n(4),a=n(13),u=n(14);function c(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function s(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function l(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new r.Buf32(852),t.distcode=t.distdyn=new r.Buf32(592),t.sane=1,t.back=-1,0):-2}function f(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,l(e)):-2}function h(e,t){var n,r;return e&&e.state?(r=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?-2:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,f(e))):-2}function p(e,t){var n,r;return e?(r=new s,e.state=r,r.window=null,0!==(n=h(e,t))&&(e.state=null),n):-2}var d,v,y=!0;function g(e){if(y){var t;for(d=new r.Buf32(512),v=new r.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(u(1,e.lens,0,288,d,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;u(2,e.lens,0,32,v,0,e.work,{bits:5}),y=!1}e.lencode=d,e.lenbits=9,e.distcode=v,e.distbits=5}function m(e,t,n,i){var o,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new r.Buf8(a.wsize)),i>=a.wsize?(r.arraySet(a.window,t,n-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((o=a.wsize-a.wnext)>i&&(o=i),r.arraySet(a.window,t,n-i,o,a.wnext),(i-=o)?(r.arraySet(a.window,t,n-i,i,0),a.wnext=i,a.whave=a.wsize):(a.wnext+=o,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=o))),0}t.inflateReset=f,t.inflateReset2=h,t.inflateResetKeep=l,t.inflateInit=function(e){return p(e,15)},t.inflateInit2=p,t.inflate=function(e,t){var n,s,l,f,h,p,d,v,y,b,w,k,S,O,_,C,E,R,x,P,T,M,A,N,j=0,I=new r.Buf8(4),L=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return-2;12===(n=e.state).mode&&(n.mode=13),h=e.next_out,l=e.output,d=e.avail_out,f=e.next_in,s=e.input,p=e.avail_in,v=n.hold,y=n.bits,b=p,w=d,M=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;y<16;){if(0===p)break e;p--,v+=s[f++]<<y,y+=8}if(2&n.wrap&&35615===v){n.check=0,I[0]=255&v,I[1]=v>>>8&255,n.check=o(n.check,I,2,0),v=0,y=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&v)<<8)+(v>>8))%31){e.msg="incorrect header check",n.mode=30;break}if(8!=(15&v)){e.msg="unknown compression method",n.mode=30;break}if(y-=4,T=8+(15&(v>>>=4)),0===n.wbits)n.wbits=T;else if(T>n.wbits){e.msg="invalid window size",n.mode=30;break}n.dmax=1<<T,e.adler=n.check=1,n.mode=512&v?10:12,v=0,y=0;break;case 2:for(;y<16;){if(0===p)break e;p--,v+=s[f++]<<y,y+=8}if(n.flags=v,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=v>>8&1),512&n.flags&&(I[0]=255&v,I[1]=v>>>8&255,n.check=o(n.check,I,2,0)),v=0,y=0,n.mode=3;case 3:for(;y<32;){if(0===p)break e;p--,v+=s[f++]<<y,y+=8}n.head&&(n.head.time=v),512&n.flags&&(I[0]=255&v,I[1]=v>>>8&255,I[2]=v>>>16&255,I[3]=v>>>24&255,n.check=o(n.check,I,4,0)),v=0,y=0,n.mode=4;case 4:for(;y<16;){if(0===p)break e;p--,v+=s[f++]<<y,y+=8}n.head&&(n.head.xflags=255&v,n.head.os=v>>8),512&n.flags&&(I[0]=255&v,I[1]=v>>>8&255,n.check=o(n.check,I,2,0)),v=0,y=0,n.mode=5;case 5:if(1024&n.flags){for(;y<16;){if(0===p)break e;p--,v+=s[f++]<<y,y+=8}n.length=v,n.head&&(n.head.extra_len=v),512&n.flags&&(I[0]=255&v,I[1]=v>>>8&255,n.check=o(n.check,I,2,0)),v=0,y=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((k=n.length)>p&&(k=p),k&&(n.head&&(T=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),r.arraySet(n.head.extra,s,f,k,T)),512&n.flags&&(n.check=o(n.check,s,k,f)),p-=k,f+=k,n.length-=k),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===p)break e;k=0;do{T=s[f+k++],n.head&&T&&n.length<65536&&(n.head.name+=String.fromCharCode(T))}while(T&&k<p);if(512&n.flags&&(n.check=o(n.check,s,k,f)),p-=k,f+=k,T)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===p)break e;k=0;do{T=s[f+k++],n.head&&T&&n.length<65536&&(n.head.comment+=String.fromCharCode(T))}while(T&&k<p);if(512&n.flags&&(n.check=o(n.check,s,k,f)),p-=k,f+=k,T)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;y<16;){if(0===p)break e;p--,v+=s[f++]<<y,y+=8}if(v!==(65535&n.check)){e.msg="header crc mismatch",n.mode=30;break}v=0,y=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=12;break;case 10:for(;y<32;){if(0===p)break e;p--,v+=s[f++]<<y,y+=8}e.adler=n.check=c(v),v=0,y=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=h,e.avail_out=d,e.next_in=f,e.avail_in=p,n.hold=v,n.bits=y,2;e.adler=n.check=1,n.mode=12;case 12:if(5===t||6===t)break e;case 13:if(n.last){v>>>=7&y,y-=7&y,n.mode=27;break}for(;y<3;){if(0===p)break e;p--,v+=s[f++]<<y,y+=8}switch(n.last=1&v,y-=1,3&(v>>>=1)){case 0:n.mode=14;break;case 1:if(g(n),n.mode=20,6===t){v>>>=2,y-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=30}v>>>=2,y-=2;break;case 14:for(v>>>=7&y,y-=7&y;y<32;){if(0===p)break e;p--,v+=s[f++]<<y,y+=8}if((65535&v)!=(v>>>16^65535)){e.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&v,v=0,y=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(k=n.length){if(k>p&&(k=p),k>d&&(k=d),0===k)break e;r.arraySet(l,s,f,k,h),p-=k,f+=k,d-=k,h+=k,n.length-=k;break}n.mode=12;break;case 17:for(;y<14;){if(0===p)break e;p--,v+=s[f++]<<y,y+=8}if(n.nlen=257+(31&v),v>>>=5,y-=5,n.ndist=1+(31&v),v>>>=5,y-=5,n.ncode=4+(15&v),v>>>=4,y-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;y<3;){if(0===p)break e;p--,v+=s[f++]<<y,y+=8}n.lens[L[n.have++]]=7&v,v>>>=3,y-=3}for(;n.have<19;)n.lens[L[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,A={bits:n.lenbits},M=u(0,n.lens,0,19,n.lencode,0,n.work,A),n.lenbits=A.bits,M){e.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;C=(j=n.lencode[v&(1<<n.lenbits)-1])>>>16&255,E=65535&j,!((_=j>>>24)<=y);){if(0===p)break e;p--,v+=s[f++]<<y,y+=8}if(E<16)v>>>=_,y-=_,n.lens[n.have++]=E;else{if(16===E){for(N=_+2;y<N;){if(0===p)break e;p--,v+=s[f++]<<y,y+=8}if(v>>>=_,y-=_,0===n.have){e.msg="invalid bit length repeat",n.mode=30;break}T=n.lens[n.have-1],k=3+(3&v),v>>>=2,y-=2}else if(17===E){for(N=_+3;y<N;){if(0===p)break e;p--,v+=s[f++]<<y,y+=8}y-=_,T=0,k=3+(7&(v>>>=_)),v>>>=3,y-=3}else{for(N=_+7;y<N;){if(0===p)break e;p--,v+=s[f++]<<y,y+=8}y-=_,T=0,k=11+(127&(v>>>=_)),v>>>=7,y-=7}if(n.have+k>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=30;break}for(;k--;)n.lens[n.have++]=T}}if(30===n.mode)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,A={bits:n.lenbits},M=u(1,n.lens,0,n.nlen,n.lencode,0,n.work,A),n.lenbits=A.bits,M){e.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,A={bits:n.distbits},M=u(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,A),n.distbits=A.bits,M){e.msg="invalid distances set",n.mode=30;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(p>=6&&d>=258){e.next_out=h,e.avail_out=d,e.next_in=f,e.avail_in=p,n.hold=v,n.bits=y,a(e,w),h=e.next_out,l=e.output,d=e.avail_out,f=e.next_in,s=e.input,p=e.avail_in,v=n.hold,y=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;C=(j=n.lencode[v&(1<<n.lenbits)-1])>>>16&255,E=65535&j,!((_=j>>>24)<=y);){if(0===p)break e;p--,v+=s[f++]<<y,y+=8}if(C&&0==(240&C)){for(R=_,x=C,P=E;C=(j=n.lencode[P+((v&(1<<R+x)-1)>>R)])>>>16&255,E=65535&j,!(R+(_=j>>>24)<=y);){if(0===p)break e;p--,v+=s[f++]<<y,y+=8}v>>>=R,y-=R,n.back+=R}if(v>>>=_,y-=_,n.back+=_,n.length=E,0===C){n.mode=26;break}if(32&C){n.back=-1,n.mode=12;break}if(64&C){e.msg="invalid literal/length code",n.mode=30;break}n.extra=15&C,n.mode=22;case 22:if(n.extra){for(N=n.extra;y<N;){if(0===p)break e;p--,v+=s[f++]<<y,y+=8}n.length+=v&(1<<n.extra)-1,v>>>=n.extra,y-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;C=(j=n.distcode[v&(1<<n.distbits)-1])>>>16&255,E=65535&j,!((_=j>>>24)<=y);){if(0===p)break e;p--,v+=s[f++]<<y,y+=8}if(0==(240&C)){for(R=_,x=C,P=E;C=(j=n.distcode[P+((v&(1<<R+x)-1)>>R)])>>>16&255,E=65535&j,!(R+(_=j>>>24)<=y);){if(0===p)break e;p--,v+=s[f++]<<y,y+=8}v>>>=R,y-=R,n.back+=R}if(v>>>=_,y-=_,n.back+=_,64&C){e.msg="invalid distance code",n.mode=30;break}n.offset=E,n.extra=15&C,n.mode=24;case 24:if(n.extra){for(N=n.extra;y<N;){if(0===p)break e;p--,v+=s[f++]<<y,y+=8}n.offset+=v&(1<<n.extra)-1,v>>>=n.extra,y-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===d)break e;if(k=w-d,n.offset>k){if((k=n.offset-k)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=30;break}k>n.wnext?(k-=n.wnext,S=n.wsize-k):S=n.wnext-k,k>n.length&&(k=n.length),O=n.window}else O=l,S=h-n.offset,k=n.length;k>d&&(k=d),d-=k,n.length-=k;do{l[h++]=O[S++]}while(--k);0===n.length&&(n.mode=21);break;case 26:if(0===d)break e;l[h++]=n.length,d--,n.mode=21;break;case 27:if(n.wrap){for(;y<32;){if(0===p)break e;p--,v|=s[f++]<<y,y+=8}if(w-=d,e.total_out+=w,n.total+=w,w&&(e.adler=n.check=n.flags?o(n.check,l,w,h-w):i(n.check,l,w,h-w)),w=d,(n.flags?v:c(v))!==n.check){e.msg="incorrect data check",n.mode=30;break}v=0,y=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;y<32;){if(0===p)break e;p--,v+=s[f++]<<y,y+=8}if(v!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=30;break}v=0,y=0}n.mode=29;case 29:M=1;break e;case 30:M=-3;break e;case 31:return-4;case 32:default:return-2}return e.next_out=h,e.avail_out=d,e.next_in=f,e.avail_in=p,n.hold=v,n.bits=y,(n.wsize||w!==e.avail_out&&n.mode<30&&(n.mode<27||4!==t))&&m(e,e.output,e.next_out,w-e.avail_out)?(n.mode=31,-4):(b-=e.avail_in,w-=e.avail_out,e.total_in+=b,e.total_out+=w,n.total+=w,n.wrap&&w&&(e.adler=n.check=n.flags?o(n.check,l,w,e.next_out-w):i(n.check,l,w,e.next_out-w)),e.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),(0===b&&0===w||4===t)&&0===M&&(M=-5),M)},t.inflateEnd=function(e){if(!e||!e.state)return-2;var t=e.state;return t.window&&(t.window=null),e.state=null,0},t.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?-2:(n.head=t,t.done=!1,0):-2},t.inflateSetDictionary=function(e,t){var n,r=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?-2:11===n.mode&&i(1,t,r,0)!==n.check?-3:m(e,t,r,r)?(n.mode=31,-4):(n.havedict=1,0):-2},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t,n){"use strict";e.exports=function(e,t){var n,r,i,o,a,u,c,s,l,f,h,p,d,v,y,g,m,b,w,k,S,O,_,C,E;n=e.state,r=e.next_in,C=e.input,i=r+(e.avail_in-5),o=e.next_out,E=e.output,a=o-(t-e.avail_out),u=o+(e.avail_out-257),c=n.dmax,s=n.wsize,l=n.whave,f=n.wnext,h=n.window,p=n.hold,d=n.bits,v=n.lencode,y=n.distcode,g=(1<<n.lenbits)-1,m=(1<<n.distbits)-1;e:do{d<15&&(p+=C[r++]<<d,d+=8,p+=C[r++]<<d,d+=8),b=v[p&g];t:for(;;){if(p>>>=w=b>>>24,d-=w,0==(w=b>>>16&255))E[o++]=65535&b;else{if(!(16&w)){if(0==(64&w)){b=v[(65535&b)+(p&(1<<w)-1)];continue t}if(32&w){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}k=65535&b,(w&=15)&&(d<w&&(p+=C[r++]<<d,d+=8),k+=p&(1<<w)-1,p>>>=w,d-=w),d<15&&(p+=C[r++]<<d,d+=8,p+=C[r++]<<d,d+=8),b=y[p&m];n:for(;;){if(p>>>=w=b>>>24,d-=w,!(16&(w=b>>>16&255))){if(0==(64&w)){b=y[(65535&b)+(p&(1<<w)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(S=65535&b,d<(w&=15)&&(p+=C[r++]<<d,(d+=8)<w&&(p+=C[r++]<<d,d+=8)),(S+=p&(1<<w)-1)>c){e.msg="invalid distance too far back",n.mode=30;break e}if(p>>>=w,d-=w,S>(w=o-a)){if((w=S-w)>l&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(O=0,_=h,0===f){if(O+=s-w,w<k){k-=w;do{E[o++]=h[O++]}while(--w);O=o-S,_=E}}else if(f<w){if(O+=s+f-w,(w-=f)<k){k-=w;do{E[o++]=h[O++]}while(--w);if(O=0,f<k){k-=w=f;do{E[o++]=h[O++]}while(--w);O=o-S,_=E}}}else if(O+=f-w,w<k){k-=w;do{E[o++]=h[O++]}while(--w);O=o-S,_=E}for(;k>2;)E[o++]=_[O++],E[o++]=_[O++],E[o++]=_[O++],k-=3;k&&(E[o++]=_[O++],k>1&&(E[o++]=_[O++]))}else{O=o-S;do{E[o++]=E[O++],E[o++]=E[O++],E[o++]=E[O++],k-=3}while(k>2);k&&(E[o++]=E[O++],k>1&&(E[o++]=E[O++]))}break}}break}}while(r<i&&o<u);r-=k=d>>3,p&=(1<<(d-=k<<3))-1,e.next_in=r,e.next_out=o,e.avail_in=r<i?i-r+5:5-(r-i),e.avail_out=o<u?u-o+257:257-(o-u),n.hold=p,n.bits=d}},function(e,t,n){"use strict";var r=n(0),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],u=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,n,c,s,l,f,h){var p,d,v,y,g,m,b,w,k,S=h.bits,O=0,_=0,C=0,E=0,R=0,x=0,P=0,T=0,M=0,A=0,N=null,j=0,I=new r.Buf16(16),L=new r.Buf16(16),F=null,D=0;for(O=0;O<=15;O++)I[O]=0;for(_=0;_<c;_++)I[t[n+_]]++;for(R=S,E=15;E>=1&&0===I[E];E--);if(R>E&&(R=E),0===E)return s[l++]=20971520,s[l++]=20971520,h.bits=1,0;for(C=1;C<E&&0===I[C];C++);for(R<C&&(R=C),T=1,O=1;O<=15;O++)if(T<<=1,(T-=I[O])<0)return-1;if(T>0&&(0===e||1!==E))return-1;for(L[1]=0,O=1;O<15;O++)L[O+1]=L[O]+I[O];for(_=0;_<c;_++)0!==t[n+_]&&(f[L[t[n+_]]++]=_);if(0===e?(N=F=f,m=19):1===e?(N=i,j-=257,F=o,D-=257,m=256):(N=a,F=u,m=-1),A=0,_=0,O=C,g=l,x=R,P=0,v=-1,y=(M=1<<R)-1,1===e&&M>852||2===e&&M>592)return 1;for(;;){b=O-P,f[_]<m?(w=0,k=f[_]):f[_]>m?(w=F[D+f[_]],k=N[j+f[_]]):(w=96,k=0),p=1<<O-P,C=d=1<<x;do{s[g+(A>>P)+(d-=p)]=b<<24|w<<16|k|0}while(0!==d);for(p=1<<O-1;A&p;)p>>=1;if(0!==p?(A&=p-1,A+=p):A=0,_++,0==--I[O]){if(O===E)break;O=t[n+f[_]]}if(O>R&&(A&y)!==v){for(0===P&&(P=R),g+=C,T=1<<(x=O-P);x+P<E&&!((T-=I[x+P])<=0);)x++,T<<=1;if(M+=1<<x,1===e&&M>852||2===e&&M>592)return 1;s[v=A&y]=R<<24|x<<16|g-l|0}}return 0!==A&&(s[g+A]=O-P<<24|64<<16|0),h.bits=R,0}},function(e,t,n){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t),n.d(t,"cell",(function(){return Le}));var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.length=0,this.obj={}}var t,n;return t=e,(n=[{key:"isEmpty",value:function(){return 0==this.length}},{key:"containsKey",value:function(e){return e in this.obj}},{key:"containsValue",value:function(e){for(var t in this.obj)if(this.obj[t]==e)return!0;return!1}},{key:"put",value:function(e,t){this.containsKey(e)||this.length++,this.obj[e]=t}},{key:"get",value:function(e){return this.containsKey(e)?this.obj[e]:null}},{key:"remove",value:function(e){if(this.containsKey(e)){var t=this.obj[e];return delete this.obj[e],this.length--,t}return null}},{key:"values",value:function(){var e=new Array;for(var t in this.obj)e.push(this.obj[t]);return e}},{key:"keySet",value:function(){var e=new Array;for(var t in this.obj)e.push(t);return e}},{key:"size",value:function(){return this.length}},{key:"clear",value:function(){this.length=0,this.obj={}}}])&&r(t.prototype,n),e}();function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.host=t,this.port=n}var t,n;return t=e,(n=[{key:"getHost",value:function(){return this.host}},{key:"getPort",value:function(){return this.port}},{key:"toString",value:function(){return this.host+":"+this.port}}])&&o(t.prototype,n),e}();function c(e){return(c="function"==typeof Symbol&&"symbol"==a(Symbol.iterator)?function(e){return a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":a(e)})(e)}var s={toBytes:function(e){if(void 0!==e){var t=c(e);if("string"==t)return this.stringToBytes(e);if("number"==t)return/^-?\d+$/.test(e.toString())?e>-2147483648&&e<2147483647?this.intToBytes(e):this.longToBytes(e):/^[-\+]?\d+(\.\d+)?$/.test(e.toString())?this.doubleToBytes(e):this.floatToBytes(e);if("boolean"==t)return this.boolToBytes(e);if("object"==t)return this.stringToBytes(JSON.stringify(e))}},intToBytes:function(e){var t=[];return t[0]=this.over127(255&e),t[1]=this.over127((65280&e)>>8),t[2]=this.over127((16711680&e)>>16),t[3]=this.over127((4278190080&e)>>24),t},longToBytes:function(e){var t=[];return t[0]=255&e,t[1]=255&this.toRight(e,8),t[2]=255&this.toRight(e,16),t[3]=255&this.toRight(e,24),t[4]=255&this.toRight(e,32),t[5]=255&this.toRight(e,40),t[6]=255&this.toRight(e,48),t[7]=255&this.toRight(e,56),t},floatToBytes:function(e){for(var t=e.toString(),n=[],r=0;r<t.length;++r)n.push(t.charCodeAt(r));return n},doubleToBytes:function(e){for(var t=e.toString(),n=[],r=0;r<t.length;++r)n.push(t.charCodeAt(r));return n},stringToBytes:function(e){return new TextEncoder("utf-8").encode(e)},boolToBytes:function(e){return[e?1:0]},toArray:function(e){for(var t=new Array,n=0,r=e.length;n<r;++n)t.push(e.charAt(n));return t},toInt:function(e){return 255&e[0]|65280&e[1]<<8|16711680&e[2]<<16|4278190080&e[3]<<24},toLong:function(e){var t=e[0]|e[1]<<8|e[2]<<16|e[3]<<24;return 4294967296*((e[4]|e[5]<<8|e[6]<<16|e[7]<<24)>>>0)+(t>>>0)},toFloat:function(e){for(var t=[],n=0;n<e.length;++n)t.push(String.fromCharCode(e[n]));var r=t.join("");return parseFloat(r)},toDouble:function(e){for(var t=[],n=0;n<e.length;++n)t.push(String.fromCharCode(e[n]));var r=t.join("");return parseFloat(r)},toBool:function(e){return 1==e[0]},toString:function(e){return new TextDecoder("utf-8").decode(new Uint8Array("object"==c(e)?e:[e]))},toRight:function(e,t){try{return parseInt(Array(t+1).join("0")+(t>e.toString(2).length?0:e.toString(2).slice(0,e.toString(2).length-t)),2)}catch(n){console.log(e,t,n)}},over127:function(e){return e>127?e-256:e},floatToIntBits:function(e){if(Math.pow(2,23),e!=e)return 2143289344;var t=e<0||0==e&&1/e<0?-2147483648:0,n=Math.abs(e);if(n==Number.POSITIVE_INFINITY)return 2139095040|t;for(var r=0,i=n;i>=2&&r<=127;)r++,i/=2;for(;i<1&&r>=-126;)r--,i*=2;var o=r+127;return 255==o?2139095040|signBit:(0==o||Math.pow(2,23),Math.pow(2,23),t|o<<23&2139095040|8388607&mantissa)}},l={sMagicNum:Math.round(Date.now()),ALPHABET:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],NUMBERS:[1,2,3,4,5,6,7,8,9,0],randomString:function(e){for(var t=new Array,n=0;n<e;++n){var r=Math.floor(Math.random()*this.ALPHABET.length);t.push(this.ALPHABET[r])}return t.join("")},randomNumberFixedLength:function(e){if(e<0)return 0;var t=new Array,n=Math.floor(Math.random()*(this.NUMBERS.length-1));t.push(this.NUMBERS[n]);for(var r=1;r<e;++r)n=Math.floor(Math.random()*this.NUMBERS.length),t.push(this.NUMBERS[n]);var i=t.join("");return parseInt(i)},randomNumber:function(e,t){return void 0===e&&(e=-32768),void 0===t&&(t=32767),Math.floor(Math.random()*(t-e))+e},randomBytes:function(e){for(var t=new Array,n=0;n<e;++n){var r=Math.floor(128*Math.random());t.push(r)}return t},parseInt32:function(e){var t=parseInt(e);return t<-2147483648?-2147483648:t>2147483647?2147483647:t},parseInt64:function(e){return parseInt(e)},generateSerialNumber:function(){var e=Date.now();return e+=this.randomNumber(),Math.abs(e)},simpleEncrypt:function(e,t){var n=null;if("string"==typeof e){n=[];for(var r=0;r<e.length;++r)n.push(e.charCodeAt(r)-256)}else n=e;var i=null;if("string"==typeof t){i=[];for(var o=0;o<t.length;++o)i.push(t.charCodeAt(o))}else i=t;if(8!=i.length)return null;var a=11+i[0];a-=i[1],a+=i[2],a-=i[3],a+=i[4],a-=i[5],a+=i[6];for(var u=(a-=i[7])%8,c=a%2==0?2:1,s=n.length,l=new Array,f=0;f<s;++f){var h=n[f]^c^u;h<0&&(h+=256),l[f]=h}return l},simpleDecrypt:function(e,t){var n=[];if("string"==typeof e){n=[];for(var r=0;r<e.length;++r)n.push(e.charCodeAt(r)-256)}else n=e;var i=[];if("string"==typeof t)for(var o=0;o<t.length;++o)i.push(t.charCodeAt(o)-256);else i=t;if(8!=i.length)return null;var a=11+i[0];a-=i[1],a+=i[2],a-=i[3],a+=i[4],a-=i[5],a+=i[6];for(var u=(a-=i[7])%8,c=a%2==0?2:1,s=n.length,l=new Array,f=0;f<s;++f){var h=n[f]^u^c;h<0&&(h+=256),l[f]=h}return l},toCharCode:function(e){var t=new Array;if("string"==typeof e)for(var n=0;n<e.length;++n)t.push(e.charCodeAt(n));else for(var r=0;r<e.length;++r)if("string"==typeof e[r])for(var i=e[r],o=0;o<i.length;++o)t.push(i.charCodeAt(o));else t.push(e[r]);return t},fromCharCode:function(e){for(var t=new Array,n=0;n<e.length;++n)t.push(String.fromCharCode(e[n]));return t.join("")}},f={DEBUG:1,INFO:2,WARNING:3,ERROR:4};function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var p=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,(n=[{key:"debug",value:function(e,t,n){}},{key:"info",value:function(e,t,n){}},{key:"warn",value:function(e,t,n){}},{key:"error",value:function(e,t,n){}}])&&h(t.prototype,n),e}();void 0===window.console?window.console={error:function(){},warn:function(){},info:function(){},log:function(){}}:(void 0===window.console.error&&(window.console.error=window.console.log),void 0===window.console.warn&&(window.console.warn=window.console.log),void 0===window.console.info&&(window.console.info=window.console.log));var d={enabled:!0,level:f.INFO,handlers:[],isDebugLevel:function(){return this.level==f.DEBUG},addHandler:function(e){this.handlers.indexOf(e)>=0||this.handlers.push(e)},removeHandler:function(e){var t=this.handlers.indexOf(e);t>=0&&this.handlers.splice(t,1)},d:function(e,t){if(this.enabled&&!(this.level>f.DEBUG)){for(var n=this._formatTime(),r=0;r<this.handlers.length;++r)this.handlers[r].debug(n,e,t);var i=[n," [DEBUG] ",e," - ",t];window.console.log(i.join("")),i=null}},i:function(e,t){if(this.enabled&&!(this.level>f.INFO)){for(var n=this._formatTime(),r=0;r<this.handlers.length;++r)this.handlers[r].info(n,e,t);var i=[n," [INFO]  ",e," - ",t];window.console.info(i.join("")),i=null}},w:function(e,t){if(this.enabled&&!(this.level>f.WARNING)){for(var n=this._formatTime(),r=0;r<this.handlers.length;++r)this.handlers[r].warn(n,e,t);var i=[n," [WARN]  ",e," - ",t];window.console.warn(i.join("")),i=null}},e:function(e,t){if(this.enabled&&!(this.level>f.ERROR)){for(var n=this._formatTime(),r=0;r<this.handlers.length;++r)this.handlers[r].error(n,e,t);var i=[n," [ERROR] ",e," - ",t];window.console.error(i.join("")),i=null}},log:function(e,t,n){if(this.enabled)switch(n){case f.DEBUG:this.d(e,t);break;case f.INFO:this.i(e,t);break;case f.WARNING:this.w(e,t);break;case f.ERROR:this.e(e,t);break;default:var r=[this._formatTime()," [LOG] ",e," - ",t];window.console.log(r.join("")),r=null}},_formatTime:function(){var e=new Date,t=[e.getHours(),":",e.getMinutes(),":",e.getSeconds(),".",e.getMilliseconds()];return e=null,t.join("")}};function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var y=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.MAJOR=2,this.MINOR=3,this.REVISION=9,this.NAME="Genie"}var t,n;return t=e,(n=[{key:"getNumbers",value:function(){return[this.MAJOR,".",this.MINOR,".",this.REVISION].join("")}},{key:"toString",value:function(){return[this.MAJOR,".",this.MINOR,".",this.REVISION," (",this.NAME,")"].join("")}}])&&v(t.prototype,n),e}(),g=function(){var e,t="0123456789abcdef".split(""),n=[],r=Math.random;n[8]=n[13]=n[18]=n[23]="-",n[14]="4";for(var i=0;i<36;i++)n[i]||(e=0|16*r(),n[i]=t[19==i?3&e|8:15&e]);return n.join("")};function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var b=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.uuid=void 0!==t?t:g().toString()}var t,n;return t=e,(n=[{key:"reset",value:function(){this.uuid=g().toString()}},{key:"asString",value:function(){return this.uuid}},{key:"toString",value:function(){return this.uuid}}])&&m(t.prototype,n),e}(),w=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.heartbeat=6e4};function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var S=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.timer=0,this.runnable=t,this.scope=void 0===n?null:n}var t,n;return t=e,(n=[{key:"start",value:function(){var e=this;this.timer=setTimeout((function(t){e.runnable.call(e.scope),clearTimeout(e.timer),e.timer=0}),0)}},{key:"delay",value:function(e){var t=this,n=setTimeout((function(){t.start(),clearTimeout(n)}),e)}}])&&k(t.prototype,n),e}();function O(e){return(O="function"==typeof Symbol&&"symbol"==a(Symbol.iterator)?function(e){return a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":a(e)})(e)}function _(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function C(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&function(e,t){(Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}(e,t)}function E(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R(this,n)}}function R(e,t){return!t||"object"!==O(t)&&"function"!=typeof t?x(e):t}function x(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function T(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function M(e){return(M="function"==typeof Symbol&&"symbol"==a(Symbol.iterator)?function(e){return a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":a(e)})(e)}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function N(e,t){return!t||"object"!==M(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function j(e){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var I=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=j(e);if(t){var i=j(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return N(this,n)}}(n);function n(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),t.call(this,e)}return n}(function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.address=t,this.id=l.generateSerialNumber(),this.timestamp=Date.now(),this.secretKey=null}var t,n;return t=e,(n=[{key:"getId",value:function(){return this.id}},{key:"getAddress",value:function(){return this.address}},{key:"setSecretKey",value:function(e){this.secretKey=e}},{key:"getSecretKey",value:function(){return this.secretKey}},{key:"toString",value:function(){return this.address.toString()}}])&&T(t.prototype,n),e}()),L=n(2),F=n.n(L);function D(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var B=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.payload=t,this.context=null,this.compressible=!1,this.verifyCompression()}var t,n,r;return t=e,r=[{key:"pack",value:function(t,n){var r;return(r=null!=n?l.simpleEncrypt(t,n):t).length>e.CompressionThreshold?e.compress(r):r}},{key:"unpack",value:function(t,n){var r;return null==(r=120==t[0]&&156==t[1]?e.uncompress(t):t)?null:null!=n?l.simpleDecrypt(r,n):r}},{key:"compress",value:function(e){return F.a.deflate(e)}},{key:"uncompress",value:function(e){var t=null;try{t=F.a.inflate(e)}catch(e){d.e("Message","Uncompress error: "+e)}return t}}],(n=[{key:"setPayload",value:function(e){this.payload=e}},{key:"setContext",value:function(e){this.context=e}},{key:"getPayload",value:function(){return this.payload}},{key:"getContext",value:function(){return this.context}},{key:"verifyCompression",value:function(){return 120==this.payload[0]&&-100==this.payload[1]||120==this.payload[0]&&156==this.payload[1]?this.compressible=!0:this.compressible=!1,this.compressible}},{key:"needCompressible",value:function(){return this.payload.length>=e.CompressionThreshold}}])&&D(t.prototype,n),r&&D(t,r),e}();function G(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}B.DefaultHead=[32,19,9,8],B.DefaultTail=[25,120,16,4],B.CompressionThreshold=1024;var U=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,(n=[{key:"initializer",value:function(){}},{key:"sessionCreated",value:function(e){}},{key:"sessionDestroyed",value:function(e){}},{key:"sessionOpened",value:function(e){}},{key:"sessionClosed",value:function(e){}},{key:"messageReceived",value:function(e,t){}},{key:"messageSent",value:function(e,t){}},{key:"errorOccurred",value:function(e,t){}}])&&G(t.prototype,n),e}();function H(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var z=200;function J(e){return(J="function"==typeof Symbol&&"symbol"==a(Symbol.iterator)?function(e){return a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":a(e)})(e)}function V(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function K(e,t){return(K=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function q(e,t){return!t||"object"!==J(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function W(e){return(W=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Z=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&K(e,t)}(i,e);var t,n,r=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=W(e);if(t){var i=W(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return q(this,n)}}(i);function i(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(e=r.call(this)).writeLimit=32768,e.address=null,e.connectTimeout=1e4,e.connectTimer=0,e.socket=null,e.session=null,e.closed=!0,e.messages=null,e.secure=window.location.protocol.toLowerCase().indexOf("https")>=0,e.receivedBuf=[],e}return t=i,(n=[{key:"getAddress",value:function(){return this.address}},{key:"connect",value:function(e){if(null!=this.socket&&this.socket.readyState==WebSocket.OPEN)return d.w("MessageConnector","Connector has connected to "+e.toString()),!1;if(!this.closed&&null!=this.socket){try{this.socket.close(1e3,"close")}catch(e){}this.destroySocketEvent(),this.socket=null,this.closed=!0}this.connectTimer>0&&(clearTimeout(this.connectTimer),this.connectTimer=0),this.messages=[],this.address=e;var t=this;return this.session=new I(this.address),t.fireSessionCreated(),this.connectTimer=setTimeout((function(){t.fireErrorOccurred(301)}),this.connectTimeout),this.socket=this.createSocket(this.address.getHost(),this.address.getPort()),null!=this.socket||(new S((function(){t.fireSessionDestroyed(),t.connectTimer>0&&(clearTimeout(t.connectTimer),t.connectTimer=0)})).start(),!1)}},{key:"disconnect",value:function(){if(this.connectTimer>0&&(clearTimeout(this.connectTimer),this.connectTimer=0),null!=this.socket)try{this.socket.close(1e3,"disconnect")}catch(e){d.e("MessageConnector","Close socket has exception.")}else this.fireSessionDestroyed();this.destroySocketEvent(),this.socket=null}},{key:"destroySocketEvent",value:function(){null!=this.socket&&(this.socket.onopen=function(e){},this.socket.onclose=function(e){},this.socket.onmessage=function(e){},this.socket.onerror=function(e){})}},{key:"createSocket",value:function(e,t){var n=this;if(void 0===window.WebSocket)return null;var r=null;try{r=this.secure?void 0!==t?new WebSocket("wss://"+e+":"+t+"/cell/","cell"):new WebSocket("wss://"+e+"/cell/","cell"):void 0!==t?new WebSocket("ws://"+e+":"+t+"/cell/","cell"):new WebSocket("ws://"+e+"/cell/","cell")}catch(e){this.fireErrorOccurred(z),console.log("WebSocket: "+e)}return null==r?null:(r.binaryType="arraybuffer",r.onopen=function(e){n.fireSessionOpened(e)},r.onclose=function(e){n.fireSessionClosed(e)},r.onmessage=function(e){n.receive(e)},r.onerror=function(e){n.fireErrorOccurred(z,e)},r)}},{key:"setConnectTimeout",value:function(e){this.connectTimeout=e}},{key:"getConnectTimeout",value:function(){return this.connectTimeout}},{key:"getSession",value:function(){return this.session}},{key:"write",value:function(e){null!=e&&void 0!==e?(this.messages.push(e),this._send()):this.fireErrorOccurred(403)}},{key:"_send",value:function(){if(!this.closed)try{if(this.messages.length>0){var e=this.messages.shift();if(null==e)return;for(var t=e.payload,n=this.session.secretKey,r=B.pack(t,n),i=new Array,o=0;o<r.length;++o)i.push(r[o]);Array.prototype.push.apply(i,B.DefaultTail);var a=new Uint8Array(i);if(this.socket.send(a),null!=this.handler&&this.handler.messageSent(this.session,e),this.messages.length>0){var u=this;new S((function(){u._send()})).delay(10)}}}catch(e){d.log("MessageConnector",e,f.WARNING)}}},{key:"receive",value:function(e){if("string"==typeof e.data)d.w("MessageConnector","Not supported string type");else if(this.receivedBuf=this.receivedBuf.concat(Array.from(new Uint8Array(e.data))),this.receivedBuf.length>4){var t=this.receivedBuf.length-1;if(this.receivedBuf[t-3]==B.DefaultTail[0]&&this.receivedBuf[t-2]==B.DefaultTail[1]&&this.receivedBuf[t-1]==B.DefaultTail[2]&&this.receivedBuf[t]==B.DefaultTail[3]){var n=this.receivedBuf.slice(0,this.receivedBuf.length-4);this.process(B.unpack(n,this.session.secretKey)),this.receivedBuf.length=0,this.receivedBuf=[]}}}},{key:"process",value:function(e){null!=this.handler&&this.handler.messageReceived(this.session,new B(e))}},{key:"fireSessionCreated",value:function(){null!=this.handler&&this.handler.sessionCreated(this.session)}},{key:"fireSessionOpened",value:function(e){this.closed=!1,this.connectTimer>0&&(clearTimeout(this.connectTimer),this.connectTimer=0),null!=this.handler&&this.handler.sessionOpened(this.session)}},{key:"fireSessionClosed",value:function(e){this.connectTimer>0&&(clearTimeout(this.connectTimer),this.connectTimer=0),this.closed||(this.closed=!0,null!=this.handler&&this.handler.sessionClosed(this.session),this.fireSessionDestroyed(this.session)),this.destroySocketEvent()}},{key:"fireSessionDestroyed",value:function(){null!=this.session&&null!=this.handler&&this.handler.sessionDestroyed(this.session),this.destroySocketEvent(),this.session=null,this.socket=null}},{key:"fireErrorOccurred",value:function(e,t){this.connectTimer>0&&(clearTimeout(this.connectTimer),this.connectTimer=0),null!=this.handler&&this.handler.errorOccurred(e,this.session),this.destroySocketEvent(),this.socket=null}}])&&V(t.prototype,n),i}(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.handler=null}var t,n;return t=e,(n=[{key:"setHandler",value:function(e){this.handler=e}},{key:"getHandler",value:function(){return this.handler}}])&&H(t.prototype,n),e}()),Y=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.session=t,this.tag=n,this.originateTimestamp=0,this.receiveTimestamp=0,this.transmitTimestamp=0,this.localTimestamp=0};function Q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var $=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,(n=[{key:"initializer",value:function(){}},{key:"onSessionTimeout",value:function(e,t){}}])&&Q(t.prototype,n),e}(),X={STRING:83,INT:73,LONG:76,FLOAT:102,DOUBLE:100,BOOL:66,JSON:74,BIN:78};function ee(e){return(ee="function"==typeof Symbol&&"symbol"==a(Symbol.iterator)?function(e){return a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":a(e)})(e)}function te(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ne=function(){function e(t,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),void 0!==t||void 0!==n)if(void 0!==n&&null!=n)switch(this.literal=n,n){case X.STRING:this.value=s.stringToBytes(t);break;case X.INT:this.value=s.intToBytes(t);break;case X.LONG:this.value=s.longToBytes(t);break;case X.JSON:this.value=s.stringToBytes(JSON.stringify(t));break;case X.BOOL:this.value=s.boolToBytes(t);break;case X.FLOAT:this.value=s.floatToBytes(t);break;case X.DOUBLE:this.value=s.doubleToBytes(t);break;case X.BIN:this.value=t}else{var r=ee(t);"string"==r?(this.value=s.stringToBytes(t),this.literal=X.STRING):"object"==r?(this.literal=X.JSON,this.value=s.stringToBytes(JSON.stringify(t))):"number"==r?/^-?\d+$/.test(t.toString())?t>=-2147483648&&t<=2147483647?(this.literal=X.INT,this.value=s.intToBytes(t)):(this.literal=X.LONG,this.value=s.longToBytes(t)):/^[-\+]?\d+(\.\d+)?$/.test(t.toString())?(this.literal=X.DOUBLE,this.value=s.doubleToBytes(t)):(this.literal=X.FLOAT,this.value=s.floatToBytes(t)):"boolean"==r?(this.literal=X.BOOL,this.value=s.boolToBytes(t)):(this.literal=X.BIN,this.value=t)}}var t,n;return t=e,(n=[{key:"restore",value:function(e,t){this.value=e,this.literal=t}},{key:"getLiteralBase",value:function(){return this.literal}},{key:"getValue",value:function(){return this.value}},{key:"getLiteralValue",value:function(){return this.getValueAs(this.literal)}},{key:"getValueAs",value:function(e){switch(e){case X.STRING:return this.getValueAsString();case X.INT:return this.getValueAsInt();case X.LONG:return this.getValueAsLong();case X.JSON:return this.getValueAsJson();case X.BOOL:return this.getValueAsBool();case X.FLOAT:return this.getValueAsFloat();case X.DOUBLE:return this.getValueAsDouble();case X.BIN:return this.getValue();default:return this.value}}},{key:"getValueAsString",value:function(){return s.toString(this.value)}},{key:"getValueAsInt",value:function(){return s.toInt(this.value)}},{key:"getValueAsLong",value:function(){return s.toLong(this.value)}},{key:"getValueAsFloat",value:function(){return s.toFloat(this.value)}},{key:"getValueAsDouble",value:function(){return s.toDouble(this.value)}},{key:"getValueAsBool",value:function(){return s.toBool(this.value)}},{key:"getValueAsJson",value:function(){var e=s.toString(this.value);return JSON.parse(e)}},{key:"equals",value:function(t){if(null==t||!(t instanceof e))return!1;if(t.literal!=this.literal||t.value.length!=this.value.length)return!1;for(var n=0,r=t.value.length;n<r;++n)if(t.value[n]!=this.value[n])return!1;return!0}}])&&te(t.prototype,n),e}();function re(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ie=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sn=void 0!==t?t:l.randomBytes(4),this.stuffList=[]}var t,n;return t=e,(n=[{key:"getSN",value:function(){return this.sn}},{key:"commit",value:function(e){return this.stuffList.push(e),this.stuffList.length-1}},{key:"setStuff",value:function(e,t){this.stuffList[e]=t}},{key:"getStuff",value:function(e){return this.stuffList[e]}},{key:"removeStuff",value:function(e){this.stuffList.splice(e,1)}},{key:"numStuff",value:function(){return this.stuffList.length}},{key:"equals",value:function(e){if(null==e||void 0===e)return!1;if(e.stuffList.length!=this.stuffList.length)return!1;if(e.sn.length!=this.sn.length)return!1;for(var t=0,n=this.sn.length;t<n;++t)if(e.sn[t]!=this.sn[t])return!1;return!0}},{key:"equalsSN",value:function(e){if(e.length!=this.sn.length)return!1;for(var t=0;t<e.length;++t)if(e[t]!=this.sn[t])return!1;return!0}},{key:"clone",value:function(){for(var t=new e(this.sn),n=0;n<this.stuffList.length;++n){var r=this.stuffList[n];switch(r.literal){case X.STRING:t.commit(new ne(r.getValueAsString(),r.literal));break;case X.INT:t.commit(new ne(r.getValueAsInt(),r.literal));break;case X.LONG:t.commit(new ne(r.getValueAsLong(),r.literal));break;case X.FLOAT:t.commit(new ne(r.getValueAsFloat(),r.literal));break;case X.DOUBLE:t.commit(new ne(r.getValueAsDouble(),r.literal));break;case X.BOOL:t.commit(new ne(r.getValueAsBool(),r.literal));break;case X.JSON:t.commit(new ne(r.getValueAsJson(),r.literal));break;case X.BIN:default:t.commit(new ne(r.getValue(),r.literal))}}return t}}])&&re(t.prototype,n),e}(),oe={Handshake:[72,83],SpeakNoAck:[83,78],SpeakAck:[83,65],Stream:[83,84],StreamControl:[83,67],Ack:[65,67],Heartbeat:[72,66],HeartbeatAck:[72,65],Goodbye:[71,66],Version:1,Reserve:[17,36,17,36],SEPARATE_CHAR:30,ESCAPE_CHAR:92,sGlobalSN:0,recognize:function(e){if(e.length<10)return null;var t=parseInt(e[6]),n=parseInt(e[7]);return t==oe.SpeakNoAck[0]&&n==oe.SpeakNoAck[1]?oe.SpeakNoAck:t==oe.SpeakAck[0]&&n==oe.SpeakAck[1]?oe.SpeakAck:t==oe.Stream[0]&&n==oe.Stream[1]?oe.Stream:t==oe.StreamControl[0]&&n==oe.StreamControl[1]?oe.StreamControl:t==oe.Ack[0]&&n==oe.Ack[1]?oe.Ack:t==oe.Heartbeat[0]&&n==oe.Heartbeat[1]?oe.Heartbeat:t==oe.HeartbeatAck[0]&&n==oe.HeartbeatAck[1]?oe.HeartbeatAck:t==oe.Handshake[0]&&n==oe.Handshake[1]?oe.Handshake:null},serializeHandshake:function(e,t){var n=new Array;return n.push(oe.Version),n.push(oe.consumeSN()),Array.prototype.push.apply(n,oe.Reserve),Array.prototype.push.apply(n,oe.Handshake),Array.prototype.push.apply(n,e),n.push(oe.SEPARATE_CHAR),Array.prototype.push.apply(n,s.stringToBytes(t)),n},deserializeHandshake:function(e){for(var t={key:null,tag:null},n=new Array,r=0,i=8;i<e.length;++i){do{var o=e[i];if(o==oe.SEPARATE_CHAR)break;n.push(String.fromCharCode(o)),++i}while(i<e.length);0==r?(t.key=new Array,Array.prototype.push.apply(t.key,n)):1==r&&(t.tag=n.join("")),n.splice(0,n.length),++r}return t},serializeSpeak:function(e,t,n){var r=new Array;r.push(oe.Version),r.push(oe.consumeSN()),Array.prototype.push.apply(r,t.getSN()),n?Array.prototype.push.apply(r,oe.SpeakAck):Array.prototype.push.apply(r,oe.SpeakNoAck),Array.prototype.push.apply(r,s.stringToBytes(e)),r.push(oe.SEPARATE_CHAR);for(var i=0,o=t.stuffList;i<o.length;++i){r.push(o[i].literal);for(var a=0,u=o[i].value;a<u.length;++a)(u[a]==oe.SEPARATE_CHAR||u[a]==oe.ESCAPE_CHAR)&&r.push(oe.ESCAPE_CHAR),r.push(u[a]);r.push(oe.SEPARATE_CHAR)}return r},deserializeSpeak:function(e){if(e.length<10)return null;for(var t=oe.recognize(e),n=e.slice(2,6),r={target:null,primitive:null,ack:t==oe.SpeakAck},i=new Array,o=8;o<e.length;++o){var a=e[o];if(a==oe.SEPARATE_CHAR)break;i.push(String.fromCharCode(a))}r.target=i.join("");for(var u=8+i.length+1,c=new ie(n),s=u;s<e.length;++s){var l=e[s],f=[];for(++s;s<e.length;){var h=e[s];if(h!=oe.ESCAPE_CHAR){if(h==oe.SEPARATE_CHAR)break;f.push(h),++s}else h=e[++s],f.push(h),++s}var p=new ne;p.restore(f,l),c.commit(p)}return r.primitive=c,r},serializeAck:function(e,t){var n=new Array;return n.push(oe.Version),n.push(oe.consumeSN()),Array.prototype.push.apply(n,t.getSN()),Array.prototype.push.apply(n,oe.Ack),Array.prototype.push.apply(n,s.stringToBytes(e)),n},deserializeAck:function(e){if(e.length<8)return null;var t={target:null,sn:null};return t.sn=e.slice(2,6),t.target=s.toString(e.slice(8,e.length)),t},serializeHeartbeat:function(e,t){var n=new Array;return n.push(oe.Version),n.push(oe.consumeSN()),Array.prototype.push.apply(n,oe.Reserve),Array.prototype.push.apply(n,oe.Heartbeat),Array.prototype.push.apply(n,s.toBytes(e)),n.push(oe.SEPARATE_CHAR),Array.prototype.push.apply(n,s.longToBytes(t)),n},deserializeHeartbeat:function(e){for(var t={tag:null,originateTimestamp:0,receiveTimestamp:0,transmitTimestamp:0},n=0,r=8;r<e.length;++r){var i=new Array;do{var o=e[r];if(o==oe.SEPARATE_CHAR)break;o==oe.ESCAPE_CHAR&&(o=e[r+=1]),i.push(o),++r}while(r<e.length);0==n?t.tag=s.toString(i):1==n&&(t.originateTimestamp=s.toLong(i)),i.splice(0,i.length),++n}return t},serializeHeartbeatAck:function(e,t,n,r){var i=new Array;return i.push(oe.Version),i.push(oe.consumeSN()),Array.prototype.push.apply(i,oe.Reserve),Array.prototype.push.apply(i,oe.HeartbeatAck),Array.prototype.push.apply(i,s.toBytes(e)),i.push(oe.SEPARATE_CHAR),Array.prototype.push.apply(i,oe.escape(s.longToBytes(t))),i.push(oe.SEPARATE_CHAR),Array.prototype.push.apply(i,oe.escape(s.longToBytes(n))),i.push(oe.SEPARATE_CHAR),Array.prototype.push.apply(i,oe.escape(s.longToBytes(r))),i},deserializeHeartbeatAck:function(e){for(var t={tag:null,originateTimestamp:0,receiveTimestamp:0,transmitTimestamp:0},n=0,r=8;r<e.length;++r){var i=new Array;do{var o=e[r];if(o==oe.SEPARATE_CHAR)break;o==oe.ESCAPE_CHAR&&(o=e[r+=1]),i.push(o),++r}while(r<e.length);if(0==n)t.tag=s.toString(i);else if(1==n){var a=i.slice(0,8);t.originateTimestamp=s.toLong(a)}else if(2==n){var u=i.slice(0,8);t.receiveTimestamp=s.toLong(u)}else if(3==n){var c=i.slice(0,8);t.transmitTimestamp=s.toLong(c)}i.splice(0,i.length),++n}return t},serializeGoodbye:function(){var e=new Array;return e.push(oe.Version),e.push(oe.consumeSN()),Array.prototype.push.apply(e,oe.Reserve),Array.prototype.push.apply(e,oe.Goodbye),e},consumeSN:function(){var e=oe.sGlobalSN;return oe.sGlobalSN+=1,oe.sGlobalSN>127&&(oe.sGlobalSN=0),e},escape:function(e){for(var t=0,n=0;n<e.length;++n)++t,e[n]!=oe.SEPARATE_CHAR&&e[n]!=oe.ESCAPE_CHAR||++t;if(t==e.length)return e;for(var r=new Array(t),i=0,o=0;i<e.length;++i,++o){var a=e[i];(a==oe.SEPARATE_CHAR||a==oe.ESCAPE_CHAR)&&(r[o]=oe.ESCAPE_CHAR,++o),r[o]=a}return r}};function ae(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ue=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.connector=t,this.hbInterval=45e3,this.hbDuration=1e4,this.daemon=0,this.contextMap=new i,this.listener=null}var t,n;return t=e,(n=[{key:"startup",value:function(){if(0==this.daemon){var e=this;this.daemon=setInterval((function(){e._daemon()}),this.hbInterval)}}},{key:"shutdown",value:function(){0!=this.daemon&&(clearInterval(this.daemon),this.daemon=0)}},{key:"setHeartbeatInterval",value:function(e){this.hbInterval!=e&&(this.hbInterval=e,this.shutdown(),this.startup())}},{key:"setListener",value:function(e){this.listener=e}},{key:"addSession",value:function(e,t){this.contextMap.containsKey(e.getId())||this.contextMap.put(e.getId(),new Y(e,t))}},{key:"removeSession",value:function(e){this.contextMap.remove(e.getId())}},{key:"getContext",value:function(e){return this.contextMap.get(e.getId())}},{key:"processHeartbeat",value:function(e,t,n){if(d.isDebugLevel()&&d.d("HM","Heartbeat from "+e.address.toString()),null!=this.contextMap.get(e.getId())){var r=oe.deserializeHeartbeat(t),i=oe.serializeHeartbeatAck(r.tag,r.originateTimestamp,n,Date.now()),o=new B(i);this.connector.write(o)}else d.w("HM","No context: "+e.toString())}},{key:"processHeartbeatAck",value:function(e,t){var n=this.contextMap.get(e.getId());if(null!=n){var r=oe.deserializeHeartbeatAck(t);r.originateTimestamp==n.originateTimestamp?d.d("HM","Received ack: "+e.toString()):d.d("HM","Can not find context : "+e.toString()),n.receiveTimestamp=r.receiveTimestamp,n.transmitTimestamp=r.transmitTimestamp,n.localTimestamp=Date.now()}else d.e("HM","Can not find session : "+e.toString())}},{key:"_daemon",value:function(){var e=Date.now(),t=this.contextMap.values();d.isDebugLevel()&&d.d("HM","Heartbeat ("+t.length+")");for(var n=0;n<t.length;++n){var r=t[n],i=r.localTimestamp-r.originateTimestamp;i>this.hbDuration&&this.listener.onSessionTimeout(r.session,i),r.originateTimestamp=e;var o=oe.serializeHeartbeat(r.tag.toString(),e),a=new B(o);this.connector.write(a)}}}])&&ae(t.prototype,n),e}();function ce(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var se=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.session=t,this.data=new i}var t,n;return t=e,(n=[{key:"addPrimitive",value:function(e,t){var n=this.data.get(e);null==n?this.data.put(e,[t]):this.data.put(e,n.push(t))}},{key:"removePrimitive",value:function(e,t){var n=null,r=this.data.get(e);if(null!=r)for(var i=0;i<r.length;++i){var o=r[i];if(o.equalsSN(t)){n=o,r.splice(i,1);break}}return n}},{key:"clean",value:function(){this.data.clear()}}])&&ce(t.prototype,n),e}();function le(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var fe=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.errorCode=t,this.description="Network error"}var t,n,r;return t=e,r=[{key:"transformError",value:function(t){var n=new e(1e3);switch(t){case 300:case 301:n.errorCode=e.NetworkConnectError,n.description="Network connection error";break;case z:case 201:case 202:case 203:n.errorCode=e.NetworkSocketError,n.description="Socket error";break;case 401:case 402:case 403:case 404:case 405:n.errorCode=e.NetworkIOError,n.description="Socket I/O error"}return n}}],(n=[{key:"getErrorCode",value:function(){return this.errorCode}},{key:"getDescription",value:function(){return this.description}}])&&le(t.prototype,n),r&&le(t,r),e}();fe.NetworkError=1e3,fe.NetworkConnectError=1010,fe.NetworkSocketError=1020,fe.NetworkIOError=1030,fe.HeartbeatTimeout=1040,fe.HandshakeError=2e3,fe.HandshakeTimeout=2001;var he=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.target=t,this.primitive=n};function pe(e){return(pe="function"==typeof Symbol&&"symbol"==a(Symbol.iterator)?function(e){return a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":a(e)})(e)}function de(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ve(e,t){return(ve=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ye(e,t){return!t||"object"!==pe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ge(e){return(ge=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var me=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ve(e,t)}(i,e);var t,n,r=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ge(e);if(t){var i=ge(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ye(this,n)}}(i);function i(e,t,n){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(o=r.call(this)).tag=e,o.address=t,o.listener=n,o.serverTag=null,o.state=1,o.connector=null,o.session=null,o.secretKey=null,o.primitiveCapsule=null,o.reconnectTimer=0,o.reconnectEnabled=!0,o.handshakeTimer=0,o.handshakeTimeout=1e4,o.hm=null,o}return t=i,(n=[{key:"start",value:function(){if(null==this.address)return!1;if(2==this.state||3==this.state)return!0;if(this.state=2,this.reconnectTimer>0&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=0),this.connector=new Z,this.connector.setHandler(this),this.hm=new ue(this.connector),this.hm.setListener(this),!this.connector.connect(this.address)){this.state=1,this.connector.setHandler(null),this.connector=null,this.hm.shutdown(),this.hm.setListener(null),this.hm=null;var e=this;this.reconnectTimer=setTimeout((function(){d.i("Speaker","Restart speaker: "+e.address.toString()),e.stop(),e.reconnectEnabled=!0,e.start()}),5e3)}return this.reconnectEnabled=!0,!0}},{key:"stop",value:function(){4!=this.state&&1!=this.state&&(d.i("Speaker","Stop speaker "+this.address.toString()),this.reconnectEnabled=!1,this.state=4,this.reconnectTimer>0&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=0),null!=this.connector&&this.connector.disconnect(),null!=this.hm&&(this.hm.shutdown(),this.hm.setListener(null),this.hm=null),this.handshakeTimer>0&&(clearTimeout(this.handshakeTimer),this.handshakeTimer=0),this.state=1)}},{key:"speak",value:function(e,t,n){if(3!=this.state)return!1;void 0===n&&(n=!1),n&&this.primitiveCapsule.addPrimitive(e,t);var r=oe.serializeSpeak(e,t,n),i=new B(r);return i.setContext(new he(e,t)),this.connector.write(i),!0}},{key:"sessionCreated",value:function(e){d.d("Speaker","sessionCreated"),this.session=e,this.primitiveCapsule=new se(e)}},{key:"sessionDestroyed",value:function(e){if(d.d("Speaker","sessionDestroyed"),null!=this.connector&&this.stop(),null!=this.primitiveCapsule&&(this.primitiveCapsule.clean(),this.primitiveCapsule=null),null!=this.hm&&(this.hm.removeSession(e),this.hm.shutdown(),this.hm=null),this.reconnectEnabled){var t=this;this.reconnectTimer=setTimeout((function(){d.i("Speaker","Reconnect "+t.address.toString()),t.stop(),t.reconnectEnabled=!0,t.start()}),5e3)}}},{key:"sessionOpened",value:function(e){d.d("Speaker","sessionOpened"),this.state=2,this.hm.addSession(e,this.tag.toString()),this.secretKey=null;var t=this;new S((function(){t.handshake()})).start()}},{key:"sessionClosed",value:function(e){d.d("Speaker","sessionClosed"),this.state=1,null!=this.hm&&(this.hm.shutdown(),this.hm.removeSession(e),this.hm.setListener(null),this.hm=null),this.handshakeTimer>0&&(clearTimeout(this.handshakeTimer),this.handshakeTimer=0),this.listener.onQuitted(this)}},{key:"messageReceived",value:function(e,t){var n=this;if(e&&t){var r=oe.recognize(t.payload);oe.SpeakNoAck==r?n.processSpeak(e,t,!1):oe.SpeakAck==r?n.processSpeak(e,t,!0):oe.Ack==r?n.processAck(e,t):oe.Heartbeat==r?n.processHeartHeat(e,t):oe.HeartbeatAck==r?n.processHeartHeatAck(e,t):oe.Handshake==r?new S((function(){n.processHandshake(e,t)})).start():d.w("Speaker","Unknown protocol")}}},{key:"messageSent",value:function(e,t){var n=oe.recognize(t.getPayload());if(oe.SpeakNoAck==n||oe.SpeakAck==n){var r=t.getContext();this.listener.onSpoke(this,r.target,r.primitive)}else oe.Handshake==n&&this.session.setSecretKey(this.secretKey)}},{key:"errorOccurred",value:function(e,t){this.reconnectTimer>0&&clearTimeout(this.reconnectTimer);var n=this;this.reconnectTimer=setTimeout((function(){d.i("Speaker","Reconnect "+n.address.toString()),n.stop(),n.reconnectEnabled=!0,n.start()}),e==z?5e3:3e3);var r=fe.transformError(e);this.listener.onFailed(this,r)}},{key:"onSessionTimeout",value:function(e,t){var n=new fe(fe.HeartbeatTimeout);this.listener.onFailed(this,n)}},{key:"handshake",value:function(){d.isDebugLevel()&&d.d("Speaker","Handshake : "+this.address.toString()),this.handshakeTimer>0&&clearTimeout(this.handshakeTimer);var e=this;this.handshakeTimer=setTimeout((function(){var t=new fe(fe.HandshakeTimeout);e.listener.onFailed(e,t),clearTimeout(e.handshakeTimer),e.handshakeTimer=0,e.stop()}),this.handshakeTimeout),this.secretKey=l.toCharCode(l.randomString(8));var t=oe.serializeHandshake(this.secretKey,this.tag.asString()),n=new B(t);try{this.connector.write(n)}catch(e){d.e("Speaker","Handshake failed: "+e)}}},{key:"processHandshake",value:function(e,t){var n=oe.deserializeHandshake(t.payload);if(null!=n.key&&null!=n.tag){if(d.isDebugLevel()&&d.d("Speaker","Handshake Success"),this.handshakeTimer>0&&(clearTimeout(this.handshakeTimer),this.handshakeTimer=0),1==this.state)return;this.hm.startup(),this.serverTag=n.tag.toString(),this.state=3,this.listener.onContacted(this)}else{this.stop();var r=new fe(fe.HandshakeError);this.listener.onFailed(this,r)}}},{key:"processHeartHeat",value:function(e,t){this.hm.processHeartbeat(e,t.payload,Date.now())}},{key:"processHeartHeatAck",value:function(e,t){this.hm.processHeartbeatAck(e,t.payload)}},{key:"processSpeak",value:function(e,t,n){if(3==this.state){var r=oe.deserializeSpeak(t.payload);null!=r.target&&null!=r.primitive&&(n&&this.ack(r.target,r.primitive),this.listener.onListened(this,r.target,r.primitive))}}},{key:"processAck",value:function(e,t){var n=oe.deserializeAck(t.payload),r=this.primitiveCapsule.removePrimitive(n.target,n.sn);null!=n&&this.listener.onAck(this,n.target,r)}},{key:"ack",value:function(e,t){if(3!=this.state)return!1;if(null!=this.connector){var n=oe.serializeAck(e,t),r=new B(n);this.connector.write(r)}return!0}}])&&de(t.prototype,n),i}(function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=function(e){C(r,e);var t=E(r);function r(){var e;_(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return e=t.call.apply(t,[this].concat(o)),n.forEach((function(t){t.prototype.initializer.call(x(e))})),e}return r}(e),o=function(e,t){Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t)).forEach((function(n){n.match(/^(?:constructor|prototype|arguments|caller|name|bind|call|apply|toString|length)$/)||Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))};return n.forEach((function(e){o(i.prototype,e.prototype),o(i,e)})),i}(U,$));function be(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var we=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,(n=[{key:"ctor",value:function(){}},{key:"initializer",value:function(){}},{key:"onListened",value:function(e,t,n){}},{key:"onSpoke",value:function(e,t,n){}},{key:"onAck",value:function(e,t,n){}},{key:"onSpeakTimeout",value:function(e,t,n){}},{key:"onContacted",value:function(e){}},{key:"onQuitted",value:function(e){}},{key:"onFailed",value:function(e,t){}}])&&be(t.prototype,n),e}();function ke(e){return(ke="function"==typeof Symbol&&"symbol"==a(Symbol.iterator)?function(e){return a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":a(e)})(e)}function Se(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Oe(e,t){return(Oe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _e(e,t){return!t||"object"!==ke(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ce(e){return(Ce=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ee=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Oe(e,t)}(i,e);var t,n,r=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Ce(e);if(t){var i=Ce(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return _e(this,n)}}(i);function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(t=r.call(this)).service=e,t}return t=i,(n=[{key:"onListened",value:function(e,t,n){if(null!=this.service.allEventListeners)for(var r=0,i=this.service.allEventListeners.length;r<i;++r)this.service.allEventListeners[r].onListened(e,t,n);if(null!=this.service.listeners){var o=this.service.listeners.get(t);null!=o&&o.onListened(e,t,n)}null!=this.service.eventListeners&&this.triggerEvent("onListened",{speaker:e,cellet:t,primitive:n})}},{key:"onSpoke",value:function(e,t,n){if(null!=this.service.allEventListeners)for(var r=0,i=this.service.allEventListeners.length;r<i;++r)this.service.allEventListeners[r].onSpoke(e,t,n);if(null!=this.service.listeners){var o=this.service.listeners.get(t);null!=o&&o.onSpoke(e,t,n)}null!=this.service.eventListeners&&this.triggerEvent("onSpoke",{speaker:e,cellet:t,primitive:n})}},{key:"onAck",value:function(e,t,n){if(null!=this.service.allEventListeners)for(var r=0,i=this.service.allEventListeners.length;r<i;++r)this.service.allEventListeners[r].onAck(e,t,n);if(null!=this.service.listeners){var o=this.service.listeners.get(t);null!=o&&o.onAck(e,t,n)}null!=this.service.eventListeners&&this.triggerEvent("onAck",{speaker:e,cellet:t,primitive:n})}},{key:"onSpeakTimeout",value:function(e,t,n){if(null!=this.service.allEventListeners)for(var r=0,i=this.service.allEventListeners.length;r<i;++r)this.service.allEventListeners[r].onSpeakTimeout(e,t,n);if(null!=this.service.listeners){var o=this.service.listeners.get(t);null!=o&&o.onSpeakTimeout(e,t,n)}null!=this.service.eventListeners&&this.triggerEvent("onSpeakTimeout",{speaker:e,cellet:t,primitive:n})}},{key:"onContacted",value:function(e){if(null!=this.service.eventListeners&&this.triggerEvent("onContacted",{speaker:e}),null!=this.service.allEventListeners)for(var t=0,n=this.service.allEventListeners.length;t<n;++t)this.service.allEventListeners[t].onContacted(e);if(null!=this.service.listeners)for(var r=this.service.listeners.keySet(),i=0;i<r.length;++i){var o=r[i],a=this.service.listeners.get(o),u=this.service.celletSpeakerMap.get(o);null!=u?u==e&&a.onContacted(e):a.onContacted(e)}}},{key:"onQuitted",value:function(e){if(null!=this.service.eventListeners&&this.triggerEvent("onQuitted",{speaker:e}),null!=this.service.allEventListeners)for(var t=0,n=this.service.allEventListeners.length;t<n;++t)this.service.allEventListeners[t].onQuitted(e);if(null!=this.service.listeners)for(var r=this.service.listeners.keySet(),i=0;i<r.length;++i){var o=r[i],a=this.service.listeners.get(o),u=this.service.celletSpeakerMap.get(o);null!=u?u==e&&a.onQuitted(e):a.onQuitted(e)}}},{key:"onFailed",value:function(e,t){if(null!=this.service.allEventListeners)for(var n=0,r=this.service.allEventListeners.length;n<r;++n)this.service.allEventListeners[n].onFailed(e,t);if(null!=this.service.listeners)for(var i=this.service.listeners.values(),o=0;o<i.length;++o)i[o].onFailed(e,t);null!=this.service.eventListeners&&this.triggerEvent("onFailed",{speaker:e,error:t})}},{key:"triggerEvent",value:function(e,t){var n=this.service.eventListeners.get(e);if(null!=n)for(var r=0;r<n.length;++r)n[r].call(null,t);if(null!=(n=this.service.eventListeners.get("*")))for(var i=0;i<n.length;++i)n[i].call(null,t)}}])&&Se(t.prototype,n),i}(we);function Re(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var xe=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tag=t,this.config=n,this.speakers=new i,this.celletSpeakerMap=new i,this.listenerProxy=new Ee(this),this.listeners=null,this.eventListeners=null,this.allEventListeners=null}var t,n;return t=e,(n=[{key:"hangupAll",value:function(){for(var e=this.speakers.values(),t=0;t<e.length;++t)e[t].stop();new Thread((function(){this.speakers.clear(),this.celletSpeakerMap.clear()}),this).delay(10)}},{key:"isWebSocketSupported",value:function(){return void 0!==window.WebSocket}},{key:"isCalled",value:function(e){if(void 0!==e){var t=this.celletSpeakerMap.get(e);return null!=t&&3==t.state}var n=this.speakers.values();return 0!=n.length&&3==n[0].state}},{key:"call",value:function(e,t){if(!this.isWebSocketSupported())return d.i("Brower",window.navigator.userAgent),d.e("TalkService","This brower can NOT support WebSocket"),null;var n=e.toString(),r=this.speakers.get(n);if(null==r&&(r=new me(this.tag,e,this.listenerProxy),this.speakers.put(n,r)),!r.start())return this.speakers.remove(n),null;if(void 0!==t)for(var i=0;i<t.length;++i)this.celletSpeakerMap.put(t[i],r);return r}},{key:"hangup",value:function(e){var t=e.toString(),n=this.speakers.get(t);if(null!=n){n.stop();for(var r=this.celletSpeakerMap.keySet(),i=0;i<r.length;++i){var o=r[i];this.celletSpeakerMap.get(o)==n&&this.celletSpeakerMap.remove(o)}}}},{key:"speak",value:function(e,t,n){var r=this.celletSpeakerMap.get(e);if(null==r){var i=this.speakers.values();if(0==i.length)return!1;r=i[0],this.celletSpeakerMap.put(e,r)}return r.speak(e,t,n)}},{key:"setListener",value:function(e,t){null==this.listeners&&(this.listeners=new i),null==t?this.listeners.remove(e):this.listeners.put(e,t)}},{key:"addListener",value:function(e,t){if("string"==typeof e){null==this.eventListeners&&(this.eventListeners=new i);var n=this.eventListeners.get(e);null==n?(n=[t],this.eventListeners.put(e,n)):n.push(t)}else null==this.allEventListeners?this.allEventListeners=[e]:this.allEventListeners.indexOf(e)<0&&this.allEventListeners.push(e)}},{key:"removeListener",value:function(e,t){if("string"==typeof e){if(null!=this.listeners&&this.listeners.remove(e),null==this.eventListeners)return;var n=this.eventListeners.get(e);if(null!=n){var r=n.indexOf(t);r>=0&&(n.splice(r,1),0==n.length&&this.eventListeners.remove(e))}}else if(null!=this.allEventListeners){var i=this.allEventListeners.indexOf(e);i>=0&&this.allEventListeners.splice(i,1)}}}])&&Re(t.prototype,n),e}();function Pe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Te=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=void 0===t?new w:t,this.version=new y,this.tag=new b,this.talkService=new xe(this.tag,t),this.talk=this.talkService,d.i("Nucleus","Cell "+this.version.getNumbers()+" (Build JavaScript/Web - "+this.version.NAME+")")}var t,n;return t=e,(n=[{key:"destroy",value:function(){null!=this.talkService&&(this.talkService.hangupAll(),this.talkService=null,this.talk=null),this.config=null,this.version=null,this.tag=null}},{key:"getTag",value:function(){return this.tag}},{key:"getTalkService",value:function(){return this.talkService}}])&&Pe(t.prototype,n),e}();function Me(e){return(Me="function"==typeof Symbol&&"symbol"==a(Symbol.iterator)?function(e){return a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":a(e)})(e)}function Ae(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ne(e,t){return(Ne=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function je(e,t){return!t||"object"!==Me(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ie(e){return(Ie=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Le={ByteUtils:s,Utils:l,Logger:d,LogLevel:f,LogHandler:p,Version:y,FastMap:i,InetAddress:u,Nucleus:Te,NucleusConfig:w,NucleusTag:b,TalkService:xe,TalkListener:we,Speaker:me,Primitive:ie,ActionDialect:function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ne(e,t)}(i,e);var t,n,r=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Ie(e);if(t){var i=Ie(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return je(this,n)}}(i);function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),t=r.call(this),"string"==typeof e?t.stuffList.push(new ne(e.toString(),X.STRING)):(t.sn=e.sn,t.stuffList=e.stuffList),t}return t=i,(n=[{key:"setName",value:function(e){this.stuffList[0]=new ne(e,X.STRING)}},{key:"getName",value:function(){return this.stuffList[0].getValueAsString()}},{key:"numParams",value:function(){return parseInt((this.stuffList.length-1)/2)}},{key:"containsParam",value:function(e){for(var t=1,n=this.stuffList.length;t<n;t+=2)if(this.stuffList[t].getValueAsString()==e)return!0;return!1}},{key:"addParam",value:function(e,t,n){var r=this.keyIndex(e);r>0?this.stuffList[r+1]=new ne(t,n):(this.stuffList.push(new ne(e,X.STRING)),this.stuffList.push(new ne(t,n)))}},{key:"getParam",value:function(e){var t=this.getValueStuff(e);return null==t?null:t.getLiteralValue()}},{key:"getParamAsString",value:function(e){var t=this.getValueStuff(e);return null==t?null:t.getValueAsString()}},{key:"getParamAsInt",value:function(e){var t=this.getValueStuff(e);return null==t?null:t.getValueAsInt()}},{key:"getParamAsLong",value:function(e){var t=this.getValueStuff(e);return null==t?null:t.getValueAsLong()}},{key:"getParamAsFloat",value:function(e){var t=this.getValueStuff(e);return null==t?null:t.getValueAsFloat()}},{key:"getParamAsDouble",value:function(e){var t=this.getValueStuff(e);return null==t?null:t.getValueAsDouble()}},{key:"getParamAsBool",value:function(e){var t=this.getValueStuff(e);return null==t?null:t.getValueAsBool()}},{key:"getParamAsJson",value:function(e){var t=this.getValueStuff(e);return null==t?null:t.getValueAsJson()}},{key:"getValueStuff",value:function(e){for(var t=1,n=this.stuffList.length;t<n;t+=2)if(this.stuffList[t].getValueAsString()==e)return this.stuffList[t+1];return null}},{key:"keyIndex",value:function(e){for(var t=1,n=this.stuffList.length;t<n;t+=2)if(this.stuffList[t].getValueAsString()==e)return t;return-1}}])&&Ae(t.prototype,n),i}(ie),LiteralBase:X,TalkError:fe};t.default=Le}])},"object"==a(t)&&"object"==a(e)?e.exports=o():(r=[],void 0===(i="function"==typeof(n=o)?n.apply(t,r):n)||(e.exports=i))}).call(this,n(398)(e))},function(e,t,n){var r=n(17),i=n(49),o=n(40),a=n(41),u=n(50),c=function(e,t,n){var s,l,f,h,p=e&c.F,d=e&c.G,v=e&c.S,y=e&c.P,g=e&c.B,m=d?r:v?r[t]||(r[t]={}):(r[t]||{}).prototype,b=d?i:i[t]||(i[t]={}),w=b.prototype||(b.prototype={});for(s in d&&(n=t),n)f=((l=!p&&m&&void 0!==m[s])?m:n)[s],h=g&&l?u(f,r):y&&"function"==typeof f?u(Function.call,f):f,m&&a(m,s,f,e&c.U),b[s]!=f&&o(b,s,h),y&&w[s]!=f&&(w[s]=f)};r.core=i,c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,e.exports=c},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.d(t,"a",(function(){return i}));var i=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t,this.data=void 0!==n?n:null,this.secondaryData=void 0!==r?r:null,this.subject=null}var t,n,i;return t=e,(n=[{key:"getName",value:function(){return this.name}},{key:"getData",value:function(){return this.data}},{key:"toString",value:function(){return null==this.data?this.name:this.name+" "+this.data.toString()}}])&&r(t.prototype,n),i&&r(t,i),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(1),i=n.n(r);function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t,this.data=n,this.sn=void 0===r?i.a.Utils.generateSerialNumber():r,this.state=null,this.responseType="json"}var t,n,r;return t=e,r=[{key:"create",value:function(t){return new e(t.name,t.data,t.sn)}}],(n=[{key:"getStateCode",value:function(){return null!=this.state?this.state.code:-1}},{key:"getPayload",value:function(){return this.data}},{key:"extractServiceStateCode",value:function(){return this.data.code}},{key:"extractServiceData",value:function(){return this.data.data}}])&&o(t.prototype,n),r&&o(t,r),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r={Ok:0,InvalidParameter:5,DataStructureError:8,Failure:9,InvalidDomain:11,NoSignIn:12,NotFindContact:14,NotFindGroup:15,NotFindContactZone:16,InconsistentToken:21,IllegalOperation:25,ServerError:101,NotAllowed:102,NoNetwork:103,Unknown:99}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r={OK:1e3,BadRequest:1400,NotFound:1404,NoAuthToken:1501,ServiceTimeout:2001,PayloadFormat:2002,InvalidParameter:2003,GatewayError:2101,extractState:function(e){return e.containsParam("state")?e.getParamAsJson("state"):null}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var r=n(125),i=(n(104),n(39));function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var i=f(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return l(this,n)}}function l(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var h=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(l,e);var t,n,r,o=s(l);function l(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(r=o.call(this,e,t,n)).devices=[],r.appendix=null,r}return t=l,r=[{key:"create",value:function(e,t){var n=e.id,r=e.timestamp,o=e.name,a=void 0!==t?t:e.domain,u=e.devices?e.devices:[],c=e.namePY?e.namePY:"",s=new l(n,o,a);s.timestamp=r,s.namePY=c,void 0!==e.last&&(s.last=e.last),void 0!==e.expiry&&(s.expiry=e.expiry);for(var f=0;f<u.length;++f){var h=u[f],p=new i.a(h.name,h.platform);s.devices.push(p)}return void 0!==e.context&&(s.context=e.context),s}}],(n=[{key:"getPriorityName",value:function(){return null!=this.appendix&&this.appendix.hasRemarkName()?this.appendix.getRemarkName():this.name}},{key:"addDevice",value:function(e){this.devices.indexOf(e)>=0||this.devices.push(e)}},{key:"removeDevice",value:function(e){var t=this.devices.indexOf(e);t>=0&&this.devices.splice(t,1)}},{key:"getDevices",value:function(){return this.devices}},{key:"getDevice",value:function(){return 0==this.devices.length?new i.a("Unknown","null"):this.devices[this.devices.length-1]}},{key:"getAppendix",value:function(){return this.appendix}},{key:"equals",value:function(e){return(e instanceof l||void 0!==e.id&&void 0!==e.domain)&&e.id==this.id&&e.domain==this.domain}},{key:"toJSON",value:function(){for(var e=u(f(l.prototype),"toJSON",this).call(this),t=[],n=0;n<this.devices.length;++n)t.push(this.devices[n].toJSON());return e.devices=t,e}},{key:"toCompactJSON",value:function(){return u(f(l.prototype),"toCompactJSON",this).call(this)}}])&&a(t.prototype,n),r&&a(t,r),l}(r.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r={Ok:0,Failure:9,InvalidDomain:11,NoDomain:12,NoDevice:13,NoContact:14,NoCommField:15,NoMediaUnit:16,NoPipeline:17,NoCommFieldEndpoint:18,NoPeerEndpoint:19,DataStructureError:20,CommFieldStateError:21,MediaUnitField:23,UnsupportedSignaling:24,UnsupportedOperation:25,CallerBusy:41,CalleeBusy:42,BeCallerBlocked:45,BeCalleeBlocked:46,Uninitialized:101,ConnRepeated:103,MediaPermissionDenied:110,NoVideoElement:111,VideoElementNotSetting:112,InvalidCallRecord:113,SignalingError:115,RTCPeerError:117,CreateOfferFailed:121,CreateAnswerFailed:122,LocalDescriptionFault:125,RemoteDescriptionFault:126,GroupStateError:130,ServerFault:200}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r={NewCall:"NewCall",InProgress:"InProgress",Ringing:"Ringing",Connected:"Connected",Busy:"Busy",Bye:"Bye",Invite:"Invite",Invited:"Invited",Arrived:"Arrived",Left:"Left",Followed:"Followed",Unfollowed:"Unfollowed",Timeout:"Timeout",MediaConnected:"MediaConnected",MediaDisconnected:"MediaDisconnected",MicrophoneVolume:"MicrophoneVolume",AudioMuted:"AudioMuted",VideoMuted:"VideoMuted",Failed:"Failed",CallFailed:"Failed"}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r={SignIn:"signIn",SignOut:"signOut",Comeback:"comeback",Leave:"leave",GetContact:"getContact",ModifyContact:"modifyContact",GetContactZone:"getContactZone",CreateContactZone:"createContactZone",DeleteContactZone:"deleteContactZone",ContainsContactInZone:"containsContactInZone",AddContactToZone:"addContactToZone",RemoveContactFromZone:"removeContactFromZone",GetGroup:"getGroup",ListGroups:"listGroups",CreateGroup:"createGroup",DismissGroup:"dismissGroup",AddGroupMember:"addGroupMember",RemoveGroupMember:"removeGroupMember",ModifyGroup:"modifyGroup",ModifyGroupMember:"modifyGroupMember",GetAppendix:"getAppendix",UpdateAppendix:"updateAppendix",GroupAppendixUpdated:"groupAppendixUpdated",BlockList:"blockList",TopList:"topList",Search:"search"}},function(e,t,n){"use strict";n.d(t,"a",(function(){return Z}));var r=n(1),i=n.n(r),o=n(18),a=n(0),u=n(33),c=n(4),s=n(6),l=n(15),f=n(36),h=n(10);function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e,t,n){return(v="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=b(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=b(e);if(t){var i=b(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return m(this,n)}}function m(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var w=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(a,e);var t,n,r,o=g(a);function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=o.call(this)).contactService=e,t}return t=a,(n=[{key:"onReceived",value:function(e,t,n){v(b(a.prototype),"onReceived",this).call(this,e,t,n),n.getStateCode()==s.a.OK?n.name==h.a.SignIn?this.contactService.triggerSignIn(n.data):n.name==h.a.ListGroups?this.contactService.triggerListGroups(n.data):n.name==h.a.ModifyGroup?this.contactService.triggerModifyGroup(n.data):n.name==h.a.ModifyGroupMember?this.contactService.triggerModifyGroupMember(n.data):n.name==h.a.CreateGroup?this.contactService.triggerCreateGroup(n.data):n.name==h.a.DismissGroup?this.contactService.triggerDismissGroup(n.data):n.name==h.a.RemoveGroupMember?this.contactService.triggerRemoveMember(n.data):n.name==h.a.AddGroupMember?this.contactService.triggerAddMember(n.data):n.name==h.a.GroupAppendixUpdated?this.contactService.triggerGroupAppendixUpdated(n.data):n.name==h.a.SignOut&&this.contactService.triggerSignOut(n.data):i.a.Logger.w("ContactPipelineListener","Pipeline error: "+n.name+" - "+n.getStateCode())}},{key:"onOpened",value:function(e){var t=this;if(v(b(a.prototype),"onOpened",this).call(this,e),null!=this.contactService.self)if(this.contactService.selfReady)var n=setTimeout((function(){clearTimeout(n),t.contactService.comeback()}),100);else{i.a.Logger.d("ContactPipelineListener",'Call "SignIn" in "onOpened": '+this.contactService.self.getId());var r=setTimeout((function(){clearTimeout(r),t.contactService.signIn(t.contactService.self)}),100)}}},{key:"onClosed",value:function(e){v(b(a.prototype),"onClosed",this).call(this,e)}},{key:"onFailed",value:function(e,t){v(b(a.prototype),"onFailed",this).call(this,e,t)}}])&&d(t.prototype,n),r&&d(t,r),a}(f.a),k=n(56),S=n(3),O=n(7),_=n(26),C=n(95),E=n.n(C),R=n(12),x=n(62);function P(e,t,n,r,i,o,a){try{var u=e[o](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,i)}function T(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){P(o,r,i,a,u,"next",e)}function u(e){P(o,r,i,a,u,"throw",e)}a(void 0)}))}}function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var A=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.service=t,this.domain=null,this.db=null,this.groupStore=null,this.contactStore=null,this.appendixStore=null}var t,n,r;return t=e,(n=[{key:"open",value:function(e,t){if(null==this.db){i.a.Logger.d("ContactStorage","Open contact storage : "+t),this.domain=t;var n={name:"CubeContact-"+t+"-"+e,version:1,stores:[{name:"group",keyPath:"id",indexes:[{name:"id",keyPath:"id",unique:!0},{name:"lastActive",keyPath:"lastActive",unique:!1},{name:"creation",keyPath:"creation",unique:!1},{name:"state",keyPath:"state",unique:!1}]},{name:"contact",keyPath:"id",indexes:[{name:"id",keyPath:"id",unique:!0},{name:"last",keyPath:"last",unique:!1},{name:"timestamp",keyPath:"timestamp",unique:!1}]},{name:"appendix",keyPath:"id",indexes:[{name:"id",keyPath:"id",unique:!0}]},{name:"top",keyPath:"id",indexes:[{name:"id",keyPath:"id",unique:!0}]},{name:"config",keyPath:"item",indexes:[{name:"item",keyPath:"item",unique:!0}]}]};this.db=new E.a(n),this.groupStore=this.db.use("group"),this.contactStore=this.db.use("contact"),this.appendixStore=this.db.use("appendix"),this.topStore=this.db.use("top"),this.configStore=this.db.use("config")}}},{key:"close",value:function(){null!=this.db&&(i.a.Logger.d("MessagingStorage","Close contact storage : "+this.domain),this.db.close(),this.db=null)}},{key:"readContact",value:function(e,t){var n=this;T(regeneratorRuntime.mark((function r(){var i,o,a;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.contactStore.query("id",e);case 2:(i=r.sent).length>0?(o=i[0],a=O.a.create(o),t(a)):t(null);case 4:case"end":return r.stop()}}),r)})))()}},{key:"writeContact",value:function(e){var t=this;T(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.toJSON(),n.next=3,t.contactStore.put(r);case 3:case"end":return n.stop()}}),n)})))()}},{key:"containsGroup",value:function(e,t){var n=this;return null!=this.db&&(T(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.groupStore.query("id",e);case 2:r.sent.length>0?t(e,!0):t(e,!1);case 4:case"end":return r.stop()}}),r)})))(),!0)}},{key:"readGroups",value:function(e,t,n,r){var i=this;return null!=this.db&&(T(regeneratorRuntime.mark((function o(){var a,u,c,s,l,f,h,p,d,v,y;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(a=null,void 0!==r){o.next=7;break}return o.next=4,i.groupStore.select([{key:"lastActive",value:e,compare:">"},{key:"lastActive",value:t,compare:"<=",optional:!0}]);case 4:a=o.sent,o.next=12;break;case 7:for(u=[{key:"lastActive",value:e,compare:">"},{key:"lastActive",value:t,compare:"<=",optional:!0}],c=0;c<r.length;++c)u.push({key:"state",value:r[c],options:!0});return o.next=11,i.groupStore.select(u);case 11:a=o.sent;case 12:if(null!=a&&void 0!==a){o.next=15;break}return n(e,t,[]),o.abrupt("return");case 15:s=i.service.getSelf().getId(),l=[],f=0,h=0;case 19:if(!(h<a.length)){o.next=47;break}if(!((p=a[h]).lastActive>e&&p.lastActive<=t)){o.next=44;break}if(void 0===r){o.next=25;break}if(!(r.indexOf(p.state)<0)){o.next=25;break}return o.abrupt("continue",44);case 25:if(d=!1,p.ownerId==s){o.next=37;break}v=0;case 28:if(!(v<p.members.length)){o.next=35;break}if(p.members[v].id!=s){o.next=32;break}return d=!0,o.abrupt("break",35);case 32:++v,o.next=28;break;case 35:o.next=38;break;case 37:d=!0;case 38:if(d){o.next=40;break}return o.abrupt("continue",44);case 40:p.domain=i.domain,y=R.a.create(i.service,p),++f,function(){var r=T(regeneratorRuntime.mark((function r(o){var a,u;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,i.appendixStore.query("id",o.id);case 2:(a=r.sent).length>0&&(u=x.a.create(i.service,o,a[0]),o.appendix=u),l.push(o),f==l.length&&n(e,t,l);case 6:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()(y);case 44:++h,o.next=19;break;case 47:f==l.length&&n(e,t,l);case 48:case"end":return o.stop()}}),o)})))(),!0)}},{key:"readGroup",value:function(e,t){var n=this;null!=this.db?T(regeneratorRuntime.mark((function r(){var i,o,a;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.groupStore.query("id",e);case 2:null!=(i=r.sent)&&i.length>0?(o=i[0],a=R.a.create(n.service,o),T(regeneratorRuntime.mark((function r(){var i,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.appendixStore.query("id",e);case 2:(i=r.sent).length>0&&(o=x.a.create(n.service,a,i[0]),a.appendix=o),t(e,a);case 5:case"end":return r.stop()}}),r)})))()):t(e,null);case 4:case"end":return r.stop()}}),r)})))():t(e,null)}},{key:"writeGroup",value:function(e){var t=this;return null!=this.db&&(T(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return delete(r=e.toJSON()).domain,n.next=4,t.groupStore.put(r);case 4:case"end":return n.stop()}}),n)})))(),T(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.getAppendix().toJSON(),n.next=3,t.appendixStore.put(r);case 3:case"end":return n.stop()}}),n)})))(),!0)}},{key:"readTopList",value:function(e){var t=this;return null!=this.db&&(T(regeneratorRuntime.mark((function n(){var r,i;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.topStore.all();case 2:null!=(r=n.sent)&&r.length>0?(i=[],r.forEach((function(e){i.push(e)})),e(i)):e([]);case 4:case"end":return n.stop()}}),n)})))(),!0)}},{key:"writeTopList",value:function(e,t){var n=this;return null!=this.db&&(T(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.topStore.put({id:e,type:t});case 2:case"end":return r.stop()}}),r)})))(),!0)}},{key:"deleteTopList",value:function(e){var t=this;return null!=this.db&&(T(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.topStore.delete(e);case 2:case"end":return n.stop()}}),n)})))(),!0)}},{key:"emptyTopList",value:function(){var e=this;return null!=this.db&&(T(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.topStore.clear();case 2:case"end":return t.stop()}}),t)})))(),!0)}},{key:"readBlockList",value:function(e){var t=this;return null!=this.db&&(T(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.configStore.get("blockList");case 2:r=n.sent,e(null!=r?r.list:[]);case 4:case"end":return n.stop()}}),n)})))(),!0)}},{key:"writeBlockList",value:function(e){var t=this;return null!=this.db&&(T(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r={item:"blockList",list:e},n.next=3,t.configStore.put(r);case 3:case"end":return n.stop()}}),n)})))(),!0)}}])&&M(t.prototype,n),r&&M(t,r),e}(),N=n(39),j=n(37),I=n(64),L=n(5),F=n(104),D=n(105),B=n(89);function G(e){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function U(e,t,n,r,i,o,a){try{var u=e[o](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,i)}function H(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function z(e,t,n){return(z="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=W(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function J(e,t){return(J=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function V(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=W(e);if(t){var i=W(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return K(this,n)}}function K(e,t){return!t||"object"!==G(t)&&"function"!=typeof t?q(e):t}function q(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function W(e){return(W=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Z=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&J(e,t)}(f,e);var t,n,r,u=V(f);function f(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),(e=u.call(this,"Contact")).self=null,e.selfReady=!1,e.signing=!1,e.contacts=new o.a,e.groups=new o.a,e.pipelineListener=new w(q(e)),e.storage=new A(q(e)),e.listGroupsContext=null,e.appendixMap=new o.a,e.contextProviderCallback=null,e}return t=f,(n=[{key:"start",value:function(){return!!z(W(f.prototype),"start",this).call(this)&&(this.kernel.inspector.depositMap(this.contacts),this.kernel.inspector.depositMap(this.groups),this.pipeline.addListener(f.NAME,this.pipelineListener),!0)}},{key:"stop",value:function(){z(W(f.prototype),"stop",this).call(this),this.kernel.inspector.withdrawMap(this.contacts),this.kernel.inspector.withdrawMap(this.groups),null!=this.pipeline&&(this.pipeline.removeListener(f.NAME,this.pipelineListener),this.storage.close())}},{key:"isReady",value:function(){return this.selfReady}},{key:"getSelf",value:function(){return this.self}},{key:"hasSignedIn",value:function(){return this.selfReady}},{key:"signIn",value:function(e,t,n,r){var o=this;if(this.selfReady)return!1;if(this.signing)return!0;this.signing=!0,this.started||this.start(),e instanceof k.a?(this.self=e,this.self.domain=l.a.DOMAIN):this.self=new k.a(parseInt(e)),this.storage.open(this.self.id,l.a.DOMAIN),void 0!==t&&null!=t&&this.self.setName(t),void 0!==n&&null!=n&&this.self.setContext(n),void 0!==r&&null!=r&&this.self.resetDevice(r);var a=this.kernel.getModule(l.a.NAME),u=0;return function e(){if(o.pipeline.isReady()&&a.isReady())o._actvieAndSignIn(2);else{if(++u>=15)return;i.a.Logger.d("ContactService",'Pipeline "'+o.pipeline.getName()+'" is no ready');var t=setTimeout((function(){clearTimeout(t),e()}),1e3)}}(),!0}},{key:"_actvieAndSignIn",value:function(e){var t,n=this;(t=regeneratorRuntime.mark((function t(){var r,o,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.kernel.activeToken(n.self.getId());case 2:if(null!=(r=t.sent)){t.next=7;break}return i.a.Logger.w("ContactService","Auth token is null"),e>0&&(--e,i.a.Logger.i("ContactService","Retry signin - "+e),setTimeout((function(){n._actvieAndSignIn(e)}),2e3)),t.abrupt("return");case 7:o={self:n.self.toJSON(),token:r.toJSON()},a=new c.a(h.a.SignIn,o),n.pipeline.send(f.NAME,a);case 10:case"end":return t.stop()}}),t)})),function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function a(e){U(o,r,i,a,u,"next",e)}function u(e){U(o,r,i,a,u,"throw",e)}a(void 0)}))})()}},{key:"signOut",value:function(e){if(!this.selfReady||null==this.self)return!1;if(!this.pipeline.isReady())return i.a.Logger.w("ContactService",'Pipeline "'+this.pipeline.getName()+'" is no ready'),!1;var t=this.self,n=new c.a(h.a.SignOut,this.self.toJSON());return this.pipeline.send(f.NAME,n,void 0!==e?function(n,r,i){null!=i&&i.getStateCode()==s.a.OK&&i.data.code==L.a.Ok&&e(t)}:void 0),!0}},{key:"comeback",value:function(){var e=this;if(null!=this.self){var t=new c.a(h.a.Comeback,this.self.toJSON());this.pipeline.send(f.NAME,t,(function(t,n,r){null!=r&&r.getStateCode()==s.a.OK&&r.data.code==L.a.Ok&&(i.a.Logger.d("ContactService","Self comeback OK"),e.notifyObservers(new S.a(_.a.Comeback,e.self)))}))}}},{key:"triggerSignIn",value:function(e){var t=this;if(this.signing=!1,e.code==L.a.Ok){var n=e.data;null==this.self&&(this.self=new k.a(n.id)),i.a.Logger.d("ContactService","Trigger SignIn: "+this.self.getId());var r=!1,o=!1,a=!1,u=!1,c=function(){r&&o&&a&&u&&(i.a.Logger.d("ContactService","Self is ready"),new Promise((function(e,t){e()})).then((function(){t.selfReady=!0,t.notifyObservers(new S.a(_.a.SignIn,t.self))})).catch((function(e){})))},s=Date.now();this.listGroups(s-this.defaultRetrospect,s,(function(e){i.a.Logger.d("ContactService","List groups number: "+e.length),r=!0,c()})),this.listBlockList((function(){i.a.Logger.d("ContactService","List block list finish"),o=!0,c()}),(function(e){o=!0,c()})),this.listTopList((function(){i.a.Logger.d("ContactService","List top list finish"),a=!0,c()}),(function(e){a=!0,c()})),this.self.name=n.name;for(var l=n.devices,f=0;f<l.length;++f)this.self.devices[f]=N.a.create(l[f]);void 0!==n.context&&this.self.setContext(n.context),this.getAppendix(this.self,(function(e){i.a.Logger.d("ContactService","Get appendix finish"),u=!0,c()}),(function(e){i.a.Logger.w("ContactService","Get self appendix: "+e),u=!0,c()}))}else i.a.Logger.e("ContactService","SignIn failed: "+e.code)}},{key:"triggerSignOut",value:function(e){if(e.code==L.a.Ok){i.a.Logger.d("ContactService","Trigger SignOut: "+this.self.getId());var t=this.self;this.self=null,this.selfReady=!1,this.notifyObservers(new S.a(_.a.SignOut,t))}else i.a.Logger.e("ContactService","SignOut failed: "+e.code)}},{key:"setContextProviderCallback",value:function(e){this.contextProviderCallback=e}},{key:"getLocalContact",value:function(e,t,n){var r=this;if(e!=this.self.id){var i=this.contacts.get(e);null==i?this.storage.readContact(e,(function(i){if(null!=i)null==i.context&&null!=r.contextProviderCallback?r.contextProviderCallback(i,new B.a(i,(function(e){r.getAppendix(e,(function(n){e.appendix=n,r.contacts.put(e.id,e),t(e)}),(function(e){n(e)}))}))):r.getAppendix(i,(function(e){i.appendix=e,r.contacts.put(i.id,i),t(i)}),(function(e){n(e)}));else{var o=new a.a(f.NAME,L.a.NotFindContact,e);n(o)}})):t(i)}else t(this.self)}},{key:"getContact",value:function(e,t,n){var r=this;if(this.selfReady){var i=e;"string"==typeof e?i=parseInt(e):e instanceof O.a&&(i=e.getId());var o=new Promise((function(e,t){if(i!=r.self.id){var n=r.contacts.get(i);null==n?r.storage.readContact(i,(function(n){if(null!=n&&n.isValid())null==n.context&&null!=r.contextProviderCallback?r.contextProviderCallback(n,new B.a(n,(function(n){r.contacts.put(n.getId(),n),r.getAppendix(n,(function(t){n.appendix=t,e(n)}),(function(e){t(e)}))}))):(r.contacts.put(n.getId(),n),r.getAppendix(n,(function(t){n.appendix=t,e(n)}),(function(e){t(e)})));else{var o=new c.a(h.a.GetContact,{id:i,domain:l.a.DOMAIN});r.pipeline.send(f.NAME,o,(function(n,o,u){if(null!=u&&u.getStateCode()==s.a.OK)if(u.data.code==L.a.Ok){var c=O.a.create(u.data.data);null==c.context&&null!=r.contextProviderCallback?r.contextProviderCallback(c,new B.a(c,(function(n){r.contacts.put(n.getId(),n),r.storage.writeContact(n),r.getAppendix(n,(function(t){n.appendix=t,e(n)}),(function(e){t(e)}))}))):(r.contacts.put(c.getId(),c),r.storage.writeContact(c),r.getAppendix(c,(function(t){c.appendix=t,e(c)}),(function(e){t(e)}))),c.resetUpdateTime(Date.now())}else t(new a.a(f.NAME,u.data.code,i));else t(new a.a(f.NAME,L.a.ServerError,i))}))}})):e(n)}else null==r.self.context&&null!=r.contextProviderCallback?r.contextProviderCallback(n,new B.a(n,(function(t){e(r.self)}))):e(r.self)}));if(t&&n)o.then((function(e){t(e)})).catch((function(e){n(e)}));else{if(!t)return o;o.then((function(e){t(e)})).catch((function(){}))}}else n&&n(new a.a(f.NAME,L.a.NotAllowed,e))}},{key:"getContactZone",value:function(e,t,n){var r=this,i=new c.a(h.a.GetContactZone,{name:e});this.pipeline.send(f.NAME,i,(function(i,o,u){null!=u&&u.getStateCode()==s.a.OK?u.data.code==L.a.Ok?t(new D.a(u.data.data,r)):n&&n(new a.a(f.NAME,u.data.code,e)):n&&n(new a.a(f.NAME,L.a.ServerError,e))}))}},{key:"createContactZone",value:function(e,t,n,r,i){var o=this,u=new c.a(h.a.CreateContactZone,{name:e,contacts:n,displayName:null!=t&&void 0!==t?t:e});this.pipeline.send(f.NAME,u,(function(t,n,u){null!=u&&u.getStateCode()==s.a.OK?u.data.code==L.a.Ok?r(new D.a(u.data.data,o)):i&&i(new a.a(f.NAME,u.data.code,e)):i&&i(new a.a(f.NAME,L.a.ServerError,e))}))}},{key:"getPendingZone",value:function(e,t,n){}},{key:"containsContactInZone",value:function(e,t,n,r){t instanceof O.a&&(t=t.getId());var i=new c.a(h.a.ContainsContactInZone,{name:e,contactId:t});this.pipeline.send(f.NAME,i,(function(t,i,o){if(null!=o&&o.getStateCode()==s.a.OK)if(o.data.code==L.a.Ok){var u=o.data.data;n(u.contained,u.name,u.contactId)}else r&&r(new a.a(f.NAME,o.data.code,e));else r&&r(new a.a(f.NAME,L.a.ServerError,e))}))}},{key:"addContactToZone",value:function(e,t,n,r,i){if(t instanceof O.a&&(t=t.getId()),t!=this.self.getId()){void 0!==n&&null!=n||(n="");var o=new c.a(h.a.AddContactToZone,{name:e,contactId:t,postscript:n});this.pipeline.send(f.NAME,o,(function(n,o,u){null!=u&&u.getStateCode()==s.a.OK?u.data.code==L.a.Ok?r&&r(e,t):i&&i(new a.a(f.NAME,u.data.code,e)):i&&i(new a.a(f.NAME,L.a.ServerError,e))}))}else i&&i(new a.a(f.NAME,L.a.IllegalOperation,e))}},{key:"removeContactFromZone",value:function(e,t,n,r){t instanceof O.a&&(t=t.getId());var i=new c.a(h.a.RemoveContactFromZone,{name:e,contactId:t});this.pipeline.send(f.NAME,i,(function(i,o,u){null!=u&&u.getStateCode()==s.a.OK?u.data.code==L.a.Ok?n&&n(e,t):r&&r(new a.a(f.NAME,u.data.code,e)):r&&r(new a.a(f.NAME,L.a.ServerError,e))}))}},{key:"modifyContact",value:function(e,t,n,r){var i=this;if(this.selfReady){var o=new Promise((function(n,r){var o={name:e,context:t};null==e&&delete o.name,null==t&&delete o.context;var u=new c.a(h.a.ModifyContact,o);i.pipeline.send(f.NAME,u,(function(e,t,u){if(null!=u&&u.getStateCode()==s.a.OK)if(u.data.code==L.a.Ok){var c=u.data.data;i.self.name=c.name,i.self.context=c.context,n(i.self)}else r(new a.a(f.NAME,u.data.code,o));else r(new a.a(f.NAME,L.a.ServerError,o))}))}));if(n&&r)o.then((function(e){n(e)})).catch((function(e){r(e)}));else{if(!n)return o;o.then((function(e){n(e)})).catch((function(){}))}}else r&&r(new a.a(f.NAME,L.a.NotAllowed,contactId))}},{key:"getGroup",value:function(e,t,n){var r=this;"string"==typeof e&&(e=parseInt(e));var o=new Promise((function(t,n){var i=r.groups.get(e);null==i?r.storage.readGroup(e,(function(e,i){if(null==i){var o=new c.a(h.a.GetGroup,{id:e,domain:l.a.DOMAIN});r.pipeline.send(f.NAME,o,(function(i,o,u){if(null!=u&&u.getStateCode()==s.a.OK&&null!=u.data)if(u.data.code==L.a.Ok){var c=R.a.create(r,u.data.data);r.getAppendix(c,(function(e,n){r.groups.put(n.getId(),n),r.storage.writeGroup(n),t(n)}),(function(e){n(e)}))}else n(new a.a(f.NAME,u.data.code,e));else n(new a.a(f.NAME,L.a.ServerError,e))}))}else r.getAppendix(i,(function(e){t(i)}),(function(e){n(e)}))})):null==i.getAppendix()?r.getAppendix(i,(function(e){t(i)}),(function(e){n(e)})):t(i)}));if(t&&n)o.then((function(e){t(e)})).catch((function(e){n(e)}));else{if(!t)return o;o.then((function(e){t(e)})).catch((function(e){i.a.Logger.d(f.NAME,"#getGroup "+e.toString())}))}}},{key:"updateGroupActiveTime",value:function(e,t){var n=this,r=this.groups.get(e);null!=r&&t>r.lastActiveTime&&(r.lastActiveTime=t),this.storage.readGroup(e,(function(e,r){null!=r&&t>r.lastActiveTime&&(r.lastActiveTime=t,n.storage.writeGroup(r))}))}},{key:"sortGroup",value:function(e,t){var n=e.lastActiveTime,r=t.lastActiveTime;return n<r?1:n>r?-1:0}},{key:"queryGroups",value:function(e,t,n,r){var i=this;"function"==typeof e?(n=e,r=t,e=0,t=Date.now()):"function"==typeof t&&(r=n=t,t=Date.now()),void 0===r&&(r=[j.a.Normal]),this.storage.readGroups(e,t,(function(e,t,r){for(var o=r.sort((function(e,t){return i.sortGroup(e,t)})),a=[],u=0,c=0;c<o.length;++c){var s=o[c],l=i.groups.get(s.id);null!=l&&(s=l),s.state==j.a.Normal&&"public"==s.tag&&(++u,null==s.appendix?i.getAppendix(s,(function(e,t){a.push(t),u==a.length&&n(a)}),(function(e){e.data.appendix=new x.a(i,e.data),a.push(e.data),u==a.length&&n(a)})):a.push(s),null==l&&i.groups.put(s.getId(),s))}u==a.length&&n(a)}),r)||n([])}},{key:"listGroups",value:function(e,t,n){var r=this;if(void 0===e||null!=this.listGroupsContext)return!1;if("function"==typeof e?(n=e,e=0,t=0):"function"==typeof t&&(n=t,t=Date.now()),e>t)return!1;this.listGroupsContext={total:-1,list:[],timer:0,handler:n},this.listGroupsContext.timer=setTimeout((function(){clearTimeout(r.listGroupsContext.timer),r.listGroupsContext.handler([]),r.listGroupsContext=null}),15e3);var i=new c.a(h.a.ListGroups,{beginning:e,ending:t});return this.pipeline.send(f.NAME,i),!0}},{key:"triggerListGroups",value:function(e){var t=this,n=e.data,r=n.list,a=n.total;if(this.listGroupsContext.total<0&&(this.listGroupsContext.total=a),0==r.length)return clearTimeout(this.listGroupsContext.timer),this.listGroupsContext.timer=0,this.listGroupsContext.handler(this.listGroupsContext.list),void(this.listGroupsContext=null);for(var u=new o.a,c=0;c<r.length;++c){var s=R.a.create(this,r[c]);u.put(s.getId(),s),s.getOwner().equals(this.self)&&(s.owner=this.self),s.getState()==j.a.Normal&&this.groups.put(s.getId(),s),this.getAppendix(s,(function(e,n){t.storage.readGroup(n.getId(),(function(e,r){if(null!=r)r.lastActiveTime!=n.lastActiveTime&&t.notifyObservers(new S.a(_.a.GroupUpdated,u.get(r.getId())));else{var i=u.get(e);i.getState()!=j.a.Normal&&i.getState()!=j.a.Dismissed||t.notifyObservers(new S.a(_.a.GroupUpdated,i))}t.storage.writeGroup(u.get(e))})),t.listGroupsContext.list.push(n),t.listGroupsContext.list.length==a&&(clearTimeout(t.listGroupsContext.timer),t.listGroupsContext.timer=0,t.listGroupsContext.handler(t.listGroupsContext.list),t.listGroupsContext=null)}),(function(e){i.a.Logger.e("ContactService","#triggerListGroups() - #getAppendix(): "+e),t.listGroupsContext.list.push(e.data),t.listGroupsContext.list.length==a&&(clearTimeout(t.listGroupsContext.timer),t.listGroupsContext.timer=0,t.listGroupsContext.handler(t.listGroupsContext.list),t.listGroupsContext=null)}))}}},{key:"createGroup",value:function(e,t,n,r){var o=this;if(0!=e.length&&null!=t)if(this.pipeline.isReady()){var u=this.self,l=new R.a(this,u);l.setName(e);for(var p=[],d=0;d<t.length;++d){var v=t[d];v instanceof O.a?p.push(v.id):"number"==typeof v?p.push(v):"string"==typeof v&&p.push(parseInt(v))}var y={group:l.toCompactJSON(),members:p},g=new c.a(h.a.CreateGroup,y);this.pipeline.send(f.NAME,g,(function(e,t,c){if(null!=c)if(c.getStateCode()==s.a.OK)if(c.getPayload().code==L.a.Ok){var h=c.getPayload().data,p=R.a.create(o,h,u);o.getAppendix(p,(function(e,t){o.storage.writeGroup(t),o.groups.put(t.getId(),t),setTimeout((function(){n(t),o.notifyObservers(new S.a(_.a.GroupCreated,l))}),0)}),(function(e){r&&r(e)}))}else{i.a.Logger.w("ContactService","Create group failed, state code: "+c.getPayload().code);var d=new a.a(f.NAME,c.getPayload().code,l);r&&r(d)}else{i.a.Logger.w("ContactService","Create group failed: "+c.getStateCode());var v=new a.a(f.NAME,L.a.ServerError,l);r&&r(v)}else{i.a.Logger.w("ContactService","Create group failed: response packet is null");var y=new a.a(f.NAME,L.a.Failure,l);r&&r(y)}}))}else{var m=new a.a(f.NAME,L.a.NoNetwork,e);r(m)}else{var b=new a.a(f.NAME,L.a.InvalidParameter,e);r(b)}}},{key:"triggerCreateGroup",value:function(e){var t=this;if(e.code==L.a.Ok){var n=function(e){e.getOwner().equals(t.self)?(t.groups.put(e.getId(),e),t.storage.writeGroup(e)):(e.getMembers((function(e,n){for(var r=0;r<e.length;++r)if(e[r].equals(t.self)){e[r]=t.self;break}})),t.groups.put(e.getId(),e),t.storage.writeGroup(e)),t.notifyObservers(new S.a(_.a.GroupCreated,e))},r=null==context?R.a.create(this,e.data):context;null==r.appendix?this.getAppendix(r,(function(e){n(r)}),(function(e){i.a.Logger.e("ContactService",e.toString())})):n(r)}}},{key:"dismissGroup",value:function(e,t,n){var r=this;if(e.getOwner().getId()!=this.self.getId()){var o=new a.a(f.NAME,L.a.NotAllowed,e);return n&&n(o),!1}var u=new c.a(h.a.DismissGroup,e.toCompactJSON());return this.pipeline.send(f.NAME,u,(function(o,u,c){if(null==c||c.getStateCode()!=s.a.OK){var l=new a.a(f.NAME,L.a.ServerError,e);return i.a.Logger.w("ContactService","Dismiss group failed - "+l),void(n&&n(l))}if(c.getPayload().code!=L.a.Ok){var h=new a.a(f.NAME,c.getPayload().code,e);return i.a.Logger.w("ContactService","Dismiss group failed - "+h),void(n&&n(h))}var p=R.a.create(r,c.getPayload().data,r.self);r.getAppendix(p,(function(){r.groups.put(p.getId(),p),t&&setTimeout((function(){t(p)}),0),r.notifyObservers(new S.a(_.a.GroupDismissed,p))}),(function(e){n&&n(e)}))})),!0}},{key:"triggerDismissGroup",value:function(e){var t=this;if(e.code==L.a.Ok){var n=R.a.create(this,e.data);new Promise((function(e,r){null==n.appendix?t.getAppendix(n,(function(){e(n)}),(function(e){r(e)})):e(n)})).then((function(e){e.getOwner().equals(t.self),t.groups.put(e.getId(),e),t.storage.writeGroup(e),t.notifyObservers(new S.a(_.a.GroupDismissed,e))})).catch((function(e){i.a.Logger.e("ContactService","#triggerDismissGroup() "+e)}))}}},{key:"quitGroup",value:function(e,t,n){var r=this,i=this.self.getId();if(!e.hasMember(this.self)){var o=new a.a(f.NAME,L.a.NotAllowed,e);return n&&n(o),!1}if(e.getOwner().getId()==i){var u=new a.a(f.NAME,L.a.NotAllowed,e);return n&&n(u),!1}var l=this.self.toCompactJSON(),p=new c.a(h.a.RemoveGroupMember,{groupId:e.getId(),memberIdList:[i],operator:l});return this.pipeline.send(f.NAME,p,(function(i,o,u){if(null!=u&&u.getStateCode()==s.a.OK)if(u.getPayload().code==L.a.Ok){var c=I.a.create(r,u.getPayload().data);c.group.appendix=e.appendix,c.includeSelf&&(c.group.state=j.a.Disabled,e.state=j.a.Disabled);for(var l=c.modified,h=0;h<l.length;++h)e._removeMember(l[h]);t&&t(c.group)}else{var p=new a.a(f.NAME,u.getPayload().code,e);n&&n(p)}else{var d=new a.a(f.NAME,L.a.ServerError,e);n&&n(d)}})),!0}},{key:"removeGroupMembers",value:function(e,t,n,r){for(var i=this,o=[],u=e.getOwner().getId(),l=0;l<t.length;++l){var p=t[l];if(p instanceof O.a){if(p.getId()==u)continue;e.hasMember(p)&&o.push(p.getId())}else{if(p==u)continue;e.hasMember(p)&&o.push(p)}}if(0==o.length){var d=new a.a(f.NAME,L.a.NotAllowed,{group:e,members:t,operator:this.self});return r&&r(d),!1}var v=this.self,y=new c.a(h.a.RemoveGroupMember,{groupId:e.getId(),memberIdList:o,operator:v.toCompactJSON()});return this.pipeline.send(f.NAME,y,(function(o,u,c){if(null!=c&&c.getStateCode()==s.a.OK)if(c.getPayload().code==L.a.Ok){var l=I.a.create(i,c.getPayload().data);l.group.appendix=e.appendix,l.includeSelf&&(l.group.state=j.a.Disabled,e.state=j.a.Disabled);for(var h=l.modified,p=0;p<h.length;++p)e._removeMember(h[p]);n&&n(l),i.notifyObservers(new S.a(_.a.GroupMemberRemoved,l))}else{var d=new a.a(f.NAME,c.getPayload().code,{group:e,members:t,operator:v});r&&r(d)}else{var y=new a.a(f.NAME,L.a.ServerError,{group:e,members:t,operator:v});r&&r(y)}})),!0}},{key:"triggerRemoveMember",value:function(e){var t=this;if(e.code==L.a.Ok){var n=I.a.create(this,e.data),r=n.group;new Promise((function(e,n){null==r.appendix?t.getAppendix(r,(function(){e(r)})):e(r)})).then((function(e){n.includeSelf?(t.groups.remove(e.getId()),e.state=j.a.Disabled):t.groups.put(e.getId(),e),t.storage.writeGroup(e),t.notifyObservers(new S.a(_.a.GroupMemberRemoved,n))})).catch((function(e){}))}}},{key:"addGroupMembers",value:function(e,t,n,r){var i=this,o=null,u=null;t[0]instanceof O.a?u=[]:o=[];for(var l=0;l<t.length;++l){var p=t[l];e.hasMember(p)||(null!=u?u.push(p.toCompactJSON()):o.push(p))}if(null!=u&&0==u.length){var d=new a.a(f.NAME,L.a.NotAllowed,{group:e,members:t,operator:this.self});return r&&r(d),!1}if(null!=o&&0==o.length){var v=new a.a(f.NAME,L.a.NotAllowed,{group:e,members:t,operator:this.self});return r&&r(v),!1}var y=this.self,g=null;return g=null!=u?new c.a(h.a.AddGroupMember,{groupId:e.getId(),memberList:u,operator:y.toCompactJSON()}):new c.a(h.a.AddGroupMember,{groupId:e.getId(),memberIdList:o,operator:y.toCompactJSON()}),this.pipeline.send(f.NAME,g,(function(o,u,c){if(null!=c&&c.getStateCode()==s.a.OK)if(c.getPayload().code==L.a.Ok){var l=I.a.create(i,c.getPayload().data);l.group.appendix=e.appendix;for(var h=l.modified,p=0;p<h.length;++p)e.memberList.push(h[p]);n&&n(l),i.notifyObservers(new S.a(_.a.GroupMemberAdded,l))}else{var d=new a.a(f.NAME,L.a.ServerError,{group:e,members:t,operator:y});r&&r(d)}else{var v=new a.a(f.NAME,L.a.ServerError,{group:e,members:t,operator:y});r&&r(v)}})),!0}},{key:"triggerAddMember",value:function(e){var t=this;if(e.code==L.a.Ok){var n=I.a.create(this,e.data),r=n.group;new Promise((function(e,n){null==r.appendix?t.getAppendix(r,(function(){e(r)})):e(r)})).then((function(e){t.groups.put(e.getId(),e),t.storage.writeGroup(e),n.includeSelf?t.notifyObservers(new S.a(_.a.GroupUpdated,e)):t.notifyObservers(new S.a(_.a.GroupMemberAdded,n))})).catch((function(e){}))}}},{key:"modifyGroup",value:function(e,t,n,r,i,o){var u=this;if(null==t&&null==n&&null==r){var l=new a.a(f.NAME,L.a.NotAllowed,e);return o&&o(l),!1}var p={groupId:e.getId()};null!=t&&t instanceof O.a&&e.isOwner(this.self)&&e.hasMember(t)&&(p.owner=t.toCompactJSON()),null!=n&&"string"==typeof n&&(p.name=n),null!=r&&(p.context=r);var d=new c.a(h.a.ModifyGroup,p);return this.pipeline.send(f.NAME,d,(function(t,n,r){if(null!=r&&r.getStateCode()==s.a.OK)if(r.getPayload().code==L.a.Ok){var c=R.a.create(u,r.getPayload().data);c.appendix=e.appendix,e.owner=c.owner,e.name=c.name,e.context=c.context,e.lastActiveTime=c.lastActiveTime,i&&i(e),u.notifyObservers(new S.a(_.a.GroupUpdated,e))}else{var l=new a.a(f.NAME,r.getPayload().code,e);o&&o(l)}else{var h=new a.a(f.NAME,L.a.ServerError,e);o&&o(h)}})),!0}},{key:"triggerModifyGroup",value:function(e){var t=this;if(e.code==L.a.Ok){var n=R.a.create(this,e.data);new Promise((function(e,r){null==n.appendix?t.getAppendix(n,(function(){e(n)})):e(n)})).then((function(e){t.groups.put(e.getId(),e),t.storage.writeGroup(e),t.notifyObservers(new S.a(_.a.GroupUpdated,e))})).catch((function(e){}))}}},{key:"modifyGroupMember",value:function(e,t,n,r){var i=this;if(!e.hasMember(t)){var o=new a.a(f.NAME,L.a.NotAllowed,e);return r&&r(o),!1}var u={groupId:e.getId(),member:t.toCompactJSON()},l=new c.a(h.a.ModifyGroupMember,u);return this.pipeline.send(f.NAME,l,(function(o,u,c){if(null!=c&&c.getStateCode()==s.a.OK)if(c.getPayload().code==L.a.Ok){var l=I.a.create(i,c.getPayload().data);l.group.appendix=e.appendix;var h=l.modified[0];e.lastActiveTime=l.group.lastActiveTime,e._replaceMember(h),n&&n(e,h)}else{var p=new a.a(f.NAME,c.getPayload().code,{group:e,member:t});r&&r(p)}else{var d=new a.a(f.NAME,L.a.ServerError,{group:e,member:t});r&&r(d)}})),!0}},{key:"triggerModifyGroupMember",value:function(e){var t=this;if(e.code==L.a.Ok){var n=I.a.create(this,e.data),r=n.group,i=n.modified[0];new Promise((function(e,n){null==r.appendix?t.getAppendix(r,(function(){e(r)})):e(r)})).then((function(e){var n=t.groups.get(r.getId());null!=n?(n.lastActiveTime=r.lastActiveTime,n._replaceMember(i),t.storage.writeGroup(n)):t.storage.readGroup(e.getId(),(function(e,n){null!=n&&(n.lastActiveTime=r.lastActiveTime,n._replaceMember(i),t.storage.writeGroup(n))}))})).catch((function(e){}))}}},{key:"getAppendix",value:function(e,t,n){var r=this,i=null;if(e instanceof R.a){var o=this.appendixMap.get(e.getId());if(null!=o)return null==e.appendix&&(e.appendix=o),void(t&&t(o,e));i={groupId:e.getId()}}else{if(!(e instanceof O.a)){var u=new a.a(f.NAME,L.a.NotAllowed,e);return void(n&&n(u))}var p=this.appendixMap.get(e.getId());if(null!=p)return null==e.appendix&&(e.appendix=p),void(t&&t(p,e));i={contactId:e.getId()}}var d=new c.a(h.a.GetAppendix,i);this.pipeline.send(f.NAME,d,(function(o,u,c){if(null!=c&&c.getStateCode()==s.a.OK)if(c.getPayload().code==L.a.Ok){var h=c.getPayload().data;if(void 0!==i.contactId&&void 0!==h.contact){var p=e;null==p&&(p=O.a.create(h.contact,l.a.DOMAIN));var d=new F.a(r,p);d.remarkName=h.remarkName,h.assignedData&&(d.assignedData=h.assignedData),p.appendix=d,r.appendixMap.put(p.getId(),d),t&&t(d,e)}else{var v=e;null==v&&(v=R.a.create(r,h.group));var y=new x.a(r,v);y.remark=h.remark,y.notice=h.notice,y.commId=h.commId,y.setMemberRemarks(h.memberRemarks),v.appendix=y,r.appendixMap.put(v.getId(),y),t&&t(y,e)}}else{var g=new a.a(f.NAME,c.getPayload().code,e);n&&n(g)}else{var m=new a.a(f.NAME,L.a.ServerError,e);n&&n(m)}}))}},{key:"remarkGroup",value:function(e,t,n,r){this.getAppendix(e,(function(e){e.updateRemark(t,n,r)}),(function(e){r&&r(e)}))}},{key:"remarkContactName",value:function(e,t,n,r){this.getAppendix(e,(function(e){e.updateRemarkName(t,n,r)}),(function(e){r&&r(e)}))}},{key:"triggerGroupAppendixUpdated",value:function(e){var t=this,n=e.data;this.getGroup(n.group.id,(function(e){var r=x.a.create(t,e,n);e.appendix=r,t.appendixMap.put(e.getId(),r),t.notifyObservers(new S.a(_.a.GroupAppendixUpdated,e))}),(function(e){i.a.Logger.e(f.NAME,e.toString())}))}},{key:"listBlockList",value:function(e,t){var n=this,r=new c.a(h.a.BlockList,{action:"get"});this.pipeline.send(f.NAME,r,(function(r,i,o){if(null!=o&&o.getStateCode()==s.a.OK)if(o.data.code==L.a.Ok){var u=o.data.data.list;n.storage.writeBlockList(u),e&&e(u)}else{var c=new a.a(f.NAME,o.data.code,"get");t&&t(c)}else{var l=new a.a(f.NAME,L.a.ServerError,"get");t&&t(l)}}))}},{key:"queryBlockList",value:function(e,t){this.storage.readBlockList((function(t){e(t)}))||t&&t(new a.a(f.NAME,L.a.IllegalOperation,null))}},{key:"addBlockList",value:function(e,t,n){var r=this,i=e instanceof O.a?e.getId():e;if(i!=this.self.getId()){var o=new c.a(h.a.BlockList,{action:"add",blockId:i});this.pipeline.send(f.NAME,o,(function(e,o,u){if(null!=u&&u.getStateCode()==s.a.OK)if(u.data.code==L.a.Ok){var c=u.data.data;r.storage.writeBlockList(c.list),t&&t(i,c.list)}else{var l=new a.a(f.NAME,u.data.code,i);n&&n(l)}else{var h=new a.a(f.NAME,L.a.ServerError,i);n&&n(h)}}))}}},{key:"removeBlockList",value:function(e,t,n){var r=this,i=e instanceof O.a?e.getId():e,o=new c.a(h.a.BlockList,{action:"remove",blockId:i});this.pipeline.send(f.NAME,o,(function(e,o,u){if(null!=u&&u.getStateCode()==s.a.OK)if(u.data.code==L.a.Ok){var c=u.data.data;r.storage.writeBlockList(c.list),t&&t(i,c.list)}else{var l=new a.a(f.NAME,u.data.code,i);n&&n(l)}else{var h=new a.a(f.NAME,L.a.ServerError,i);n&&n(h)}}))}},{key:"listTopList",value:function(e,t){var n=this,r=new c.a(h.a.TopList,{action:"get"});this.pipeline.send(f.NAME,r,(function(r,i,o){if(null!=o&&o.getStateCode()==s.a.OK)if(o.data.code==L.a.Ok){n.storage.emptyTopList();for(var u=o.data.data.list,c=0;c<u.length;++c){var l=u[c];n.storage.writeTopList(l.id,l.type)}e&&e(u)}else{var h=new a.a(f.NAME,o.data.code,"get");t&&t(h)}else{var p=new a.a(f.NAME,L.a.ServerError,"get");t&&t(p)}}))}},{key:"queryTopList",value:function(e,t){this.storage.readTopList((function(t){e(t)}))||t&&t(new a.a(f.NAME,L.a.IllegalOperation,null))}},{key:"addTopList",value:function(e,t,n){var r=this,i=new c.a(h.a.TopList,{action:"add",topId:e.getId(),type:e instanceof R.a?"group":"contact"});this.pipeline.send(f.NAME,i,(function(i,o,u){if(null!=u&&u.getStateCode()==s.a.OK)if(u.data.code==L.a.Ok){var c=u.data.data;r.storage.writeTopList(c.topId,c.type),t&&t(e)}else{var l=new a.a(f.NAME,u.data.code,e);n&&n(l)}else{var h=new a.a(f.NAME,L.a.ServerError,e);n&&n(h)}}))}},{key:"removeTopList",value:function(e,t,n){var r=this,i=new c.a(h.a.TopList,{action:"remove",topId:e.getId()});this.pipeline.send(f.NAME,i,(function(i,o,u){if(null!=u&&u.getStateCode()==s.a.OK)if(u.data.code==L.a.Ok){var c=u.data.data;r.storage.deleteTopList(c.topId),t&&t(e)}else{var l=new a.a(f.NAME,u.data.code,e);n&&n(l)}else{var h=new a.a(f.NAME,L.a.ServerError,e);n&&n(h)}}))}},{key:"search",value:function(e,t,n){var r=this,i=new c.a(h.a.Search,{keyword:e.toString()});this.pipeline.send(f.NAME,i,(function(i,o,u){if(null!=u&&u.getStateCode()==s.a.OK)if(u.data.code==L.a.Ok){var c=u.data.data,l=c.contactList.length,h=c.groupList.length,p=0==l,d=0==h;if(p&&d)t(c);else{for(var v=[],y=[],g=function(){p&&d&&(c.contactList=v,c.groupList=y,t(c))},m=0;m<l;++m){var b=c.contactList.shift();r.getContact(b.id,(function(e){v.push(e),v.length==l&&(p=!0,g())}))}for(var w=0;w<h;++w){var k=c.groupList.shift();r.getGroup(k.id,(function(e){y.push(e),y.length==h&&(d=!0,g())}))}}}else{var S=new a.a(f.NAME,u.data.code,e);n&&n(S)}else{var O=new a.a(f.NAME,L.a.ServerError,e);n&&n(O)}}))}}])&&H(t.prototype,n),r&&H(t,r),f}(u.a);!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(Z,"NAME","Contact")},function(e,t,n){"use strict";n.d(t,"a",(function(){return w}));var r=n(1),i=n.n(r),o=n(125),a=n(7),u=n(11),c=n(37),s=n(56),l=n(15),f=n(0),h=n(5);n(62);function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e,t,n){return(v="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=b(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=b(e);if(t){var i=b(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return m(this,n)}}function m(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var w=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(p,e);var t,n,r,o=g(p);function p(e,t,n,r,a){var u;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p),(u=o.call(this,void 0===n?i.a.Utils.generateSerialNumber():n,r,void 0===a?l.a.DOMAIN:a)).service=e,u.owner=t,u.ownerId=null!=t?t.id:0,u.tag="public",u.creationTime=0,u.lastActiveTime=0,u.memberIdList=0!=u.ownerId?[u.ownerId]:[],u.state=c.a.Normal,u.appendix=null,u}return t=p,r=[{key:"create",value:function(e,t,n){var r=new p(e,null,t.id,t.name,t.domain);if(r.ownerId=t.ownerId,r.tag=t.tag,r.creationTime=t.creation,r.lastActiveTime=t.lastActive,r.state=t.state,void 0!==t.members)for(var i=0;i<t.members.length;++i){var o=t.members[i];r.memberIdList.push(o)}return void 0!==t.context&&(r.context=t.context),void 0===n&&e.getContact(t.ownerId,(function(e){r.owner=e}),(function(e){})),r}}],(n=[{key:"changeOwner",value:function(e,t,n){return e instanceof a.a?this.service.modifyGroup(this,e,null,null,t,n):(n&&n(new f.a(u.a.NAME,h.a.NotAllowed,this)),!1)}},{key:"modifyName",value:function(e,t,n){return e==this.name?(n&&n(new f.a(u.a.NAME,h.a.NotAllowed,this)),!1):this.service.modifyGroup(this,null,e,null,t,n)}},{key:"modifyContext",value:function(e,t,n){return this.service.modifyGroup(this,null,null,e,t,n)}},{key:"getOwner",value:function(){return this.owner}},{key:"isOwner",value:function(e){return(e instanceof a.a||e instanceof s.a?e.getId():"number"==typeof e?e:this.service.getSelf().getId())==this.owner.id}},{key:"getCreationTime",value:function(){return this.creationTime}},{key:"getLastActiveTime",value:function(){return this.lastActiveTime}},{key:"getState",value:function(){return this.state}},{key:"getAppendix",value:function(){return null==this.appendix&&(this.appendix=this.service.appendixMap.get(this.id)),this.appendix}},{key:"getMemberName",value:function(e){return this.appendix.hasMemberRemark(e)?this.appendix.getMemberRemark(e):e.getPriorityName()}},{key:"getMemberById",value:function(e,t){this.memberIdList.indexOf(e)>=0?this.service.getContact(e,t,(function(e){t(null)})):t(null)}},{key:"numMembers",value:function(){return this.memberIdList.length}},{key:"getMemberIds",value:function(){return this.memberIdList.concat()}},{key:"modifyMember",value:function(e){var t=this.getMemberById(e.getId());null!=t&&(t.context=e.context,t.name=e.name)}},{key:"listMembers",value:function(e){var t=this;new Promise((function(e,n){for(var r=[],i=0;i<t.memberIdList.length;++i){var o=t.memberIdList[i];t.service.getContact(o,(function(n){r.push(n),r.length==t.memberIdList.length&&e(r)}),(function(e){n(e)}))}})).then((function(n){e(n,t)})).catch((function(n){console.error(n),e([],t)}))}},{key:"getMembers",value:function(e){this.listMembers(e)}},{key:"addMembers",value:function(e,t,n){return this.service.addGroupMembers(this,e,t,n)}},{key:"removeMembers",value:function(e,t,n){return this.service.removeGroupMembers(this,e,t,n)}},{key:"hasMember",value:function(e){var t=0;t=e instanceof a.a?e.getId():parseInt(e);for(var n=0;n<this.memberIdList.length;++n)if(this.memberIdList[n]==t)return!0;return!1}},{key:"_removeMember",value:function(e){for(var t=e.getId(),n=0;n<this.memberIdList.length;++n)if(this.memberIdList[n]==t)return void this.memberIdList.splice(n,1)}},{key:"_replaceMember",value:function(e){this._removeMember(e),this.memberIdList.push(e),this.owner.getId()==e.getId()&&(this.owner=e)}},{key:"toJSON",value:function(){var e=v(b(p.prototype),"toJSON",this).call(this);return e.ownerId=this.ownerId,e.tag=this.tag,e.creation=this.creationTime,e.lastActive=this.lastActiveTime,e.state=this.state,e.members=this.memberIdList,e}},{key:"toCompactJSON",value:function(){var e=v(b(p.prototype),"toCompactJSON",this).call(this);return e.domain=this.domain,e.ownerId=this.ownerId,e.tag=this.tag,e.creation=this.creationTime,e.lastActive=this.lastActiveTime,e.state=this.state,e}}])&&d(t.prototype,n),r&&d(t,r),p}(o.a)},function(e,t,n){var r=n(25);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return(o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=s(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=s(e);if(t){var i=s(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return c(this,n)}}function c(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"a",(function(){return f}));var f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(l,e);var t,n,r,c=u(l);function l(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(n=c.call(this)).id=0,void 0!==e&&("number"==typeof e?n.id=e:"string"==typeof e&&(n.id=parseInt(e))),n.timestamp=void 0!==t&&"number"==typeof t?t:Date.now(),n.last=n.timestamp,n.expiry=n.last+l.Lifespan,n.context=null,n.moduleName=null,n.entityCreation=Date.now(),n.entityLifeExpiry=n.entityCreation+l.CacheDuration,n}return t=l,(n=[{key:"getId",value:function(){return this.id}},{key:"getTimestamp",value:function(){return this.timestamp}},{key:"getLast",value:function(){return this.last}},{key:"getExpiry",value:function(){return this.expiry}},{key:"resetUpdateTime",value:function(e){this.last=e,this.expiry=this.last+l.Lifespan}},{key:"setContext",value:function(e){this.context=e}},{key:"getContext",value:function(){return this.context}},{key:"isOverdue",value:function(){return this.expiry<=Date.now()}},{key:"isValid",value:function(){return this.expiry>Date.now()}},{key:"toJSON",value:function(){var e=o(s(l.prototype),"toJSON",this).call(this);return e.id=this.id,e.timestamp=this.timestamp,e.last=this.last,e.expiry=this.expiry,e}},{key:"toCompactJSON",value:function(){var e=o(s(l.prototype),"toCompactJSON",this).call(this);return e.id=this.id,e.timestamp=this.timestamp,e}},{key:"getObjectClass",value:function(){if(this.constructor&&this.constructor.toString()){if(obj.constructor.name)return obj.constructor.name;var e=obj.constructor.toString(),t=null;if((t="["==e.charAt(0)?e.match(/\[\w+\s*(\w+)\]/):e.match(/function\s*(\w+)/))&&2==t.length)return t[1]}}}])&&i(t.prototype,n),r&&i(t,r),l}(n(24).a);l(f,"CacheDuration",6e5),l(f,"Lifespan",6048e5)},function(e,t,n){"use strict";n.d(t,"a",(function(){return I}));var r=n(1),i=n.n(r),o=n(33),a="applyToken",u="getToken",c=n(70);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var i=d(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p(this,n)}}function p(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(o,e);var t,n,r,i=h(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this)).authService=e,t}return t=o,(n=[{key:"onReceived",value:function(e,t,n){}}])&&l(t.prototype,n),r&&l(t,r),o}(n(36).a),y=n(4),g=n(6),m=n(3),b={InvalidToken:"InvalidToken"},w=function(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=[],r=atob(t),i=0;i<r.length;++i)n[i]=r.charCodeAt(i);return n},k=function(e){for(var t=[],n=0;n<e.length;++n)t.push(String.fromCharCode(e[n]));return btoa(t.join(""))};function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var O=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"saveToken",value:function(e){this.save("token",e)}},{key:"loadToken",value:function(){return this.load("token")}},{key:"removeToken",value:function(){this.remove("token")}},{key:"load",value:function(e){var t=window.localStorage.getItem("_cube_"+e+"_");if(t){var n=w(t),r=i.a.Utils.simpleDecrypt(n,["S","X","c","u","b","e","3","0"]),o=i.a.Utils.fromCharCode(r);return c.a.create(JSON.parse(o))}return null}},{key:"save",value:function(e,t){var n=JSON.stringify(t.toJSON()),r=i.a.Utils.simpleEncrypt(n,["S","X","c","u","b","e","3","0"]),o=k(r);window.localStorage.setItem("_cube_"+e+"_",o)}},{key:"remove",value:function(e){window.localStorage.removeItem("_cube_"+e+"_")}},{key:"removeAll",value:function(){for(var e=0;e<window.localStorage.length;++e){var t=window.localStorage.key(e);t.startsWith("_cube_")&&window.localStorage.removeItem(t)}}}])&&S(t.prototype,n),r&&S(t,r),e}();function _(e){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function C(e,t,n,r,i,o,a){try{var u=e[o](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,i)}function E(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){C(o,r,i,a,u,"next",e)}function u(e){C(o,r,i,a,u,"throw",e)}a(void 0)}))}}function R(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function x(e,t,n){return(x="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=N(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function T(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=N(e);if(t){var i=N(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return M(this,n)}}function M(e,t){return!t||"object"!==_(t)&&"function"!=typeof t?A(e):t}function A(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function N(e){return(N=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function j(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var I=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}(s,e);var t,n,r,o=T(s);function s(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(e=o.call(this,"Auth")).domain=null,e.appKey=null,e.token=null,e.pipelineListener=new v(A(e)),e.checkTimer=0,e}return t=s,(n=[{key:"start",value:function(){return!!x(N(s.prototype),"start",this).call(this)&&(this.pipeline.addListener(s.NAME,this.pipelineListener),!0)}},{key:"stop",value:function(){x(N(s.prototype),"stop",this).call(this),null!=this.pipeline&&(this.checkTimer>0&&(clearTimeout(this.checkTimer),this.checkTimer=0),this.pipeline.removeListener(s.NAME,this.pipelineListener))}},{key:"isReady",value:function(){return null!=this.token}},{key:"getToken",value:function(){return this.token}},{key:"allocToken",value:function(e,t){var n=this,r=new O,i=r.load(e);if(null!=i&&i.isValid()){if(0==i.cid)return i.cid=e,this.token=i,r.save(e,i),s.TOKEN=this.token.code,void t(this.token);if(i.cid==e)return this.token=i,s.TOKEN=this.token.code,void t(this.token)}E(regeneratorRuntime.mark((function i(){var o;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,n.applyToken(n.domain,n.appKey);case 2:null!=(o=i.sent)?(o.cid=e,r.save(e,o),n.token=o,s.TOKEN=n.token.code,t(n.token)):(s.TOKEN=null,t(null));case 4:case"end":return i.stop()}}),i)})))()}},{key:"check",value:function(e,t,n){var r=this;s.DOMAIN=e,this.domain=e,this.appKey=t;var i=new O;if(this.token=i.loadToken(),null!=this.token&&this.token.isValid())return s.TOKEN=this.token.code,void n(this.token);E(regeneratorRuntime.mark((function o(){return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,r.applyToken(e,t);case 2:r.token=o.sent,null!=r.token&&(s.TOKEN=r.token.code,i.saveToken(r.token)),n(r.token);case 5:case"end":return o.stop()}}),o)})))()}},{key:"applyToken",value:function(e,t){var n=this;return new Promise((function(r,o){var u=0,l=0;u=setTimeout((function o(){if(++l>100)return i.a.Logger.w("AuthService","Network timeout"),clearTimeout(u),void r(null);if(!n.pipeline.isReady())return clearTimeout(u),void(u=setTimeout(o,200));clearTimeout(u);var f=new y.a(a,{domain:e,appKey:t});n.pipeline.send(s.NAME,f,(function(e,t,n){if(null==n)return i.a.Logger.w("AuthService","Pipeline timeout"),void r(null);var o=n.getStateCode();if(o==g.a.OK)if(0==n.data.code){var a=c.a.create(n.data.data);r(a)}else i.a.Logger.w("AuthService","Apply auth token failed: "+n.data.code),r(null);else i.a.Logger.w("AuthService","Pipeline error: "+o),r(null)}))}),200)}))}},{key:"checkToken",value:function(){var e=this;if(null!=this.token){var t=this.token.code,n=new y.a(u,{code:t});this.pipeline.send(s.NAME,n,(function(n,r,o){if(null!=o)if(o.getStateCode()==g.a.OK&&0==o.data.code)i.a.Logger.d("AuthService",'Token "'+t+'" is valid');else{var a=new m.a(b.InvalidToken,e.token);e.notifyObservers(a);var u=new O;u.removeToken(),u.remove(e.token.cid),e.token=null}}))}}},{key:"cleanToken",value:function(){var e=new O;e.removeAll(),e=null}}])&&R(t.prototype,n),r&&R(t,r),s}(o.a);j(I,"NAME","Auth"),j(I,"DOMAIN",""),j(I,"TOKEN","")},function(e,t,n){"use strict";n.d(t,"a",(function(){return U}));var r=n(1),i=n.n(r),o=n(33),a=n(26),u=n(7),c=(n(39),n(12)),s=n(11),l=n(4),f=n(6),h=n(18),p=n(34),d=n(20),v=n(83),y=(n(54),n(8));function g(e){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e,t,n){return(b="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=O(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=O(e);if(t){var i=O(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return S(this,n)}}function S(e,t){return!t||"object"!==g(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var _=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(a,e);var t,n,r,o=k(a);function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=o.call(this)).multipointComm=e,t}return t=a,(n=[{key:"onReceived",value:function(e,t,n){b(O(a.prototype),"onReceived",this).call(this,e,t,n),n.getStateCode()==f.a.OK?n.name==d.a.Offer?this.multipointComm.triggerOffer(n.data):n.name==d.a.Answer?this.multipointComm.triggerAnswer(n.data):n.name==d.a.Bye?this.multipointComm.triggerBye(n.data):n.name==d.a.Busy?this.multipointComm.triggerBusy(n.data):n.name==d.a.Candidate?this.multipointComm.triggerCandidate(n.data):n.name==d.a.Broadcast?this.multipointComm.triggerBroadcast(n.data):n.name==d.a.Invite?this.multipointComm.triggerInvite(n.data):n.name==d.a.Arrived?this.multipointComm.triggerArrived(n.data):n.name==d.a.Left&&this.multipointComm.triggerLeft(n.data):i.a.Logger.w("CommPipelineListener","Pipeline error: "+n.name+" - "+n.getStateCode())}}])&&m(t.prototype,n),r&&m(t,r),a}(n(36).a),C=n(3),E=n(9),R=n(35),x=n(0),P=n(63),T=n(43),M=n(94),A=n(84);function N(e){return(N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function j(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function I(e,t,n){return(I="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=G(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function L(e,t){return(L=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function F(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=G(e);if(t){var i=G(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return D(this,n)}}function D(e,t){return!t||"object"!==N(t)&&"function"!=typeof t?B(e):t}function B(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function G(e){return(G=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var U=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&L(e,t)}(g,e);var t,n,r,o=F(g);function g(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,g),(e=o.call(this,g.NAME)).pipelineListener=new _(B(e)),e.cs=null,e.iceServers=null,e.privateField=null,e.fields=new h.a,e.offerSignaling=null,e.answerSignaling=null,e.activeCall=null,e.videoElem={local:null,remote:null},e.videoElemAgent=null,e.statsTimer=0,e.callTimer=0,e.callTimeout=3e4,e}return t=g,(n=[{key:"start",value:function(){var e=this;if(!I(G(g.prototype),"start",this).call(this))return!1;this.pipeline.addListener(g.NAME,this.pipelineListener);var t=this.kernel.getModule(s.a.NAME);t.attachWithName(a.a.SignIn,(function(t){if(null==e.privateField){var n=t.data;e.privateField=new p.a(n.getId(),n,e.pipeline,n),e.privateField.mediaListener=e}})),t.attachWithName(a.a.SignOut,(function(t){null!=e.activeCall&&e.hangupCall()}));var n=t.getSelf();return null!=n&&(this.privateField=new p.a(n.getId(),n,this.pipeline,n),this.privateField.mediaListener=this),this.cs=t,!0}},{key:"stop",value:function(){var e=this;I(G(g.prototype),"stop",this).call(this),null!=this.pipeline&&(null!=this.privateField&&this.privateField.closeRTCDevices(),null!=this.activeCall&&this.activeCall.isActive()?this.hangupCall((function(){e.activeCall=null,e.pipeline.removeListener(g.NAME,e.pipelineListener)}),(function(){e.activeCall=null,e.pipeline.removeListener(g.NAME,e.pipelineListener)})):this.pipeline.removeListener(g.NAME,this.pipelineListener))}},{key:"config",value:function(e){e.iceServers&&(this.iceServers=e.iceServers)}},{key:"getLocalVideoElement",value:function(){return this.videoElem.local}},{key:"setLocalVideoElement",value:function(e){this.videoElem.local=e}},{key:"getRemoteVideoElement",value:function(){return this.videoElem.remote}},{key:"setRemoteVideoElement",value:function(e){this.videoElem.remote=e}},{key:"setVideoElementAgent",value:function(e){this.videoElemAgent=e}},{key:"getPrivateField",value:function(){return this.privateField}},{key:"listMediaDevices",value:function(e){var t=[];M.a.enumDevices((function(n){for(var r=0;r<n.length;++r)"default"!=n[r].deviceId&&t.push(n[r]);e(t)}))}},{key:"createRTCDevice",value:function(e,t,n){var r=new v.a(e);return t&&(t.muted=!0,t.volume=0,r.localVideoElem=t),n&&(r.remoteVideoElem=n),r.enableICE(this.iceServers),r}},{key:"createCommField",value:function(e,t,n,r,o,a){var u=new p.a(i.a.Utils.generateSerialNumber(),this.cs.getSelf(),this.pipeline,this.cs.getSelf());u.mediaConstraint=e,u.mediaListener=this,r&&(u.group=r),o&&(u.name=o),a&&(u.invitees=a);var c=new l.a(d.a.CreateField,u.toJSON());this.pipeline.send(g.NAME,c,(function(e,r,i){if(null!=i&&i.getStateCode()==f.a.OK)if(i.data.code==y.a.Ok)t&&t(u);else{var o=new x.a(g.NAME,i.data.code,u);n&&n(o)}else{var a=new x.a(g.NAME,y.a.ServerFault,u);n&&n(a)}}))}},{key:"getCommField",value:function(e,t,n){var r=this,i="number"==typeof e?e:e.getAppendix().getCommId(),o=new l.a(d.a.GetField,{commFieldId:i});this.pipeline.send(g.NAME,o,(function(e,o,a){if(null!=a&&a.getStateCode()==f.a.OK)if(a.data.code==y.a.Ok){var u=p.a.create(a.data.data,r.pipeline,r.cs.getSelf());null!=r.activeCall&&r.activeCall.field.id==u.id&&(r.activeCall.field.copy(u),u=r.activeCall.field),null!=u.group?r.cs.getGroup(u.group.id,(function(e){u.group=e,t(u)}),(function(e){t(u)})):t(u)}else{var c=new x.a(g.NAME,a.data.code,i);n&&n(c)}else{var s=new x.a(g.NAME,y.a.ServerFault,i);n&&n(s)}}))}},{key:"destroyCommField",value:function(e,t,n){var r=this,i=new l.a(d.a.DestroyField,{commFieldId:e});this.pipeline.send(g.NAME,i,(function(i,o,a){if(null!=a&&a.getStateCode()==f.a.OK)if(a.data.code==y.a.Ok){var u=p.a.create(a.data.data,r.pipeline,r.cs.getSelf());null!=u.group?r.cs.getGroup(u.group.id,(function(e){u.group=e,t(u)}),(function(e){t(u)})):t(u)}else{var c=new x.a(g.NAME,a.data.code,e);n&&n(c)}else{var s=new x.a(g.NAME,y.a.ServerFault,e);n&&n(s)}}))}},{key:"makeCall",value:function(e,t,n,r){var o=this;if(null==this.privateField){var a=new x.a(g.NAME,y.a.Uninitialized,e);return r&&r(a),this.notifyObservers(new C.a(E.a.Failed,a)),!1}var s=function(e){n&&n(o.activeCall),o.activeCall.field.isPrivate()?o.notifyObservers(new C.a(E.a.Ringing,o.activeCall)):(o.notifyObservers(new C.a(E.a.Ringing,o.activeCall)),setTimeout((function(){var e=o.cs.getSelf();o.activeCall.field.mediaConstraint.videoEnabled?o.activeCall.field.getEndpoints().forEach((function(t){t.contact.id!=e.id&&o.follow(t)})):o.touch(o.activeCall.field)}),100))},l=function(e){o.callTimer>0&&(clearTimeout(o.callTimer),o.callTimer=0),null!=o.activeCall?(o.activeCall.lastError=e,e.code==y.a.MediaPermissionDenied?(o.activeCall.field.isPrivate()?o.privateField.applyTerminate(o.privateField.founder,o.privateField.self.getDevice()):o.activeCall.field.applyTerminate(o.privateField.founder,o.privateField.self.getDevice()),r&&r(e),o.notifyObservers(new C.a(E.a.Failed,e)),o.activeCall=null):(r&&r(e),o.notifyObservers(new C.a(E.a.Failed,e)),o.hangupCall())):r&&r(e)};if(e instanceof u.a){if(null!=this.activeCall&&this.activeCall.isActive()){var f=new x.a(g.NAME,y.a.CallerBusy,e);return r&&r(f),this.notifyObservers(new C.a(E.a.Failed,f)),!1}this.activeCall=new P.a(this.privateField.self,this.privateField),this.privateField.caller=this.privateField.founder,this.privateField.callee=e,this.privateField.mediaConstraint=t,new Promise((function(e,t){o.callTimer=setTimeout((function(){o.fireCallTimeout()}),o.callTimeout),e()})).then((function(){o.notifyObservers(new C.a(E.a.InProgress,o.activeCall))})),this.privateField.applyCall(this.privateField.caller,this.privateField.self.getDevice(),(function(e,n,r){o.activeCall.callerMediaConstraint=t;var i=o.createRTCDevice("sendrecv",o.videoElem.local,o.videoElem.remote);o.privateField.launchOffer(i,t,s,l)}),(function(e){l(e)}))}else if(e instanceof c.a)e.getAppendix().getCommId((function(i,a,u){0==i?o.createCommField(t,(function(i){e.getAppendix().updateCommId(i.getId(),(function(e){setTimeout((function(){o.makeCall(i,t,n,r)}),0)}),(function(t){l(new x.a(g.NAME,y.a.GroupStateError,e))}))}),(function(e){l(e)}),e,e.getName()+"#"+e.getId()):o.getCommField(i,(function(e){setTimeout((function(){o.makeCall(e,t,n,r)}),0)}),(function(i){i.code==y.a.NoCommField?e.getAppendix().updateCommId(0,(function(){setTimeout((function(){o.makeCall(e,t,n,r)}),0)}),(function(){l(new x.a(g.NAME,y.a.GroupStateError,e))})):l(i)}))}),(function(t){l(new x.a(g.NAME,y.a.GroupStateError,e))}));else{if(!(e instanceof p.a)){var h=new x.a(g.NAME,y.a.Failure,e);return r&&r(h),!1}if(null!=this.activeCall&&null!=this.activeCall.field&&this.activeCall.field.getId()!=e.getId()){i.a.Logger.w("MultipointComm","Comm field data error");var d=new x.a(g.NAME,y.a.CommFieldStateError,this.activeCall);return r&&r(d),!1}null==this.activeCall&&(this.activeCall=new P.a(this.privateField.founder)),this.activeCall.field=e,new Promise((function(e,t){e()})).then((function(){o.notifyObservers(new C.a(E.a.InProgress,o.activeCall))}));var v=this.cs.getSelf();e.applyCall(v,v.getDevice(),(function(e,n,r){var i=e.getEndpoint(v);i.videoEnabled=t.videoEnabled,i.audioEnabled=t.audioEnabled,o.activeCall.field.copy(e);var a=o.createRTCDevice("sendonly",o.videoElem.local,null);o.activeCall.field.launchOffer(a,t,s,l,i)}),(function(e){l(e)}))}return!0}},{key:"inviteCall",value:function(e,t,n,r){var i=this,o=0;o=e instanceof c.a?e.getAppendix().getCommId():e instanceof p.a?e.getId():e;var a=function(e){var o=new R.a(d.a.Invite,e,i.privateField.founder,i.privateField.founder.device);o.invitees=t;var a=new l.a(d.a.Invite,o.toJSON());i.pipeline.send(g.NAME,a,(function(o,a,u){if(null!=u&&u.getStateCode()==f.a.OK)if(u.data.code==y.a.Ok){n&&n(e);var c=new C.a(E.a.Invite,e);c.secondaryData=t,i.notifyObservers(c)}else r&&r(new x.a(g.NAME,u.data.code,e));else r&&r(new x.a(g.NAME,y.a.ServerFault,e))}))};null!=this.activeCall&&null!=this.activeCall.field&&this.activeCall.field.id==o?a(this.activeCall.field):this.getCommField(o,(function(e){a(e)}),(function(e){r&&r(e)}))}},{key:"answerCall",value:function(e,t,n,r){var o=this;if(null==e||void 0===e)return!1;if(null==this.offerSignaling)return i.a.Logger.w(g.NAME,"#answerCall offer signaling is null"),!1;"function"==typeof t?(r=n,n=t,t=this.offerSignaling.field.isPrivate()?this.offerSignaling.caller:this.offerSignaling.field):void 0===t&&(t=this.offerSignaling.field.isPrivate()?this.offerSignaling.caller:this.offerSignaling.field),this.callTimer>0&&(clearTimeout(this.callTimer),this.callTimer=0);var a=function(){n&&n(o.activeCall),o.notifyObservers(new C.a(E.a.Connected,o.activeCall))},c=function(e){o.activeCall.lastError=e,r&&r(e),o.notifyObservers(new C.a(E.a.Failed,e)),o.activeCall.field.isPrivate()&&o.hangupCall()};if(new Promise((function(e,t){e()})).then((function(){o.notifyObservers(new C.a(E.a.InProgress,o.activeCall))})),t instanceof u.a){if(null!=this.activeCall&&this.activeCall.isActive()){var s=new x.a(g.NAME,y.a.CalleeBusy,this.activeCall);return r&&r(s),this.notifyObservers(new C.a(E.a.Failed,s)),!1}if(null==this.videoElem.local&&null==this.videoElem.remote){var l=new x.a(g.NAME,y.a.VideoElementNotSetting,this.activeCall);return r&&r(l),this.notifyObservers(new C.a(E.a.Failed,l)),!1}this.activeCall.answerTime=Date.now(),this.privateField.applyJoin(this.privateField.founder,this.privateField.founder.device,(function(t,n,r){o.activeCall.calleeMediaConstraint=e;var i=o.createRTCDevice("sendrecv",o.videoElem.local,o.videoElem.remote);o.privateField.launchAnswer(i,o.offerSignaling.sessionDescription,e,a,c)}),(function(e){c(e)}))}else if(!(t instanceof p.a))return!1;return!0}},{key:"hangupCall",value:function(e,t){var n=this;if(null==this.activeCall){if(i.a.Logger.w("MultipointComm","#hangupCall() - No active calling"),t){var r=new x.a(g.NAME,y.a.Failure,null);t(r)}return!1}this.statsTimer>0&&(clearInterval(this.statsTimer),this.statsTimer=0);var o=this.activeCall.field,a=function(r,i,a){if(null!=n.activeCall){var u=n.activeCall;if(null==a||a.getStateCode()!=f.a.OK){var c=new x.a(g.NAME,y.a.ServerFault,u);return u.endTime=Date.now(),u.lastError=c,o.close(),t&&t(c),n.notifyObservers(new C.a(E.a.Failed,c)),void(n.activeCall=null)}if(a.data.code!=y.a.Ok){var s=new x.a(g.NAME,a.data.code,u);return u.endTime=Date.now(),u.lastError=s,o.close(),t&&t(s),n.notifyObservers(new C.a(E.a.Failed,s)),void(n.activeCall=null)}var l=R.a.create(a.data.data,n.pipeline,n.cs.getSelf());o.isPrivate()?(o.close(),n.offerSignaling=null,n.answerSignaling=null,u.endTime=Date.now(),e&&e(u),n.notifyObservers(new C.a(E.a.Bye,u))):(o.copy(l.field),e&&e(u),n.notifyObservers(new C.a(E.a.Bye,u)),o.close()),n.activeCall=null}else if(t){var h=new x.a(g.NAME,y.a.Failure,null);t(h)}};if(this.callTimer>0&&(clearTimeout(this.callTimer),this.callTimer=0),o.isPrivate())if(this.activeCall.isActive()){var u=new R.a(d.a.Bye,o,this.privateField.founder,this.privateField.founder.getDevice()),c=new l.a(d.a.Bye,u.toJSON());this.pipeline.send(g.NAME,c,a)}else{var s=new R.a(d.a.Busy,o,this.privateField.founder,this.privateField.founder.getDevice());s.caller=this.activeCall.getCaller(),s.callee=this.activeCall.getCallee();var h=new l.a(d.a.Busy,s.toJSON());this.pipeline.send(g.NAME,h,a)}else{var p=new R.a(d.a.Bye,o,this.privateField.founder,this.privateField.founder.device),v=new l.a(d.a.Bye,p.toJSON());this.pipeline.send(g.NAME,v,a)}return!0}},{key:"touch",value:function(e,t,n){var r=this;if(null==this.videoElem.remote)return n&&n(new x.a(g.NAME,y.a.VideoElementNotSetting,e)),!1;i.a.Logger.d(g.NAME,"Touch comm filed: "+e.getName());var o=this.createRTCDevice("recvonly",null,this.videoElem.remote);return this.activeCall.field.launchOffer(o,this.activeCall.field.mediaConstraint,(function(){t&&t(r.activeCall)}),(function(e){null!=r.activeCall&&(r.activeCall.lastError=e),n&&n(e)})),!0}},{key:"follow",value:function(e,t,n){var r=this;if(null==this.privateField){var o=new x.a(g.NAME,y.a.Uninitialized,e);return n&&n(o),this.notifyObservers(new C.a(E.a.Failed,o)),!1}var a=function(t){null!=r.activeCall&&(r.activeCall.lastError=t),n&&n(t),null!=r.activeCall&&r.activeCall.field.closeRTCDevice(e)};if(null==this.activeCall){if(null==e.field)return a(new x.a(g.NAME,y.a.NoCommField,e)),!1;this.activeCall=new P.a(this.privateField.founder),this.activeCall.field=e.field}else if(this.activeCall.field.isPrivate())return a(new x.a(g.NAME,y.a.CommFieldStateError,e)),!1;if(this.activeCall.field.hasRTCDevice(e)){var u=new x.a(g.NAME,y.a.CommFieldStateError,e);return n&&n(u),!1}if(null==this.videoElemAgent||"function"!=typeof this.videoElemAgent)return a(new x.a(g.NAME,y.a.VideoElementNotSetting,e)),!1;var c=this.videoElemAgent(e.contact);if(null==c||void 0===c)return a(new x.a(g.NAME,y.a.NoVideoElement,e)),!1;i.a.Logger.d(g.NAME,"Follow endpoint "+e.id+" ("+A.a.getBrowserName()+")");var s=this.createRTCDevice("recvonly",null,c);return this.activeCall.field.launchOffer(s,this.activeCall.field.mediaConstraint,(function(){e.field=r.activeCall.field,t&&t(r.activeCall,e),r.notifyObservers(new C.a(E.a.Followed,e))}),a,e),!0}},{key:"unfollow",value:function(e,t,n){var r=this;if(null==this.privateField){var i=new x.a(g.NAME,y.a.Uninitialized,e);return n&&n(i),this.notifyObservers(new C.a(E.a.Failed,i)),!1}if(null==this.activeCall){var o=new x.a(g.NAME,y.a.InvalidCallRecord,e);return n&&n(o),!1}var a=new R.a(d.a.Bye,this.activeCall.field,this.privateField.founder,this.privateField.founder.device);a.target=e;var u=new l.a(d.a.Bye,a.toJSON());return this.pipeline.send(g.NAME,u,(function(i,o,a){if(null!=a&&a.getStateCode()==f.a.OK)if(a.data.code==y.a.Ok)e.field=r.activeCall.field,r.activeCall.field.closeEndpoint(e),r.activeCall.field.closeRTCDevice(e),r.notifyObservers(new C.a(E.a.Unfollowed,e)),t&&t(r.activeCall,e);else{var u=new x.a(g.NAME,a.data.code,e);n&&n(u)}else{var c=new x.a(g.NAME,y.a.ServerFault,e);n&&n(c)}})),!0}},{key:"getActiveField",value:function(){return null==this.activeCall?null:this.activeCall.field}},{key:"getActiveRecord",value:function(){return this.activeCall}},{key:"isCalling",value:function(e,t){var n=this;e.getAppendix().getCommId((function(e){0!=e?n.getCommField(e,(function(){t(!0)}),(function(){t(!1)})):t(!1)}),(function(e){t(!1)}))}},{key:"fireCallTimeout",value:function(){this.callTimer>0&&(clearTimeout(this.callTimer),this.callTimer=0),this.notifyObservers(new C.a(E.a.Timeout,this.activeCall)),this.hangupCall()}},{key:"onMediaConnected",value:function(e,t){var n=this;this.notifyObservers(new C.a(E.a.MediaConnected,this.activeCall)),0==this.statsTimer&&(this.statsTimer=setInterval((function(){n.onTimer()}),1e3))}},{key:"onMediaDisconnected",value:function(e,t){this.statsTimer>0&&(clearInterval(this.statsTimer),this.statsTimer=0),this.notifyObservers(new C.a(E.a.MediaDisconnected,this.activeCall)),this.activeCall.field.isPrivate()&&this.hangupCall()}},{key:"onTimer",value:function(){if(null!=this.activeCall){var e=this.activeCall.field;if(null!=e){var t=e.getEndpoint(this.cs.getSelf());if(null!=t){var n=t.volume,r=e.getMicrophoneVolume();if(r>=0){var i=window.performance.now();if(Math.abs(n-r)>=10){var o=new l.a(d.a.Broadcast,{source:t.toJSON(),data:{event:E.a.MicrophoneVolume,value:r,timestamp:i}});this.pipeline.send(g.NAME,o)}this.notifyObservers(new C.a(E.a.MicrophoneVolume,{endpoint:t,volume:r,timestamp:i}))}}}}}},{key:"triggerOffer",value:function(e){var t=this,n=e.data,r=R.a.create(n,this.pipeline,this.cs.getSelf());if(null!=this.activeCall&&this.activeCall.isActive()){var i=new R.a(d.a.Busy,r.field,this.privateField.self,this.privateField.self.getDevice()),o=new l.a(d.a.Busy,i.toJSON());this.pipeline.send(g.NAME,o)}else if(this.offerSignaling=r,this.callTimer=setTimeout((function(){t.fireCallTimeout()}),this.callTimeout-1e4),this.activeCall=new P.a(this.privateField.founder),this.offerSignaling.field.isPrivate()){this.privateField.caller=r.caller,this.privateField.callee=r.callee,this.activeCall.field=this.privateField,this.activeCall.callerMediaConstraint=this.offerSignaling.mediaConstraint;var a=function(){t.notifyObservers(new C.a(E.a.NewCall,t.activeCall))};this.cs.getContact(this.offerSignaling.caller.id,(function(e){t.activeCall.field.caller=t.offerSignaling.caller=e,t.activeCall.field.callee=t.offerSignaling.callee=t.cs.getSelf(),a()}),(function(e){t.activeCall.field.callee=t.offerSignaling.callee=t.cs.getSelf(),a()}))}else this.activeCall.field=this.offerSignaling.field,this.notifyObservers(new C.a(E.a.NewCall,this.activeCall))}},{key:"triggerAnswer",value:function(e){var t=this;if(null!=this.activeCall&&this.activeCall.isActive()){this.callTimer>0&&(clearTimeout(this.callTimer),this.callTimer=0),this.activeCall.answerTime=Date.now();var n=e.data,r=R.a.create(n,this.pipeline,this.cs.getSelf()),o=null;if(this.activeCall.field.isPrivate())this.answerSignaling=r,this.activeCall.calleeMediaConstraint=this.answerSignaling.mediaConstraint,o=this.activeCall.field.getRTCDevice();else if(0==r.sn){var a=r.contact,u=this.activeCall.field.getEndpoint(a);o=this.activeCall.field.getRTCDevice(u)}else o=this.activeCall.field.getRTCDevice(r.sn);if(null!=o)i.a.Logger.d(g.NAME,"Answer from "+r.contact.getId()),o.doAnswer(r.sessionDescription,(function(){"sendrecv"!=o.mode&&"sendonly"!=o.mode||t.notifyObservers(new C.a(E.a.Connected,t.activeCall))}),(function(e){t.activeCall.lastError=e,t.notifyObservers(new C.a(E.a.Failed,e))}));else{i.a.Logger.w(g.NAME,"#triggerAnswer() - Can not find rtc device for "+r.contact.id);var c=new x.a(g.NAME,y.a.NoPeerEndpoint,this.activeCall);this.notifyObservers(new C.a(E.a.Failed,c))}}else i.a.Logger.e(g.NAME,"#triggerAnswer() no active call record")}},{key:"triggerCandidate",value:function(e){var t=R.a.create(e.data,this.pipeline,this.cs.getSelf()),n=null;if(this.activeCall.field.isPrivate())n=this.activeCall.field.getRTCDevice();else if(0==t.sn){var r=this.activeCall.field.getEndpoint(t.contact);null!=r&&(n=this.activeCall.field.getRTCDevice(r))}else n=this.activeCall.field.getRTCDevice(t.sn);if(null!=n){if(null!=t.candidates)for(var o=t.candidates,a=0;a<o.length;++a)n.doCandidate(o[a]);null!=t.candidate&&n.doCandidate(t.candidate)}else i.a.Logger.e(g.NAME,"#triggerCandidate() - Can NOT find RTC device: "+t.name)}},{key:"triggerBusy",value:function(e){if(e.code==y.a.Ok){this.callTimer>0&&(clearTimeout(this.callTimer),this.callTimer=0);var t=R.a.create(e.data,this.pipeline,this.cs.getSelf());t.field.isPrivate()?t.callee.getId()==this.privateField.getId()?(this.activeCall.endTime=Date.now(),this.notifyObservers(new C.a(E.a.Bye,this.activeCall))):(this.notifyObservers(new C.a(E.a.Busy,this.activeCall)),this.hangupCall()):this.notifyObservers(new C.a(E.a.Busy,this.activeCall))}else{var n=new x.a(g.NAME,e.code,this);this.notifyObservers(new C.a(E.a.Failed,n))}}},{key:"triggerBye",value:function(e){R.a.create(e.data,this.pipeline,this.cs.getSelf()).field.isPrivate()&&this.hangupCall()}},{key:"triggerInvite",value:function(e){var t=this;if(null==this.activeCall||!this.activeCall.isActive()){var n=R.a.create(e.data,this.pipeline,this.cs.getSelf());i.a.Logger.d(g.NAME,'Receive "'+n.field.getName()+'" invitation'),this.activeCall=new P.a(this.privateField.founder),this.activeCall.field=n.field,this.cs.getContact(n.contact.getId(),(function(e){t.notifyObservers(new C.a(E.a.Invited,n.field,e))}),(function(e){t.notifyObservers(new C.a(E.a.Invited,n.field,n.contact))}))}}},{key:"triggerArrived",value:function(e){var t=this,n=e.data,r=p.a.create(n.field,this.pipeline,this.cs.getSelf());r.id==this.activeCall.field.id&&(this.activeCall.field.copy(r),r=this.activeCall.field);var o=T.a.create(n.endpoint);o.field=r,i.a.Logger.d(g.NAME,'Endpoint "'+o.getName()+'" arrived "'+r.getName()+'"'),this.notifyObservers(new C.a(E.a.Arrived,o)),r.id==this.activeCall.field.id&&r.mediaConstraint.videoEnabled&&setTimeout((function(){t.follow(o)||i.a.Logger.w(g.NAME,'Comm field state error, can not follow endpoint "'+o.getName()+'"')}),1e3)}},{key:"triggerLeft",value:function(e){var t=this,n=e.data,r=p.a.create(n.field,this.pipeline,this.cs.getSelf()),o=T.a.create(n.endpoint);if(o.field=r,i.a.Logger.d(g.NAME,'Endpoint "'+o.getName()+'" left "'+r.getName()+'"'),null!=this.activeCall&&r.id==this.activeCall.field.id){var a=this.activeCall.field.getRTCDevice(o);this.activeCall.field.copy(r),null!=a?setTimeout((function(){t.unfollow(o,(function(){t.notifyObservers(new C.a(E.a.Left,o))}))||i.a.Logger.w(g.NAME,'Comm field state error, can not unfollow endpoint "'+o.getName()+'"')}),1):(this.activeCall.field.closeEndpoint(o),this.notifyObservers(new C.a(E.a.Left,o)))}}},{key:"triggerBroadcast",value:function(e,t){var n=this,r=e.data;if(void 0!==r.data&&void 0!==r.source){var i=T.a.create(r.source),o=r.data.event;if(o==E.a.MicrophoneVolume){var a=r.data.value,u=r.data.timestamp;if(null!=this.activeCall){var c=this.activeCall.field.getEndpoint(i);null!=c&&(c.volume=a,new Promise((function(e,t){e()})).then((function(){n.notifyObservers(new C.a(E.a.MicrophoneVolume,{endpoint:c,volume:a,timestamp:u}))})).catch((function(e){})))}}else if(o==E.a.AudioMuted){var s=r.data.value,l=r.data.timestamp;if(null!=this.activeCall){var f=this.activeCall.field.getEndpoint(i);null!=f&&(f.audioStreamEnabled=!s,new Promise((function(e,t){e()})).then((function(){n.notifyObservers(new C.a(E.a.AudioMuted,{endpoint:f,volume:s,timestamp:l}))})).catch((function(e){})))}}}}}])&&j(t.prototype,n),r&&j(t,r),g}(o.a);!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(U,"NAME","MultipointComm")},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.d(t,"a",(function(){return i}));var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._keys=[],this._values=[]}var t,n,i;return t=e,(n=[{key:"isEmpty",value:function(){return 0==this._keys.length}},{key:"containsKey",value:function(e){return this._keys.indexOf(e)>=0}},{key:"containsValue",value:function(e){return this._values.indexOf(e)>=0}},{key:"put",value:function(e,t){var n=this._keys.indexOf(e);n>=0?this._values[n]=t:(this._keys.push(e),this._values.push(t))}},{key:"get",value:function(e){var t=this._keys.indexOf(e);return t>=0?this._values[t]:null}},{key:"remove",value:function(e){var t=this._keys.indexOf(e);if(t>=0){var n=this._values[t];return this._keys.splice(t,1),this._values.splice(t,1),n}return null}},{key:"values",value:function(){var e=new Array;return Array.prototype.push.apply(e,this._values),e}},{key:"keys",value:function(){var e=new Array;return Array.prototype.push.apply(e,this._keys),e}},{key:"keySet",value:function(){var e=new Array;return Array.prototype.push.apply(e,this._keys),e}},{key:"size",value:function(){return this._keys.length}},{key:"clear",value:function(){this._keys=[],this._values=[]}},{key:"forEach",value:function(e){for(var t=this.keySet(),n=0;n<t.length;++n){var r=t[n];if(e(r,this.get(r)))break}}}])&&r(t.prototype,n),i&&r(t,i),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return y}));var r=n(1),i=n.n(r),o=n(14),a=n(21),u=n(15),c=n(71);n(7),n(12);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t,n){return(f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=v(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v(e);if(t){var i=v(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return d(this,n)}}function d(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(s,e);var t,n,r,o=p(s);function s(e,t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s);var r=void 0!==e&&e instanceof s;return(n=o.call(this)).id=r?e.id:i.a.Utils.generateSerialNumber(),n.domain=r?e.domain:u.a.DOMAIN,n.payload=null,r?n.payload=e.payload:void 0===e||null==e||e instanceof File?n.payload={}:n.payload=e,n.from=r?e.from:0,n.sender=r?e.sender:null,n.to=r?e.to:0,n.receiver=r?e.receiver:null,n.source=r?e.source:0,n.sourecGroup=r?e.sourecGroup:null,n.owner=r?e.owner:0,n.localTS=r?e.localTS:0,n.remoteTS=r?e.remoteTS:0,n.attachment=null,r?n.attachment=e.attachment:e instanceof File?n.attachment=new c.a(e):void 0!==t&&null!=t&&t instanceof File&&(n.attachment=new c.a(t)),n.state=r?e.state:a.a.Unknown,n.scope=r?e.scope:0,n}return t=s,r=[{key:"create",value:function(e){var t=new s;return t.id=e.id,t.domain=e.domain,t.from=e.from,t.to=e.to,t.source=e.source,t.owner=e.owner,t.localTS=e.lts,t.remoteTS=e.rts,t.state=e.state,t.scope=e.scope,void 0!==e.payload&&(t.payload=e.payload),void 0!==e.attachment&&(t.attachment=c.a.create(e.attachment)),t}}],(n=[{key:"getDomain",value:function(){return this.domain}},{key:"getFrom",value:function(){return this.from}},{key:"getSender",value:function(){return this.sender}},{key:"getTo",value:function(){return this.to}},{key:"getReceiver",value:function(){return this.receiver}},{key:"getSource",value:function(){return this.source}},{key:"getSourceGroup",value:function(){return this.sourecGroup}},{key:"getPayload",value:function(){return this.payload}},{key:"setPayload",value:function(e){this.payload=e}},{key:"getLocalTimestamp",value:function(){return this.localTS}},{key:"getRemoteTimestamp",value:function(){return this.remoteTS}},{key:"getSummary",value:function(){return this.payload.toString()}},{key:"getState",value:function(){return this.state}},{key:"markOnlyOwner",value:function(){this.scope=1}},{key:"isRead",value:function(){return 0==this.owner||this.from==this.owner||this.state==a.a.Read}},{key:"setAttachment",value:function(e){e instanceof File?this.attachment=new c.a(e):e instanceof c.a&&(this.attachment=e)}},{key:"getAttachment",value:function(){return this.attachment}},{key:"hasAttachment",value:function(){return null!=this.attachment}},{key:"isFromGroup",value:function(){return this.source>0}},{key:"getGroupId",value:function(){return this.source}},{key:"clone",value:function(e){this.id=e.id,this.domain=e.domain,this.from=e.from,this.to=e.to,this.source=e.source,this.owner=e.owner,this.localTS=e.localTS,this.remoteTS=e.remoteTS,this.state=e.state,this.scope=e.scope,this.payload=e.payload,this.attachment=e.attachment}},{key:"toJSON",value:function(){var e=f(v(s.prototype),"toJSON",this).call(this);return e.id=this.id,e.domain=this.domain,e.from=this.from,e.to=this.to,e.source=this.source,e.owner=this.owner,e.lts=this.localTS,e.rts=this.remoteTS,e.state=this.state,e.scope=this.scope,e.payload=this.payload,null!=this.attachment&&(e.attachment=this.attachment.toJSON()),e}}])&&l(t.prototype,n),r&&l(t,r),s}(o.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r={Offer:"offer",Answer:"answer",Bye:"bye",Busy:"busy",Candidate:"candidate",Invite:"invite",Arrived:"arrived",Left:"left",GetField:"getField",CreateField:"createField",DestroyField:"destroyField",ApplyCall:"applyCall",ApplyJoin:"applyJoin",ApplyTerminate:"applyTerminate",Broadcast:"broadcast"}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r={Unknown:0,Unsent:5,Sending:9,Sent:10,Read:20,Recalled:30,Deleted:40,SendBlocked:51,ReceiveBlocked:52,Fault:1}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return(o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=s(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=s(e);if(t){var i=s(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return c(this,n)}}function c(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}n.d(t,"a",(function(){return l}));var l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(l,e);var t,n,r,c=u(l);function l(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(n=c.call(this)).id=e,n.domain=t,n.ownerId=0,n.fileName=null,n.fileSize=0,n.lastModified=0,n.completedTime=0,n.expiryTime=0,n.fileCode=null,n.fileType="unknown",n.md5Code=null,n.sha1Code=null,n.fileURL=null,n.fileSecureURL=null,n}return t=l,r=[{key:"create",value:function(e){var t=new l(e.id,e.domain);if(t.fileCode=e.fileCode,t.ownerId=e.ownerId,t.fileName=e.fileName,t.fileSize=e.fileSize,t.lastModified=e.lastModified,t.completedTime=e.completedTime,t.expiryTime=e.expiryTime,t.fileType=e.fileType,t.md5Code=void 0!==e.md5?e.md5:null,t.sha1Code=void 0!==e.sha1?e.sha1:null,t.fileURL=void 0!==e.fileURL?e.fileURL:null,t.fileSecureURL=void 0!==e.fileSecureURL?e.fileSecureURL:null,"unknown"==t.fileType){var n=t.fileName.lastIndexOf(".");if(n>0){var r=t.fileName.substring(n+1);t.fileType=r}}return t}}],(n=[{key:"getId",value:function(){return this.id}},{key:"getDomain",value:function(){return this.domain}},{key:"getOwnderId",value:function(){return this.ownerId}},{key:"getFileName",value:function(){return this.fileName}},{key:"getFileSize",value:function(){return this.fileSize}},{key:"getLastModified",value:function(){return this.lastModified}},{key:"getFileCode",value:function(){return this.fileCode}},{key:"getCompletedTime",value:function(){return this.completedTime}},{key:"getExpiryTime",value:function(){return this.expiryTime}},{key:"getFileType",value:function(){return this.fileType}},{key:"getMD5Code",value:function(){return this.md5Code}},{key:"getSHA1Code",value:function(){return this.sha1Code}},{key:"getFileURL",value:function(){return this.fileURL}},{key:"getFileSecureURL",value:function(){return this.fileSecureURL}},{key:"isDocumentType",value:function(){var e=this.fileType;return"doc"==e||"docx"==e||"ppt"==e||"pptx"==e||"pdf"==e||"xls"==e||"xlsx"==e}},{key:"isImageType",value:function(){var e=this.fileType;return"png"==e||"jpeg"==e||"gif"==e||"jpg"==e||"bmp"==e}},{key:"toJSON",value:function(){var e=o(s(l.prototype),"toJSON",this).call(this);return e.id=this.id,e.domain=this.domain,e.fileCode=this.fileCode,e.ownerId=this.ownerId,e.fileName=this.fileName,e.fileSize=this.fileSize,e.lastModified=this.lastModified,e.completed=this.completedTime,e.expiry=this.expiryTime,e.fileType=this.fileType,null!=this.md5Code&&(e.md5=this.md5Code),null!=this.sha1Code&&(e.sha1=this.sha1Code),null!=this.fileURL&&(e.fileURL=this.fileURL),null!=this.fileSecureURL&&(e.fileSecureURL=this.fileSecureURL),e}},{key:"toCompactJSON",value:function(){return this.toJSON()}}])&&i(t.prototype,n),r&&i(t,r),l}(n(14).a)},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.d(t,"a",(function(){return i}));var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,i;return t=e,(n=[{key:"initializer",value:function(){}},{key:"toJSON",value:function(){return{}}},{key:"toCompactJSON",value:function(){return{}}}])&&r(t.prototype,n),i&&r(t,i),e}()},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r={SignIn:"SignIn",SignOut:"SignOut",Comeback:"Comeback",GroupUpdated:"GroupUpdated",GroupCreated:"GroupCreated",GroupDismissed:"GroupDismissed",GroupMemberAdded:"GroupMemberAdded",GroupMemberRemoved:"GroupMemberRemoved",GroupAppendixUpdated:"GroupAppendixUpdated",Fault:"Fault",Unknown:"Unknown"}},function(e,t,n){var r=n(97)("wks"),i=n(73),o=n(17).Symbol,a="function"==typeof o;(e.exports=function(e){return r[e]||(r[e]=a&&o[e]||(a?o:i)("Symbol."+e))}).store=r},function(e,t,n){var r=n(52),i=Math.min;e.exports=function(e){return e>0?i(r(e),9007199254740991):0}},function(e,t,n){e.exports=!n(22)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=u(e);if(t){var i=u(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return a(this,n)}}function a(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}n.d(t,"a",(function(){return c}));var c=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(n,e);var t=o(n);function n(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),t.call(this,n.NAME)}return n}(n(123).a);!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(c,"NAME","Instantiate")},function(e,t,n){var r=n(13),i=n(159),o=n(57),a=Object.defineProperty;t.f=n(29)?Object.defineProperty:function(e,t,n){if(r(e),t=o(t,!0),r(n),i)try{return a(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){var r=n(58);e.exports=function(e){return Object(r(e))}},function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r=n(1),i=n.n(r),o=n(122),a=(n(55),n(61),n(157)),u=(n(70),n(18));function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p(e);if(t){var i=p(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h(this,n)}}function h(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var d=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(c,e);var t,n,r,o=f(c);function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=o.call(this)).name=e,t.kernel=null,t.pipeline=null,t.started=!1,t.dependencies=[],t.deps=[],t.depsLoadMap=new u.a,t.depsLoading=!1,t.pluginSystem=new a.a,t.defaultRetrospect=2592e6,t}return t=c,(n=[{key:"getName",value:function(){return this.name}},{key:"getAuthToken",value:function(){return this.kernel.getAuthToken()}},{key:"require",value:function(e){this.dependencies.indexOf(e)>=0||this.dependencies.push(e)}},{key:"requireFile",value:function(e,t,n){if(!(this.deps.indexOf(e)>=0)&&(this.deps.push(e),this.depsLoadMap.put(e,{key:e,success:t,failure:n}),this.started)){if(this.depsLoading)return;this.depsLoading=!0,this._loadDepsByOrder()}}},{key:"_loadDepsByOrder",value:function(){var e=this;if(this.depsLoadMap.isEmpty())this.depsLoading=!1;else{var t=this.depsLoadMap.keys()[0],n=this.depsLoadMap.remove(t),r=n.success,o=n.failure,a=function(){e._loadDepsByOrder()};this.kernel.loadDepsJS(t).then((function(){i.a.Logger.i(e.getName(),"Load deps file: "+t),void 0!==r&&r(t),a()})).catch((function(){i.a.Logger.w(e.getName(),"Can NOT load deps file: "+t),void 0!==o&&o(t),a()}))}}},{key:"hasStarted",value:function(){return this.started}},{key:"start",value:function(){if(!this.kernel.working)return!1;if(this.started)return!1;for(var e=0;e<this.dependencies.length;++e){var t=this.kernel.getModule(this.dependencies[e]);null!=t&&t.start()}return this.started=!0,!0}},{key:"stop",value:function(){this.started=!1,this.depsLoading=!1,this.depsLoadMap.clear()}},{key:"suspend",value:function(){}},{key:"resume",value:function(){}},{key:"config",value:function(e){}},{key:"isReady",value:function(){return!0}},{key:"on",value:function(e,t){"string"==typeof e?this.attachWithName(e,t):"function"==typeof e&&this.attach(e)}},{key:"getPluginSystem",value:function(){return this.pluginSystem}}])&&s(t.prototype,n),r&&s(t,r),c}(o.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return _}));var r=n(14),i=(n(39),n(7)),o=n(56),a=n(12),u=n(43),c=n(54),s=(n(83),n(158),n(20)),l=(n(61),n(16)),f=n(4),h=n(6),p=n(8),d=n(35),v=n(0),y=n(18);function g(e){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e,t,n){return(b="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=O(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=O(e);if(t){var i=O(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return S(this,n)}}function S(e,t){return!t||"object"!==g(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var _=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(S,e);var t,n,r,g=k(S);function S(e,t,n,r){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,S),(i=g.call(this,e)).name=t.getName()+"#"+e,i.founder=t,i.startTime=0,i.endTime=0,i.pipeline=n,i.self=r,i.mediaListener=null,i.mediaConstraint=new c.a(!0,!0),i.endpoints=[],i.outboundRTC=null,i.inboundRTCMap=new y.a,i.inboundRTC=null,i.rtcForEndpointMap=new y.a,i.group=null,i.caller=null,i.callee=null,i}return t=S,r=[{key:"create",value:function(e,t,n){var r=new S(e.id,i.a.create(e.founder),t,n);if(r.name=e.name,r.mediaConstraint=c.a.create(e.mediaConstraint),r.startTime=e.startTime,r.endTime=e.endTime,void 0!==e.endpoints)for(var o=e.endpoints,s=0;s<o.length;++s){var l=u.a.create(o[s]);l.field=r,r.endpoints.push(l)}return void 0!==e.group&&(r.group=a.a.create(null,e.group)),void 0!==e.caller&&(r.caller=i.a.create(e.caller,e.domain)),void 0!==e.callee&&(r.callee=i.a.create(e.callee,e.domain)),r}}],(n=[{key:"getName",value:function(){return this.name}},{key:"getFounder",value:function(){return this.founder}},{key:"getMediaConstraint",value:function(){return this.mediaConstraint}},{key:"isPrivate",value:function(){return this.id==this.founder.getId()}},{key:"getLocalDevice",value:function(){return this.outboundRTC}},{key:"getMicrophoneVolume",value:function(){if(null==this.outboundRTC)return-1;if(null!=this.outboundRTC.outboundMeter){var e=Math.round(100*this.outboundRTC.outboundMeter.volume),t=this.getEndpoint(this.self);return null!=t&&(t.volume=e),e}return 0}},{key:"snapshootStatsReport",value:function(e,t){var n=this;null!=this.outboundRTC?this.outboundRTC.pc.getStats(null).then((function(t){e(n,t)})):e(this,null),t&&(null!=this.inboundRTC?this.inboundRTC.pc.getStats(null).then((function(e){t(n,e)})):t(this,null))}},{key:"launchOffer",value:function(e,t,n,r,i){var o=this;"sendrecv"==e.mode||"sendonly"==e.mode?this.outboundRTC=e:void 0!==i&&null!=i?this.inboundRTCMap.put(i.id,e):this.inboundRTC=e,void 0!==i&&null!=i&&this.rtcForEndpointMap.put(e.sn,i),e.onIceCandidate=function(e,t){o.onIceCandidate(e,t)},e.onMediaConnected=function(e){o.onMediaConnected(e)},e.onMediaDisconnected=function(e){o.onMediaDisconnected(e)},this.isPrivate()||(t.limitPattern=!0),e.openOffer(t,(function(a){var u=new d.a(s.a.Offer,o,o.self,o.self.device);u.sn=e.sn,u.sessionDescription=a,u.mediaConstraint=t,void 0!==i&&(u.target=i);try{o.sendSignaling(u,(function(e){o.copy(e.field),n(o)}),r)}catch(e){r(new v.a(l.a.NAME,p.a.Failure,e))}}),(function(e){r(e)}))}},{key:"launchAnswer",value:function(e,t,n,r,i,o){var a=this;"sendrecv"==e.mode||"sendonly"==e.mode?this.outboundRTC=e:void 0!==o&&null!=o?this.inboundRTCMap.put(o.id,e):this.inboundRTC=e,e.onIceCandidate=function(t){a.onIceCandidate(t,e)},e.onMediaConnected=function(e){a.onMediaConnected(e)},e.onMediaDisconnected=function(e){a.onMediaDisconnected(e)},e.openAnswer(t,n,(function(t){var u=new d.a(s.a.Answer,a,a.self,a.self.device);u.sn=e.sn,u.sessionDescription=t,u.mediaConstraint=n,void 0!==o&&(u.target=o);try{a.sendSignaling(u,(function(e){a.copy(e.field),r(a)}),i)}catch(e){i(new v.a(l.a.NAME,p.a.Failure,e))}}),(function(e){i(e)}))}},{key:"applyCall",value:function(e,t,n,r){var i=this,o=new f.a(s.a.ApplyCall,{field:this.toCompactJSON(),participant:e.toCompactJSON(),device:t.toCompactJSON()});this.pipeline.send(l.a.NAME,o,(function(o,a,u){if(null!=u&&u.getStateCode()==h.a.OK)if(u.data.code==p.a.Ok){var c=u.data.data;i.copy(c),n(i,e,t)}else{var s=new v.a(l.a.NAME,u.data.code,{field:i,participant:e,device:t});r(s)}else{var f=new v.a(l.a.NAME,null!=u?u.getStateCode():p.a.ServerFault,{field:i,participant:e,device:t});r(f)}}))}},{key:"applyJoin",value:function(e,t,n,r){var i=this,o=new f.a(s.a.ApplyJoin,{field:this.toCompactJSON(),participant:e.toCompactJSON(),device:t.toCompactJSON()});this.pipeline.send(l.a.NAME,o,(function(o,a,u){if(null!=u&&u.getStateCode()==h.a.OK)if(u.data.code==p.a.Ok){var c=u.data.data;i.copy(c),n(i,e,t)}else{var s=new v.a(l.a.NAME,u.data.code,{field:i,participant:e,device:t});r(s)}else{var f=new v.a(l.a.NAME,null!=u?u.getStateCode():p.a.ServerFault,{field:i,participant:e,device:t});r(f)}}))}},{key:"applyTerminate",value:function(e,t,n,r){var i=this,o=new f.a(s.a.ApplyTerminate,{field:this.toCompactJSON(),participant:e.toCompactJSON(),device:t.toCompactJSON()});this.pipeline.send(l.a.NAME,o,(function(o,a,u){if(null!=u&&u.getStateCode()==h.a.OK)if(u.data.code==p.a.Ok){var c=u.data.data;i.copy(c),n&&n(i,e,t)}else{var s=new v.a(l.a.NAME,u.data.code,{field:i,participant:e,device:t});r&&r(s)}else{var f=new v.a(l.a.NAME,null!=u?u.getStateCode():p.a.ServerFault,{field:i,participant:e,device:t});r&&r(f)}}))}},{key:"hasJoin",value:function(){for(var e=0;e<this.endpoints.length;++e){var t=this.endpoints[e];if(t.contact.id==this.self.id&&t.device.name==this.self.device.name)return!0}return!1}},{key:"numEndpoints",value:function(){return this.endpoints.length}},{key:"getEndpoints",value:function(){return this.endpoints.concat()}},{key:"getEndpoint",value:function(e){if(void 0===e){for(var t=0;t<this.endpoints.length;++t){var n=this.endpoints[t];if(n.contact.id==this.self.id)return n.rtcDevice=this.getRTCDevice(),n}return null}if(e instanceof u.a)for(var r=0;r<this.endpoints.length;++r){var a=this.endpoints[r];if(a.getId()==e.getId())return a.rtcDevice=this.getRTCDevice(a),a}else if(e instanceof i.a||e instanceof o.a)for(var c=0;c<this.endpoints.length;++c){var s=this.endpoints[c];if(s.contact.id==e.id)return s.rtcDevice=this.getRTCDevice(s),s}else if("number"==typeof e)for(var l=0;l<this.endpoints.length;++l){var f=this.endpoints[l];if(f.getId()==e)return f.rtcDevice=this.getRTCDevice(f),f}return null}},{key:"closeEndpoint",value:function(e){for(var t=0;t<this.endpoints.length;++t){var n=this.endpoints[t];if(n.getId()==e.getId()){this.closeRTCDevice(n),this.endpoints.splice(t,1);break}}}},{key:"numRTCDevices",value:function(){return(null!=this.outboundRTC?1:0)+this.inboundRTCMap.size()}},{key:"getRTCDevice",value:function(e){if(void 0===e)return this.outboundRTC;if("number"==typeof e)return this.getRTCDeviceWithSN(e);var t=this.inboundRTCMap.get(e.getId());return null!=t?t:e.contact.id==this.self.id&&e.device.name==this.self.device.name?this.outboundRTC:null}},{key:"getRTCDeviceWithSN",value:function(e){if(null!=this.outboundRTC&&this.outboundRTC.sn==e)return this.outboundRTC;if(null!=this.inboundRTC&&this.inboundRTC.sn==e)return this.inboundRTC;for(var t=this.inboundRTCMap.values(),n=0;n<t.length;++n){var r=t[n];if(r.sn==e)return r}return null}},{key:"hasRTCDevice",value:function(e){return this.inboundRTCMap.containsKey(e.getId())}},{key:"close",value:function(){this.closeRTCDevices(),this.endpoints.splice(0,this.endpoints.length),this.caller=null,this.callee=null,this.group=null}},{key:"closeRTCDevice",value:function(e){if(null!=this.outboundRTC&&this.self.id==e.contact.id&&this.self.device.name==e.device.name)return this.outboundRTC.close(),void(this.outboundRTC=null);var t=this.inboundRTCMap.remove(e.getId());null!=t&&(this.rtcForEndpointMap.remove(t.sn),t.close())}},{key:"closeRTCDevices",value:function(){null!=this.outboundRTC&&(this.outboundRTC.close(),this.outboundRTC=null),this.inboundRTCMap.forEach((function(e,t){t.close()})),this.inboundRTCMap.clear(),this.rtcForEndpointMap.clear(),null!=this.inboundRTC&&(this.inboundRTC.close(),this.inboundRTC=null)}},{key:"sendSignaling",value:function(e,t,n){var r=this;this.pipeline.send(l.a.NAME,new f.a(e.name,e.toJSON()),(function(e,i,o){if(null!=o&&o.getStateCode()==h.a.OK)if(o.data.code==p.a.Ok){var a=o.data.data,u=d.a.create(a,r.pipeline,r.self);t&&t(u)}else n&&n(new v.a(l.a.NAME,o.data.code,r));else n&&n(new v.a(l.a.NAME,p.a.ServerFault,r))}))}},{key:"sendBroadcast",value:function(e,t){var n=new f.a(s.a.Broadcast,{source:e.toJSON(),data:t});this.pipeline.send(l.a.NAME,n)}},{key:"onIceCandidate",value:function(e,t){var n=new d.a(s.a.Candidate,this,this.self,this.self.device);n.sn=t.sn,n.candidate=e;var r=this.rtcForEndpointMap.get(t.sn);null!=r&&(n.target=r),this.sendSignaling(n)}},{key:"onMediaConnected",value:function(e){var t=this;e==this.outboundRTC&&null==this.outboundRTC.outboundMeter&&setTimeout((function(){t.outboundRTC.startOutboundMeter()}),1),null!=this.mediaListener&&this.mediaListener.onMediaConnected(this,e)}},{key:"onMediaDisconnected",value:function(e){null!=this.mediaListener&&this.mediaListener.onMediaDisconnected(this,e)}},{key:"copy",value:function(e){var t=this;e instanceof S?(this.endpoints=e.endpoints.concat(),e.mediaConstraint&&(this.mediaConstraint=e.mediaConstraint),e.startTime>0&&(this.startTime=e.startTime),e.endTime>0&&(this.endTime=e.endTime),null==this.group&&null!=e.group&&(this.group=e.group),null!=e.caller&&(this.caller=e.caller),null!=e.callee&&(this.callee=e.callee)):(void 0!==e.endpoints&&(this.endpoints.splice(0,this.endpoints.length),e.endpoints.forEach((function(e){var n=u.a.create(e);n.field=t,t.endpoints.push(n)}))),void 0!==e.mediaConstraint&&(this.mediaConstraint=c.a.create(e.mediaConstraint)),void 0!==e.startTime&&(this.startTime=e.startTime),void 0!==e.endTime&&(this.endTime=e.endTime),void 0!==e.group&&(this.group=a.a.create(null,e.group)),null==this.caller&&void 0!==e.caller&&(this.caller=i.a.create(e.caller)),null==this.callee&&void 0!==e.callee&&(this.callee=i.a.create(e.callee)))}},{key:"toJSON",value:function(){var e=b(O(S.prototype),"toJSON",this).call(this);e.domain=this.founder.getDomain(),e.name=this.name,e.founder=this.founder.toCompactJSON(),e.mediaConstraint=this.mediaConstraint.toJSON(),e.startTime=this.startTime,e.endTime=this.endTime,e.endpoints=[];for(var t=0;t<this.endpoints.length;++t)e.endpoints.push(this.endpoints[t].toJSON());return null!=this.group&&(e.group=this.group.toCompactJSON()),null!=this.caller&&(e.caller=this.caller.toCompactJSON()),null!=this.callee&&(e.callee=this.callee.toCompactJSON()),e}},{key:"toCompactJSON",value:function(){var e=b(O(S.prototype),"toCompactJSON",this).call(this);return e.domain=this.founder.getDomain(),e.name=this.name,e.founder=this.founder.toCompactJSON(),e.mediaConstraint=this.mediaConstraint.toJSON(),e.startTime=this.startTime,e.endTime=this.endTime,null!=this.group&&(e.group=this.group.toCompactJSON()),null!=this.caller&&(e.caller=this.caller.toCompactJSON()),null!=this.callee&&(e.callee=this.callee.toCompactJSON()),e}}])&&m(t.prototype,n),r&&m(t,r),S}(r.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return y}));var r=n(7),i=n(39),o=(n(61),n(24)),a=n(34),u=n(43),c=n(54);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t,n){return(f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=v(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v(e);if(t){var i=v(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return d(this,n)}}function d(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(d,e);var t,n,o,s=p(d);function d(e,t,n,r){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d),(i=s.call(this)).sn=0,i.name=e,i.field=t,i.contact=n,i.device=r,i.target=null,i.sessionDescription=null,i.candidate=null,i.candidates=null,i.mediaConstraint=null,i.invitee=null,i.invitees=[],i.caller=null,i.callee=null,i}return t=d,o=[{key:"create",value:function(e,t,n){var o=new d(e.name,a.a.create(e.field,t,n),r.a.create(e.contact),i.a.create(e.device));if(o.sn=e.sn,e.description&&(o.sessionDescription=e.description),e.target&&(o.target=u.a.create(e.target)),e.candidate&&(o.candidate=e.candidate),e.candidates&&(o.candidates=e.candidates),e.constraint&&(o.mediaConstraint=c.a.create(e.constraint)),e.invitees)for(var s=0;s<e.invitees.length;++s)o.invitees.push(e.invitees[s]);return e.invitee&&(o.invitee=r.a.create(e.invitee)),e.caller&&(o.caller=r.a.create(e.caller)),e.callee&&(o.callee=r.a.create(e.callee)),o}}],(n=[{key:"toJSON",value:function(){var e=f(v(d.prototype),"toJSON",this).call(this);return e.sn=this.sn,e.name=this.name,e.field=this.field.toCompactJSON(),e.contact=this.contact.toCompactJSON(),e.device=this.device.toCompactJSON(),null!=this.sessionDescription&&(e.description=this.sessionDescription),null!=this.target&&(e.target=this.target.toJSON()),null!=this.candidate&&(e.candidate=this.candidate),null!=this.mediaConstraint&&(e.constraint=this.mediaConstraint.toJSON()),this.invitees.length>0&&(e.invitees=this.invitees.concat()),null!=this.caller&&(e.caller=this.caller.toCompactJSON()),null!=this.callee&&(e.callee=this.callee.toCompactJSON()),e}},{key:"toCompactJSON",value:function(){return this.toJSON()}}])&&l(t.prototype,n),o&&l(t,o),d}(o.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));n(61),n(4),n(121);function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,i;return t=e,(n=[{key:"onReceived",value:function(e,t,n){}},{key:"onOpened",value:function(e){}},{key:"onClosed",value:function(e){}},{key:"onFailed",value:function(e,t){}}])&&r(t.prototype,n),i&&r(t,i),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r={Normal:0,Dismissed:1,Forbidden:2,HighRisk:3,Disabled:9,Unknown:-1}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var r=n(24),i=n(84);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var i=f(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return l(this,n)}}function l(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var h=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(l,e);var t,n,r,o=s(l);function l(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(n=o.call(this)).name=e,n.platform=null,n.platform=void 0===t?i.a.getBrowserName()+"/"+i.a.getSystem():t,n}return t=l,r=[{key:"create",value:function(e){return new l(e.name,e.platform)}}],(n=[{key:"getName",value:function(){return this.name}},{key:"getPlatform",value:function(){return this.platform}},{key:"setPlatform",value:function(e){this.platform=e}},{key:"toJSON",value:function(){var e=u(f(l.prototype),"toJSON",this).call(this);return e.name=this.name,e.platform=this.platform,e}},{key:"toCompactJSON",value:function(){return this.toJSON()}}])&&a(t.prototype,n),r&&a(t,r),l}(r.a)},function(e,t,n){var r=n(31),i=n(72);e.exports=n(29)?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){var r=n(17),i=n(40),o=n(44),a=n(73)("src"),u=n(199),c=(""+u).split("toString");n(49).inspectSource=function(e){return u.call(e)},(e.exports=function(e,t,n,u){var s="function"==typeof n;s&&(o(n,"name")||i(n,"name",t)),e[t]!==n&&(s&&(o(n,a)||i(n,a,e[t]?""+e[t]:c.join(String(t)))),e===r?e[t]=n:u?e[t]?e[t]=n:i(e,t,n):(delete e[t],i(e,t,n)))})(Function.prototype,"toString",(function(){return"function"==typeof this&&this[a]||u.call(this)}))},function(e,t,n){var r=n(2),i=n(22),o=n(58),a=/"/g,u=function(e,t,n,r){var i=String(o(e)),u="<"+t;return""!==n&&(u+=" "+n+'="'+String(r).replace(a,"&quot;")+'"'),u+">"+i+"</"+t+">"};e.exports=function(e,t){var n={};n[e]=t(u),r(r.P+r.F*i((function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3})),"String",n)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return y}));n(1);var r=n(14),i=n(7),o={Normal:0,Calling:10,Busy:11,CallConnected:13,CallBye:15,Unknown:99},a=n(9),u=n(39),c=function(e){for(var t=0,n=0,r=e.length;n<r;++n){t+=3*e.charCodeAt(n)+3*t}return Math.abs(t)};n(34),n(83);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t,n){return(f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=v(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v(e);if(t){var i=v(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return d(this,n)}}function d(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(d,e);var t,n,r,s=p(d);function d(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d),(r=s.call(this,e)).name=[t.getId(),"_",t.getDomain(),"_",n.getName(),"_",n.getPlatform()].join(""),0==r.id&&(r.id=c(r.name)),r.contact=t,r.device=n,r.field=null,r.rtcDevice=null,r.state=o.Normal,r.volume=0,r.videoEnabled=!1,r.videoStreamEnabled=!1,r.audioEnabled=!1,r.audioStreamEnabled=!1,r.videoUpstreamBandwidth=0,r.videoDownstreamBandwidth=0,r.audioUpstreamBandwidth=0,r.audioDownstreamBandwidth=0,r.sessionDescription=null,r}return t=d,r=[{key:"create",value:function(e){var t=new d(e.id,i.a.create(e.contact,e.domain),u.a.create(e.device));return t.state=e.state,t.name=e.name,t.videoEnabled=e.video.enabled,t.videoStreamEnabled=e.video.streamEnabled,t.audioEnabled=e.audio.enabled,t.audioStreamEnabled=e.audio.streamEnabled,t}}],(n=[{key:"getName",value:function(){return this.name}},{key:"getContact",value:function(){return this.contact}},{key:"getDevice",value:function(){return this.device}},{key:"isVideoMuted",value:function(){return null!=this.rtcDevice&&(this.videoStreamEnabled=this.rtcDevice.outboundVideoEnabled()),!this.videoStreamEnabled}},{key:"muteVideo",value:function(){this.videoStreamEnabled=!1,null!=this.rtcDevice&&this.rtcDevice.enableOutboundVideo(!1),null!=this.field&&this.field.sendBroadcast(this,{event:a.a.VideoMuted,value:!0,timestamp:window.performance.now()})}},{key:"unmuteVideo",value:function(){this.videoStreamEnabled=!0,null!=this.rtcDevice&&this.rtcDevice.enableOutboundVideo(!0),null!=this.field&&this.field.sendBroadcast(this,{event:a.a.VideoMuted,value:!1,timestamp:window.performance.now()})}},{key:"isAudioMuted",value:function(){return null!=this.rtcDevice&&(this.audioStreamEnabled=this.rtcDevice.outboundAudioEnabled()),!this.audioStreamEnabled}},{key:"muteAudio",value:function(){this.audioStreamEnabled=!1,null!=this.rtcDevice&&this.rtcDevice.enableOutboundAudio(!1),null!=this.field&&this.field.sendBroadcast(this,{event:a.a.AudioMuted,value:!0,timestamp:window.performance.now()})}},{key:"unmuteAudio",value:function(){this.audioStreamEnabled=!0,null!=this.rtcDevice&&this.rtcDevice.enableOutboundAudio(!0),null!=this.field&&this.field.sendBroadcast(this,{event:a.a.AudioMuted,value:!1,timestamp:window.performance.now()})}},{key:"toJSON",value:function(){var e=f(v(d.prototype),"toJSON",this).call(this);return e.id=this.id,e.domain=this.contact.getDomain(),e.contact=this.contact.toCompactJSON(),e.device=this.device.toJSON(),e.state=this.state,e.name=this.name,e.video={enabled:this.videoEnabled,streamEnabled:this.videoStreamEnabled},e.audio={enabled:this.audioEnabled,streamEnabled:this.audioStreamEnabled},e}},{key:"toCompactJSON",value:function(){var e=f(v(d.prototype),"toCompactJSON",this).call(this);return e.id=this.id,e.domain=this.contact.getDomain(),e.contact=this.contact.toCompactJSON(),e.device=this.device.toCompactJSON(),e.state=this.state,e.name=this.name,e}}])&&l(t.prototype,n),r&&l(t,r),d}(r.a)},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,n){var r=n(98),i=n(58);e.exports=function(e){return r(i(e))}},function(e,t,n){var r=n(99),i=n(72),o=n(45),a=n(57),u=n(44),c=n(159),s=Object.getOwnPropertyDescriptor;t.f=n(29)?s:function(e,t){if(e=o(e),t=a(t,!0),c)try{return s(e,t)}catch(e){}if(u(e,t))return i(!r.f.call(e,t),e[t])}},function(e,t,n){var r=n(44),i=n(32),o=n(131)("IE_PROTO"),a=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=i(e),r(e,o)?e[o]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?a:null}},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.d(t,"a",(function(){return i}));var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.length=0,this.obj=new Object}var t,n,i;return t=e,(n=[{key:"isEmpty",value:function(){return 0==this.length}},{key:"containsKey",value:function(e){return e in this.obj}},{key:"containsValue",value:function(e){for(var t in this.obj)if(this.obj[t]==e)return!0;return!1}},{key:"put",value:function(e,t){this.containsKey(e)||this.length++,this.obj[e]=t}},{key:"get",value:function(e){return this.containsKey(e)?this.obj[e]:null}},{key:"remove",value:function(e){if(this.containsKey(e)){var t=this.obj[e];return delete this.obj[e],this.length--,t}return null}},{key:"values",value:function(){var e=new Array;for(var t in this.obj)e.push(this.obj[t]);return e}},{key:"keys",value:function(){var e=new Array;for(var t in this.obj)e.push(t);return e}},{key:"keySet",value:function(){var e=new Array;for(var t in this.obj)e.push(t);return e}},{key:"size",value:function(){return this.length}},{key:"clear",value:function(){this.length=0,this.obj=new Object}}])&&r(t.prototype,n),i&&r(t,i),e}()},function(e,t){var n=e.exports={version:"2.6.12"};"number"==typeof __e&&(__e=n)},function(e,t,n){var r=n(38);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t){var n=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:n)(e)}},function(e,t,n){"use strict";var r=n(22);e.exports=function(e,t){return!!e&&r((function(){t?e.call(null,(function(){}),1):e.call(null)}))}},function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var r=n(24),i=n(106);n(102);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var i=f(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return l(this,n)}}function l(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var h=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(l,e);var t,n,r,o=s(l);function l(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(n=o.call(this)).videoEnabled=e,n.videoDevice=null,n.audioEnabled=t,n.audioDevice=null,n.dimension=i.a.VGA_IDEAL,n.limitPattern=!1,n}return t=l,r=[{key:"create",value:function(e){var t=new l(e.video,e.audio);return t.dimension=e.dimension,t}}],(n=[{key:"setVideoDimension",value:function(e){this.dimension=e}},{key:"getVideoDimension",value:function(){return this.dimension}},{key:"setAudioDevice",value:function(e){return!!e.isAudioInput()&&(this.audioDevice=e,!0)}},{key:"setVideoDevice",value:function(e){return!!e.isVideoInput()&&(this.videoDevice=e,!0)}},{key:"getConstraints",value:function(){var e={};return this.audioEnabled?null==this.audioDevice?e.audio=this.audioEnabled:e.audio={deviceId:this.audioDevice.deviceId,groupId:this.audioDevice.groupId}:e.audio=!1,this.videoEnabled?(e.video=this.dimension.constraints,this.limitPattern&&(e.video=i.a.VGA_IDEAL.constraints,e.video.frameRate=15),null!=this.videoDevice&&(e.video.deviceId=this.videoDevice.deviceId,e.video.groupId=this.videoDevice.groupId)):e.video=!1,e}},{key:"toJSON",value:function(){var e=u(f(l.prototype),"toJSON",this).call(this);return e.audio=this.audioEnabled,e.video=this.videoEnabled,e.dimension=this.dimension,e}}])&&a(t.prototype,n),r&&a(t,r),l}(r.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return y}));var r=n(1),i=n.n(r),o=n(48),a=(n(61),n(33),n(70),n(96)),u=n(15),c=n(87),s=(n(18),n(14));function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var f=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.depositedMapList=[],this.depositedArrayList=[],this.listener=null,this.timer=0}var t,n,r;return t=e,(n=[{key:"start",value:function(){var e=this;this.timer=setInterval((function(t){e._onTick()}),1e4)}},{key:"stop",value:function(){clearInterval(this.timer)}},{key:"depositMap",value:function(e){this.depositedMapList.push(e)}},{key:"depositArray",value:function(e){this.depositedArrayList.push(e)}},{key:"withdrawMap",value:function(e){var t=this.depositedMapList.indexOf(e);t>=0&&this.depositedMapList.splice(t,1)}},{key:"withdrawArray",value:function(e){var t=this.depositedArrayList.indexOf(e);t>=0&&this.depositedArrayList.splice(t,1)}},{key:"setListener",value:function(e){this.listener=e}},{key:"_onTick",value:function(){for(var e=Date.now(),t=0;t<this.depositedMapList.length;++t)for(var n=this.depositedMapList[t],r=n.keys(),i=0;i<r.length;++i){var o=r[i],a=n.get(o);a instanceof s.a&&e-a.entityCreation>s.a.CacheDuration&&(n.remove(o),null!=this.listener&&this.listener(a))}for(var u=0;u<this.depositedArrayList.length;++u)for(var c=this.depositedArrayList[u],l=0;l<c.length;++l){var f=c[l];f instanceof s.a&&e-f.entityCreation>s.a.CacheDuration&&(c.splice(l,1),null!=this.listener&&this.listener(f),--l)}}}])&&l(t.prototype,n),r&&l(t,r),e}();function h(e,t,n,r,i,o,a){try{var u=e[o](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,i)}function p(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){h(o,r,i,a,u,"next",e)}function u(e){h(o,r,i,a,u,"throw",e)}a(void 0)}))}}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var y=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=null,this.working=!1,this.depsPath="libs/",this.pipelines=new o.a,this.inspector=new f,this.modules=new o.a,e.gsInstance=this}var t,n,r,s;return t=e,(n=[{key:"getConfig",value:function(){return this.config}},{key:"startup",value:(s=p(regeneratorRuntime.mark((function t(n,r,o){var u,s,l,f=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return void 0===n.log?i.a.Logger.level=i.a.LogLevel.DEBUG:i.a.Logger.level=n.log,void 0===n.address&&(n.address="127.0.0.1"),u=window.location.protocol.toLowerCase().indexOf("https")>=0,this.pipelines.values().forEach((function(e){e instanceof c.a&&(void 0===n.port||u?void 0!==n.securePort&&u&&(e.port=parseInt(n.securePort)):e.port=parseInt(n.port),e.address=n.address)})),this.working=!0,this.config=n,e.CONFIG=n,this.inspector.start(),this.bundleDefault(),t.next=11,this.checkAuth(n);case 11:if(null!=(s=t.sent)&&s.isValid()){t.next=15;break}return o(new a.a("Invalid token config data")),t.abrupt("return");case 15:this.configModules(n,s),l=function(){var e=p(regeneratorRuntime.mark((function e(t){var i,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===n.unconnected||!n.unconnected){e.next=4;break}t?r():o(new a.a("Load module deps failed")),e.next=10;break;case 4:for(i=f.pipelines.values(),u=0;u<i.length;++u)i[u].open();if(void 0===n.pipelineReady||!n.pipelineReady){e.next=9;break}return e.next=9,f.waitPipelineReady(1e4);case 9:t?r():o(new a.a("Load module deps failed"));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.loadModuleDeps((function(e,t){l(!0)}),(function(e,t){l(!1)}));case 18:case"end":return t.stop()}}),t,this)}))),function(e,t,n){return s.apply(this,arguments)})},{key:"shutdown",value:function(){this.working=!1,this.inspector.stop();for(var e=this.modules.values(),t=0;t<e.length;++t)e[t].stop();for(var n=this.pipelines.values(),r=0;r<n.length;++r)n[r].close()}},{key:"suspend",value:function(){}},{key:"resume",value:function(){}},{key:"installPipeline",value:function(e){e.kernel=this,this.pipelines.put(e.getName(),e)}},{key:"uninstallPipeline",value:function(e){this.pipelines.remove(e.getName())}},{key:"getPipeline",value:function(e){return this.pipelines.get(e)}},{key:"installModule",value:function(e){e.kernel=this,this.modules.put(e.getName(),e)}},{key:"uninstallModule",value:function(e){this.modules.remove(e.getName())}},{key:"getModule",value:function(e){return this.modules.get(e)}},{key:"getAuthToken",value:function(){return this.getModule(u.a.NAME).getToken()}},{key:"activeToken",value:function(e){var t=this;return new Promise((function(n,r){t.getModule(u.a.NAME).allocToken(e,(function(e){if(null!=e){for(var r=t.pipelines.values(),i=0;i<r.length;++i)r[i].setTokenCode(e.code);n(e)}else n(null)}))}))}},{key:"waitPipelineReady",value:function(e){var t=this;return new Promise((function(n,r){var i=0,o=setTimeout((function(e){clearInterval(i),clearTimeout(o),n()}),e),a=t.pipelines.get("Cell");i=setInterval((function(e){a.isReady()&&(clearInterval(i),clearTimeout(o),n())}),100)}))}},{key:"checkAuth",value:function(e){var t=this;return new Promise((function(n,r){var o=t.getModule(u.a.NAME);if(null==o)return i.a.Logger.w("Kernel","Can NOT find auth module"),void n(null);if(void 0===e.domain||void 0===e.appKey)return i.a.Logger.w("Kernel","Auth config error"),void n(null);var a=t.pipelines.get("Cell");void 0!==e.address&&a.address!=e.address&&a.setRemoteAddress(e.address),a.open(),o.start(),o.check(e.domain,e.appKey,(function(e){null==e?(i.a.Logger.w("Kernel","Auth token is invalid"),n(null)):n(e)}))}))}},{key:"bundle",value:function(e,t){}},{key:"bundleDefault",value:function(){for(var e=this.pipelines.get("Cell"),t=this.modules.values(),n=0;n<t.length;++n){var r=t[n];null==r.pipeline&&(r.pipeline=e)}}},{key:"configModules",value:function(e,t){if(null==t)return!1;for(var n=this.pipelines.values(),r=0;r<n.length;++r)n[r].setTokenCode(t.code);for(var o=this.modules.values(),a=0;a<o.length;++a){for(var u=o[a],c=0;c<u.dependencies.length;++c){var s=u.dependencies[c];this.modules.containsKey(s)||i.a.Logger.e("Kernel",'Module "'+s+'" is not installed, which module "'+u.name+'" depends.')}if(t.description.primaryContent.hasOwnProperty(u.name)){var l=t.description.primaryContent[u.name];u.config(l)}}return!0}},{key:"loadModuleDeps",value:function(e,t){for(var n=this,r=[],o=this.modules.values(),a=0;a<o.length;++a)for(var u=o[a],c=0;c<u.deps.length;++c){var s=u.deps[c];r.indexOf(s)>=0||r.push(s)}var l=[],f=[];0!=r.length?new Promise((function(e,t){!function e(){var t=null;r.length>0&&(t=r.splice(0,1),n.loadDepsJS(t).then((function(t){l.push(t),e()})).catch((function(t){f.push(t),i.a.Logger.i("Kernel","Startup error: can not load file: "+t),e()})))}();var o=0,a=setInterval((function(n){if(++o>=50)return clearInterval(a),void t();0==r.length&&(clearInterval(a),f.length>0?t():e())}),100)})).then((function(t){i.a.Logger.d("Kernel","Module deps files loaded: "+l.length),e.call(null,l,f)})).catch((function(e){t.call(null,l,f)})):e(l,f)}},{key:"loadDepsJS",value:function(e){var t=this.depsPath;return new Promise((function(n,r){var i=document.createElement("script");i.type="text/javascript",i.readyState?i.onreadystatechange=function(){"loaded"!=i.readyState&&"complete"!=i.readyState||(i.onreadystatechange=null,n(e))}:(i.onload=function(t){n(e)},i.onerror=function(t){r(e)}),e.startsWith("http://")||e.startsWith("https://")?i.src=e:i.src=t+e,document.getElementsByTagName("body")[0].appendChild(i)}))}}])&&d(t.prototype,n),r&&d(t,r),e}();v(y,"VERSION","3.0.0"),v(y,"WORKER_URL_PATH","/cube/"),v(y,"CONFIG",null),v(y,"gsInstance",null)},function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var r=n(7),i=n(39),o=n(15);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=h(e);if(t){var i=h(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f(this,n)}}function f(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var p=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(f,e);var t,n,r,a=l(f);function f(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),(n=a.call(this,e,t,o.a.DOMAIN)).device=new i.a("Web"),n.addDevice(n.device),n}return t=f,(n=[{key:"getDevice",value:function(){return this.device}},{key:"resetDevice",value:function(e){this.removeDevice(this.device),this.device=e,this.addDevice(this.device)}},{key:"toJSON",value:function(){var e=c(h(f.prototype),"toJSON",this).call(this);return e.device=this.device.toJSON(),e}},{key:"toCompactJSON",value:function(){var e=c(h(f.prototype),"toCompactJSON",this).call(this);return e.device=this.device.toCompactJSON(),e}}])&&u(t.prototype,n),r&&u(t,r),f}(r.a)},function(e,t,n){var r=n(25);e.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,n){var r=n(2),i=n(49),o=n(22);e.exports=function(e,t){var n=(i.Object||{})[e]||Object[e],a={};a[e]=t(n),r(r.S+r.F*o((function(){n(1)})),"Object",a)}},function(e,t,n){var r=n(50),i=n(98),o=n(32),a=n(28),u=n(147);e.exports=function(e,t){var n=1==e,c=2==e,s=3==e,l=4==e,f=6==e,h=5==e||f,p=t||u;return function(t,u,d){for(var v,y,g=o(t),m=i(g),b=r(u,d,3),w=a(m.length),k=0,S=n?p(t,w):c?p(t,0):void 0;w>k;k++)if((h||k in m)&&(y=b(v=m[k],k,g),e))if(n)S[k]=y;else if(y)switch(e){case 3:return!0;case 5:return v;case 6:return k;case 2:S.push(v)}else if(l)return!1;return f?-1:s||l?l:S}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(48);n(55),n(36),n(4),n(121);function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t,this.kernel=null,this.listenerMap=new r.a,this.stateListenerList=[],this.address=null,this.port=7070,window.location.protocol.toLowerCase().indexOf("https")>=0&&(this.port=7077),this.opened=!1,this.tokenCode=null}var t,n,o;return t=e,(n=[{key:"getName",value:function(){return this.name}},{key:"setRemoteAddress",value:function(e,t){if(void 0!==t){if(this.port==t&&this.address==e)return}else if(this.address==e)return;var n=this.opened;n&&this.close(),this.address=e,void 0!==t&&(this.port=t),n&&this.open()}},{key:"setTokenCode",value:function(e){this.tokenCode=e}},{key:"open",value:function(){this.opened=!0}},{key:"close",value:function(){this.opened=!1}},{key:"isReady",value:function(){return!0}},{key:"addStateListener",value:function(e){this.stateListenerList.indexOf(e)>=0||this.stateListenerList.push(e)}},{key:"removeStateListener",value:function(e){var t=this.stateListenerList.indexOf(e);t>=0&&this.stateListenerList.splice(t,1)}},{key:"triggerState",value:function(e,t){for(var n=[],r=this.listenerMap.values(),i=0;i<r.length;++i)for(var o=r[i],a=0;a<o.length;++a)n.push(o[a]);if(n=n.concat(this.stateListenerList),"connected"===e)for(var u=0;u<n.length;++u){var c=n[u];"function"==typeof c?c({name:e,pipeline:this}):c.onOpened&&c.onOpened(this)}else if("failed"===e)for(var s=0;s<n.length;++s){var l=n[s];"function"==typeof l?l({name:e,pipeline:this,error:t}):l.onFailed&&l.onFailed(this,t)}else if("disconnected"===e)for(var f=0;f<n.length;++f){var h=n[f];"function"==typeof h?h({name:e,pipeline:this}):h&&h.onClosed&&h.onClosed(this)}}},{key:"send",value:function(e,t,n){}},{key:"addListener",value:function(e,t){var n=this.listenerMap.get(e);null==n?this.listenerMap.put(e,[t]):n.indexOf(t)<0&&n.push(t)}},{key:"removeListener",value:function(e,t){var n=this.listenerMap.get(e);if(null!=n){var r=n.indexOf(t);r>=0&&n.splice(r,1)}}},{key:"getListeners",value:function(e){return this.listenerMap.get(e)}},{key:"triggerListeners",value:function(e,t){var n=this.listenerMap.get(e);if(null!=n)for(var r=0;r<n.length;++r){var i=n[r];"function"==typeof i?i(this,e,t):i.onReceived(this,e,t)}}},{key:"touchCallback",value:function(e,t,n){n(this,e,t)}}])&&i(t.prototype,n),o&&i(t,o),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var r=n(0),i=n(4),o=n(6),a=n(24),u=n(18),c=n(7),s=n(10),l=n(11),f=n(5);n(12);function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t,n){return(d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=m(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m(e);if(t){var i=m(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g(this,n)}}function g(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var b=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(g,e);var t,n,a,h=y(g);function g(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,g),(n=h.call(this)).service=e,n.group=t,n.remark=null,n.notice="",n.following=!1,n.memberRemarkMap=new u.a,n.context=null,n.commId=0,n}return t=g,a=[{key:"create",value:function(e,t,n){var r=new g(e,t);return r.notice=n.notice,n.memberRemarks.forEach((function(e){r.memberRemarkMap.put(e.id,e.name)})),n.remark&&(r.remark=n.remark),n.context&&(r.context=n.context),void 0!==n.commId&&(r.commId=n.commId),r}}],(n=[{key:"hasRemark",value:function(){return null!=this.remark&&this.remark.length>0}},{key:"getRemark",value:function(){return this.remark}},{key:"getNotice",value:function(){return this.notice}},{key:"getMemberRemark",value:function(e){return e instanceof c.a?this.memberRemarkMap.get(e.getId()):this.memberRemarkMap.get(parseInt(e))}},{key:"hasMemberRemark",value:function(e){return e instanceof c.a?this.memberRemarkMap.containsKey(e.getId()):this.memberRemarkMap.containsKey(parseInt(e))}},{key:"setMemberRemark",value:function(e,t){this.memberRemarkMap.put(e instanceof c.a?e.getId():parseInt(e),t)}},{key:"setMemberRemarks",value:function(e){for(var t=0;t<e.length;++t){var n=e[t];this.memberRemarkMap.put(n.id,n.name)}}},{key:"getCommId",value:function(e,t){var n=this;if(void 0===e&&void 0===t)return this.commId;var a=new i.a(s.a.GetAppendix,{groupId:this.group.getId(),commId:this.commId});this.service.pipeline.send(l.a.NAME,a,(function(i,a,u){if(null!=u&&u.getStateCode()==o.a.OK)if(u.getPayload().code==f.a.Ok)n.commId=u.getPayload().data.commId,e(n.commId,n,n.group);else{var c=new r.a(l.a.NAME,u.getPayload().code,n);t&&t(c)}else{var s=new r.a(l.a.NAME,f.a.ServerError,n);t&&t(s)}}))}},{key:"updateRemark",value:function(e,t,n){var a=this,u=new i.a(s.a.UpdateAppendix,{groupId:this.group.getId(),remark:e});this.service.pipeline.send(l.a.NAME,u,(function(i,u,c){if(null!=c&&c.getStateCode()==o.a.OK)if(c.getPayload().code==f.a.Ok)a.remark=e,t&&t(a);else{var s=new r.a(l.a.NAME,c.getPayload().code,a);n&&n(s)}else{var h=new r.a(l.a.NAME,f.a.ServerError,a);n&&n(h)}}))}},{key:"updateNotice",value:function(e,t,n){var a=this,u=new i.a(s.a.UpdateAppendix,{groupId:this.group.getId(),notice:e});this.service.pipeline.send(l.a.NAME,u,(function(i,u,c){if(null!=c&&c.getStateCode()==o.a.OK)if(c.getPayload().code==f.a.Ok)a.notice=e,t&&t(a);else{var s=new r.a(l.a.NAME,c.getPayload().code,a);n&&n(s)}else{var h=new r.a(l.a.NAME,f.a.ServerError,a);n&&n(h)}}))}},{key:"updateMemberRemark",value:function(e,t,n,a){var u=this,h=new i.a(s.a.UpdateAppendix,{groupId:this.group.getId(),memberRemark:{id:e instanceof c.a?e.getId():parseInt(e),name:t}});this.service.pipeline.send(l.a.NAME,h,(function(i,c,s){if(null!=s&&s.getStateCode()==o.a.OK)if(s.getPayload().code==f.a.Ok)u.setMemberRemark(e,t),n&&n(u);else{var h=new r.a(l.a.NAME,s.getPayload().code,u);a&&a(h)}else{var p=new r.a(l.a.NAME,f.a.ServerError,u);a&&a(p)}}))}},{key:"updateCommId",value:function(e,t,n){var a=this,u=new i.a(s.a.UpdateAppendix,{groupId:this.group.getId(),commId:e});this.service.pipeline.send(l.a.NAME,u,(function(i,u,c){if(null!=c&&c.getStateCode()==o.a.OK)if(c.getPayload().code==f.a.Ok)a.commId=e,t&&t(a);else{var s=new r.a(l.a.NAME,c.getPayload().code,a);n&&n(s)}else{var h=new r.a(l.a.NAME,f.a.ServerError,a);n&&n(h)}}))}},{key:"toJSON",value:function(){var e=this,t=d(m(g.prototype),"toJSON",this).call(this);return t.id=this.group.getId(),t.notice=this.notice,null!=this.remark&&(t.remark=this.remark),t.memberRemarks=[],this.memberRemarkMap.keySet().forEach((function(n){var r=e.memberRemarkMap.get(n);t.memberRemarks.push({id:n,name:r})})),null!=this.context&&(t.context=this.context),t.commId=this.commId,t}},{key:"toCompactJSON",value:function(){return this.toJSON()}}])&&p(t.prototype,n),a&&p(t,a),g}(a.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));n(7),n(56),n(0),n(34),n(43),n(54);function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.self=t,this.field=void 0!==n?n:null,this.startTime=Date.now(),this.answerTime=0,this.endTime=0,this.callerMediaConstraint=null,this.calleeMediaConstraint=null,this.lastError=null}var t,n,i;return t=e,(n=[{key:"isActive",value:function(){return null!=this.field&&this.field.numRTCDevices()>0}},{key:"getCaller",value:function(){return this.field.caller}},{key:"getCallee",value:function(){return this.field.callee}},{key:"isCaller",value:function(){return null!=this.field.caller&&this.self.getId()==this.field.caller.getId()}},{key:"isVideoCaller",value:function(){return this.callerMediaConstraint.videoEnabled}},{key:"getPeer",value:function(){return this.self.getId()==this.field.caller.getId()?this.field.callee:this.field.caller}},{key:"getDuration",value:function(){return 0==this.answerTime||0==this.endTime?0:this.endTime-this.answerTime}}])&&r(t.prototype,n),i&&r(t,i),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(12),i=n(7);n(11);function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.group=null,this.modified=[],this.operator=null,this.includeSelf=!1}var t,n,a;return t=e,a=[{key:"create",value:function(t,n){var o=new e;o.group=r.a.create(t,n.group);for(var a=n.modified,u=0;u<a.length;++u){var c=a[u],s=i.a.create(c,o.group.getDomain());t.getAppendix(s),o.modified.push(s),s.getId()==t.self.getId()&&(o.includeSelf=!0)}return void 0!==n.operator&&(o.operator=i.a.create(n.operator,o.group.getDomain()),t.getAppendix(o.operator)),o}}],(n=null)&&o(t.prototype,n),a&&o(t,a),e}()},function(e,t,n){"use strict";if(n(29)){var r=n(67),i=n(17),o=n(22),a=n(2),u=n(117),c=n(155),s=n(50),l=n(79),f=n(72),h=n(40),p=n(81),d=n(52),v=n(28),y=n(187),g=n(75),m=n(57),b=n(44),w=n(91),k=n(25),S=n(32),O=n(144),_=n(76),C=n(47),E=n(77).f,R=n(146),x=n(73),P=n(27),T=n(60),M=n(107),A=n(101),N=n(149),j=n(93),I=n(112),L=n(78),F=n(148),D=n(176),B=n(31),G=n(46),U=B.f,H=G.f,z=i.RangeError,J=i.TypeError,V=i.Uint8Array,K=Array.prototype,q=c.ArrayBuffer,W=c.DataView,Z=T(0),Y=T(2),Q=T(3),$=T(4),X=T(5),ee=T(6),te=M(!0),ne=M(!1),re=N.values,ie=N.keys,oe=N.entries,ae=K.lastIndexOf,ue=K.reduce,ce=K.reduceRight,se=K.join,le=K.sort,fe=K.slice,he=K.toString,pe=K.toLocaleString,de=P("iterator"),ve=P("toStringTag"),ye=x("typed_constructor"),ge=x("def_constructor"),me=u.CONSTR,be=u.TYPED,we=u.VIEW,ke=T(1,(function(e,t){return Ee(A(e,e[ge]),t)})),Se=o((function(){return 1===new V(new Uint16Array([1]).buffer)[0]})),Oe=!!V&&!!V.prototype.set&&o((function(){new V(1).set({})})),_e=function(e,t){var n=d(e);if(n<0||n%t)throw z("Wrong offset!");return n},Ce=function(e){if(k(e)&&be in e)return e;throw J(e+" is not a typed array!")},Ee=function(e,t){if(!k(e)||!(ye in e))throw J("It is not a typed array constructor!");return new e(t)},Re=function(e,t){return xe(A(e,e[ge]),t)},xe=function(e,t){for(var n=0,r=t.length,i=Ee(e,r);r>n;)i[n]=t[n++];return i},Pe=function(e,t,n){U(e,t,{get:function(){return this._d[n]}})},Te=function(e){var t,n,r,i,o,a,u=S(e),c=arguments.length,l=c>1?arguments[1]:void 0,f=void 0!==l,h=R(u);if(null!=h&&!O(h)){for(a=h.call(u),r=[],t=0;!(o=a.next()).done;t++)r.push(o.value);u=r}for(f&&c>2&&(l=s(l,arguments[2],2)),t=0,n=v(u.length),i=Ee(this,n);n>t;t++)i[t]=f?l(u[t],t):u[t];return i},Me=function(){for(var e=0,t=arguments.length,n=Ee(this,t);t>e;)n[e]=arguments[e++];return n},Ae=!!V&&o((function(){pe.call(new V(1))})),Ne=function(){return pe.apply(Ae?fe.call(Ce(this)):Ce(this),arguments)},je={copyWithin:function(e,t){return D.call(Ce(this),e,t,arguments.length>2?arguments[2]:void 0)},every:function(e){return $(Ce(this),e,arguments.length>1?arguments[1]:void 0)},fill:function(e){return F.apply(Ce(this),arguments)},filter:function(e){return Re(this,Y(Ce(this),e,arguments.length>1?arguments[1]:void 0))},find:function(e){return X(Ce(this),e,arguments.length>1?arguments[1]:void 0)},findIndex:function(e){return ee(Ce(this),e,arguments.length>1?arguments[1]:void 0)},forEach:function(e){Z(Ce(this),e,arguments.length>1?arguments[1]:void 0)},indexOf:function(e){return ne(Ce(this),e,arguments.length>1?arguments[1]:void 0)},includes:function(e){return te(Ce(this),e,arguments.length>1?arguments[1]:void 0)},join:function(e){return se.apply(Ce(this),arguments)},lastIndexOf:function(e){return ae.apply(Ce(this),arguments)},map:function(e){return ke(Ce(this),e,arguments.length>1?arguments[1]:void 0)},reduce:function(e){return ue.apply(Ce(this),arguments)},reduceRight:function(e){return ce.apply(Ce(this),arguments)},reverse:function(){for(var e,t=Ce(this).length,n=Math.floor(t/2),r=0;r<n;)e=this[r],this[r++]=this[--t],this[t]=e;return this},some:function(e){return Q(Ce(this),e,arguments.length>1?arguments[1]:void 0)},sort:function(e){return le.call(Ce(this),e)},subarray:function(e,t){var n=Ce(this),r=n.length,i=g(e,r);return new(A(n,n[ge]))(n.buffer,n.byteOffset+i*n.BYTES_PER_ELEMENT,v((void 0===t?r:g(t,r))-i))}},Ie=function(e,t){return Re(this,fe.call(Ce(this),e,t))},Le=function(e){Ce(this);var t=_e(arguments[1],1),n=this.length,r=S(e),i=v(r.length),o=0;if(i+t>n)throw z("Wrong length!");for(;o<i;)this[t+o]=r[o++]},Fe={entries:function(){return oe.call(Ce(this))},keys:function(){return ie.call(Ce(this))},values:function(){return re.call(Ce(this))}},De=function(e,t){return k(e)&&e[be]&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},Be=function(e,t){return De(e,t=m(t,!0))?f(2,e[t]):H(e,t)},Ge=function(e,t,n){return!(De(e,t=m(t,!0))&&k(n)&&b(n,"value"))||b(n,"get")||b(n,"set")||n.configurable||b(n,"writable")&&!n.writable||b(n,"enumerable")&&!n.enumerable?U(e,t,n):(e[t]=n.value,e)};me||(G.f=Be,B.f=Ge),a(a.S+a.F*!me,"Object",{getOwnPropertyDescriptor:Be,defineProperty:Ge}),o((function(){he.call({})}))&&(he=pe=function(){return se.call(this)});var Ue=p({},je);p(Ue,Fe),h(Ue,de,Fe.values),p(Ue,{slice:Ie,set:Le,constructor:function(){},toString:he,toLocaleString:Ne}),Pe(Ue,"buffer","b"),Pe(Ue,"byteOffset","o"),Pe(Ue,"byteLength","l"),Pe(Ue,"length","e"),U(Ue,ve,{get:function(){return this[be]}}),e.exports=function(e,t,n,c){var s=e+((c=!!c)?"Clamped":"")+"Array",f="get"+e,p="set"+e,d=i[s],g=d||{},m=d&&C(d),b=!d||!u.ABV,S={},O=d&&d.prototype,R=function(e,n){U(e,n,{get:function(){return function(e,n){var r=e._d;return r.v[f](n*t+r.o,Se)}(this,n)},set:function(e){return function(e,n,r){var i=e._d;c&&(r=(r=Math.round(r))<0?0:r>255?255:255&r),i.v[p](n*t+i.o,r,Se)}(this,n,e)},enumerable:!0})};b?(d=n((function(e,n,r,i){l(e,d,s,"_d");var o,a,u,c,f=0,p=0;if(k(n)){if(!(n instanceof q||"ArrayBuffer"==(c=w(n))||"SharedArrayBuffer"==c))return be in n?xe(d,n):Te.call(d,n);o=n,p=_e(r,t);var g=n.byteLength;if(void 0===i){if(g%t)throw z("Wrong length!");if((a=g-p)<0)throw z("Wrong length!")}else if((a=v(i)*t)+p>g)throw z("Wrong length!");u=a/t}else u=y(n),o=new q(a=u*t);for(h(e,"_d",{b:o,o:p,l:a,e:u,v:new W(o)});f<u;)R(e,f++)})),O=d.prototype=_(Ue),h(O,"constructor",d)):o((function(){d(1)}))&&o((function(){new d(-1)}))&&I((function(e){new d,new d(null),new d(1.5),new d(e)}),!0)||(d=n((function(e,n,r,i){var o;return l(e,d,s),k(n)?n instanceof q||"ArrayBuffer"==(o=w(n))||"SharedArrayBuffer"==o?void 0!==i?new g(n,_e(r,t),i):void 0!==r?new g(n,_e(r,t)):new g(n):be in n?xe(d,n):Te.call(d,n):new g(y(n))})),Z(m!==Function.prototype?E(g).concat(E(m)):E(g),(function(e){e in d||h(d,e,g[e])})),d.prototype=O,r||(O.constructor=d));var x=O[de],P=!!x&&("values"==x.name||null==x.name),T=Fe.values;h(d,ye,!0),h(O,be,s),h(O,we,!0),h(O,ge,d),(c?new d(1)[ve]==s:ve in O)||U(O,ve,{get:function(){return s}}),S[s]=d,a(a.G+a.W+a.F*(d!=g),S),a(a.S,s,{BYTES_PER_ELEMENT:t}),a(a.S+a.F*o((function(){g.of.call(d,1)})),s,{from:Te,of:Me}),"BYTES_PER_ELEMENT"in O||h(O,"BYTES_PER_ELEMENT",t),a(a.P,s,je),L(s),a(a.P+a.F*Oe,s,{set:Le}),a(a.P+a.F*!P,s,Fe),r||O.toString==he||(O.toString=he),a(a.P+a.F*o((function(){new d(1).slice()})),s,{slice:Ie}),a(a.P+a.F*(o((function(){return[1,2].toLocaleString()!=new d([1,2]).toLocaleString()}))||!o((function(){O.toLocaleString.call([1,2])}))),s,{toLocaleString:Ne}),j[s]=P?x:T,r||P||h(O,de,T)}}else e.exports=function(){}},function(e,t,n){var r=n(182),i=n(2),o=n(97)("metadata"),a=o.store||(o.store=new(n(185))),u=function(e,t,n){var i=a.get(e);if(!i){if(!n)return;a.set(e,i=new r)}var o=i.get(t);if(!o){if(!n)return;i.set(t,o=new r)}return o};e.exports={store:a,map:u,has:function(e,t,n){var r=u(t,n,!1);return void 0!==r&&r.has(e)},get:function(e,t,n){var r=u(t,n,!1);return void 0===r?void 0:r.get(e)},set:function(e,t,n,r){u(n,r,!0).set(e,t)},keys:function(e,t){var n=u(e,t,!1),r=[];return n&&n.forEach((function(e,t){r.push(t)})),r},key:function(e){return void 0===e||"symbol"==typeof e?e:String(e)},exp:function(e){i(i.S,"Reflect",e)}}},function(e,t){e.exports=!1},function(e,t,n){var r=n(73)("meta"),i=n(25),o=n(44),a=n(31).f,u=0,c=Object.isExtensible||function(){return!0},s=!n(22)((function(){return c(Object.preventExtensions({}))})),l=function(e){a(e,r,{value:{i:"O"+ ++u,w:{}}})},f=e.exports={KEY:r,NEED:!1,fastKey:function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!o(e,r)){if(!c(e))return"F";if(!t)return"E";l(e)}return e[r].i},getWeak:function(e,t){if(!o(e,r)){if(!c(e))return!0;if(!t)return!1;l(e)}return e[r].w},onFreeze:function(e){return s&&f.NEED&&c(e)&&!o(e,r)&&l(e),e}}},function(e,t,n){var r=n(27)("unscopables"),i=Array.prototype;null==i[r]&&n(40)(i,r,{}),e.exports=function(e){i[r][e]=!0}},function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var r=n(24),i=n(124);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var i=f(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return l(this,n)}}function l(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var h=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(l,e);var t,n,r,o=s(l);function l(e,t,n,r,i,a,u){var c;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(c=o.call(this)).code=e,c.domain=t,c.appKey=n,c.cid=r,c.issues=i,c.expiry=a,c.description=u,c}return t=l,r=[{key:"create",value:function(e){return new l(e.code,e.domain,e.appKey,e.cid,e.issues,e.expiry,i.a.create(e.description))}}],(n=[{key:"isValid",value:function(){return Date.now()<this.expiry}},{key:"getDescription",value:function(){return this.description}},{key:"toJSON",value:function(){var e=u(f(l.prototype),"toJSON",this).call(this);return e.code=this.code,e.domain=this.domain,e.appKey=this.appKey,e.cid=this.cid,e.issues=this.issues,e.expiry=this.expiry,e.description=this.description.toJSON(),e}}])&&a(t.prototype,n),r&&a(t,r),l}(r.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var r=n(24),i=n(85),o=n(23),a=n(127),u=n(15);function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,n){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=d(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var i=d(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p(this,n)}}function p(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(p,e);var t,n,r,c=h(p);function p(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p),(t=c.call(this)).file=e,t.anchor=null,t.label=null,t.thumbConfig=null,t.thumbs=null,t.token=null,t}return t=p,r=[{key:"create",value:function(e){var t=new p(null);if(void 0!==e.anchor&&(t.anchor=i.a.create(e.anchor)),void 0!==e.label&&(t.label=o.a.create(e.label)),void 0!==e.thumbConfig&&(t.thumbConfig=e.thumbConfig),void 0!==e.thumbs){t.thumbs=[];for(var n=0;n<e.thumbs.length;++n){var r=a.a.create(e.thumbs[n]);t.thumbs.push(r)}}return t}}],(n=[{key:"getFileCode",value:function(){return null!=this.anchor?this.anchor.fileCode:null!=this.label?this.label.fileCode:null}},{key:"getFileName",value:function(){return null!=this.label?this.label.fileName:null!=this.anchor?this.anchor.fileName:null}},{key:"getFileSize",value:function(){return null!=this.label?this.label.fileSize:null!=this.anchor?this.anchor.fileSize:0}},{key:"getFileType",value:function(){return null!=this.label?this.label.fileType:null!=this.anchor?this.anchor.getExtension().toLowerCase():"unknown"}},{key:"isImageType",value:function(){var e=this.getFileType();return"png"==e||"jpeg"==e||"gif"==e||"jpg"==e||"bmp"==e}},{key:"isEnabled",value:function(){return null!=this.label}},{key:"getFileURL",value:function(e){return null==this.label?null:(null!=this.token&&0!=this.token.length||(this.token=u.a.TOKEN),(void 0!==e?[e?this.label.getFileSecureURL():this.label.getFileURL(),"&token=",this.token,"&type=",this.label.fileType]:[this.label.getFileURL(),"&token=",this.token,"&type=",this.label.fileType]).join(""))}},{key:"enableThumb",value:function(e){this.thumbConfig=void 0===e?{size:480,quality:.7}:e}},{key:"disableThumb",value:function(){this.thumbConfig=null}},{key:"getDefaultThumb",value:function(){if(null==this.thumbs)return null;null!=this.token&&0!=this.token.length||(this.token=u.a.TOKEN);var e=this.thumbs[0];return e.token=this.token,e}},{key:"getDefaultThumbURL",value:function(e){if(null==this.thumbs)return null;null!=this.token&&0!=this.token.length||(this.token=u.a.TOKEN);var t=this.thumbs[0];return t.token=this.token,t.getFileURL(e)}},{key:"toJSON",value:function(){var e=l(d(p.prototype),"toJSON",this).call(this);if(null!=this.anchor&&(e.anchor=this.anchor.toJSON()),null!=this.label&&(e.label=this.label.toJSON()),null!=this.thumbConfig&&(e.thumbConfig=this.thumbConfig),null!=this.thumbs){e.thumbs=[];for(var t=0;t<this.thumbs.length;++t)e.thumbs.push(this.thumbs[t].toJSON())}return e}}])&&s(t.prototype,n),r&&s(t,r),p}(r.a)},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t){var n=0,r=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+r).toString(36))}},function(e,t,n){var r=n(161),i=n(132);e.exports=Object.keys||function(e){return r(e,i)}},function(e,t,n){var r=n(52),i=Math.max,o=Math.min;e.exports=function(e,t){return(e=r(e))<0?i(e+t,0):o(e,t)}},function(e,t,n){var r=n(13),i=n(162),o=n(132),a=n(131)("IE_PROTO"),u=function(){},c=function(){var e,t=n(129)("iframe"),r=o.length;for(t.style.display="none",n(133).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),c=e.F;r--;)delete c.prototype[o[r]];return c()};e.exports=Object.create||function(e,t){var n;return null!==e?(u.prototype=r(e),n=new u,u.prototype=null,n[a]=e):n=c(),void 0===t?n:i(n,t)}},function(e,t,n){var r=n(161),i=n(132).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},function(e,t,n){"use strict";var r=n(17),i=n(31),o=n(29),a=n(27)("species");e.exports=function(e){var t=r[e];o&&t&&!t[a]&&i.f(t,a,{configurable:!0,get:function(){return this}})}},function(e,t){e.exports=function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!");return e}},function(e,t,n){var r=n(50),i=n(174),o=n(144),a=n(13),u=n(28),c=n(146),s={},l={};(t=e.exports=function(e,t,n,f,h){var p,d,v,y,g=h?function(){return e}:c(e),m=r(n,f,t?2:1),b=0;if("function"!=typeof g)throw TypeError(e+" is not iterable!");if(o(g)){for(p=u(e.length);p>b;b++)if((y=t?m(a(d=e[b])[0],d[1]):m(e[b]))===s||y===l)return y}else for(v=g.call(e);!(d=v.next()).done;)if((y=i(v,m,d.value,t))===s||y===l)return y}).BREAK=s,t.RETURN=l},function(e,t,n){var r=n(41);e.exports=function(e,t,n){for(var i in t)r(e,i,t[i],n);return e}},function(e,t,n){var r=n(25);e.exports=function(e,t){if(!r(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var r=n(1),i=n.n(r),o=n(0),a=n(84);function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c=function(){function e(t,n,r,i,o){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.volume=0,this.clipping=!1,this.lastClip=0,this.clipLevel=r||.98,this.smoothingFactor=i||.95,this.clipLag=o||750;var u=t.createMediaStreamSource(n),c=t.createScriptProcessor(512);c.onaudioprocess=function(e){a.volumeAudioProcess(e)},c.connect(t.destination),u.connect(c),this.processor=c}var t,n,r;return t=e,(n=[{key:"getVolume",value:function(){return this.volume}},{key:"checkClipping",value:function(){return!!this.clipping&&(this.lastClip+this.clipLag<window.performance.now()&&(this.clipping=!1),this.clipping)}},{key:"shutdown",value:function(){this.processor.disconnect(),this.processor.onaudioprocess=null}},{key:"volumeAudioProcess",value:function(e){for(var t=e.inputBuffer.getChannelData(0),n=t.length,r=0,i=0,o=0;o<n;++o)i=t[o],Math.abs(i)>=this.clipLevel&&(this.clipping=!0,this.lastClip=window.performance.now()),r+=i*i;var a=Math.sqrt(r/n);this.volume=Math.max(a,this.volume*this.smoothingFactor)}}])&&u(t.prototype,n),r&&u(t,r),e}(),s=n(55);function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var f=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.volume=0,this.microphoneSource=null,this.node=null,t.audioWorklet.addModule(s.a.WORKER_URL_PATH+"cube-volume-processor.js").then((function(){var e=t.createMediaStreamSource(n),i=new AudioWorkletNode(t,"volume-meter");i.port.postMessage({sampleRate:t.sampleRate}),i.port.onmessage=function(e){r.volume=e.data.volume},e.connect(i).connect(t.destination),r.node=i,r.microphoneSource=e})).catch((function(e){console.warn(e)}))}var t,n,r;return t=e,(n=[{key:"shutdown",value:function(){null!=this.microphoneSource&&(this.microphoneSource.disconnect(),this.node.disconnect(),this.microphoneSource=null,this.node=null)}}])&&l(t.prototype,n),r&&l(t,r),e}();n(54);var h=n(16),p=n(8);function d(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return v(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function y(e,t,n,r,i,o,a){try{var u=e[o](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,i)}function g(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){y(o,r,i,a,u,"next",e)}function u(e){y(o,r,i,a,u,"throw",e)}a(void 0)}))}}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var b=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sn=i.a.Utils.generateSerialNumber(),this.mode=void 0===t?"sendrecv":t,this.mediaConstraint=null,this.configuration=null,this.pc=null,this.candidates=[],this.localVideoElem=null,this.remoteVideoElem=null,this.outboundStream=null,this.inboundStream=null,this.outboundMeter=null,this.started=!1,this.ready=!1,this.mediaReady=!1,this.spanners=[],this.streamState={in:{video:!0,audio:!0,volume:1},out:{video:!0,audio:!0}}}var t,n,r;return t=e,(n=[{key:"outboundVideoEnabled",value:function(){return null==this.outboundStream||(this.streamState.out.video=this.streamEnabled(this.outboundStream,"video")),this.streamState.out.video}},{key:"outboundAudioEnabled",value:function(){return null==this.outboundStream||(this.streamState.out.audio=this.streamEnabled(this.outboundStream,"audio")),this.streamState.out.audio}},{key:"inboundVideoEnabled",value:function(){return null==this.inboundStream||(this.streamState.in.video=this.streamEnabled(this.inboundStream,"video")),this.streamState.in.video}},{key:"inboundAudioEnabled",value:function(){return null==this.inboundStream||(this.streamState.in.audio=this.streamEnabled(this.inboundStream,"audio")),this.streamState.in.audio}},{key:"streamEnabled",value:function(e,t){if(null==e)return!1;var n=!1;return e.getTracks().some((function(e){return e.kind==t&&(n=e.enabled,!0)})),n}},{key:"enableOutboundVideo",value:function(e){return this.streamState.out.video=e,this.enableStream(this.outboundStream,"video",e)}},{key:"enableOutboundAudio",value:function(e){return this.streamState.out.audio=e,this.enableStream(this.outboundStream,"audio",e)}},{key:"enableInboundVideo",value:function(e){return this.streamState.in.video=e,this.enableStream(this.inboundStream,"video",e)}},{key:"enableInboundAudio",value:function(e){return this.streamState.in.audio=e,this.enableStream(this.inboundStream,"audio",e)}},{key:"enableStream",value:function(e,t,n){if(null==e)return!1;var r=!1;return e.getTracks().some((function(e){return e.kind==t&&(e.enabled=n,r=!0,!0)})),r}},{key:"syncStreamState",value:function(e,t){e.getTracks().forEach((function(e){"audio"==e.kind?e.enabled=t.audio:"video"==e.kind&&(e.enabled=t.video)}))}},{key:"setVolume",value:function(e){this.streamState.in.volume=e,null!=this.remoteVideoElem&&(this.remoteVideoElem.volume=e)}},{key:"getVolume",value:function(){return null!=this.remoteVideoElem?this.remoteVideoElem.volume:this.streamState.in.volume}},{key:"isWorking",value:function(){return null!=this.pc}},{key:"enableICE",value:function(e){null!=e&&(this.configuration={iceServers:e})}},{key:"disableICE",value:function(){this.configuration=null}},{key:"onIceCandidate",value:function(e,t){}},{key:"onMediaConnected",value:function(e){}},{key:"onMediaDisconnected",value:function(e){}},{key:"openOffer",value:function(e,t,n){var r=this;null==this.pc?(this.mediaConstraint=e,this.pc=null!=this.configuration?new RTCPeerConnection(this.configuration):new RTCPeerConnection,this.pc.ontrack=function(e){r.fireOnTrack(e)},this.pc.onicecandidate=function(e){r.fireOnIceCandidate(e)},this.pc.oniceconnectionstatechange=function(e){r.fireOnIceConnectionStateChange(e)},g(regeneratorRuntime.mark((function e(){var i,a,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("recvonly"!==r.mode){e.next=7;break}i=r.mediaConstraint.audioEnabled,a=r.mediaConstraint.videoEnabled,i&&r.pc.addTransceiver("audio",{direction:"recvonly"}),a&&r.pc.addTransceiver("video",{direction:"recvonly"}),e.next=23;break;case 7:if(null!=r.outboundStream){e.next=20;break}return u=r.mediaConstraint.getConstraints(),e.next=11,r.getUserMedia(u);case 11:if((c=e.sent)instanceof MediaStream){e.next=16;break}return n(new o.a(h.a.NAME,p.a.MediaPermissionDenied,r,c)),r.close(),e.abrupt("return");case 16:null!=r.localVideoElem&&(r.localVideoElem.autoplay=!0,r.localVideoElem.srcObject=c),r.outboundStream=c,e.next=21;break;case 20:null!=r.localVideoElem&&(r.localVideoElem.autoplay=!0,r.localVideoElem.srcObject=r.outboundStream);case 21:r.outboundStream.getTracks().forEach((function(e){r.pc.addTrack(e,r.outboundStream)})),"sendonly"==r.mode&&r.pc.getTransceivers().forEach((function(e){e.direction="sendonly"}));case 23:r.pc.createOffer().then((function(e){r.pc.setLocalDescription(new RTCSessionDescription(e)).then((function(){t(r.pc.localDescription)})).catch((function(e){n(new o.a(h.a.NAME,p.a.LocalDescriptionFault,r,e)),r.close()}))})).catch((function(e){n(new o.a(h.a.NAME,p.a.CreateOfferFailed,r,e)),r.close()})),r.started=!0;case 25:case"end":return e.stop()}}),e)})))()):n(new o.a(h.a.NAME,p.a.ConnRepeated,this))}},{key:"doAnswer",value:function(e,t,n){var r=this;this.pc.setRemoteDescription(new RTCSessionDescription(e)).then((function(){t(),r.doReady()})).catch((function(e){n(new o.a(h.a.NAME,p.a.RemoteDescriptionFault,r,e)),r.close()}))}},{key:"openAnswer",value:function(e,t,n,r){var i=this;null==this.pc?(this.mediaConstraint=t,this.pc=null!=this.configuration?new RTCPeerConnection(this.configuration):new RTCPeerConnection,this.pc.ontrack=function(e){i.fireOnTrack(e)},this.pc.onicecandidate=function(e){i.fireOnIceCandidate(e)},this.pc.oniceconnectionstatechange=function(e){i.fireOnIceConnectionStateChange(e)},this.pc.setRemoteDescription(new RTCSessionDescription(e)).then((function(){g(regeneratorRuntime.mark((function e(){var a,u,c,s,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.getConstraints(),null!=i.outboundStream){e.next=13;break}return e.next=4,i.getUserMedia(a);case 4:if((u=e.sent)instanceof MediaStream){e.next=9;break}return r(new o.a(h.a.NAME,p.a.MediaPermissionDenied,i)),i.close(),e.abrupt("return");case 9:null!=i.localVideoElem&&(i.localVideoElem.autoplay=!0,i.localVideoElem.srcObject=u),i.outboundStream=u,e.next=14;break;case 13:null!=i.localVideoElem&&(i.localVideoElem.autoplay=!0,i.localVideoElem.srcObject=i.outboundStream);case 14:c=d(i.outboundStream.getTracks());try{for(c.s();!(s=c.n()).done;)l=s.value,i.pc.addTrack(l,i.outboundStream)}catch(e){c.e(e)}finally{c.f()}i.pc.createAnswer().then((function(e){i.pc.setLocalDescription(new RTCSessionDescription(e)).then((function(){n(i.pc.localDescription),i.doReady()})).catch((function(e){r(new o.a(h.a.NAME,p.a.LocalDescriptionFault,i,e)),i.close()}))})).catch((function(e){r(new o.a(h.a.NAME,p.a.CreateAnswerFailed,i,e)),i.close()})),i.started=!0;case 18:case"end":return e.stop()}}),e)})))()})).catch((function(e){r(new o.a(h.a.NAME,p.a.RemoteDescriptionFault,i,e)),i.close()}))):r(new o.a(h.a.NAME,p.a.ConnRepeated,this))}},{key:"doCandidate",value:function(e){if(null!=this.pc)if(this.ready){if(this.candidates.length>0){for(var t=0;t<this.candidates.length;++t){var n=this.candidates[t],r=new RTCIceCandidate(n);this.pc.addIceCandidate(r).catch((function(e){i.a.Logger.e("RTCDevice","Ice Candidate error: "+e)})),i.a.Logger.d("RTCDevice","#doCandidate [array] add candidate: "+n.sdpMid)}this.candidates.splice(0,this.candidates.length)}var o=new RTCIceCandidate(e);this.pc.addIceCandidate(o).catch((function(e){i.a.Logger.e("RTCDevice","Ice Candidate error: "+e)})),i.a.Logger.d("RTCDevice","#doCandidate add candidate: "+o.sdpMid)}else this.candidates.push(e)}},{key:"doReady",value:function(){var e=this;this.ready=!0;for(var t=0;t<this.candidates.length;++t){var n=this.candidates[t],r=new RTCIceCandidate(n);this.pc.addIceCandidate(r).catch((function(e){i.a.Logger.e("RTCDevice","Ice Candidate error: "+e)})),i.a.Logger.d("RTCDevice","#doReady() add candidate: "+n.sdpMid)}this.candidates.splice(0,this.candidates.length),setTimeout((function(){null!=e.outboundStream&&e.syncStreamState(e.outboundStream,e.streamState.out)}),33)}},{key:"close",value:function(){if(this.started=!1,this.stopOutboundMeter(),this.candidates=[],null!=this.inboundStream){var e=[];this.inboundStream.getTracks().forEach((function(t){t.stop(),e.push(t)}));for(var t=0;t<e.length;++t)this.inboundStream.removeTrack(e[t]);this.inboundStream=null}if(null!=this.outboundStream){var n=[];this.outboundStream.getTracks().forEach((function(e){e.stop(),n.push(e)}));for(var r=0;r<n.length;++r)this.outboundStream.removeTrack(n[r]);this.outboundStream=null}null!=this.pc&&(this.pc.close(),this.pc=null),this.disableICE(),null!=this.localVideoElem&&this.localVideoElem.pause(),null!=this.remoteVideoElem&&this.remoteVideoElem.pause(),this.ready=!1,this.mediaReady=!1}},{key:"startOutboundMeter",value:function(){if(null!=this.outboundStream&&null==this.outboundMeter){var e=new AudioContext,t="Chrome"==a.a.getBrowserName();this.outboundMeter=t?new f(e,this.outboundStream):new c(e,this.outboundStream)}}},{key:"stopOutboundMeter",value:function(){null!=this.outboundMeter&&(this.outboundMeter.shutdown(),this.outboundMeter=null)}},{key:"fireOnTrack",value:function(e){var t=this;e.streams&&e.streams[0]?(this.inboundStream=e.streams[0],null!=this.remoteVideoElem&&(this.remoteVideoElem.autoplay=!0,this.remoteVideoElem.srcObject=this.inboundStream)):(null==this.inboundStream&&(this.inboundStream=new MediaStream,null!=this.remoteVideoElem&&(this.remoteVideoElem.autoplay=!0,this.remoteVideoElem.srcObject=this.inboundStream)),this.inboundStream.addTrack(e.track)),setTimeout((function(){null!=t.inboundStream&&(t.syncStreamState(t.inboundStream,t.streamState.in),t.remoteVideoElem.volume=t.streamState.in.volume)}),33)}},{key:"fireOnIceCandidate",value:function(e){e.candidate&&this.onIceCandidate(e.candidate,this)}},{key:"fireOnIceConnectionStateChange",value:function(e){var t=this.pc.iceConnectionState;i.a.Logger.d("RTCDevice","ICE state : "+t),"failed"===t||"disconnected"===t||"closed"===t?(this.mediaReady=!1,this.onMediaDisconnected(this)):"connected"===t&&(this.mediaReady=!0,this.onMediaConnected(this))}},{key:"getUserMedia",value:function(e){return new Promise((function(t,n){navigator.mediaDevices.getUserMedia(e).then((function(e){t(e)})).catch((function(e){t(e)}))}))}}])&&m(t.prototype,n),r&&m(t,r),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r={browserName:null,browserVersion:null,system:null,getBrowserName:function(){return null==r.browserName&&r.parseBrowser(),r.browserName},getBrowserVersion:function(){return null==r.browserVersion&&r.parseBrowser(),r.browserVersion},getSystem:function(){return null==r.system&&r.parseSystem(),r.system},parseBrowser:function(){var e,t=navigator.userAgent.toLowerCase(),n="",i="";if(t.indexOf("msie")>0){n="IE",i=""+t.match(/msie [\d.]+;/gi)}else if(t.indexOf("firefox")>0){n="Firefox",i=""+t.match(/firefox\/[\d.]+/gi)}else if(t.indexOf("chrome")>0){n="Chrome",i=""+t.match(/chrome\/[\d.]+/gi)}else if(t.indexOf("safari")>0&&t.indexOf("chrome")<0){n="Safari",i=""+t.match(/version\/[\d.]+/gi)}else if(t.indexOf("opera")>=0){n="Opera",i=""+t.match(/version\/[\d.]+/gi)}else{if("Netscape"==navigator.appName)i=t.split(";")[7].replace(/[ ]/g,"").match(/[\d\.]/g).toString().replace(/[,]/g,""),n="IE"}e=i.replace(/[^0-9.]/gi,""),r.browserVersion=e,r.browserName=n},parseSystem:function(){var e={win:!1,mac:!1,x11:!1,iphone:!1,ipoad:!1,ipad:!1,ios:!1,android:!1,nokiaN:!1,winMobile:!1,wii:!1,ps:!1},t=navigator.userAgent,n=navigator.platform;if(e.win=0==n.indexOf("Window"),e.mac=0==n.indexOf("Mac"),e.x11=0==n.indexOf("X11")||0==n.indexOf("Linux"),e.win){if(/Win(?:dows )?([^do]{2})\s?(\d+\.\d+)?/.test(t))if("NT"==RegExp.$1)switch(RegExp.$2){case"5.0":e.win="2000";break;case"5.1":e.win="XP";break;case"6.0":e.win="Vista";break;case"6.1":e.win="7";break;case"6.2":e.win="8";break;case"10":case"10.0":e.win="10";break;default:e.win="NT"}else"9x"==RegExp.$1?e.win="ME":e.win=RegExp.$1}else e.mac&&(t.indexOf("Chrome")>0&&/Mac OS X (\d+\_\d+)?/.test(t)?(e.mac=RegExp.$1.trim(),e.mac=e.mac.replace("_",".")):t.indexOf("Firefox")>0&&/Mac OS X (\d+\.\d+)?/.test(t)&&(e.mac=RegExp.$1.trim()));e.iphone=t.indexOf("iPhone")>-1,e.ipod=t.indexOf("iPod")>-1,e.ipad=t.indexOf("iPad")>-1,e.nokiaN=t.indexOf("nokiaN")>-1,"CE"==e.win?e.winMobile=e.win:"Ph"==e.win&&/Windows Phone OS (\d+.\d)/i.test(t)&&(e.win="Phone",e.winMobile=parseFloat(RegExp.$1)),e.mac&&t.indexOf("Mobile")>-1&&(/CPU (?:iPhone )?OS (\d+_\d+)/i.test(t)?e.ios=parseFloat(RegExp.$1.replace("_",".")):e.ios=2),/Android (\d+\.\d+)/i.test(t)&&(e.android=parseFloat(RegExp.$1)),e.wii=t.indexOf("Wii")>-1,e.ps=/PlayStation/i.test(t),e.win?r.system="Windows "+e.win:e.mac?r.system="Mac OS X "+e.mac:e.x11?r.system="Linux":r.system=""}}},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return(o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=s(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=s(e);if(t){var i=s(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return c(this,n)}}function c(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}n.d(t,"a",(function(){return l}));var l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(l,e);var t,n,r,c=u(l);function l(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(e=c.call(this)).position=0,e.fileName=null,e.fileSize=0,e.lastModified=0,e.fileCode=null,e.success=!1,e.finishCallback=null,e}return t=l,r=[{key:"create",value:function(e){var t=new l;return t.fileName=e.fileName,t.fileSize=e.fileSize,t.fileCode=e.fileCode,t.position=e.position,t}}],(n=[{key:"getExtension",value:function(){var e=this.fileName.lastIndexOf(".");return e<=0?"":this.fileName.substring(e+1)}},{key:"toJSON",value:function(){var e=o(s(l.prototype),"toJSON",this).call(this);return e.fileName=this.fileName,e.fileSize=this.fileSize,e.fileCode=null!=this.fileCode?this.fileCode:"",e.position=this.position,e}},{key:"toCompactJSON",value:function(){return this.toJSON()}},{key:"toString",value:function(){return this.position.toString()}}])&&i(t.prototype,n),r&&i(t,r),l}(n(24).a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var r=n(103),i=n(30);n(19);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=l(e);if(t){var i=l(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return s(this,n)}}function s(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(s,e);var t,n,r,o=c(s);function s(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),o.call(this)}return t=s,(n=[{key:"onEvent",value:function(e,t){return e==i.a.NAME?this.onInstantiate(t):t}},{key:"onInstantiate",value:function(e){return e}}])&&a(t.prototype,n),r&&a(t,r),s}(r.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return C}));var r=n(1),i=n.n(r),o=n(18),a=n(61),u=n(121);function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p(e);if(t){var i=p(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h(this,n)}}function h(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var d=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(a,e);var t,n,r,o=f(a);function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=o.call(this)).pipeline=e,t}return t=a,(n=[{key:"onListened",value:function(e,t,n){this.pipeline.triggerListened(e,t,n)}},{key:"onSpoke",value:function(e,t,n){}},{key:"onAck",value:function(e,t,n){}},{key:"onSpeakTimeout",value:function(e,t,n){}},{key:"onContacted",value:function(e){i.a.Logger.d("CellTalkListener","onContacted"),this.pipeline.triggerState("connected")}},{key:"onQuitted",value:function(e){i.a.Logger.d("CellTalkListener","onQuitted"),this.pipeline.triggerState("disconnected")}},{key:"onFailed",value:function(e,t){this.pipeline.triggerState("failed",new u.a(t.getDescription(),t.getErrorCode()))}}])&&s(t.prototype,n),r&&s(t,r),a}(i.a.TalkListener),v=n(4),y=n(6);function g(e){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e,t,n){return(b="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=_(e);if(t){var i=_(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return S(this,n)}}function S(e,t){return!t||"object"!==g(t)&&"function"!=typeof t?O(e):t}function O(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var C=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(u,e);var t,n,r,a=k(u);function u(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(e=a.call(this,"Cell")).talkListener=new d(O(e)),e.nucleus=new i.a.Nucleus,e.nucleus.talk.addListener(e.talkListener),e.responseMap=new o.a,e.responseTimer=0,e.responseTimeout=15e3,e.timerPeriod=1e3,e}return t=u,(n=[{key:"open",value:function(){this.opened||(b(_(u.prototype),"open",this).call(this),null!=this.address&&0!=this.port?this.nucleus.talk.call(new i.a.InetAddress(this.address,this.port)):i.a.Logger.w("CellPipeline","Not configured address and port"))}},{key:"close",value:function(){b(_(u.prototype),"close",this).call(this),null!=this.address&&0!=this.port?this.nucleus.talk.hangup(new i.a.InetAddress(this.address,this.port)):i.a.Logger.d("CellPipeline","Not configured address and port")}},{key:"isReady",value:function(){return this.nucleus.talk.isCalled()}},{key:"send",value:function(e,t,n){var r=this;if(void 0!==n&&(this.responseMap.put(t.sn,{destination:e,handle:n,timestamp:Date.now()}),0==this.responseTimer)){var i=this;this.responseTimer=setInterval((function(){if(0==i.responseMap.size())return clearInterval(i.responseTimer),void(i.responseTimer=0);for(var e=Date.now(),t=i.responseMap.keys(),n=0;n<t.length;++n){var o=t[n],a=i.responseMap.get(o);e-a.timestamp>=i.responseTimeout&&(i.responseMap.remove(o),b(_(u.prototype),"touchCallback",r).call(r,a.destination,null,a.handle))}}),this.timerPeriod)}var o=this.convertPacketToPrimitive(t);this.nucleus.talkService.speak(e,o)}},{key:"triggerListened",value:function(e,t,n){var r=this.convertPrimitiveToPacket(n),i=this.responseMap.remove(r.sn);null!=i?b(_(u.prototype),"touchCallback",this).call(this,t,r,i.handle):b(_(u.prototype),"triggerListeners",this).call(this,t,r)}},{key:"convertPacketToPrimitive",value:function(e){var t=new i.a.ActionDialect(e.name);return t.addParam("sn",e.sn,i.a.LiteralBase.LONG),t.addParam("data",e.data,i.a.LiteralBase.JSON),null!=this.tokenCode&&t.addParam("token",this.tokenCode,i.a.LiteralBase.STRING),t}},{key:"convertPrimitiveToPacket",value:function(e){var t=new i.a.ActionDialect(e),n=new v.a(t.getName(),t.getParamAsJson("data"),t.getParamAsLong("sn"));return n.state=y.a.extractState(t),n}}])&&m(t.prototype,n),r&&m(t,r),u}(a.a);!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(C,"NAME","Cell")},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r={Contact:1,Group:2,Organization:3,System:4,Conference:5,Other:9}},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.d(t,"a",(function(){return i}));var i=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.contact=t,this.completion=n}var t,n,i;return t=e,(n=[{key:"setContext",value:function(e){this.contact.context=e,this.completion(this.contact)}}])&&r(t.prototype,n),i&&r(t,i),e}()},function(e,t,n){var r=n(31).f,i=n(44),o=n(27)("toStringTag");e.exports=function(e,t,n){e&&!i(e=n?e:e.prototype,o)&&r(e,o,{configurable:!0,value:t})}},function(e,t,n){var r=n(51),i=n(27)("toStringTag"),o="Arguments"==r(function(){return arguments}());e.exports=function(e){var t,n,a;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),i))?n:o?r(t):"Object"==(a=r(t))&&"function"==typeof t.callee?"Arguments":a}},function(e,t,n){var r=n(2),i=n(58),o=n(22),a=n(135),u="["+a+"]",c=RegExp("^"+u+u+"*"),s=RegExp(u+u+"*$"),l=function(e,t,n){var i={},u=o((function(){return!!a[e]()||"​"!="​"[e]()})),c=i[e]=u?t(f):a[e];n&&(i[n]=c),r(r.P+r.F*u,"String",i)},f=l.trim=function(e,t){return e=String(i(e)),1&t&&(e=e.replace(c,"")),2&t&&(e=e.replace(s,"")),e};e.exports=l},function(e,t){e.exports={}},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(102);function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,o;return t=e,o=[{key:"enumDevices",value:function(e){var t=[];navigator.mediaDevices.enumerateDevices().then((function(n){n.forEach((function(e){for(var n=0;n<t.length;++n){var i=t[n];if(i.deviceId==e.deviceId&&i.kind==e.kind)return}t.push(new r.a(e.deviceId,e.groupId,e.kind,e.label))})),e(t)})).catch((function(n){e(t)}))}},{key:"getUserMedia",value:function(e,t,n){navigator.mediaDevices.getUserMedia(e).then((function(e){t(e)})).catch((function(e){n(e)}))}},{key:"loadVideoDeviceStream",value:function(t,n,r,i,o){var a=t,u={audio:r,video:{deviceId:n.deviceId,groupId:n.groupId}},c=n;e.getUserMedia(u,(function(t){e.bindVideoStream(a,t,(function(){i(a,c,t)}))}),(function(e){o(e)}))}},{key:"bindVideoStream",value:function(e,t,n){n&&e.addEventListener("play",n),e.setAttribute("autoplay","autoplay"),e.srcObject=t}},{key:"stopStream",value:function(e,t){t&&t.pause();var n=[];e.getTracks().forEach((function(e){e.stop(),n.push(e)}));for(var r=0;r<n.length;++r)e.removeTrack(n[r])}}],(n=null)&&i(t.prototype,n),o&&i(t,o),e}()},function(e,t,n){(function(t){var n;"undefined"!=typeof window?window:void 0!==t||"undefined"!=typeof self&&self,n=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t),n.d(t,"InDB",(function(){return c})),n.d(t,"InDBStore",(function(){return s}));var r=n(1);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}var c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o(this,e);var n=t.name,i=t.version,a=void 0===i?1:i,u=t.stores,c=!n;n||(n="__indb__"),u&&Array.isArray(u)&&u.length||(u=[{name:"__indb__",isKv:!0}]),this.name=n,this.version=a,this.stores=u;var s=indexedDB.open(n,a);if(s.onupgradeneeded=function(e){var t=e.target.result,n=Array.from(t.objectStoreNames),r=[];u.forEach((function(i){var o=null;if(n.indexOf(i.name)>-1)o=e.target.transaction.objectStore(i.name);else{var a=i.isKv?"key":i.keyPath,u=!i.isKv&&i.autoIncrement;o=t.createObjectStore(i.name,{keyPath:a,autoIncrement:u})}var c=o.indexNames;c&&c.length&&Array.from(c).forEach((function(e){return o.deleteIndex(e)})),i.indexes&&i.indexes.length&&i.indexes.forEach((function(e){o.createIndex(e.name,e.keyPath||e.name,{unique:e.unique,multiEntry:Array.isArray(e.keyPath)})})),r.push(i.name)})),n&&n.forEach((function(e){-1===r.indexOf(e)&&t.deleteObjectStore(e)}))},s.onblocked=function(e){console.error(Object(r.a)(new Error("indexedDB "+n+" is blocked")))},this.using={},c)return this.use(n)}return u(e,[{key:"connect",value:function(){var e=this;return new Promise((function(t,n){var i=indexedDB.open(e.name,e.version);i.onerror=function(e){n(Object(r.a)(e))},i.onsuccess=function(e){t(e.target.result)}}))}},{key:"use",value:function(e){var t=this.stores.find((function(t){return t.name===e}));if(!t)throw new Error("[InDB]: store ".concat(e," is not existing."));if(this.using[e])return this.using[e];var n=new s({db:this,store:t});return t.isKv&&(n.key=function(e){return n.keys().then((function(t){return t&&t[e]}))},n.getItem=function(e){return n.get(e).then((function(e){return e&&e.value}))},n.setItem=function(e,t){return n.put({key:e,value:t})},n.removeItem=function(e){return n.delete(e)}),this.using[e]=n,n}},{key:"close",value:function(){return this.using=null,this.stores=null,this.connect().then((function(e){e.close()}))}}]),e}();c.deleteDatabase=function(e){return new Promise((function(t,n){var r=indexedDB.deleteDatabase(e);r.onsuccess=function(){t()},r.onerror=function(e){n(e)}}))},c.databases=function(){return indexedDB.databases()},t.default=c;var s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o(this,e);var n=t.store,r=t.db;if("object"!==i(n)||!n.name||"string"!=typeof n.name)throw new Error("[InDBStore]: options.store should be a store config object.");if(!(r instanceof c))throw new Error("[InDBStore]: options.db should be an instanceof InDB.");this.store=n,this.db=r,this.name=n.name,this.keyPath=n.isKv?"key":n.keyPath}return u(e,[{key:"transaction",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=this.name,r=t?"readwrite":"readonly",i=this.db.connection,o=i?Promise.resolve(i):this.db.connect();return o.then((function(t){e.db.connection=t;var i=t.transaction(n,r),o=function(){e.db.connection=null};return i.oncomplete=o,i.onabort=o,i.onerror=o,i}))}},{key:"objectStore",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.name;return this.transaction(e).then((function(e){return e.objectStore(t)}))}},{key:"cursor",value:function(e){var t=e.index,n=e.range,i=e.direction,o=e.onTouch,a=e.onDone,u=e.onError,c=e.writable,s=void 0!==c&&c;return this.objectStore(s).then((function(e){var c=t?e.index(t):e,s=c.openCursor(n,i);s.onsuccess=function(e){var t=e.target.result;t?o(t,c):a(t,c)},s.onerror=function(e){u(Object(r.a)(e))}}))}},{key:"request",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.writable,o=void 0!==i&&i;return new Promise((function(n,i){t.objectStore(o).then((function(t){var o=e(t);o.onsuccess=function(e){var t=e.target.result;n(t)},o.onerror=function(e){i(Object(r.a)(e))}}))}))}},{key:"iterate",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.index,i=n.range,o=n.writable,a=void 0!==o&&o,u=n.direction,c=void 0===u?"next":u;return new Promise((function(n,o){t.cursor({index:r,range:i,writable:a,direction:c,onTouch:function(t,r){e(t,(function(){return t.continue()}),(function(){r.transaction.commit(),n()}))},onDone:function(){n()},onError:function(e){o(e)}})}))}},{key:"batch",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.writable,o=void 0===i||i;return this.transaction(o).then((function(n){var i=t.name,o=[],a=n.objectStore(i);return e.forEach((function(e){var t=new Promise((function(t,n){var i=e(a);i.onsuccess=function(e){var n=e.target.result;t(n)},i.onerror=function(e){n(Object(r.a)(e))}}));o.push(t)})),Promise.all(o)}))}},{key:"get",value:function(e){if(!Array.isArray(e))return this.request((function(t){return t.get(e)}));var t=e.map((function(e){return function(t){return t.get(e)}}));return this.batch(t,{writable:!1})}},{key:"keys",value:function(){var e=this.keyPath,t=[];return this.each((function(n){var i=Object(r.b)(n,e);t.push(i)})).then((function(){return t}))}},{key:"all",value:function(){var e=[];return this.each((function(t){e.push(t)})).then((function(){return e}))}},{key:"count",value:function(){return this.request((function(e){return e.count()}))}},{key:"each",value:function(e){return this.iterate((function(t,n){var r=t.value;e(r),n()}))}},{key:"reverse",value:function(e){return this.iterate((function(t,n){var r=t.value;e(r),n()}),{direction:"prev"})}},{key:"some",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new Promise((function(r,i){var o,a=[],u=0,c=n,s=n+t;n<0&&(o="prev",t=Math.min(t,-n),s=(c=-(n+t)||0)+t),e.iterate((function(e,t,n){u<c?(u++,t()):u<s?(a.push(e.value),u++,t()):n()}),{direction:o}).then((function(){n<0&&a.reverse(),r(a)})).catch(i)}))}},{key:"first",value:function(){return this.some(1).then((function(e){return e[0]}))}},{key:"last",value:function(){return this.some(1,-1).then((function(e){return e[0]}))}},{key:"find",value:function(e,t){return this.request((function(n){return n.index(e).get(t)}))}},{key:"query",value:function(e,t,n){var i=this,o=function(){switch(n){case">":return IDBKeyRange.lowerBound(t,!0);case">=":return IDBKeyRange.lowerBound(t);case"<":return IDBKeyRange.upperBound(t,!0);case"<=":return IDBKeyRange.upperBound(t);case"%":case"!=":case"in":return;default:return IDBKeyRange.only(t)}}(),a=[];return new Promise((function(u,c){i.cursor({index:e,range:o,onTouch:function(e,i){var o=e.value,u=i.keyPath,c=Object(r.b)(o,u);"!="===n?c!==t&&a.push(o):"%"===n?"string"==typeof c&&c.indexOf(t)>-1&&a.push(o):"in"===n?Array.isArray(t)&&t.indexOf(c)>-1&&a.push(o):a.push(o),e.continue()},onDone:function(){u(a)},onError:function(e){c(e)}})}))}},{key:"select",value:function(e){var t=this.store.indexes||[],n={};t.forEach((function(e){var t=e.name,r=e.keyPath;n[t]=r}));for(var i=[],o=[],a=0,u=e.length;a<u;a++){var c=e[a],s=c.key,l=c.value,f=c.compare,h=c.optional,p=n[s]||s;h?i.push({keyPath:p,value:l,compare:f}):o.push({keyPath:p,value:l,compare:f})}var d=[];return this.each((function(e){(function(e){for(var t=function(e,t,n){if(void 0===e)return!1;switch(n){case">":return e>t;case">=":return e>=t;case"<":return e<t;case"<=":return e<=t;case"!=":return e!==t;case"%":return"string"==typeof e&&e.indexOf(t)>-1;case"in":return Array.isArray(t)&&t.indexOf(e)>-1;default:return e===t}},n=0,a=o.length;n<a;n++){var u=o[n],c=u.keyPath,s=u.value,l=u.compare;if(!t(Object(r.b)(e,c),s,l))return!1}for(var f=0,h=i.length;f<h;f++){var p=i[f],d=p.keyPath,v=p.value,y=p.compare;if(t(Object(r.b)(e,d),v,y))return!0}return!1})(e)&&d.push(e)})).then((function(){return d}))}},{key:"add",value:function(e,t){if(Array.isArray(e)){var n=e;if(n.length<2)return this.add(e[0],t);var r=n.map((function(e){return function(n){return n.add(e,t)}}));return this.batch(r)}return e?this.request((function(n){return n.add(e,t)}),{writable:!0}):Promise.resolve()}},{key:"put",value:function(e,t){if(Array.isArray(e)){var n=e;if(n.length<2)return this.put(n[0],t);var r=n.map((function(e){return function(n){return n.put(e,t)}}));return this.batch(r)}return e?this.request((function(n){return n.put(e,t)}),{writable:!0}):Promise.resolve()}},{key:"delete",value:function(e){if(Array.isArray(e)){var t=e;if(t.length<2)return this.delete(t[0]);var n=t.map((function(e){return function(t){return t.delete(e)}}));return this.batch(n)}return e?this.request((function(t){return t.delete(e)}),{writable:!0}):Promise.resolve()}},{key:"remove",value:function(e){var t=this.keyPath;if(Array.isArray(e)){var n=e;if(n.length<2)return this.remove(n[0]);var i=n.map((function(e){var n=Object(r.b)(e,t);return function(e){return e.delete(n)}}));return this.batch(i)}if(!e)return Promise.resolve();var o=Object(r.b)(e,t);return o?this.delete(o):Promise.resolve()}},{key:"clear",value:function(){return this.request((function(e){return e.clear()}),{writable:!0})}}]),e}()},function(e,t,n){"use strict";function r(e,t){if(!Array.isArray(t)){var n=function(e){return e.toString().split(/\.|\[|\]/).filter((function(e){return!!e}))}(t);if(!n.length)return e;for(var i=e,o=0,a=n.length;o<a;o++){var u=n[o];if(void 0===i[u])return;i=i[u]}return i}for(var c=0,s=t.length;c<s;c++){var l=r(e,t[c]);if(void 0!==l)return l}}function i(e){var t=e.message;return e.message=-1===t.indexOf("[IndexedDB]")?"[IndexedDB]: "+t:t,e}n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return i}))}])},e.exports=n()}).call(this,n(128))},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function a(e){var t="function"==typeof Map?new Map:void 0;return(a=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return u(e,arguments,l(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),s(r,e)})(e)}function u(e,t,n){return(u=c()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&s(i,n.prototype),i}).apply(null,arguments)}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}n.d(t,"a",(function(){return f}));var f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(h,e);var t,n,r,a,u,f=(t=h,n=c(),function(){var e,r=l(t);if(n){var i=l(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return o(this,e)});function h(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),(t=f.call(this)).name="KernelError",t.message=e,t}return r=h,(a=[{key:"toString",value:function(){return this.name+" "+this.message}}])&&i(r.prototype,a),u&&i(r,u),h}(a(Error))},function(e,t,n){var r=n(49),i=n(17),o=i["__core-js_shared__"]||(i["__core-js_shared__"]={});(e.exports=function(e,t){return o[e]||(o[e]=void 0!==t?t:{})})("versions",[]).push({version:r.version,mode:n(67)?"pure":"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})},function(e,t,n){var r=n(51);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,n){"use strict";var r=n(13);e.exports=function(){var e=r(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},function(e,t,n){var r=n(13),i=n(38),o=n(27)("species");e.exports=function(e,t){var n,a=r(e).constructor;return void 0===a||null==(n=r(a)[o])?t:i(n)}},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.d(t,"a",(function(){return i}));var i=function(){function e(t,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.deviceId=t,this.groupId=n,this.kind=r,this.label=i}var t,n,i;return t=e,(n=[{key:"getDeviceId",value:function(){return this.deviceId}},{key:"getGroupId",value:function(){return this.groupId}},{key:"getLabel",value:function(){return this.label}},{key:"isVideoInput",value:function(){return"videoinput"==this.kind.toLowerCase()}},{key:"isAudioInput",value:function(){return"audioinput"==this.kind.toLowerCase()}}])&&r(t.prototype,n),i&&r(t,i),e}()},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.d(t,"a",(function(){return i}));var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,i;return t=e,(n=[{key:"onEvent",value:function(e,t){return t}}])&&r(t.prototype,n),i&&r(t,i),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var r=n(0),i=n(4),o=n(6),a=(n(7),n(10)),u=n(11),c=n(5);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var f=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.service=t,this.owner=n,this.remarkName="",this.assignedData=null}var t,n,f;return t=e,(n=[{key:"hasRemarkName",value:function(){return null!=this.remarkName&&this.remarkName.length>0}},{key:"getRemarkName",value:function(){return this.remarkName}},{key:"updateRemarkName",value:function(e,t,n){var s=this,l=new i.a(a.a.UpdateAppendix,{contactId:this.owner.getId(),remarkName:e});this.service.pipeline.send(u.a.NAME,l,(function(i,a,l){if(null!=l&&l.getStateCode()==o.a.OK)if(l.getPayload().code==c.a.Ok)s.remarkName=e,t&&t(s);else{var f=new r.a(u.a.NAME,l.getPayload().code,s);n&&n(f)}else{var h=new r.a(u.a.NAME,c.a.ServerError,s);n&&n(h)}}))}},{key:"getAssignedData",value:function(e){if(null==this.assignedData)return null;var t=this.assignedData[e];return void 0===t?null:t}},{key:"setAssignedData",value:function(e,t,n,r){if(this.service.self.id!=this.owner.id||"object"!=s(t))return!1;null==this.assignedData&&(this.assignedData={}),this.assignedData[e]=t;var o=new i.a(a.a.UpdateAppendix,{contactId:this.owner.getId(),assignedKey:e,assignedValue:t});return this._update(o,n,r),!0}},{key:"_update",value:function(e,t,n){var i=this;this.service.pipeline.send(u.a.NAME,e,(function(e,a,s){if(null!=s&&s.getStateCode()==o.a.OK)if(s.getPayload().code==c.a.Ok)t&&t(i);else{var l=new r.a(u.a.NAME,s.getPayload().code,i);n&&n(l)}else{var f=new r.a(u.a.NAME,c.a.ServerError,i);n&&n(f)}}))}}])&&l(t.prototype,n),f&&l(t,f),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var r=n(14),i=(n(11),n(126));function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=l(e);if(t){var i=l(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return s(this,n)}}function s(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var h=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(s,e);var t,n,r,o=c(s);function s(e,t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(n=o.call(this,e.id,e.timestamp)).service=t,n.domain=e.domain,n.owner=e.owner,n.name=e.name,n.displayName=e.displayName,n.state=e.state,n.peerMode=e.peerMode,n.participants=[];for(var r=0;r<e.participants.length;++r){var a=new i.a(e.participants[r],t);n.participants.push(a)}return n}return t=s,(n=[{key:"numParticipants",value:function(){return this.participants.length}},{key:"getParticipant",value:function(e){var t=this.contacts.indexOf(e);return t>=0?this.participants[t]:null}},{key:"getParticipants",value:function(e){for(var t=this,n=0,r=function(){n==t.participants.length&&e(t.participants)},i=0;i<this.participants.length;++i){var o=this.participants[i];o.isAssigned()?++n:o._assigns(this.service,(function(e){++n,r()}))}r()}}])&&a(t.prototype,n),r&&a(t,r),s}(r.a);f(h,"StateNormal",1),f(h,"StateDeleted",0)},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r={QVGA:{width:320,height:240,constraints:{width:{max:320},height:{max:240}}},VGA_IDEAL:{width:640,height:480,constraints:{width:{min:320,max:640},height:{min:240,max:480}}},VGA:{width:640,height:480,constraints:{width:{max:640},height:{max:480}}},SVGA:{width:800,height:600,constraints:{width:{max:800},height:{max:600}}},HD:{width:1280,height:720,constraints:{width:{max:1280},height:{max:720}}},FullHD:{width:1920,height:1080,constraints:{width:{max:1920},height:{max:1080}}},FourK:{width:4096,height:2160,constraints:{width:{max:4096},height:{max:2160}}},EightK:{width:7680,height:4320,constraints:{width:{max:7680},height:{max:4320}}}}},function(e,t,n){var r=n(45),i=n(28),o=n(75);e.exports=function(e){return function(t,n,a){var u,c=r(t),s=i(c.length),l=o(a,s);if(e&&n!=n){for(;s>l;)if((u=c[l++])!=u)return!0}else for(;s>l;l++)if((e||l in c)&&c[l]===n)return e||l||0;return!e&&-1}}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,n){var r=n(51);e.exports=Array.isArray||function(e){return"Array"==r(e)}},function(e,t,n){var r=n(52),i=n(58);e.exports=function(e){return function(t,n){var o,a,u=String(i(t)),c=r(n),s=u.length;return c<0||c>=s?e?"":void 0:(o=u.charCodeAt(c))<55296||o>56319||c+1===s||(a=u.charCodeAt(c+1))<56320||a>57343?e?u.charAt(c):o:e?u.slice(c,c+2):a-56320+(o-55296<<10)+65536}}},function(e,t,n){var r=n(25),i=n(51),o=n(27)("match");e.exports=function(e){var t;return r(e)&&(void 0!==(t=e[o])?!!t:"RegExp"==i(e))}},function(e,t,n){var r=n(27)("iterator"),i=!1;try{var o=[7][r]();o.return=function(){i=!0},Array.from(o,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var n=!1;try{var o=[7],a=o[r]();a.next=function(){return{done:n=!0}},o[r]=function(){return a},e(o)}catch(e){}return n}},function(e,t,n){"use strict";var r=n(91),i=RegExp.prototype.exec;e.exports=function(e,t){var n=e.exec;if("function"==typeof n){var o=n.call(e,t);if("object"!=typeof o)throw new TypeError("RegExp exec method returned something other than an Object or null");return o}if("RegExp"!==r(e))throw new TypeError("RegExp#exec called on incompatible receiver");return i.call(e,t)}},function(e,t,n){"use strict";n(178);var r=n(41),i=n(40),o=n(22),a=n(58),u=n(27),c=n(150),s=u("species"),l=!o((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})),f=function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2===n.length&&"a"===n[0]&&"b"===n[1]}();e.exports=function(e,t,n){var h=u(e),p=!o((function(){var t={};return t[h]=function(){return 7},7!=""[e](t)})),d=p?!o((function(){var t=!1,n=/a/;return n.exec=function(){return t=!0,null},"split"===e&&(n.constructor={},n.constructor[s]=function(){return n}),n[h](""),!t})):void 0;if(!p||!d||"replace"===e&&!l||"split"===e&&!f){var v=/./[h],y=n(a,h,""[e],(function(e,t,n,r,i){return t.exec===c?p&&!i?{done:!0,value:v.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}})),g=y[0],m=y[1];r(String.prototype,e,g),i(RegExp.prototype,h,2==t?function(e,t){return m.call(e,this,t)}:function(e){return m.call(e,this)})}}},function(e,t,n){var r=n(17).navigator;e.exports=r&&r.userAgent||""},function(e,t,n){"use strict";var r=n(17),i=n(2),o=n(41),a=n(81),u=n(68),c=n(80),s=n(79),l=n(25),f=n(22),h=n(112),p=n(90),d=n(136);e.exports=function(e,t,n,v,y,g){var m=r[e],b=m,w=y?"set":"add",k=b&&b.prototype,S={},O=function(e){var t=k[e];o(k,e,"delete"==e||"has"==e?function(e){return!(g&&!l(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return g&&!l(e)?void 0:t.call(this,0===e?0:e)}:"add"==e?function(e){return t.call(this,0===e?0:e),this}:function(e,n){return t.call(this,0===e?0:e,n),this})};if("function"==typeof b&&(g||k.forEach&&!f((function(){(new b).entries().next()})))){var _=new b,C=_[w](g?{}:-0,1)!=_,E=f((function(){_.has(1)})),R=h((function(e){new b(e)})),x=!g&&f((function(){for(var e=new b,t=5;t--;)e[w](t,t);return!e.has(-0)}));R||((b=t((function(t,n){s(t,b,e);var r=d(new m,t,b);return null!=n&&c(n,y,r[w],r),r}))).prototype=k,k.constructor=b),(E||x)&&(O("delete"),O("has"),y&&O("get")),(x||C)&&O(w),g&&k.clear&&delete k.clear}else b=v.getConstructor(t,e,y,w),a(b.prototype,n),u.NEED=!0;return p(b,e),S[e]=b,i(i.G+i.W+i.F*(b!=m),S),g||v.setStrong(b,e,y),b}},function(e,t,n){for(var r,i=n(17),o=n(40),a=n(73),u=a("typed_array"),c=a("view"),s=!(!i.ArrayBuffer||!i.DataView),l=s,f=0,h="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");f<9;)(r=i[h[f++]])?(o(r.prototype,u,!0),o(r.prototype,c,!0)):l=!1;e.exports={ABV:s,CONSTR:l,TYPED:u,VIEW:c}},function(e,t,n){"use strict";e.exports=n(67)||!n(22)((function(){var e=Math.random();__defineSetter__.call(null,e,(function(){})),delete n(17)[e]}))},function(e,t,n){"use strict";var r=n(2);e.exports=function(e){r(r.S,e,{of:function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},function(e,t,n){"use strict";var r=n(2),i=n(38),o=n(50),a=n(80);e.exports=function(e){r(r.S,e,{from:function(e){var t,n,r,u,c=arguments[1];return i(this),(t=void 0!==c)&&i(c),null==e?new this:(n=[],t?(r=0,u=o(c,arguments[2],2),a(e,!1,(function(e){n.push(u(e,r++))}))):a(e,!1,n.push,n),new this(n))}})}},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=u(e);if(t){var i=u(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return a(this,n)}}function a(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}n.d(t,"a",(function(){return c}));var c=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(n,e);var t=o(n);function n(e,r){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(i=t.call(this,e)).code=r,i.name="PipelineError",i}return n}(n(96).a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));n(156),n(3);var r=n(48);function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.observers=[],this.functions=[],this.namedObservers=null,this.namedFunctions=null}var t,n,o;return t=e,(n=[{key:"attach",value:function(e){var t=null;(t="function"==typeof e?this.functions:this.observers).indexOf(e)>=0||t.push(e)}},{key:"attachWithName",value:function(e,t){var n=null;"function"==typeof t?(null==this.namedFunctions&&(this.namedFunctions=new r.a),n=this.namedFunctions):(null==this.namedObservers&&(this.namedObservers=new r.a),n=this.namedObservers);var i=n.get(e);null==i?n.put(e,[t]):i.push(t)}},{key:"detach",value:function(e){var t=null,n=(t="function"==typeof e?this.functions:this.observers).indexOf(e);n>=0&&t.splice(n,1)}},{key:"detachWithName",value:function(e,t){var n=null;if("function"==typeof t){if(null==this.namedFunctions)return;n=this.namedFunctions}else{if(null==this.namedObservers)return;n=this.namedObservers}var r=n.get(e);if(null!=r){var i=r.indexOf(t);i>=0&&r.splice(i,1)}}},{key:"notifyObservers",value:function(e){e.subject=this;for(var t=0;t<this.functions.length;++t)(0,this.functions[t])(e);for(var n=0;n<this.observers.length;++n)this.observers[n].update(e);if(null!=this.namedFunctions){var r=this.namedFunctions.get(e.name);if(null!=r)for(var i=0;i<r.length;++i)r[i](e)}if(null!=this.namedObservers){var o=this.namedObservers.get(e.name);if(null!=o)for(var a=0;a<o.length;++a)o[a].update(e)}}}])&&i(t.prototype,n),o&&i(t,o),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));n(157);function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t,this.system=null}var t,n,i;return t=e,(n=[{key:"getName",value:function(){return this.name}},{key:"apply",value:function(e){return this.system.syncApply(this.name,e)}}])&&r(t.prototype,n),i&&r(t,i),e}()},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return(o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=s(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=s(e);if(t){var i=s(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return c(this,n)}}function c(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}n.d(t,"a",(function(){return l}));var l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(l,e);var t,n,r,c=u(l);function l(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(n=c.call(this)).address=e,n.primaryContent=t,n}return t=l,r=[{key:"create",value:function(e){return new l(e.address,e.primaryContent)}}],(n=[{key:"getAddress",value:function(){return this.address}},{key:"getPrimaryContent",value:function(){return this.primaryContent}},{key:"toJSON",value:function(){var e=o(s(l.prototype),"toJSON",this).call(this);return e.address=this.address,e.primaryContent=this.primaryContent,e}}])&&i(t.prototype,n),r&&i(t,r),l}(n(24).a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var r=n(24);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=l(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=l(e);if(t){var i=l(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return s(this,n)}}function s(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(f,e);var t,n,i,s=c(f);function f(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),(r=s.call(this,e)).name=void 0===t?"Cube-"+e:t,r.namePY="",r.domain=void 0===n?AuthService.DOMAIN:n,r}return t=f,(n=[{key:"getId",value:function(){return this.id}},{key:"getDomain",value:function(){return this.domain}},{key:"setName",value:function(e){this.name=e}},{key:"getName",value:function(){return this.name}},{key:"getNamePinYin",value:function(){return this.namePY.split(",").join("")}},{key:"toJSON",value:function(){var e=a(l(f.prototype),"toJSON",this).call(this);return e.name=this.name,e.domain=this.domain,e.namePY=this.namePY,null!=this.context&&(e.context=this.context instanceof r.a?this.context.toJSON():this.context),e}},{key:"toCompactJSON",value:function(){var e=a(l(f.prototype),"toCompactJSON",this).call(this);return e.name=this.name,e.domain=this.domain,e.namePY=this.namePY,null!=this.context&&(e.context=this.context instanceof r.a?this.context.toJSON():this.context),e}}])&&o(t.prototype,n),i&&o(t,i),f}(n(14).a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var r=n(14),i=(n(7),n(12),n(88));n(11);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=l(e);if(t){var i=l(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return s(this,n)}}function s(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(s,e);var t,n,r,o=c(s);function s(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(n=o.call(this,e.id,e.timestamp)).type=e.type,n.state=e.state,n.inviterId=e.inviterId,n.postscript="",void 0!==e.postscript&&(n.postscript=e.postscript),n.contact=null,n.group=null,n._assigns(t),n}return t=s,(n=[{key:"_assigns",value:function(e,t){var n=this;this.type==i.a.Contact?e.getContact(this.id,(function(e){n.contact=e,void 0!==t&&t(n)}),(function(e){void 0!==t&&t(n)})):this.type==i.a.Group&&e.getGroup(this.id,(function(e){n.group=e,void 0!==t&&t(n)}),(function(e){void 0!==t&&t(n)}))}},{key:"isAssigned",value:function(){return this.type==i.a.Contact?null!=this.contact:this.type!=i.a.Group||null!=this.group}}])&&a(t.prototype,n),r&&a(t,r),s}(r.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var r=n(15),i=n(14),o=n(23);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=h(e);if(t){var i=h(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f(this,n)}}function f(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var p=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(f,e);var t,n,i,a=l(f);function f(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),(e=a.call(this)).domain=null,e.fileLabel=null,e.width=0,e.height=0,e.sourceFileCode=null,e.sourceWidth=0,e.sourceHeight=0,e.quality=1,e.token=null,e}return t=f,i=[{key:"create",value:function(e){var t=new f;return t.id=e.id,t.domain=e.domain,t.fileLabel=o.a.create(e.fileLabel),t.width=e.width,t.height=e.height,t.sourceFileCode=e.sourceFileCode,t.sourceWidth=e.sourceWidth,t.sourceHeight=e.sourceHeight,t.quality=e.quality,t}}],(n=[{key:"getFileURL",value:function(e){return null!=this.token&&0!=this.token.length||(this.token=r.a.TOKEN),(void 0!==e?[e?this.fileLabel.getFileSecureURL():this.fileLabel.getFileURL(),"&token=",this.token,"&type=",this.fileLabel.fileType]:[this.fileLabel.getFileURL(),"&token=",this.token,"&type=",this.fileLabel.fileType]).join("")}},{key:"toJSON",value:function(){var e=c(h(f.prototype),"toJSON",this).call(this);return e.id=this.id,e.domain=this.domain,e.fileLabel=this.fileLabel.toJSON(),e.width=this.width,e.height=this.height,e.sourceFileCode=this.sourceFileCode,e.sourceWidth=this.sourceWidth,e.sourceHeight=this.sourceHeight,e.quality=this.quality,e}},{key:"toCompactJSON",value:function(){return this.toJSON()}}])&&u(t.prototype,n),i&&u(t,i),f}(i.a)},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var r=n(25),i=n(17).document,o=r(i)&&r(i.createElement);e.exports=function(e){return o?i.createElement(e):{}}},function(e,t,n){var r=n(17),i=n(49),o=n(67),a=n(160),u=n(31).f;e.exports=function(e){var t=i.Symbol||(i.Symbol=o?{}:r.Symbol||{});"_"==e.charAt(0)||e in t||u(t,e,{value:a.f(e)})}},function(e,t,n){var r=n(97)("keys"),i=n(73);e.exports=function(e){return r[e]||(r[e]=i(e))}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,n){var r=n(17).document;e.exports=r&&r.documentElement},function(e,t,n){var r=n(25),i=n(13),o=function(e,t){if(i(e),!r(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,r){try{(r=n(50)(Function.call,n(46).f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,n){return o(e,n),t?e.__proto__=n:r(e,n),e}}({},!1):void 0),check:o}},function(e,t){e.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},function(e,t,n){var r=n(25),i=n(134).set;e.exports=function(e,t,n){var o,a=t.constructor;return a!==n&&"function"==typeof a&&(o=a.prototype)!==n.prototype&&r(o)&&i&&i(e,o),e}},function(e,t,n){"use strict";var r=n(52),i=n(58);e.exports=function(e){var t=String(i(this)),n="",o=r(e);if(o<0||o==1/0)throw RangeError("Count can't be negative");for(;o>0;(o>>>=1)&&(t+=t))1&o&&(n+=t);return n}},function(e,t){e.exports=Math.sign||function(e){return 0==(e=+e)||e!=e?e:e<0?-1:1}},function(e,t){var n=Math.expm1;e.exports=!n||n(10)>22025.465794806718||n(10)<22025.465794806718||-2e-17!=n(-2e-17)?function(e){return 0==(e=+e)?e:e>-1e-6&&e<1e-6?e+e*e/2:Math.exp(e)-1}:n},function(e,t,n){"use strict";var r=n(67),i=n(2),o=n(41),a=n(40),u=n(93),c=n(141),s=n(90),l=n(47),f=n(27)("iterator"),h=!([].keys&&"next"in[].keys()),p=function(){return this};e.exports=function(e,t,n,d,v,y,g){c(n,t,d);var m,b,w,k=function(e){if(!h&&e in C)return C[e];switch(e){case"keys":case"values":return function(){return new n(this,e)}}return function(){return new n(this,e)}},S=t+" Iterator",O="values"==v,_=!1,C=e.prototype,E=C[f]||C["@@iterator"]||v&&C[v],R=E||k(v),x=v?O?k("entries"):R:void 0,P="Array"==t&&C.entries||E;if(P&&(w=l(P.call(new e)))!==Object.prototype&&w.next&&(s(w,S,!0),r||"function"==typeof w[f]||a(w,f,p)),O&&E&&"values"!==E.name&&(_=!0,R=function(){return E.call(this)}),r&&!g||!h&&!_&&C[f]||a(C,f,R),u[t]=R,u[S]=p,v)if(m={values:O?R:k("values"),keys:y?R:k("keys"),entries:x},g)for(b in m)b in C||o(C,b,m[b]);else i(i.P+i.F*(h||_),t,m);return m}},function(e,t,n){"use strict";var r=n(76),i=n(72),o=n(90),a={};n(40)(a,n(27)("iterator"),(function(){return this})),e.exports=function(e,t,n){e.prototype=r(a,{next:i(1,n)}),o(e,t+" Iterator")}},function(e,t,n){var r=n(111),i=n(58);e.exports=function(e,t,n){if(r(t))throw TypeError("String#"+n+" doesn't accept regex!");return String(i(e))}},function(e,t,n){var r=n(27)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[r]=!1,!"/./"[e](t)}catch(e){}}return!0}},function(e,t,n){var r=n(93),i=n(27)("iterator"),o=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||o[i]===e)}},function(e,t,n){"use strict";var r=n(31),i=n(72);e.exports=function(e,t,n){t in e?r.f(e,t,i(0,n)):e[t]=n}},function(e,t,n){var r=n(91),i=n(27)("iterator"),o=n(93);e.exports=n(49).getIteratorMethod=function(e){if(null!=e)return e[i]||e["@@iterator"]||o[r(e)]}},function(e,t,n){var r=n(288);e.exports=function(e,t){return new(r(e))(t)}},function(e,t,n){"use strict";var r=n(32),i=n(75),o=n(28);e.exports=function(e){for(var t=r(this),n=o(t.length),a=arguments.length,u=i(a>1?arguments[1]:void 0,n),c=a>2?arguments[2]:void 0,s=void 0===c?n:i(c,n);s>u;)t[u++]=e;return t}},function(e,t,n){"use strict";var r=n(69),i=n(177),o=n(93),a=n(45);e.exports=n(140)(Array,"Array",(function(e,t){this._t=a(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,i(1)):i(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])}),"values"),o.Arguments=o.Array,r("keys"),r("values"),r("entries")},function(e,t,n){"use strict";var r,i,o=n(100),a=RegExp.prototype.exec,u=String.prototype.replace,c=a,s=(r=/a/,i=/b*/g,a.call(r,"a"),a.call(i,"a"),0!==r.lastIndex||0!==i.lastIndex),l=void 0!==/()??/.exec("")[1];(s||l)&&(c=function(e){var t,n,r,i,c=this;return l&&(n=new RegExp("^"+c.source+"$(?!\\s)",o.call(c))),s&&(t=c.lastIndex),r=a.call(c,e),s&&r&&(c.lastIndex=c.global?r.index+r[0].length:t),l&&r&&r.length>1&&u.call(r[0],n,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(r[i]=void 0)})),r}),e.exports=c},function(e,t,n){"use strict";var r=n(110)(!0);e.exports=function(e,t,n){return t+(n?r(e,t).length:1)}},function(e,t,n){var r,i,o,a=n(50),u=n(167),c=n(133),s=n(129),l=n(17),f=l.process,h=l.setImmediate,p=l.clearImmediate,d=l.MessageChannel,v=l.Dispatch,y=0,g={},m=function(){var e=+this;if(g.hasOwnProperty(e)){var t=g[e];delete g[e],t()}},b=function(e){m.call(e.data)};h&&p||(h=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return g[++y]=function(){u("function"==typeof e?e:Function(e),t)},r(y),y},p=function(e){delete g[e]},"process"==n(51)(f)?r=function(e){f.nextTick(a(m,e,1))}:v&&v.now?r=function(e){v.now(a(m,e,1))}:d?(o=(i=new d).port2,i.port1.onmessage=b,r=a(o.postMessage,o,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(r=function(e){l.postMessage(e+"","*")},l.addEventListener("message",b,!1)):r="onreadystatechange"in s("script")?function(e){c.appendChild(s("script")).onreadystatechange=function(){c.removeChild(this),m.call(e)}}:function(e){setTimeout(a(m,e,1),0)}),e.exports={set:h,clear:p}},function(e,t,n){var r=n(17),i=n(152).set,o=r.MutationObserver||r.WebKitMutationObserver,a=r.process,u=r.Promise,c="process"==n(51)(a);e.exports=function(){var e,t,n,s=function(){var r,i;for(c&&(r=a.domain)&&r.exit();e;){i=e.fn,e=e.next;try{i()}catch(r){throw e?n():t=void 0,r}}t=void 0,r&&r.enter()};if(c)n=function(){a.nextTick(s)};else if(!o||r.navigator&&r.navigator.standalone)if(u&&u.resolve){var l=u.resolve(void 0);n=function(){l.then(s)}}else n=function(){i.call(r,s)};else{var f=!0,h=document.createTextNode("");new o(s).observe(h,{characterData:!0}),n=function(){h.data=f=!f}}return function(r){var i={fn:r,next:void 0};t&&(t.next=i),e||(e=i,n()),t=i}}},function(e,t,n){"use strict";var r=n(38);function i(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=r(t),this.reject=r(n)}e.exports.f=function(e){return new i(e)}},function(e,t,n){"use strict";var r=n(17),i=n(29),o=n(67),a=n(117),u=n(40),c=n(81),s=n(22),l=n(79),f=n(52),h=n(28),p=n(187),d=n(77).f,v=n(31).f,y=n(148),g=n(90),m=r.ArrayBuffer,b=r.DataView,w=r.Math,k=r.RangeError,S=r.Infinity,O=m,_=w.abs,C=w.pow,E=w.floor,R=w.log,x=w.LN2,P=i?"_b":"buffer",T=i?"_l":"byteLength",M=i?"_o":"byteOffset";function A(e,t,n){var r,i,o,a=new Array(n),u=8*n-t-1,c=(1<<u)-1,s=c>>1,l=23===t?C(2,-24)-C(2,-77):0,f=0,h=e<0||0===e&&1/e<0?1:0;for((e=_(e))!=e||e===S?(i=e!=e?1:0,r=c):(r=E(R(e)/x),e*(o=C(2,-r))<1&&(r--,o*=2),(e+=r+s>=1?l/o:l*C(2,1-s))*o>=2&&(r++,o/=2),r+s>=c?(i=0,r=c):r+s>=1?(i=(e*o-1)*C(2,t),r+=s):(i=e*C(2,s-1)*C(2,t),r=0));t>=8;a[f++]=255&i,i/=256,t-=8);for(r=r<<t|i,u+=t;u>0;a[f++]=255&r,r/=256,u-=8);return a[--f]|=128*h,a}function N(e,t,n){var r,i=8*n-t-1,o=(1<<i)-1,a=o>>1,u=i-7,c=n-1,s=e[c--],l=127&s;for(s>>=7;u>0;l=256*l+e[c],c--,u-=8);for(r=l&(1<<-u)-1,l>>=-u,u+=t;u>0;r=256*r+e[c],c--,u-=8);if(0===l)l=1-a;else{if(l===o)return r?NaN:s?-S:S;r+=C(2,t),l-=a}return(s?-1:1)*r*C(2,l-t)}function j(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]}function I(e){return[255&e]}function L(e){return[255&e,e>>8&255]}function F(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]}function D(e){return A(e,52,8)}function B(e){return A(e,23,4)}function G(e,t,n){v(e.prototype,t,{get:function(){return this[n]}})}function U(e,t,n,r){var i=p(+n);if(i+t>e[T])throw k("Wrong index!");var o=e[P]._b,a=i+e[M],u=o.slice(a,a+t);return r?u:u.reverse()}function H(e,t,n,r,i,o){var a=p(+n);if(a+t>e[T])throw k("Wrong index!");for(var u=e[P]._b,c=a+e[M],s=r(+i),l=0;l<t;l++)u[c+l]=s[o?l:t-l-1]}if(a.ABV){if(!s((function(){m(1)}))||!s((function(){new m(-1)}))||s((function(){return new m,new m(1.5),new m(NaN),"ArrayBuffer"!=m.name}))){for(var z,J=(m=function(e){return l(this,m),new O(p(e))}).prototype=O.prototype,V=d(O),K=0;V.length>K;)(z=V[K++])in m||u(m,z,O[z]);o||(J.constructor=m)}var q=new b(new m(2)),W=b.prototype.setInt8;q.setInt8(0,2147483648),q.setInt8(1,2147483649),!q.getInt8(0)&&q.getInt8(1)||c(b.prototype,{setInt8:function(e,t){W.call(this,e,t<<24>>24)},setUint8:function(e,t){W.call(this,e,t<<24>>24)}},!0)}else m=function(e){l(this,m,"ArrayBuffer");var t=p(e);this._b=y.call(new Array(t),0),this[T]=t},b=function(e,t,n){l(this,b,"DataView"),l(e,m,"DataView");var r=e[T],i=f(t);if(i<0||i>r)throw k("Wrong offset!");if(i+(n=void 0===n?r-i:h(n))>r)throw k("Wrong length!");this[P]=e,this[M]=i,this[T]=n},i&&(G(m,"byteLength","_l"),G(b,"buffer","_b"),G(b,"byteLength","_l"),G(b,"byteOffset","_o")),c(b.prototype,{getInt8:function(e){return U(this,1,e)[0]<<24>>24},getUint8:function(e){return U(this,1,e)[0]},getInt16:function(e){var t=U(this,2,e,arguments[1]);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=U(this,2,e,arguments[1]);return t[1]<<8|t[0]},getInt32:function(e){return j(U(this,4,e,arguments[1]))},getUint32:function(e){return j(U(this,4,e,arguments[1]))>>>0},getFloat32:function(e){return N(U(this,4,e,arguments[1]),23,4)},getFloat64:function(e){return N(U(this,8,e,arguments[1]),52,8)},setInt8:function(e,t){H(this,1,e,I,t)},setUint8:function(e,t){H(this,1,e,I,t)},setInt16:function(e,t){H(this,2,e,L,t,arguments[2])},setUint16:function(e,t){H(this,2,e,L,t,arguments[2])},setInt32:function(e,t){H(this,4,e,F,t,arguments[2])},setUint32:function(e,t){H(this,4,e,F,t,arguments[2])},setFloat32:function(e,t){H(this,4,e,B,t,arguments[2])},setFloat64:function(e,t){H(this,8,e,D,t,arguments[2])}});g(m,"ArrayBuffer"),g(b,"DataView"),u(b.prototype,a.VIEW,!0),t.ArrayBuffer=m,t.DataView=b},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));n(3);function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,i;return t=e,(n=[{key:"update",value:function(e){}}])&&r(t.prototype,n),i&&r(t,i),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r=n(18),i=n(123);n(103);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),e}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=h(e);if(t){var i=h(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f(this,n)}}function f(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var p=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(n,e);var t=l(n);function n(){return a(this,n),t.call(this,"CubeDummyHook")}return c(n,[{key:"apply",value:function(e){return e}}]),n}(i.a),d=function(){function e(){a(this,e),this.hooks=new r.a,this.plugins=new r.a,this.dummyHook=new p}return c(e,[{key:"addHook",value:function(e){e.system=this,this.hooks.put(e.getName(),e)}},{key:"removeHook",value:function(e){this.hooks.remove(e.getName()),e.system=null}},{key:"getHook",value:function(e){var t=this.hooks.get(e);return null==t?this.dummyHook:t}},{key:"register",value:function(e,t){var n=this.plugins.get(e);null==n&&(n=new Array,this.plugins.put(e,n)),n.push(t)}},{key:"deregister",value:function(e,t){var n=this.plugins.get(e);if(null!=n){var r=n.indexOf(t);r>=0&&n.splice(r,1)}}},{key:"syncApply",value:function(e,t){var n=this.plugins.get(e);if(null==n)return t;for(var r=t,i=0;i<n.length;++i){r=n[i].onEvent(e,r)}return r}}]),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));n(34),n(83);function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,i;return t=e,(n=[{key:"onMediaConnected",value:function(e,t){}},{key:"onMediaDisconnected",value:function(e,t){}}])&&r(t.prototype,n),i&&r(t,i),e}()},function(e,t,n){e.exports=!n(29)&&!n(22)((function(){return 7!=Object.defineProperty(n(129)("div"),"a",{get:function(){return 7}}).a}))},function(e,t,n){t.f=n(27)},function(e,t,n){var r=n(44),i=n(45),o=n(107)(!1),a=n(131)("IE_PROTO");e.exports=function(e,t){var n,u=i(e),c=0,s=[];for(n in u)n!=a&&r(u,n)&&s.push(n);for(;t.length>c;)r(u,n=t[c++])&&(~o(s,n)||s.push(n));return s}},function(e,t,n){var r=n(31),i=n(13),o=n(74);e.exports=n(29)?Object.defineProperties:function(e,t){i(e);for(var n,a=o(t),u=a.length,c=0;u>c;)r.f(e,n=a[c++],t[n]);return e}},function(e,t,n){var r=n(45),i=n(77).f,o={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return a&&"[object Window]"==o.call(e)?function(e){try{return i(e)}catch(e){return a.slice()}}(e):i(r(e))}},function(e,t,n){"use strict";var r=n(29),i=n(74),o=n(108),a=n(99),u=n(32),c=n(98),s=Object.assign;e.exports=!s||n(22)((function(){var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach((function(e){t[e]=e})),7!=s({},e)[n]||Object.keys(s({},t)).join("")!=r}))?function(e,t){for(var n=u(e),s=arguments.length,l=1,f=o.f,h=a.f;s>l;)for(var p,d=c(arguments[l++]),v=f?i(d).concat(f(d)):i(d),y=v.length,g=0;y>g;)p=v[g++],r&&!h.call(d,p)||(n[p]=d[p]);return n}:s},function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}},function(e,t,n){"use strict";var r=n(38),i=n(25),o=n(167),a=[].slice,u={},c=function(e,t,n){if(!(t in u)){for(var r=[],i=0;i<t;i++)r[i]="a["+i+"]";u[t]=Function("F,a","return new F("+r.join(",")+")")}return u[t](e,n)};e.exports=Function.bind||function(e){var t=r(this),n=a.call(arguments,1),u=function(){var r=n.concat(a.call(arguments));return this instanceof u?c(t,r.length,r):o(t,r,e)};return i(t.prototype)&&(u.prototype=t.prototype),u}},function(e,t){e.exports=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},function(e,t,n){var r=n(17).parseInt,i=n(92).trim,o=n(135),a=/^[-+]?0[xX]/;e.exports=8!==r(o+"08")||22!==r(o+"0x16")?function(e,t){var n=i(String(e),3);return r(n,t>>>0||(a.test(n)?16:10))}:r},function(e,t,n){var r=n(17).parseFloat,i=n(92).trim;e.exports=1/r(n(135)+"-0")!=-1/0?function(e){var t=i(String(e),3),n=r(t);return 0===n&&"-"==t.charAt(0)?-0:n}:r},function(e,t,n){var r=n(51);e.exports=function(e,t){if("number"!=typeof e&&"Number"!=r(e))throw TypeError(t);return+e}},function(e,t,n){var r=n(25),i=Math.floor;e.exports=function(e){return!r(e)&&isFinite(e)&&i(e)===e}},function(e,t){e.exports=Math.log1p||function(e){return(e=+e)>-1e-8&&e<1e-8?e-e*e/2:Math.log(1+e)}},function(e,t,n){var r=n(138),i=Math.pow,o=i(2,-52),a=i(2,-23),u=i(2,127)*(2-a),c=i(2,-126);e.exports=Math.fround||function(e){var t,n,i=Math.abs(e),s=r(e);return i<c?s*(i/c/a+1/o-1/o)*c*a:(n=(t=(1+a/o)*i)-(t-i))>u||n!=n?s*(1/0):s*n}},function(e,t,n){var r=n(13);e.exports=function(e,t,n,i){try{return i?t(r(n)[0],n[1]):t(n)}catch(t){var o=e.return;throw void 0!==o&&r(o.call(e)),t}}},function(e,t,n){var r=n(38),i=n(32),o=n(98),a=n(28);e.exports=function(e,t,n,u,c){r(t);var s=i(e),l=o(s),f=a(s.length),h=c?f-1:0,p=c?-1:1;if(n<2)for(;;){if(h in l){u=l[h],h+=p;break}if(h+=p,c?h<0:f<=h)throw TypeError("Reduce of empty array with no initial value")}for(;c?h>=0:f>h;h+=p)h in l&&(u=t(u,l[h],h,s));return u}},function(e,t,n){"use strict";var r=n(32),i=n(75),o=n(28);e.exports=[].copyWithin||function(e,t){var n=r(this),a=o(n.length),u=i(e,a),c=i(t,a),s=arguments.length>2?arguments[2]:void 0,l=Math.min((void 0===s?a:i(s,a))-c,a-u),f=1;for(c<u&&u<c+l&&(f=-1,c+=l-1,u+=l-1);l-- >0;)c in n?n[u]=n[c]:delete n[u],u+=f,c+=f;return n}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,n){"use strict";var r=n(150);n(2)({target:"RegExp",proto:!0,forced:r!==/./.exec},{exec:r})},function(e,t,n){n(29)&&"g"!=/./g.flags&&n(31).f(RegExp.prototype,"flags",{configurable:!0,get:n(100)})},function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},function(e,t,n){var r=n(13),i=n(25),o=n(154);e.exports=function(e,t){if(r(e),i(t)&&t.constructor===e)return t;var n=o.f(e);return(0,n.resolve)(t),n.promise}},function(e,t,n){"use strict";var r=n(183),i=n(82);e.exports=n(116)("Map",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(e){var t=r.getEntry(i(this,"Map"),e);return t&&t.v},set:function(e,t){return r.def(i(this,"Map"),0===e?0:e,t)}},r,!0)},function(e,t,n){"use strict";var r=n(31).f,i=n(76),o=n(81),a=n(50),u=n(79),c=n(80),s=n(140),l=n(177),f=n(78),h=n(29),p=n(68).fastKey,d=n(82),v=h?"_s":"size",y=function(e,t){var n,r=p(t);if("F"!==r)return e._i[r];for(n=e._f;n;n=n.n)if(n.k==t)return n};e.exports={getConstructor:function(e,t,n,s){var l=e((function(e,r){u(e,l,t,"_i"),e._t=t,e._i=i(null),e._f=void 0,e._l=void 0,e[v]=0,null!=r&&c(r,n,e[s],e)}));return o(l.prototype,{clear:function(){for(var e=d(this,t),n=e._i,r=e._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];e._f=e._l=void 0,e[v]=0},delete:function(e){var n=d(this,t),r=y(n,e);if(r){var i=r.n,o=r.p;delete n._i[r.i],r.r=!0,o&&(o.n=i),i&&(i.p=o),n._f==r&&(n._f=i),n._l==r&&(n._l=o),n[v]--}return!!r},forEach:function(e){d(this,t);for(var n,r=a(e,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(e){return!!y(d(this,t),e)}}),h&&r(l.prototype,"size",{get:function(){return d(this,t)[v]}}),l},def:function(e,t,n){var r,i,o=y(e,t);return o?o.v=n:(e._l=o={i:i=p(t,!0),k:t,v:n,p:r=e._l,n:void 0,r:!1},e._f||(e._f=o),r&&(r.n=o),e[v]++,"F"!==i&&(e._i[i]=o)),e},getEntry:y,setStrong:function(e,t,n){s(e,t,(function(e,n){this._t=d(e,t),this._k=n,this._l=void 0}),(function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?l(0,"keys"==e?t.k:"values"==e?t.v:[t.k,t.v]):(this._t=void 0,l(1))}),n?"entries":"values",!n,!0),f(t)}}},function(e,t,n){"use strict";var r=n(183),i=n(82);e.exports=n(116)("Set",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(e){return r.def(i(this,"Set"),e=0===e?0:e,e)}},r)},function(e,t,n){"use strict";var r,i=n(17),o=n(60)(0),a=n(41),u=n(68),c=n(164),s=n(186),l=n(25),f=n(82),h=n(82),p=!i.ActiveXObject&&"ActiveXObject"in i,d=u.getWeak,v=Object.isExtensible,y=s.ufstore,g=function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},m={get:function(e){if(l(e)){var t=d(e);return!0===t?y(f(this,"WeakMap")).get(e):t?t[this._i]:void 0}},set:function(e,t){return s.def(f(this,"WeakMap"),e,t)}},b=e.exports=n(116)("WeakMap",g,m,s,!0,!0);h&&p&&(c((r=s.getConstructor(g,"WeakMap")).prototype,m),u.NEED=!0,o(["delete","has","get","set"],(function(e){var t=b.prototype,n=t[e];a(t,e,(function(t,i){if(l(t)&&!v(t)){this._f||(this._f=new r);var o=this._f[e](t,i);return"set"==e?this:o}return n.call(this,t,i)}))})))},function(e,t,n){"use strict";var r=n(81),i=n(68).getWeak,o=n(13),a=n(25),u=n(79),c=n(80),s=n(60),l=n(44),f=n(82),h=s(5),p=s(6),d=0,v=function(e){return e._l||(e._l=new y)},y=function(){this.a=[]},g=function(e,t){return h(e.a,(function(e){return e[0]===t}))};y.prototype={get:function(e){var t=g(this,e);if(t)return t[1]},has:function(e){return!!g(this,e)},set:function(e,t){var n=g(this,e);n?n[1]=t:this.a.push([e,t])},delete:function(e){var t=p(this.a,(function(t){return t[0]===e}));return~t&&this.a.splice(t,1),!!~t}},e.exports={getConstructor:function(e,t,n,o){var s=e((function(e,r){u(e,s,t,"_i"),e._t=t,e._i=d++,e._l=void 0,null!=r&&c(r,n,e[o],e)}));return r(s.prototype,{delete:function(e){if(!a(e))return!1;var n=i(e);return!0===n?v(f(this,t)).delete(e):n&&l(n,this._i)&&delete n[this._i]},has:function(e){if(!a(e))return!1;var n=i(e);return!0===n?v(f(this,t)).has(e):n&&l(n,this._i)}}),s},def:function(e,t,n){var r=i(o(t),!0);return!0===r?v(e).set(t,n):r[e._i]=n,e},ufstore:v}},function(e,t,n){var r=n(52),i=n(28);e.exports=function(e){if(void 0===e)return 0;var t=r(e),n=i(t);if(t!==n)throw RangeError("Wrong length!");return n}},function(e,t,n){var r=n(77),i=n(108),o=n(13),a=n(17).Reflect;e.exports=a&&a.ownKeys||function(e){var t=r.f(o(e)),n=i.f;return n?t.concat(n(e)):t}},function(e,t,n){"use strict";var r=n(109),i=n(25),o=n(28),a=n(50),u=n(27)("isConcatSpreadable");e.exports=function e(t,n,c,s,l,f,h,p){for(var d,v,y=l,g=0,m=!!h&&a(h,p,3);g<s;){if(g in c){if(d=m?m(c[g],g,n):c[g],v=!1,i(d)&&(v=void 0!==(v=d[u])?!!v:r(d)),v&&f>0)y=e(t,n,d,o(d.length),y,f-1)-1;else{if(y>=9007199254740991)throw TypeError();t[y]=d}y++}g++}return y}},function(e,t,n){var r=n(28),i=n(137),o=n(58);e.exports=function(e,t,n,a){var u=String(o(e)),c=u.length,s=void 0===n?" ":String(n),l=r(t);if(l<=c||""==s)return u;var f=l-c,h=i.call(s,Math.ceil(f/s.length));return h.length>f&&(h=h.slice(0,f)),a?h+u:u+h}},function(e,t,n){var r=n(29),i=n(74),o=n(45),a=n(99).f;e.exports=function(e){return function(t){for(var n,u=o(t),c=i(u),s=c.length,l=0,f=[];s>l;)n=c[l++],r&&!a.call(u,n)||f.push(e?[n,u[n]]:u[n]);return f}}},function(e,t,n){var r=n(91),i=n(193);e.exports=function(e){return function(){if(r(this)!=e)throw TypeError(e+"#toJSON isn't generic");return i(this)}}},function(e,t,n){var r=n(80);e.exports=function(e,t){var n=[];return r(e,!1,n.push,n,t),n}},function(e,t){e.exports=Math.scale||function(e,t,n,r,i){return 0===arguments.length||e!=e||t!=t||n!=n||r!=r||i!=i?NaN:e===1/0||e===-1/0?e:(e-t)*(i-r)/(n-t)+r}},function(e,t,n){n(196),n(399),e.exports=n(400)},function(e,t,n){"use strict";(function(e){if(n(197),n(394),n(395),e._babelPolyfill)throw new Error("only one instance of babel-polyfill is allowed");e._babelPolyfill=!0;function t(e,t,n){e[t]||Object.defineProperty(e,t,{writable:!0,configurable:!0,value:n})}t(String.prototype,"padLeft","".padStart),t(String.prototype,"padRight","".padEnd),"pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach((function(e){[][e]&&t(Array,e,Function.call.bind([][e]))}))}).call(this,n(128))},function(e,t,n){n(198),n(201),n(202),n(203),n(204),n(205),n(206),n(207),n(208),n(209),n(210),n(211),n(212),n(213),n(214),n(215),n(216),n(217),n(218),n(219),n(220),n(221),n(222),n(223),n(224),n(225),n(226),n(227),n(228),n(229),n(230),n(231),n(232),n(233),n(234),n(235),n(236),n(237),n(238),n(239),n(240),n(241),n(242),n(243),n(244),n(245),n(246),n(247),n(248),n(249),n(250),n(251),n(252),n(253),n(254),n(255),n(256),n(257),n(258),n(259),n(260),n(261),n(262),n(263),n(264),n(265),n(266),n(267),n(268),n(269),n(270),n(271),n(272),n(273),n(274),n(275),n(276),n(278),n(279),n(281),n(282),n(283),n(284),n(285),n(286),n(287),n(289),n(290),n(291),n(292),n(293),n(294),n(295),n(296),n(297),n(298),n(299),n(300),n(301),n(149),n(302),n(178),n(303),n(179),n(304),n(305),n(306),n(307),n(308),n(182),n(184),n(185),n(309),n(310),n(311),n(312),n(313),n(314),n(315),n(316),n(317),n(318),n(319),n(320),n(321),n(322),n(323),n(324),n(325),n(326),n(327),n(328),n(329),n(330),n(331),n(332),n(333),n(334),n(335),n(336),n(337),n(338),n(339),n(340),n(341),n(342),n(343),n(344),n(345),n(346),n(347),n(348),n(349),n(350),n(351),n(352),n(353),n(354),n(355),n(356),n(357),n(358),n(359),n(360),n(361),n(362),n(363),n(364),n(365),n(366),n(367),n(368),n(369),n(370),n(371),n(372),n(373),n(374),n(375),n(376),n(377),n(378),n(379),n(380),n(381),n(382),n(383),n(384),n(385),n(386),n(387),n(388),n(389),n(390),n(391),n(392),n(393),e.exports=n(49)},function(e,t,n){"use strict";var r=n(17),i=n(44),o=n(29),a=n(2),u=n(41),c=n(68).KEY,s=n(22),l=n(97),f=n(90),h=n(73),p=n(27),d=n(160),v=n(130),y=n(200),g=n(109),m=n(13),b=n(25),w=n(32),k=n(45),S=n(57),O=n(72),_=n(76),C=n(163),E=n(46),R=n(108),x=n(31),P=n(74),T=E.f,M=x.f,A=C.f,N=r.Symbol,j=r.JSON,I=j&&j.stringify,L=p("_hidden"),F=p("toPrimitive"),D={}.propertyIsEnumerable,B=l("symbol-registry"),G=l("symbols"),U=l("op-symbols"),H=Object.prototype,z="function"==typeof N&&!!R.f,J=r.QObject,V=!J||!J.prototype||!J.prototype.findChild,K=o&&s((function(){return 7!=_(M({},"a",{get:function(){return M(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=T(H,t);r&&delete H[t],M(e,t,n),r&&e!==H&&M(H,t,r)}:M,q=function(e){var t=G[e]=_(N.prototype);return t._k=e,t},W=z&&"symbol"==typeof N.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof N},Z=function(e,t,n){return e===H&&Z(U,t,n),m(e),t=S(t,!0),m(n),i(G,t)?(n.enumerable?(i(e,L)&&e[L][t]&&(e[L][t]=!1),n=_(n,{enumerable:O(0,!1)})):(i(e,L)||M(e,L,O(1,{})),e[L][t]=!0),K(e,t,n)):M(e,t,n)},Y=function(e,t){m(e);for(var n,r=y(t=k(t)),i=0,o=r.length;o>i;)Z(e,n=r[i++],t[n]);return e},Q=function(e){var t=D.call(this,e=S(e,!0));return!(this===H&&i(G,e)&&!i(U,e))&&(!(t||!i(this,e)||!i(G,e)||i(this,L)&&this[L][e])||t)},$=function(e,t){if(e=k(e),t=S(t,!0),e!==H||!i(G,t)||i(U,t)){var n=T(e,t);return!n||!i(G,t)||i(e,L)&&e[L][t]||(n.enumerable=!0),n}},X=function(e){for(var t,n=A(k(e)),r=[],o=0;n.length>o;)i(G,t=n[o++])||t==L||t==c||r.push(t);return r},ee=function(e){for(var t,n=e===H,r=A(n?U:k(e)),o=[],a=0;r.length>a;)!i(G,t=r[a++])||n&&!i(H,t)||o.push(G[t]);return o};z||(u((N=function(){if(this instanceof N)throw TypeError("Symbol is not a constructor!");var e=h(arguments.length>0?arguments[0]:void 0),t=function(n){this===H&&t.call(U,n),i(this,L)&&i(this[L],e)&&(this[L][e]=!1),K(this,e,O(1,n))};return o&&V&&K(H,e,{configurable:!0,set:t}),q(e)}).prototype,"toString",(function(){return this._k})),E.f=$,x.f=Z,n(77).f=C.f=X,n(99).f=Q,R.f=ee,o&&!n(67)&&u(H,"propertyIsEnumerable",Q,!0),d.f=function(e){return q(p(e))}),a(a.G+a.W+a.F*!z,{Symbol:N});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ne=0;te.length>ne;)p(te[ne++]);for(var re=P(p.store),ie=0;re.length>ie;)v(re[ie++]);a(a.S+a.F*!z,"Symbol",{for:function(e){return i(B,e+="")?B[e]:B[e]=N(e)},keyFor:function(e){if(!W(e))throw TypeError(e+" is not a symbol!");for(var t in B)if(B[t]===e)return t},useSetter:function(){V=!0},useSimple:function(){V=!1}}),a(a.S+a.F*!z,"Object",{create:function(e,t){return void 0===t?_(e):Y(_(e),t)},defineProperty:Z,defineProperties:Y,getOwnPropertyDescriptor:$,getOwnPropertyNames:X,getOwnPropertySymbols:ee});var oe=s((function(){R.f(1)}));a(a.S+a.F*oe,"Object",{getOwnPropertySymbols:function(e){return R.f(w(e))}}),j&&a(a.S+a.F*(!z||s((function(){var e=N();return"[null]"!=I([e])||"{}"!=I({a:e})||"{}"!=I(Object(e))}))),"JSON",{stringify:function(e){for(var t,n,r=[e],i=1;arguments.length>i;)r.push(arguments[i++]);if(n=t=r[1],(b(t)||void 0!==e)&&!W(e))return g(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!W(t))return t}),r[1]=t,I.apply(j,r)}}),N.prototype[F]||n(40)(N.prototype,F,N.prototype.valueOf),f(N,"Symbol"),f(Math,"Math",!0),f(r.JSON,"JSON",!0)},function(e,t,n){e.exports=n(97)("native-function-to-string",Function.toString)},function(e,t,n){var r=n(74),i=n(108),o=n(99);e.exports=function(e){var t=r(e),n=i.f;if(n)for(var a,u=n(e),c=o.f,s=0;u.length>s;)c.call(e,a=u[s++])&&t.push(a);return t}},function(e,t,n){var r=n(2);r(r.S,"Object",{create:n(76)})},function(e,t,n){var r=n(2);r(r.S+r.F*!n(29),"Object",{defineProperty:n(31).f})},function(e,t,n){var r=n(2);r(r.S+r.F*!n(29),"Object",{defineProperties:n(162)})},function(e,t,n){var r=n(45),i=n(46).f;n(59)("getOwnPropertyDescriptor",(function(){return function(e,t){return i(r(e),t)}}))},function(e,t,n){var r=n(32),i=n(47);n(59)("getPrototypeOf",(function(){return function(e){return i(r(e))}}))},function(e,t,n){var r=n(32),i=n(74);n(59)("keys",(function(){return function(e){return i(r(e))}}))},function(e,t,n){n(59)("getOwnPropertyNames",(function(){return n(163).f}))},function(e,t,n){var r=n(25),i=n(68).onFreeze;n(59)("freeze",(function(e){return function(t){return e&&r(t)?e(i(t)):t}}))},function(e,t,n){var r=n(25),i=n(68).onFreeze;n(59)("seal",(function(e){return function(t){return e&&r(t)?e(i(t)):t}}))},function(e,t,n){var r=n(25),i=n(68).onFreeze;n(59)("preventExtensions",(function(e){return function(t){return e&&r(t)?e(i(t)):t}}))},function(e,t,n){var r=n(25);n(59)("isFrozen",(function(e){return function(t){return!r(t)||!!e&&e(t)}}))},function(e,t,n){var r=n(25);n(59)("isSealed",(function(e){return function(t){return!r(t)||!!e&&e(t)}}))},function(e,t,n){var r=n(25);n(59)("isExtensible",(function(e){return function(t){return!!r(t)&&(!e||e(t))}}))},function(e,t,n){var r=n(2);r(r.S+r.F,"Object",{assign:n(164)})},function(e,t,n){var r=n(2);r(r.S,"Object",{is:n(165)})},function(e,t,n){var r=n(2);r(r.S,"Object",{setPrototypeOf:n(134).set})},function(e,t,n){"use strict";var r=n(91),i={};i[n(27)("toStringTag")]="z",i+""!="[object z]"&&n(41)(Object.prototype,"toString",(function(){return"[object "+r(this)+"]"}),!0)},function(e,t,n){var r=n(2);r(r.P,"Function",{bind:n(166)})},function(e,t,n){var r=n(31).f,i=Function.prototype,o=/^\s*function ([^ (]*)/;"name"in i||n(29)&&r(i,"name",{configurable:!0,get:function(){try{return(""+this).match(o)[1]}catch(e){return""}}})},function(e,t,n){"use strict";var r=n(25),i=n(47),o=n(27)("hasInstance"),a=Function.prototype;o in a||n(31).f(a,o,{value:function(e){if("function"!=typeof this||!r(e))return!1;if(!r(this.prototype))return e instanceof this;for(;e=i(e);)if(this.prototype===e)return!0;return!1}})},function(e,t,n){var r=n(2),i=n(168);r(r.G+r.F*(parseInt!=i),{parseInt:i})},function(e,t,n){var r=n(2),i=n(169);r(r.G+r.F*(parseFloat!=i),{parseFloat:i})},function(e,t,n){"use strict";var r=n(17),i=n(44),o=n(51),a=n(136),u=n(57),c=n(22),s=n(77).f,l=n(46).f,f=n(31).f,h=n(92).trim,p=r.Number,d=p,v=p.prototype,y="Number"==o(n(76)(v)),g="trim"in String.prototype,m=function(e){var t=u(e,!1);if("string"==typeof t&&t.length>2){var n,r,i,o=(t=g?t.trim():h(t,3)).charCodeAt(0);if(43===o||45===o){if(88===(n=t.charCodeAt(2))||120===n)return NaN}else if(48===o){switch(t.charCodeAt(1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+t}for(var a,c=t.slice(2),s=0,l=c.length;s<l;s++)if((a=c.charCodeAt(s))<48||a>i)return NaN;return parseInt(c,r)}}return+t};if(!p(" 0o1")||!p("0b1")||p("+0x1")){p=function(e){var t=arguments.length<1?0:e,n=this;return n instanceof p&&(y?c((function(){v.valueOf.call(n)})):"Number"!=o(n))?a(new d(m(t)),n,p):m(t)};for(var b,w=n(29)?s(d):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),k=0;w.length>k;k++)i(d,b=w[k])&&!i(p,b)&&f(p,b,l(d,b));p.prototype=v,v.constructor=p,n(41)(r,"Number",p)}},function(e,t,n){"use strict";var r=n(2),i=n(52),o=n(170),a=n(137),u=1..toFixed,c=Math.floor,s=[0,0,0,0,0,0],l="Number.toFixed: incorrect invocation!",f=function(e,t){for(var n=-1,r=t;++n<6;)r+=e*s[n],s[n]=r%1e7,r=c(r/1e7)},h=function(e){for(var t=6,n=0;--t>=0;)n+=s[t],s[t]=c(n/e),n=n%e*1e7},p=function(){for(var e=6,t="";--e>=0;)if(""!==t||0===e||0!==s[e]){var n=String(s[e]);t=""===t?n:t+a.call("0",7-n.length)+n}return t},d=function(e,t,n){return 0===t?n:t%2==1?d(e,t-1,n*e):d(e*e,t/2,n)};r(r.P+r.F*(!!u&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!n(22)((function(){u.call({})}))),"Number",{toFixed:function(e){var t,n,r,u,c=o(this,l),s=i(e),v="",y="0";if(s<0||s>20)throw RangeError(l);if(c!=c)return"NaN";if(c<=-1e21||c>=1e21)return String(c);if(c<0&&(v="-",c=-c),c>1e-21)if(n=(t=function(e){for(var t=0,n=e;n>=4096;)t+=12,n/=4096;for(;n>=2;)t+=1,n/=2;return t}(c*d(2,69,1))-69)<0?c*d(2,-t,1):c/d(2,t,1),n*=4503599627370496,(t=52-t)>0){for(f(0,n),r=s;r>=7;)f(1e7,0),r-=7;for(f(d(10,r,1),0),r=t-1;r>=23;)h(1<<23),r-=23;h(1<<r),f(1,1),h(2),y=p()}else f(0,n),f(1<<-t,0),y=p()+a.call("0",s);return y=s>0?v+((u=y.length)<=s?"0."+a.call("0",s-u)+y:y.slice(0,u-s)+"."+y.slice(u-s)):v+y}})},function(e,t,n){"use strict";var r=n(2),i=n(22),o=n(170),a=1..toPrecision;r(r.P+r.F*(i((function(){return"1"!==a.call(1,void 0)}))||!i((function(){a.call({})}))),"Number",{toPrecision:function(e){var t=o(this,"Number#toPrecision: incorrect invocation!");return void 0===e?a.call(t):a.call(t,e)}})},function(e,t,n){var r=n(2);r(r.S,"Number",{EPSILON:Math.pow(2,-52)})},function(e,t,n){var r=n(2),i=n(17).isFinite;r(r.S,"Number",{isFinite:function(e){return"number"==typeof e&&i(e)}})},function(e,t,n){var r=n(2);r(r.S,"Number",{isInteger:n(171)})},function(e,t,n){var r=n(2);r(r.S,"Number",{isNaN:function(e){return e!=e}})},function(e,t,n){var r=n(2),i=n(171),o=Math.abs;r(r.S,"Number",{isSafeInteger:function(e){return i(e)&&o(e)<=9007199254740991}})},function(e,t,n){var r=n(2);r(r.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(e,t,n){var r=n(2);r(r.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(e,t,n){var r=n(2),i=n(169);r(r.S+r.F*(Number.parseFloat!=i),"Number",{parseFloat:i})},function(e,t,n){var r=n(2),i=n(168);r(r.S+r.F*(Number.parseInt!=i),"Number",{parseInt:i})},function(e,t,n){var r=n(2),i=n(172),o=Math.sqrt,a=Math.acosh;r(r.S+r.F*!(a&&710==Math.floor(a(Number.MAX_VALUE))&&a(1/0)==1/0),"Math",{acosh:function(e){return(e=+e)<1?NaN:e>94906265.62425156?Math.log(e)+Math.LN2:i(e-1+o(e-1)*o(e+1))}})},function(e,t,n){var r=n(2),i=Math.asinh;r(r.S+r.F*!(i&&1/i(0)>0),"Math",{asinh:function e(t){return isFinite(t=+t)&&0!=t?t<0?-e(-t):Math.log(t+Math.sqrt(t*t+1)):t}})},function(e,t,n){var r=n(2),i=Math.atanh;r(r.S+r.F*!(i&&1/i(-0)<0),"Math",{atanh:function(e){return 0==(e=+e)?e:Math.log((1+e)/(1-e))/2}})},function(e,t,n){var r=n(2),i=n(138);r(r.S,"Math",{cbrt:function(e){return i(e=+e)*Math.pow(Math.abs(e),1/3)}})},function(e,t,n){var r=n(2);r(r.S,"Math",{clz32:function(e){return(e>>>=0)?31-Math.floor(Math.log(e+.5)*Math.LOG2E):32}})},function(e,t,n){var r=n(2),i=Math.exp;r(r.S,"Math",{cosh:function(e){return(i(e=+e)+i(-e))/2}})},function(e,t,n){var r=n(2),i=n(139);r(r.S+r.F*(i!=Math.expm1),"Math",{expm1:i})},function(e,t,n){var r=n(2);r(r.S,"Math",{fround:n(173)})},function(e,t,n){var r=n(2),i=Math.abs;r(r.S,"Math",{hypot:function(e,t){for(var n,r,o=0,a=0,u=arguments.length,c=0;a<u;)c<(n=i(arguments[a++]))?(o=o*(r=c/n)*r+1,c=n):o+=n>0?(r=n/c)*r:n;return c===1/0?1/0:c*Math.sqrt(o)}})},function(e,t,n){var r=n(2),i=Math.imul;r(r.S+r.F*n(22)((function(){return-5!=i(4294967295,5)||2!=i.length})),"Math",{imul:function(e,t){var n=+e,r=+t,i=65535&n,o=65535&r;return 0|i*o+((65535&n>>>16)*o+i*(65535&r>>>16)<<16>>>0)}})},function(e,t,n){var r=n(2);r(r.S,"Math",{log10:function(e){return Math.log(e)*Math.LOG10E}})},function(e,t,n){var r=n(2);r(r.S,"Math",{log1p:n(172)})},function(e,t,n){var r=n(2);r(r.S,"Math",{log2:function(e){return Math.log(e)/Math.LN2}})},function(e,t,n){var r=n(2);r(r.S,"Math",{sign:n(138)})},function(e,t,n){var r=n(2),i=n(139),o=Math.exp;r(r.S+r.F*n(22)((function(){return-2e-17!=!Math.sinh(-2e-17)})),"Math",{sinh:function(e){return Math.abs(e=+e)<1?(i(e)-i(-e))/2:(o(e-1)-o(-e-1))*(Math.E/2)}})},function(e,t,n){var r=n(2),i=n(139),o=Math.exp;r(r.S,"Math",{tanh:function(e){var t=i(e=+e),n=i(-e);return t==1/0?1:n==1/0?-1:(t-n)/(o(e)+o(-e))}})},function(e,t,n){var r=n(2);r(r.S,"Math",{trunc:function(e){return(e>0?Math.floor:Math.ceil)(e)}})},function(e,t,n){var r=n(2),i=n(75),o=String.fromCharCode,a=String.fromCodePoint;r(r.S+r.F*(!!a&&1!=a.length),"String",{fromCodePoint:function(e){for(var t,n=[],r=arguments.length,a=0;r>a;){if(t=+arguments[a++],i(t,1114111)!==t)throw RangeError(t+" is not a valid code point");n.push(t<65536?o(t):o(55296+((t-=65536)>>10),t%1024+56320))}return n.join("")}})},function(e,t,n){var r=n(2),i=n(45),o=n(28);r(r.S,"String",{raw:function(e){for(var t=i(e.raw),n=o(t.length),r=arguments.length,a=[],u=0;n>u;)a.push(String(t[u++])),u<r&&a.push(String(arguments[u]));return a.join("")}})},function(e,t,n){"use strict";n(92)("trim",(function(e){return function(){return e(this,3)}}))},function(e,t,n){"use strict";var r=n(110)(!0);n(140)(String,"String",(function(e){this._t=String(e),this._i=0}),(function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})}))},function(e,t,n){"use strict";var r=n(2),i=n(110)(!1);r(r.P,"String",{codePointAt:function(e){return i(this,e)}})},function(e,t,n){"use strict";var r=n(2),i=n(28),o=n(142),a="".endsWith;r(r.P+r.F*n(143)("endsWith"),"String",{endsWith:function(e){var t=o(this,e,"endsWith"),n=arguments.length>1?arguments[1]:void 0,r=i(t.length),u=void 0===n?r:Math.min(i(n),r),c=String(e);return a?a.call(t,c,u):t.slice(u-c.length,u)===c}})},function(e,t,n){"use strict";var r=n(2),i=n(142);r(r.P+r.F*n(143)("includes"),"String",{includes:function(e){return!!~i(this,e,"includes").indexOf(e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,n){var r=n(2);r(r.P,"String",{repeat:n(137)})},function(e,t,n){"use strict";var r=n(2),i=n(28),o=n(142),a="".startsWith;r(r.P+r.F*n(143)("startsWith"),"String",{startsWith:function(e){var t=o(this,e,"startsWith"),n=i(Math.min(arguments.length>1?arguments[1]:void 0,t.length)),r=String(e);return a?a.call(t,r,n):t.slice(n,n+r.length)===r}})},function(e,t,n){"use strict";n(42)("anchor",(function(e){return function(t){return e(this,"a","name",t)}}))},function(e,t,n){"use strict";n(42)("big",(function(e){return function(){return e(this,"big","","")}}))},function(e,t,n){"use strict";n(42)("blink",(function(e){return function(){return e(this,"blink","","")}}))},function(e,t,n){"use strict";n(42)("bold",(function(e){return function(){return e(this,"b","","")}}))},function(e,t,n){"use strict";n(42)("fixed",(function(e){return function(){return e(this,"tt","","")}}))},function(e,t,n){"use strict";n(42)("fontcolor",(function(e){return function(t){return e(this,"font","color",t)}}))},function(e,t,n){"use strict";n(42)("fontsize",(function(e){return function(t){return e(this,"font","size",t)}}))},function(e,t,n){"use strict";n(42)("italics",(function(e){return function(){return e(this,"i","","")}}))},function(e,t,n){"use strict";n(42)("link",(function(e){return function(t){return e(this,"a","href",t)}}))},function(e,t,n){"use strict";n(42)("small",(function(e){return function(){return e(this,"small","","")}}))},function(e,t,n){"use strict";n(42)("strike",(function(e){return function(){return e(this,"strike","","")}}))},function(e,t,n){"use strict";n(42)("sub",(function(e){return function(){return e(this,"sub","","")}}))},function(e,t,n){"use strict";n(42)("sup",(function(e){return function(){return e(this,"sup","","")}}))},function(e,t,n){var r=n(2);r(r.S,"Date",{now:function(){return(new Date).getTime()}})},function(e,t,n){"use strict";var r=n(2),i=n(32),o=n(57);r(r.P+r.F*n(22)((function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})})),"Date",{toJSON:function(e){var t=i(this),n=o(t);return"number"!=typeof n||isFinite(n)?t.toISOString():null}})},function(e,t,n){var r=n(2),i=n(277);r(r.P+r.F*(Date.prototype.toISOString!==i),"Date",{toISOString:i})},function(e,t,n){"use strict";var r=n(22),i=Date.prototype.getTime,o=Date.prototype.toISOString,a=function(e){return e>9?e:"0"+e};e.exports=r((function(){return"0385-07-25T07:06:39.999Z"!=o.call(new Date(-50000000000001))}))||!r((function(){o.call(new Date(NaN))}))?function(){if(!isFinite(i.call(this)))throw RangeError("Invalid time value");var e=this,t=e.getUTCFullYear(),n=e.getUTCMilliseconds(),r=t<0?"-":t>9999?"+":"";return r+("00000"+Math.abs(t)).slice(r?-6:-4)+"-"+a(e.getUTCMonth()+1)+"-"+a(e.getUTCDate())+"T"+a(e.getUTCHours())+":"+a(e.getUTCMinutes())+":"+a(e.getUTCSeconds())+"."+(n>99?n:"0"+a(n))+"Z"}:o},function(e,t,n){var r=Date.prototype,i=r.toString,o=r.getTime;new Date(NaN)+""!="Invalid Date"&&n(41)(r,"toString",(function(){var e=o.call(this);return e==e?i.call(this):"Invalid Date"}))},function(e,t,n){var r=n(27)("toPrimitive"),i=Date.prototype;r in i||n(40)(i,r,n(280))},function(e,t,n){"use strict";var r=n(13),i=n(57);e.exports=function(e){if("string"!==e&&"number"!==e&&"default"!==e)throw TypeError("Incorrect hint");return i(r(this),"number"!=e)}},function(e,t,n){var r=n(2);r(r.S,"Array",{isArray:n(109)})},function(e,t,n){"use strict";var r=n(50),i=n(2),o=n(32),a=n(174),u=n(144),c=n(28),s=n(145),l=n(146);i(i.S+i.F*!n(112)((function(e){Array.from(e)})),"Array",{from:function(e){var t,n,i,f,h=o(e),p="function"==typeof this?this:Array,d=arguments.length,v=d>1?arguments[1]:void 0,y=void 0!==v,g=0,m=l(h);if(y&&(v=r(v,d>2?arguments[2]:void 0,2)),null==m||p==Array&&u(m))for(n=new p(t=c(h.length));t>g;g++)s(n,g,y?v(h[g],g):h[g]);else for(f=m.call(h),n=new p;!(i=f.next()).done;g++)s(n,g,y?a(f,v,[i.value,g],!0):i.value);return n.length=g,n}})},function(e,t,n){"use strict";var r=n(2),i=n(145);r(r.S+r.F*n(22)((function(){function e(){}return!(Array.of.call(e)instanceof e)})),"Array",{of:function(){for(var e=0,t=arguments.length,n=new("function"==typeof this?this:Array)(t);t>e;)i(n,e,arguments[e++]);return n.length=t,n}})},function(e,t,n){"use strict";var r=n(2),i=n(45),o=[].join;r(r.P+r.F*(n(98)!=Object||!n(53)(o)),"Array",{join:function(e){return o.call(i(this),void 0===e?",":e)}})},function(e,t,n){"use strict";var r=n(2),i=n(133),o=n(51),a=n(75),u=n(28),c=[].slice;r(r.P+r.F*n(22)((function(){i&&c.call(i)})),"Array",{slice:function(e,t){var n=u(this.length),r=o(this);if(t=void 0===t?n:t,"Array"==r)return c.call(this,e,t);for(var i=a(e,n),s=a(t,n),l=u(s-i),f=new Array(l),h=0;h<l;h++)f[h]="String"==r?this.charAt(i+h):this[i+h];return f}})},function(e,t,n){"use strict";var r=n(2),i=n(38),o=n(32),a=n(22),u=[].sort,c=[1,2,3];r(r.P+r.F*(a((function(){c.sort(void 0)}))||!a((function(){c.sort(null)}))||!n(53)(u)),"Array",{sort:function(e){return void 0===e?u.call(o(this)):u.call(o(this),i(e))}})},function(e,t,n){"use strict";var r=n(2),i=n(60)(0),o=n(53)([].forEach,!0);r(r.P+r.F*!o,"Array",{forEach:function(e){return i(this,e,arguments[1])}})},function(e,t,n){var r=n(25),i=n(109),o=n(27)("species");e.exports=function(e){var t;return i(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!i(t.prototype)||(t=void 0),r(t)&&null===(t=t[o])&&(t=void 0)),void 0===t?Array:t}},function(e,t,n){"use strict";var r=n(2),i=n(60)(1);r(r.P+r.F*!n(53)([].map,!0),"Array",{map:function(e){return i(this,e,arguments[1])}})},function(e,t,n){"use strict";var r=n(2),i=n(60)(2);r(r.P+r.F*!n(53)([].filter,!0),"Array",{filter:function(e){return i(this,e,arguments[1])}})},function(e,t,n){"use strict";var r=n(2),i=n(60)(3);r(r.P+r.F*!n(53)([].some,!0),"Array",{some:function(e){return i(this,e,arguments[1])}})},function(e,t,n){"use strict";var r=n(2),i=n(60)(4);r(r.P+r.F*!n(53)([].every,!0),"Array",{every:function(e){return i(this,e,arguments[1])}})},function(e,t,n){"use strict";var r=n(2),i=n(175);r(r.P+r.F*!n(53)([].reduce,!0),"Array",{reduce:function(e){return i(this,e,arguments.length,arguments[1],!1)}})},function(e,t,n){"use strict";var r=n(2),i=n(175);r(r.P+r.F*!n(53)([].reduceRight,!0),"Array",{reduceRight:function(e){return i(this,e,arguments.length,arguments[1],!0)}})},function(e,t,n){"use strict";var r=n(2),i=n(107)(!1),o=[].indexOf,a=!!o&&1/[1].indexOf(1,-0)<0;r(r.P+r.F*(a||!n(53)(o)),"Array",{indexOf:function(e){return a?o.apply(this,arguments)||0:i(this,e,arguments[1])}})},function(e,t,n){"use strict";var r=n(2),i=n(45),o=n(52),a=n(28),u=[].lastIndexOf,c=!!u&&1/[1].lastIndexOf(1,-0)<0;r(r.P+r.F*(c||!n(53)(u)),"Array",{lastIndexOf:function(e){if(c)return u.apply(this,arguments)||0;var t=i(this),n=a(t.length),r=n-1;for(arguments.length>1&&(r=Math.min(r,o(arguments[1]))),r<0&&(r=n+r);r>=0;r--)if(r in t&&t[r]===e)return r||0;return-1}})},function(e,t,n){var r=n(2);r(r.P,"Array",{copyWithin:n(176)}),n(69)("copyWithin")},function(e,t,n){var r=n(2);r(r.P,"Array",{fill:n(148)}),n(69)("fill")},function(e,t,n){"use strict";var r=n(2),i=n(60)(5),o=!0;"find"in[]&&Array(1).find((function(){o=!1})),r(r.P+r.F*o,"Array",{find:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),n(69)("find")},function(e,t,n){"use strict";var r=n(2),i=n(60)(6),o="findIndex",a=!0;o in[]&&Array(1)[o]((function(){a=!1})),r(r.P+r.F*a,"Array",{findIndex:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),n(69)(o)},function(e,t,n){n(78)("Array")},function(e,t,n){var r=n(17),i=n(136),o=n(31).f,a=n(77).f,u=n(111),c=n(100),s=r.RegExp,l=s,f=s.prototype,h=/a/g,p=/a/g,d=new s(h)!==h;if(n(29)&&(!d||n(22)((function(){return p[n(27)("match")]=!1,s(h)!=h||s(p)==p||"/a/i"!=s(h,"i")})))){s=function(e,t){var n=this instanceof s,r=u(e),o=void 0===t;return!n&&r&&e.constructor===s&&o?e:i(d?new l(r&&!o?e.source:e,t):l((r=e instanceof s)?e.source:e,r&&o?c.call(e):t),n?this:f,s)};for(var v=function(e){e in s||o(s,e,{configurable:!0,get:function(){return l[e]},set:function(t){l[e]=t}})},y=a(l),g=0;y.length>g;)v(y[g++]);f.constructor=s,s.prototype=f,n(41)(r,"RegExp",s)}n(78)("RegExp")},function(e,t,n){"use strict";n(179);var r=n(13),i=n(100),o=n(29),a=/./.toString,u=function(e){n(41)(RegExp.prototype,"toString",e,!0)};n(22)((function(){return"/a/b"!=a.call({source:"a",flags:"b"})}))?u((function(){var e=r(this);return"/".concat(e.source,"/","flags"in e?e.flags:!o&&e instanceof RegExp?i.call(e):void 0)})):"toString"!=a.name&&u((function(){return a.call(this)}))},function(e,t,n){"use strict";var r=n(13),i=n(28),o=n(151),a=n(113);n(114)("match",1,(function(e,t,n,u){return[function(n){var r=e(this),i=null==n?void 0:n[t];return void 0!==i?i.call(n,r):new RegExp(n)[t](String(r))},function(e){var t=u(n,e,this);if(t.done)return t.value;var c=r(e),s=String(this);if(!c.global)return a(c,s);var l=c.unicode;c.lastIndex=0;for(var f,h=[],p=0;null!==(f=a(c,s));){var d=String(f[0]);h[p]=d,""===d&&(c.lastIndex=o(s,i(c.lastIndex),l)),p++}return 0===p?null:h}]}))},function(e,t,n){"use strict";var r=n(13),i=n(32),o=n(28),a=n(52),u=n(151),c=n(113),s=Math.max,l=Math.min,f=Math.floor,h=/\$([$&`']|\d\d?|<[^>]*>)/g,p=/\$([$&`']|\d\d?)/g;n(114)("replace",2,(function(e,t,n,d){return[function(r,i){var o=e(this),a=null==r?void 0:r[t];return void 0!==a?a.call(r,o,i):n.call(String(o),r,i)},function(e,t){var i=d(n,e,this,t);if(i.done)return i.value;var f=r(e),h=String(this),p="function"==typeof t;p||(t=String(t));var y=f.global;if(y){var g=f.unicode;f.lastIndex=0}for(var m=[];;){var b=c(f,h);if(null===b)break;if(m.push(b),!y)break;""===String(b[0])&&(f.lastIndex=u(h,o(f.lastIndex),g))}for(var w,k="",S=0,O=0;O<m.length;O++){b=m[O];for(var _=String(b[0]),C=s(l(a(b.index),h.length),0),E=[],R=1;R<b.length;R++)E.push(void 0===(w=b[R])?w:String(w));var x=b.groups;if(p){var P=[_].concat(E,C,h);void 0!==x&&P.push(x);var T=String(t.apply(void 0,P))}else T=v(_,h,C,E,x,t);C>=S&&(k+=h.slice(S,C)+T,S=C+_.length)}return k+h.slice(S)}];function v(e,t,r,o,a,u){var c=r+e.length,s=o.length,l=p;return void 0!==a&&(a=i(a),l=h),n.call(u,l,(function(n,i){var u;switch(i.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,r);case"'":return t.slice(c);case"<":u=a[i.slice(1,-1)];break;default:var l=+i;if(0===l)return n;if(l>s){var h=f(l/10);return 0===h?n:h<=s?void 0===o[h-1]?i.charAt(1):o[h-1]+i.charAt(1):n}u=o[l-1]}return void 0===u?"":u}))}}))},function(e,t,n){"use strict";var r=n(13),i=n(165),o=n(113);n(114)("search",1,(function(e,t,n,a){return[function(n){var r=e(this),i=null==n?void 0:n[t];return void 0!==i?i.call(n,r):new RegExp(n)[t](String(r))},function(e){var t=a(n,e,this);if(t.done)return t.value;var u=r(e),c=String(this),s=u.lastIndex;i(s,0)||(u.lastIndex=0);var l=o(u,c);return i(u.lastIndex,s)||(u.lastIndex=s),null===l?-1:l.index}]}))},function(e,t,n){"use strict";var r=n(111),i=n(13),o=n(101),a=n(151),u=n(28),c=n(113),s=n(150),l=n(22),f=Math.min,h=[].push,p="length",d=!l((function(){RegExp(4294967295,"y")}));n(114)("split",2,(function(e,t,n,l){var v;return v="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1)[p]||2!="ab".split(/(?:ab)*/)[p]||4!=".".split(/(.?)(.?)/)[p]||".".split(/()()/)[p]>1||"".split(/.?/)[p]?function(e,t){var i=String(this);if(void 0===e&&0===t)return[];if(!r(e))return n.call(i,e,t);for(var o,a,u,c=[],l=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),f=0,d=void 0===t?4294967295:t>>>0,v=new RegExp(e.source,l+"g");(o=s.call(v,i))&&!((a=v.lastIndex)>f&&(c.push(i.slice(f,o.index)),o[p]>1&&o.index<i[p]&&h.apply(c,o.slice(1)),u=o[0][p],f=a,c[p]>=d));)v.lastIndex===o.index&&v.lastIndex++;return f===i[p]?!u&&v.test("")||c.push(""):c.push(i.slice(f)),c[p]>d?c.slice(0,d):c}:"0".split(void 0,0)[p]?function(e,t){return void 0===e&&0===t?[]:n.call(this,e,t)}:n,[function(n,r){var i=e(this),o=null==n?void 0:n[t];return void 0!==o?o.call(n,i,r):v.call(String(i),n,r)},function(e,t){var r=l(v,e,this,t,v!==n);if(r.done)return r.value;var s=i(e),h=String(this),p=o(s,RegExp),y=s.unicode,g=(s.ignoreCase?"i":"")+(s.multiline?"m":"")+(s.unicode?"u":"")+(d?"y":"g"),m=new p(d?s:"^(?:"+s.source+")",g),b=void 0===t?4294967295:t>>>0;if(0===b)return[];if(0===h.length)return null===c(m,h)?[h]:[];for(var w=0,k=0,S=[];k<h.length;){m.lastIndex=d?k:0;var O,_=c(m,d?h:h.slice(k));if(null===_||(O=f(u(m.lastIndex+(d?0:k)),h.length))===w)k=a(h,k,y);else{if(S.push(h.slice(w,k)),S.length===b)return S;for(var C=1;C<=_.length-1;C++)if(S.push(_[C]),S.length===b)return S;k=w=O}}return S.push(h.slice(w)),S}]}))},function(e,t,n){"use strict";var r,i,o,a,u=n(67),c=n(17),s=n(50),l=n(91),f=n(2),h=n(25),p=n(38),d=n(79),v=n(80),y=n(101),g=n(152).set,m=n(153)(),b=n(154),w=n(180),k=n(115),S=n(181),O=c.TypeError,_=c.process,C=_&&_.versions,E=C&&C.v8||"",R=c.Promise,x="process"==l(_),P=function(){},T=i=b.f,M=!!function(){try{var e=R.resolve(1),t=(e.constructor={})[n(27)("species")]=function(e){e(P,P)};return(x||"function"==typeof PromiseRejectionEvent)&&e.then(P)instanceof t&&0!==E.indexOf("6.6")&&-1===k.indexOf("Chrome/66")}catch(e){}}(),A=function(e){var t;return!(!h(e)||"function"!=typeof(t=e.then))&&t},N=function(e,t){if(!e._n){e._n=!0;var n=e._c;m((function(){for(var r=e._v,i=1==e._s,o=0,a=function(t){var n,o,a,u=i?t.ok:t.fail,c=t.resolve,s=t.reject,l=t.domain;try{u?(i||(2==e._h&&L(e),e._h=1),!0===u?n=r:(l&&l.enter(),n=u(r),l&&(l.exit(),a=!0)),n===t.promise?s(O("Promise-chain cycle")):(o=A(n))?o.call(n,c,s):c(n)):s(r)}catch(e){l&&!a&&l.exit(),s(e)}};n.length>o;)a(n[o++]);e._c=[],e._n=!1,t&&!e._h&&j(e)}))}},j=function(e){g.call(c,(function(){var t,n,r,i=e._v,o=I(e);if(o&&(t=w((function(){x?_.emit("unhandledRejection",i,e):(n=c.onunhandledrejection)?n({promise:e,reason:i}):(r=c.console)&&r.error&&r.error("Unhandled promise rejection",i)})),e._h=x||I(e)?2:1),e._a=void 0,o&&t.e)throw t.v}))},I=function(e){return 1!==e._h&&0===(e._a||e._c).length},L=function(e){g.call(c,(function(){var t;x?_.emit("rejectionHandled",e):(t=c.onrejectionhandled)&&t({promise:e,reason:e._v})}))},F=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),N(t,!0))},D=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw O("Promise can't be resolved itself");(t=A(e))?m((function(){var r={_w:n,_d:!1};try{t.call(e,s(D,r,1),s(F,r,1))}catch(e){F.call(r,e)}})):(n._v=e,n._s=1,N(n,!1))}catch(e){F.call({_w:n,_d:!1},e)}}};M||(R=function(e){d(this,R,"Promise","_h"),p(e),r.call(this);try{e(s(D,this,1),s(F,this,1))}catch(e){F.call(this,e)}},(r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=n(81)(R.prototype,{then:function(e,t){var n=T(y(this,R));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=x?_.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&N(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),o=function(){var e=new r;this.promise=e,this.resolve=s(D,e,1),this.reject=s(F,e,1)},b.f=T=function(e){return e===R||e===a?new o(e):i(e)}),f(f.G+f.W+f.F*!M,{Promise:R}),n(90)(R,"Promise"),n(78)("Promise"),a=n(49).Promise,f(f.S+f.F*!M,"Promise",{reject:function(e){var t=T(this);return(0,t.reject)(e),t.promise}}),f(f.S+f.F*(u||!M),"Promise",{resolve:function(e){return S(u&&this===a?R:this,e)}}),f(f.S+f.F*!(M&&n(112)((function(e){R.all(e).catch(P)}))),"Promise",{all:function(e){var t=this,n=T(t),r=n.resolve,i=n.reject,o=w((function(){var n=[],o=0,a=1;v(e,!1,(function(e){var u=o++,c=!1;n.push(void 0),a++,t.resolve(e).then((function(e){c||(c=!0,n[u]=e,--a||r(n))}),i)})),--a||r(n)}));return o.e&&i(o.v),n.promise},race:function(e){var t=this,n=T(t),r=n.reject,i=w((function(){v(e,!1,(function(e){t.resolve(e).then(n.resolve,r)}))}));return i.e&&r(i.v),n.promise}})},function(e,t,n){"use strict";var r=n(186),i=n(82);n(116)("WeakSet",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(e){return r.def(i(this,"WeakSet"),e,!0)}},r,!1,!0)},function(e,t,n){"use strict";var r=n(2),i=n(117),o=n(155),a=n(13),u=n(75),c=n(28),s=n(25),l=n(17).ArrayBuffer,f=n(101),h=o.ArrayBuffer,p=o.DataView,d=i.ABV&&l.isView,v=h.prototype.slice,y=i.VIEW;r(r.G+r.W+r.F*(l!==h),{ArrayBuffer:h}),r(r.S+r.F*!i.CONSTR,"ArrayBuffer",{isView:function(e){return d&&d(e)||s(e)&&y in e}}),r(r.P+r.U+r.F*n(22)((function(){return!new h(2).slice(1,void 0).byteLength})),"ArrayBuffer",{slice:function(e,t){if(void 0!==v&&void 0===t)return v.call(a(this),e);for(var n=a(this).byteLength,r=u(e,n),i=u(void 0===t?n:t,n),o=new(f(this,h))(c(i-r)),s=new p(this),l=new p(o),d=0;r<i;)l.setUint8(d++,s.getUint8(r++));return o}}),n(78)("ArrayBuffer")},function(e,t,n){var r=n(2);r(r.G+r.W+r.F*!n(117).ABV,{DataView:n(155).DataView})},function(e,t,n){n(65)("Int8",1,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},function(e,t,n){n(65)("Uint8",1,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},function(e,t,n){n(65)("Uint8",1,(function(e){return function(t,n,r){return e(this,t,n,r)}}),!0)},function(e,t,n){n(65)("Int16",2,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},function(e,t,n){n(65)("Uint16",2,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},function(e,t,n){n(65)("Int32",4,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},function(e,t,n){n(65)("Uint32",4,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},function(e,t,n){n(65)("Float32",4,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},function(e,t,n){n(65)("Float64",8,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},function(e,t,n){var r=n(2),i=n(38),o=n(13),a=(n(17).Reflect||{}).apply,u=Function.apply;r(r.S+r.F*!n(22)((function(){a((function(){}))})),"Reflect",{apply:function(e,t,n){var r=i(e),c=o(n);return a?a(r,t,c):u.call(r,t,c)}})},function(e,t,n){var r=n(2),i=n(76),o=n(38),a=n(13),u=n(25),c=n(22),s=n(166),l=(n(17).Reflect||{}).construct,f=c((function(){function e(){}return!(l((function(){}),[],e)instanceof e)})),h=!c((function(){l((function(){}))}));r(r.S+r.F*(f||h),"Reflect",{construct:function(e,t){o(e),a(t);var n=arguments.length<3?e:o(arguments[2]);if(h&&!f)return l(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var r=[null];return r.push.apply(r,t),new(s.apply(e,r))}var c=n.prototype,p=i(u(c)?c:Object.prototype),d=Function.apply.call(e,p,t);return u(d)?d:p}})},function(e,t,n){var r=n(31),i=n(2),o=n(13),a=n(57);i(i.S+i.F*n(22)((function(){Reflect.defineProperty(r.f({},1,{value:1}),1,{value:2})})),"Reflect",{defineProperty:function(e,t,n){o(e),t=a(t,!0),o(n);try{return r.f(e,t,n),!0}catch(e){return!1}}})},function(e,t,n){var r=n(2),i=n(46).f,o=n(13);r(r.S,"Reflect",{deleteProperty:function(e,t){var n=i(o(e),t);return!(n&&!n.configurable)&&delete e[t]}})},function(e,t,n){"use strict";var r=n(2),i=n(13),o=function(e){this._t=i(e),this._i=0;var t,n=this._k=[];for(t in e)n.push(t)};n(141)(o,"Object",(function(){var e,t=this._k;do{if(this._i>=t.length)return{value:void 0,done:!0}}while(!((e=t[this._i++])in this._t));return{value:e,done:!1}})),r(r.S,"Reflect",{enumerate:function(e){return new o(e)}})},function(e,t,n){var r=n(46),i=n(47),o=n(44),a=n(2),u=n(25),c=n(13);a(a.S,"Reflect",{get:function e(t,n){var a,s,l=arguments.length<3?t:arguments[2];return c(t)===l?t[n]:(a=r.f(t,n))?o(a,"value")?a.value:void 0!==a.get?a.get.call(l):void 0:u(s=i(t))?e(s,n,l):void 0}})},function(e,t,n){var r=n(46),i=n(2),o=n(13);i(i.S,"Reflect",{getOwnPropertyDescriptor:function(e,t){return r.f(o(e),t)}})},function(e,t,n){var r=n(2),i=n(47),o=n(13);r(r.S,"Reflect",{getPrototypeOf:function(e){return i(o(e))}})},function(e,t,n){var r=n(2);r(r.S,"Reflect",{has:function(e,t){return t in e}})},function(e,t,n){var r=n(2),i=n(13),o=Object.isExtensible;r(r.S,"Reflect",{isExtensible:function(e){return i(e),!o||o(e)}})},function(e,t,n){var r=n(2);r(r.S,"Reflect",{ownKeys:n(188)})},function(e,t,n){var r=n(2),i=n(13),o=Object.preventExtensions;r(r.S,"Reflect",{preventExtensions:function(e){i(e);try{return o&&o(e),!0}catch(e){return!1}}})},function(e,t,n){var r=n(31),i=n(46),o=n(47),a=n(44),u=n(2),c=n(72),s=n(13),l=n(25);u(u.S,"Reflect",{set:function e(t,n,u){var f,h,p=arguments.length<4?t:arguments[3],d=i.f(s(t),n);if(!d){if(l(h=o(t)))return e(h,n,u,p);d=c(0)}if(a(d,"value")){if(!1===d.writable||!l(p))return!1;if(f=i.f(p,n)){if(f.get||f.set||!1===f.writable)return!1;f.value=u,r.f(p,n,f)}else r.f(p,n,c(0,u));return!0}return void 0!==d.set&&(d.set.call(p,u),!0)}})},function(e,t,n){var r=n(2),i=n(134);i&&r(r.S,"Reflect",{setPrototypeOf:function(e,t){i.check(e,t);try{return i.set(e,t),!0}catch(e){return!1}}})},function(e,t,n){"use strict";var r=n(2),i=n(107)(!0);r(r.P,"Array",{includes:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),n(69)("includes")},function(e,t,n){"use strict";var r=n(2),i=n(189),o=n(32),a=n(28),u=n(38),c=n(147);r(r.P,"Array",{flatMap:function(e){var t,n,r=o(this);return u(e),t=a(r.length),n=c(r,0),i(n,r,r,t,0,1,e,arguments[1]),n}}),n(69)("flatMap")},function(e,t,n){"use strict";var r=n(2),i=n(189),o=n(32),a=n(28),u=n(52),c=n(147);r(r.P,"Array",{flatten:function(){var e=arguments[0],t=o(this),n=a(t.length),r=c(t,0);return i(r,t,t,n,0,void 0===e?1:u(e)),r}}),n(69)("flatten")},function(e,t,n){"use strict";var r=n(2),i=n(110)(!0),o=n(22)((function(){return"𠮷"!=="𠮷".at(0)}));r(r.P+r.F*o,"String",{at:function(e){return i(this,e)}})},function(e,t,n){"use strict";var r=n(2),i=n(190),o=n(115),a=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(o);r(r.P+r.F*a,"String",{padStart:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0,!0)}})},function(e,t,n){"use strict";var r=n(2),i=n(190),o=n(115),a=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(o);r(r.P+r.F*a,"String",{padEnd:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0,!1)}})},function(e,t,n){"use strict";n(92)("trimLeft",(function(e){return function(){return e(this,1)}}),"trimStart")},function(e,t,n){"use strict";n(92)("trimRight",(function(e){return function(){return e(this,2)}}),"trimEnd")},function(e,t,n){"use strict";var r=n(2),i=n(58),o=n(28),a=n(111),u=n(100),c=RegExp.prototype,s=function(e,t){this._r=e,this._s=t};n(141)(s,"RegExp String",(function(){var e=this._r.exec(this._s);return{value:e,done:null===e}})),r(r.P,"String",{matchAll:function(e){if(i(this),!a(e))throw TypeError(e+" is not a regexp!");var t=String(this),n="flags"in c?String(e.flags):u.call(e),r=new RegExp(e.source,~n.indexOf("g")?n:"g"+n);return r.lastIndex=o(e.lastIndex),new s(r,t)}})},function(e,t,n){n(130)("asyncIterator")},function(e,t,n){n(130)("observable")},function(e,t,n){var r=n(2),i=n(188),o=n(45),a=n(46),u=n(145);r(r.S,"Object",{getOwnPropertyDescriptors:function(e){for(var t,n,r=o(e),c=a.f,s=i(r),l={},f=0;s.length>f;)void 0!==(n=c(r,t=s[f++]))&&u(l,t,n);return l}})},function(e,t,n){var r=n(2),i=n(191)(!1);r(r.S,"Object",{values:function(e){return i(e)}})},function(e,t,n){var r=n(2),i=n(191)(!0);r(r.S,"Object",{entries:function(e){return i(e)}})},function(e,t,n){"use strict";var r=n(2),i=n(32),o=n(38),a=n(31);n(29)&&r(r.P+n(118),"Object",{__defineGetter__:function(e,t){a.f(i(this),e,{get:o(t),enumerable:!0,configurable:!0})}})},function(e,t,n){"use strict";var r=n(2),i=n(32),o=n(38),a=n(31);n(29)&&r(r.P+n(118),"Object",{__defineSetter__:function(e,t){a.f(i(this),e,{set:o(t),enumerable:!0,configurable:!0})}})},function(e,t,n){"use strict";var r=n(2),i=n(32),o=n(57),a=n(47),u=n(46).f;n(29)&&r(r.P+n(118),"Object",{__lookupGetter__:function(e){var t,n=i(this),r=o(e,!0);do{if(t=u(n,r))return t.get}while(n=a(n))}})},function(e,t,n){"use strict";var r=n(2),i=n(32),o=n(57),a=n(47),u=n(46).f;n(29)&&r(r.P+n(118),"Object",{__lookupSetter__:function(e){var t,n=i(this),r=o(e,!0);do{if(t=u(n,r))return t.set}while(n=a(n))}})},function(e,t,n){var r=n(2);r(r.P+r.R,"Map",{toJSON:n(192)("Map")})},function(e,t,n){var r=n(2);r(r.P+r.R,"Set",{toJSON:n(192)("Set")})},function(e,t,n){n(119)("Map")},function(e,t,n){n(119)("Set")},function(e,t,n){n(119)("WeakMap")},function(e,t,n){n(119)("WeakSet")},function(e,t,n){n(120)("Map")},function(e,t,n){n(120)("Set")},function(e,t,n){n(120)("WeakMap")},function(e,t,n){n(120)("WeakSet")},function(e,t,n){var r=n(2);r(r.G,{global:n(17)})},function(e,t,n){var r=n(2);r(r.S,"System",{global:n(17)})},function(e,t,n){var r=n(2),i=n(51);r(r.S,"Error",{isError:function(e){return"Error"===i(e)}})},function(e,t,n){var r=n(2);r(r.S,"Math",{clamp:function(e,t,n){return Math.min(n,Math.max(t,e))}})},function(e,t,n){var r=n(2);r(r.S,"Math",{DEG_PER_RAD:Math.PI/180})},function(e,t,n){var r=n(2),i=180/Math.PI;r(r.S,"Math",{degrees:function(e){return e*i}})},function(e,t,n){var r=n(2),i=n(194),o=n(173);r(r.S,"Math",{fscale:function(e,t,n,r,a){return o(i(e,t,n,r,a))}})},function(e,t,n){var r=n(2);r(r.S,"Math",{iaddh:function(e,t,n,r){var i=e>>>0,o=n>>>0;return(t>>>0)+(r>>>0)+((i&o|(i|o)&~(i+o>>>0))>>>31)|0}})},function(e,t,n){var r=n(2);r(r.S,"Math",{isubh:function(e,t,n,r){var i=e>>>0,o=n>>>0;return(t>>>0)-(r>>>0)-((~i&o|~(i^o)&i-o>>>0)>>>31)|0}})},function(e,t,n){var r=n(2);r(r.S,"Math",{imulh:function(e,t){var n=+e,r=+t,i=65535&n,o=65535&r,a=n>>16,u=r>>16,c=(a*o>>>0)+(i*o>>>16);return a*u+(c>>16)+((i*u>>>0)+(65535&c)>>16)}})},function(e,t,n){var r=n(2);r(r.S,"Math",{RAD_PER_DEG:180/Math.PI})},function(e,t,n){var r=n(2),i=Math.PI/180;r(r.S,"Math",{radians:function(e){return e*i}})},function(e,t,n){var r=n(2);r(r.S,"Math",{scale:n(194)})},function(e,t,n){var r=n(2);r(r.S,"Math",{umulh:function(e,t){var n=+e,r=+t,i=65535&n,o=65535&r,a=n>>>16,u=r>>>16,c=(a*o>>>0)+(i*o>>>16);return a*u+(c>>>16)+((i*u>>>0)+(65535&c)>>>16)}})},function(e,t,n){var r=n(2);r(r.S,"Math",{signbit:function(e){return(e=+e)!=e?e:0==e?1/e==1/0:e>0}})},function(e,t,n){"use strict";var r=n(2),i=n(49),o=n(17),a=n(101),u=n(181);r(r.P+r.R,"Promise",{finally:function(e){var t=a(this,i.Promise||o.Promise),n="function"==typeof e;return this.then(n?function(n){return u(t,e()).then((function(){return n}))}:e,n?function(n){return u(t,e()).then((function(){throw n}))}:e)}})},function(e,t,n){"use strict";var r=n(2),i=n(154),o=n(180);r(r.S,"Promise",{try:function(e){var t=i.f(this),n=o(e);return(n.e?t.reject:t.resolve)(n.v),t.promise}})},function(e,t,n){var r=n(66),i=n(13),o=r.key,a=r.set;r.exp({defineMetadata:function(e,t,n,r){a(e,t,i(n),o(r))}})},function(e,t,n){var r=n(66),i=n(13),o=r.key,a=r.map,u=r.store;r.exp({deleteMetadata:function(e,t){var n=arguments.length<3?void 0:o(arguments[2]),r=a(i(t),n,!1);if(void 0===r||!r.delete(e))return!1;if(r.size)return!0;var c=u.get(t);return c.delete(n),!!c.size||u.delete(t)}})},function(e,t,n){var r=n(66),i=n(13),o=n(47),a=r.has,u=r.get,c=r.key,s=function(e,t,n){if(a(e,t,n))return u(e,t,n);var r=o(t);return null!==r?s(e,r,n):void 0};r.exp({getMetadata:function(e,t){return s(e,i(t),arguments.length<3?void 0:c(arguments[2]))}})},function(e,t,n){var r=n(184),i=n(193),o=n(66),a=n(13),u=n(47),c=o.keys,s=o.key,l=function(e,t){var n=c(e,t),o=u(e);if(null===o)return n;var a=l(o,t);return a.length?n.length?i(new r(n.concat(a))):a:n};o.exp({getMetadataKeys:function(e){return l(a(e),arguments.length<2?void 0:s(arguments[1]))}})},function(e,t,n){var r=n(66),i=n(13),o=r.get,a=r.key;r.exp({getOwnMetadata:function(e,t){return o(e,i(t),arguments.length<3?void 0:a(arguments[2]))}})},function(e,t,n){var r=n(66),i=n(13),o=r.keys,a=r.key;r.exp({getOwnMetadataKeys:function(e){return o(i(e),arguments.length<2?void 0:a(arguments[1]))}})},function(e,t,n){var r=n(66),i=n(13),o=n(47),a=r.has,u=r.key,c=function(e,t,n){if(a(e,t,n))return!0;var r=o(t);return null!==r&&c(e,r,n)};r.exp({hasMetadata:function(e,t){return c(e,i(t),arguments.length<3?void 0:u(arguments[2]))}})},function(e,t,n){var r=n(66),i=n(13),o=r.has,a=r.key;r.exp({hasOwnMetadata:function(e,t){return o(e,i(t),arguments.length<3?void 0:a(arguments[2]))}})},function(e,t,n){var r=n(66),i=n(13),o=n(38),a=r.key,u=r.set;r.exp({metadata:function(e,t){return function(n,r){u(e,t,(void 0!==r?i:o)(n),a(r))}}})},function(e,t,n){var r=n(2),i=n(153)(),o=n(17).process,a="process"==n(51)(o);r(r.G,{asap:function(e){var t=a&&o.domain;i(t?t.bind(e):e)}})},function(e,t,n){"use strict";var r=n(2),i=n(17),o=n(49),a=n(153)(),u=n(27)("observable"),c=n(38),s=n(13),l=n(79),f=n(81),h=n(40),p=n(80),d=p.RETURN,v=function(e){return null==e?void 0:c(e)},y=function(e){var t=e._c;t&&(e._c=void 0,t())},g=function(e){return void 0===e._o},m=function(e){g(e)||(e._o=void 0,y(e))},b=function(e,t){s(e),this._c=void 0,this._o=e,e=new w(this);try{var n=t(e),r=n;null!=n&&("function"==typeof n.unsubscribe?n=function(){r.unsubscribe()}:c(n),this._c=n)}catch(t){return void e.error(t)}g(this)&&y(this)};b.prototype=f({},{unsubscribe:function(){m(this)}});var w=function(e){this._s=e};w.prototype=f({},{next:function(e){var t=this._s;if(!g(t)){var n=t._o;try{var r=v(n.next);if(r)return r.call(n,e)}catch(e){try{m(t)}finally{throw e}}}},error:function(e){var t=this._s;if(g(t))throw e;var n=t._o;t._o=void 0;try{var r=v(n.error);if(!r)throw e;e=r.call(n,e)}catch(e){try{y(t)}finally{throw e}}return y(t),e},complete:function(e){var t=this._s;if(!g(t)){var n=t._o;t._o=void 0;try{var r=v(n.complete);e=r?r.call(n,e):void 0}catch(e){try{y(t)}finally{throw e}}return y(t),e}}});var k=function(e){l(this,k,"Observable","_f")._f=c(e)};f(k.prototype,{subscribe:function(e){return new b(e,this._f)},forEach:function(e){var t=this;return new(o.Promise||i.Promise)((function(n,r){c(e);var i=t.subscribe({next:function(t){try{return e(t)}catch(e){r(e),i.unsubscribe()}},error:r,complete:n})}))}}),f(k,{from:function(e){var t="function"==typeof this?this:k,n=v(s(e)[u]);if(n){var r=s(n.call(e));return r.constructor===t?r:new t((function(e){return r.subscribe(e)}))}return new t((function(t){var n=!1;return a((function(){if(!n){try{if(p(e,!1,(function(e){if(t.next(e),n)return d}))===d)return}catch(e){if(n)throw e;return void t.error(e)}t.complete()}})),function(){n=!0}}))},of:function(){for(var e=0,t=arguments.length,n=new Array(t);e<t;)n[e]=arguments[e++];return new("function"==typeof this?this:k)((function(e){var t=!1;return a((function(){if(!t){for(var r=0;r<n.length;++r)if(e.next(n[r]),t)return;e.complete()}})),function(){t=!0}}))}}),h(k.prototype,u,(function(){return this})),r(r.G,{Observable:k}),n(78)("Observable")},function(e,t,n){var r=n(17),i=n(2),o=n(115),a=[].slice,u=/MSIE .\./.test(o),c=function(e){return function(t,n){var r=arguments.length>2,i=!!r&&a.call(arguments,2);return e(r?function(){("function"==typeof t?t:Function(t)).apply(this,i)}:t,n)}};i(i.G+i.B+i.F*u,{setTimeout:c(r.setTimeout),setInterval:c(r.setInterval)})},function(e,t,n){var r=n(2),i=n(152);r(r.G+r.B,{setImmediate:i.set,clearImmediate:i.clear})},function(e,t,n){for(var r=n(149),i=n(74),o=n(41),a=n(17),u=n(40),c=n(93),s=n(27),l=s("iterator"),f=s("toStringTag"),h=c.Array,p={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},d=i(p),v=0;v<d.length;v++){var y,g=d[v],m=p[g],b=a[g],w=b&&b.prototype;if(w&&(w[l]||u(w,l,h),w[f]||u(w,f,g),c[g]=h,m))for(y in r)w[y]||o(w,y,r[y],!0)}},function(e,t,n){(function(t){!function(t){"use strict";var n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag",c="object"==typeof e,s=t.regeneratorRuntime;if(s)c&&(e.exports=s);else{(s=t.regeneratorRuntime=c?e.exports:{}).wrap=v;var l={},f={};f[o]=function(){return this};var h=Object.getPrototypeOf,p=h&&h(h(E([])));p&&p!==n&&r.call(p,o)&&(f=p);var d=b.prototype=g.prototype=Object.create(f);m.prototype=d.constructor=b,b.constructor=m,b[u]=m.displayName="GeneratorFunction",s.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},s.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u in e||(e[u]="GeneratorFunction")),e.prototype=Object.create(d),e},s.awrap=function(e){return{__await:e}},w(k.prototype),k.prototype[a]=function(){return this},s.AsyncIterator=k,s.async=function(e,t,n,r){var i=new k(v(e,t,n,r));return s.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},w(d),d[u]="Generator",d[o]=function(){return this},d.toString=function(){return"[object Generator]"},s.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},s.values=E,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var u=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(u&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),_(n),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;_(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:E(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}}}function v(e,t,n,r){var i=t&&t.prototype instanceof g?t:g,o=Object.create(i.prototype),a=new C(r||[]);return o._invoke=function(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return R()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var u=S(a,n);if(u){if(u===l)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=y(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}(e,n,a),o}function y(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function g(){}function m(){}function b(){}function w(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function k(e){function n(t,i,o,a){var u=y(e[t],e,i);if("throw"!==u.type){var c=u.arg,s=c.value;return s&&"object"==typeof s&&r.call(s,"__await")?Promise.resolve(s.__await).then((function(e){n("next",e,o,a)}),(function(e){n("throw",e,o,a)})):Promise.resolve(s).then((function(e){c.value=e,o(c)}),a)}a(u.arg)}var i;"object"==typeof t.process&&t.process.domain&&(n=t.process.domain.bind(n)),this._invoke=function(e,t){function r(){return new Promise((function(r,i){n(e,t,r,i)}))}return i=i?i.then(r,r):r()}}function S(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=y(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,l;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function _(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function E(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:R}}function R(){return{value:void 0,done:!0}}}("object"==typeof t?t:"object"==typeof window?window:"object"==typeof self?self:this)}).call(this,n(128))},function(e,t,n){n(396),e.exports=n(49).RegExp.escape},function(e,t,n){var r=n(2),i=n(397)(/[\\^$*+?.()|[\]{}]/g,"\\$&");r(r.S,"RegExp",{escape:function(e){return i(e)}})},function(e,t){e.exports=function(e,t){var n=t===Object(t)?function(e){return t[e]}:t;return function(t){return String(t).replace(e,n)}}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";n.r(t);var r=n(1),i=n.n(r),o=n(122),a=n(156),u=n(3),c=n(24),s=n(18),l=n(94),f=n(102),h=n(14),p=n(55),d=n(33),v=n(61);function y(e){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function b(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=k(e);if(t){var i=k(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return w(this,n)}}function w(e,t){return!t||"object"!==y(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}i.a.LogHandler;var S=n(87),O=n(48),_=n(4);function C(e){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function E(e,t){return(E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function R(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var i=P(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return x(this,n)}}function x(e,t){return!t||"object"!==C(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var T=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&E(e,t)}(n,e);var t=R(n);function n(e,r,i,o,a,u,c,s,l){var f;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),f=t.call(this,"FileChunk",null,l);var h=new FormData;return h.append("cid",e),h.append("domain",r),h.append("fileSize",o),h.append("lastModified",a),h.append("cursor",c),h.append("size",s),h.append("file",u,i),f.data=h,f}return n}(_.a),M=n(6);function A(e,t,n){return(A="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=L(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function N(e,t){return(N=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function j(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=L(e);if(t){var i=L(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I(this,n)}}function I(e,t){return!t||"object"!==F(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function L(e){return(L=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function F(e){return(F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function D(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function B(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function G(e,t,n){return t&&B(e.prototype,t),n&&B(e,n),e}var U=function(){function e(t,n){D(this,e),this.xhr=t,this.url=n,this.method="GET",this.headers=null,this.params=null,this.data=null,this.dataType="json",this.responseType="json"}return G(e,[{key:"setMethod",value:function(e){return this.method=e,this}},{key:"setHeader",value:function(e,t){return null==this.headers&&(this.headers=new O.a),this.headers.put(e,t),this}},{key:"setParams",value:function(e){return this.params=e,this}},{key:"setResponseType",value:function(e){this.responseType=e}},{key:"setData",value:function(e,t){return this.data=e,void 0!==t&&(this.dataType=t),this}},{key:"send",value:function(e){this.xhr.responseType=this.responseType;var t=null;if(null!=this.params){if("object"===F(this.params))for(var n in this.params)null==t?t=n+"="+encodeURIComponent(this.params[n]):t+="&"+n+"="+encodeURIComponent(this.params[n]);else t=this.params;t=this.url.indexOf("?")>0?"&"+t:"?"+t}if(void 0!==e){var r=this.xhr;r.onreadystatechange=function(){r.readyState===XMLHttpRequest.DONE&&e.call(null,r.status,r.response)}}var i=null==t?this.url:this.url+t;if(this.xhr.open(this.method,i,!0),null!=this.headers)for(var o=this.headers.keySet(),a=0;a<o.length;++a){var u=o[a],c=this.headers.get(u);this.xhr.setRequestHeader(u,c)}null!=this.data&&(this.data instanceof FormData?this.xhr.setRequestHeader("Content-Type","multipart/form-data"):this.xhr.setRequestHeader("Content-Type","application/json")),null!=this.data?this.xhr.send(this.data):this.xhr.send()}},{key:"getResponseHeader",value:function(e){return this.xhr.getResponseHeader(e)}}]),e}(),H=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&N(e,t)}(n,e);var t=j(n);function n(){return D(this,n),t.call(this,"Ajax")}return G(n,[{key:"open",value:function(){A(L(n.prototype),"open",this).call(this)}},{key:"close",value:function(){A(L(n.prototype),"close",this).call(this)}},{key:"isReady",value:function(){return!0}},{key:"send",value:function(e,t,r){var i=this,o=this.tokenCode.toString(),a=this.newRequest(e);if(t instanceof T)a.setMethod("POST").setParams({token:o,sn:t.sn}).setData(t.data),a.send((function(t,o){if(200==t){var a=_.a.create(o);a.state={code:M.a.OK,desc:"Ok"},void 0!==r&&r(i,e,a),A(L(n.prototype),"triggerListeners",i).call(i,e,a)}else void 0!==r&&r(i,e,null),A(L(n.prototype),"triggerListeners",i).call(i,e,null)}));else if(t instanceof _.a){if("GET"==t.name.toUpperCase()){var u={token:o,sn:t.sn};if(t.data)for(var c in t.data)u[c]=t.data[c];a.setMethod(t.name).setParams(u)}else a.setMethod(t.name).setParams({token:o,sn:t.sn}).setData(t.data);a.setResponseType(t.responseType),a.send((function(o,u){if(200==o){var c=null;(c=a.getResponseHeader("Content-Type").indexOf("octet-stream")>=0?new _.a(t.name,u,t.sn):_.a.create(u)).state={code:M.a.OK,desc:"Ok"},void 0!==r&&r(i,e,c),A(L(n.prototype),"triggerListeners",i).call(i,e,c)}else void 0!==r&&r(i,e,null),A(L(n.prototype),"triggerListeners",i).call(i,e,null)}))}}},{key:"newRequest",value:function(e){var t=null;return t=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),new U(t,e)}}]),n}(v.a);!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(H,"NAME","Ajax");var z=n(15),J=n(11),V=n(0),K=n(7),q=n(12),W=n(26),Z=n(85),Y=n(23),Q={Ready:"Ready",Uploading:"Uploading",UploadCompleted:"UploadCompleted",UploadFailed:"UploadFailed",Downloading:"Downloading",DownloadCompleted:"DownloadCompleted",DownloadFailed:"DownloadFailed",FileUpdated:"FileUpdated"},$=n(36),X="putFile",ee="getFile",te="getRoot",ne="insertFile",re="listDirs",ie="listFiles",oe="newDir",ae="deleteDir",ue="deleteFile",ce="listTrash",se="eraseTrash",le="emptyTrash",fe="restoreTrash",he="searchFile",pe="findFile",de="createSharingTag",ve="listSharingTags",ye="listTraces";function ge(e){return(ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function me(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function be(e,t,n){return(be="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Oe(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function we(e,t){return(we=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ke(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Oe(e);if(t){var i=Oe(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Se(this,n)}}function Se(e,t){return!t||"object"!==ge(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Oe(e){return(Oe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var _e=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&we(e,t)}(a,e);var t,n,r,o=ke(a);function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=o.call(this)).fileStorage=e,t}return t=a,(n=[{key:"onReceived",value:function(e,t,n){be(Oe(a.prototype),"onReceived",this).call(this,e,t,n),n.getStateCode()==M.a.OK?n.name==X&&this.fileStorage.triggerPutFile(n.data):i.a.Logger.w("FileStoragePipeListener","Pipeline error: "+n.name+" - "+n.getStateCode())}}])&&me(t.prototype,n),r&&me(t,r),a}($.a),Ce=n(95),Ee=n.n(Ce);function Re(e,t,n,r,i,o,a){try{var u=e[o](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,i)}function xe(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){Re(o,r,i,a,u,"next",e)}function u(e){Re(o,r,i,a,u,"throw",e)}a(void 0)}))}}function Pe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Te=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.domain=null,this.db=null,this.labelStore=null}var t,n,r;return t=e,(n=[{key:"open",value:function(e){if(null==this.db){i.a.Logger.d("FileStructStorage","Open file struct storage : "+e),this.domain=e;var t={name:"CubeFileStorage-"+e,version:1,stores:[{name:"label",keyPath:"fileCode",indexes:[{name:"fileCode",keyPath:"fileCode",unique:!0},{name:"id",keyPath:"id",unique:!0},{name:"ownerId",keyPath:"ownerId",unique:!1},{name:"fileName",keyPath:"fileName",unique:!1},{name:"expiryTime",keyPath:"expiryTime",unique:!1},{name:"fileType",keyPath:"fileType",unique:!1}]},{name:"config",keyPath:"item",indexes:[{name:"item",keyPath:"item",unique:!0}]}]};this.db=new Ee.a(t),this.labelStore=this.db.use("label")}}},{key:"close",value:function(){null!=this.db&&(i.a.Logger.d("FileStructStorage","Close file struct storage : "+this.domain),this.db.close(),this.db=null)}},{key:"readFileLabel",value:function(e,t){var n=this;return null!=this.db&&(xe(regeneratorRuntime.mark((function r(){var i,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.labelStore.query("fileCode",e);case 2:(i=r.sent).length>0?(i[0].domain=n.domain,o=Y.a.create(i[0]),t(e,o)):t(e,null);case 4:case"end":return r.stop()}}),r)})))(),!0)}},{key:"writeFileLabel",value:function(e){var t=this;return null!=this.db&&(xe(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return delete(r=e.toJSON()).domain,n.next=4,t.labelStore.put(r);case 4:case"end":return n.stop()}}),n)})))(),!0)}}])&&Pe(t.prototype,n),r&&Pe(t,r),e}(),Me=0,Ae=9,Ne=12,je=13,Ie=15,Le=17,Fe=101,De=104,Be=105,Ge=106;function Ue(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var He=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.dir=this.unpackDirectory(t.directory),this.trashTimestamp=void 0!==t.timestamp?t.timestamp:0,this.trashId=t.id}var t,n,r;return t=e,(n=[{key:"getId",value:function(){return this.trashId}},{key:"getDomain",value:function(){return this.dir.domain}},{key:"getParent",value:function(){return this.dir.parent}},{key:"isRoot",value:function(){return null==this.dir.parent}},{key:"getName",value:function(){return this.dir.name}},{key:"getCreation",value:function(){return this.dir.creation}},{key:"getLastModified",value:function(){return this.dir.lastModified}},{key:"getSize",value:function(){return this.dir.size}},{key:"isHidden",value:function(){return this.dir.hidden}},{key:"totalDirs",value:function(){return this.dir.numDirs}},{key:"totalFiles",value:function(){return this.dir.numFiles}},{key:"isFile",value:function(){return!1}},{key:"isDirectory",value:function(){return!0}},{key:"getTrashTimestamp",value:function(){return this.trashTimestamp}},{key:"unpackDirectory",value:function(e){var t=this,n=this.toDirectory(e);if(e.parent){var r=this.toDirectory(e.parent);n.parent=r}return e.dirs&&e.dirs.forEach((function(e){var r=t.unpackDirectory(e);n.addChild(r)})),e.files&&e.files.forEach((function(e){var t=Y.a.create(e);n.addFile(t)})),n}},{key:"toDirectory",value:function(e){var t=new tt(null);return t.id=e.id,t.domain=e.domain,t.name=e.name,t.creation=e.creation,t.lastModified=e.lastModified,t.size=e.size,t.hidden=e.hidden,t.numDirs=e.numDirs,t.numFiles=e.numFiles,t}}])&&Ue(t.prototype,n),r&&Ue(t,r),e}();function ze(e){return(ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Je(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ve(e,t){return(Ve=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ke(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=We(e);if(t){var i=We(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return qe(this,n)}}function qe(e,t){return!t||"object"!==ze(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function We(e){return(We=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ze=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ve(e,t)}(o,e);var t,n,r,i=Ke(o);function o(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),t=i.call(this,e.id,e.domain);var n=e.file;return t.fileCode=n.fileCode,t.ownerId=n.ownerId,t.fileName=n.fileName,t.fileSize=n.fileSize,t.lastModified=n.lastModified,t.completedTime=n.completed,t.expiryTime=n.expiry,t.fileType=n.fileType,t.md5Code=void 0!==n.md5?n.md5:null,t.sha1Code=void 0!==n.sha1?n.sha1:null,t.fileURL=void 0!==n.fileURL?n.fileURL:null,t.fileSecureURL=void 0!==n.fileSecureURL?n.fileSecureURL:null,t.trashTimestamp=e.timestamp,t}return t=o,(n=[{key:"isFile",value:function(){return!0}},{key:"isDirectory",value:function(){return!1}},{key:"getTrashTimestamp",value:function(){return this.trashTimestamp}}])&&Je(t.prototype,n),r&&Je(t,r),o}(Y.a);function Ye(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Qe=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.directory=t,this.file=n}var t,n,r;return t=e,(n=[{key:"equals",value:function(e){return e.directory.id==this.directory.id&&e.file.fileCode==this.file.fileCode}}])&&Ye(t.prototype,n),r&&Ye(t,r),e}();function $e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Xe=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.storage=t,this.root=null,this.dirMap=new O.a,this.searchResults=[]}var t,n,r;return t=e,(n=[{key:"getRoot",value:function(){return this.root}},{key:"uploadFile",value:function(e,t,n,r,o){var a=this,u=function(e){var n=new _.a(ne,{root:a.root.getId(),dirId:t.getId(),fileCode:e.fileCode});a.storage.pipeline.send(Rt.NAME,n,(function(n,a,u){if(null==u||u.getStateCode()!=M.a.OK){var c=new V.a(Rt.NAME,Ae,e);return i.a.Logger.w("FileHierarchy","#uploadFile() - "+c),void(o&&o(c))}if(u.getPayload().code!=Me){var s=new V.a(Rt.NAME,u.getPayload().code,e);return i.a.Logger.w("FileHierarchy","#uploadFile() - "+s),void(o&&o(s))}var l=u.getPayload().data.file,f=Y.a.create(l);t.addFile(f),t.numFiles+=1,r(t,f)}))};null==e?this.storage.uploadFileWithSelector(n,u,(function(e){i.a.Logger.w("FileHierarchy","#uploadFile() - "+e),o&&o(e)})):this.storage.uploadFile(e,n,u,(function(e){i.a.Logger.w("FileHierarchy","#uploadFile() - "+e),o&&o(e)}))}},{key:"getDirectory",value:function(e){var t=parseInt(e);return this.dirMap.get(t)}},{key:"getDirectoryByName",value:function(e){for(var t=this.dirMap.values(),n=0;n<t.length;++n){var r=t[n];if(r.name==e)return r}return null}},{key:"listDirectories",value:function(e,t,n){this.listDirs(e,t,n)}},{key:"listDirs",value:function(e,t,n){var r=this,i=new _.a(re,{root:this.root.id,id:e.id});this.storage.pipeline.send(Rt.NAME,i,(function(i,o,a){if(null!=a&&a.getStateCode()==M.a.OK)if(a.getPayload().code==Me){var u=a.getPayload().data.list;u.forEach((function(t){var n=tt.create(t,r);e.addChild(n)})),e.numDirs=u.length,t(e),r.dirMap.put(e.getId(),e)}else{var c=new V.a(Rt.NAME,a.getPayload().code,e);n(c)}else{var s=new V.a(Rt.NAME,Ae,e);n(s)}}))}},{key:"listFiles",value:function(e,t,n,r,i){var o=this,a=new _.a(ie,{root:this.root.id,id:e.id,begin:t,end:n});this.storage.pipeline.send(Rt.NAME,a,(function(t,n,a){if(null!=a&&a.getStateCode()==M.a.OK)if(a.getPayload().code==Me){var u=[],c=a.getPayload().data;c.list.forEach((function(t){var n=Y.a.create(t);e.addFile(n),u.push(n)})),r(e,u,c.begin,c.end),o.dirMap.put(e.getId(),e)}else{var s=new V.a(Rt.NAME,a.getPayload().code,e);i(s)}else{var l=new V.a(Rt.NAME,Ae,e);i(l)}}))}},{key:"newDirectory",value:function(e,t,n,r){var o=this,a=this._recurseRoot(e);if(a.getId()!=this.root.getId()){var u=new V.a(Rt.NAME,je,e);return i.a.Logger.w("FileHierarchy","#newDirectory() - "+u),void(r&&r(u))}var c=new _.a(oe,{root:a.getId(),workingId:e.getId(),dirName:t});this.storage.pipeline.send(Rt.NAME,c,(function(t,a,u){if(null==u||u.getStateCode()!=M.a.OK){var c=new V.a(Rt.NAME,Ae,e);return i.a.Logger.w("FileHierarchy","#newDirectory() - "+c),void(r&&r(c))}if(u.getPayload().code!=Me){var s=new V.a(Rt.NAME,u.getPayload().code,e);return i.a.Logger.w("FileHierarchy","#newDirectory() - "+s),void(r&&r(s))}var l=u.getPayload().data,f=tt.create(l,o);e.addChild(f),e.numDirs+=1,n(f),o.dirMap.put(e.getId(),e)}))}},{key:"deleteDirectory",value:function(e,t,n,r,o){var a=this,u=this._recurseRoot(e);if(u.getId()!=this.root.getId()){var c=new V.a(Rt.NAME,je,e);return i.a.Logger.w("FileHierarchy","#deleteDirectory() - "+c),void(o&&o(c))}var s=[],l=[];if(t instanceof Array){if(0==t.length)return;t.forEach((function(t){if("number"==typeof t||"string"==typeof t){var n=e.getDirectory(t);null!=n&&(s.push(n),l.push(n.getId()))}else if(t instanceof tt){var r=e.getDirectory(t.getId());null!=r&&(s.push(r),l.push(r.getId()))}}))}else if("number"==typeof t||"string"==typeof t){var f=e.getDirectory(t);null!=f&&(s.push(f),l.push(f.getId()))}else{if(!(t instanceof tt)){var h=new V.a(Rt.NAME,Ne,t);return i.a.Logger.w("FileHierarchy","#deleteDirectory() - "+h),void(o&&o(h))}var p=e.getDirectory(t.getId());null!=p&&(s.push(p),l.push(p.getId()))}if(0==s.length){var d=new V.a(Rt.NAME,je,t);return i.a.Logger.w("FileHierarchy","#deleteDirectory() - "+d),void(o&&o(d))}var v=new _.a(ae,{root:u.getId(),workingId:e.getId(),dirList:l,recursive:n});this.storage.pipeline.send(Rt.NAME,v,(function(n,u,c){if(null==c||c.getStateCode()!=M.a.OK){var l=new V.a(Rt.NAME,Ae,t);return i.a.Logger.w("FileHierarchy","#deleteDirectory() - "+l),void(o&&o(l))}if(c.getPayload().code!=Me){var f=new V.a(Rt.NAME,c.getPayload().code,t);return i.a.Logger.w("FileHierarchy","#deleteDirectory() - "+f),void(o&&o(f))}for(var h=c.getPayload().data.deletedList,p=function(e){for(var t=0;t<h.length;++t)if(h[t].id==e.id)return!0;return!1},d=[],v=0;v<s.length;++v){var y=s[v];p(y)&&(e.removeChild(y),d.push(y))}e.numDirs-=d.length,r(e,d),a.dirMap.put(e.getId(),e)}))}},{key:"deleteFiles",value:function(e,t,n,r){var o=this,a=this._recurseRoot(e);if(a.getId()!=this.root.getId()){var u=new V.a(Rt.NAME,je,e);return i.a.Logger.w("FileHierarchy","#deleteFiles() - "+u),void(r&&r(u))}var c=t instanceof Array?t:[t];if(0!=c.length){var s=new _.a(ue,{root:a.getId(),workingId:e.getId(),fileList:c});this.storage.pipeline.send(Rt.NAME,s,(function(a,u,c){if(null==c||c.getStateCode()!=M.a.OK){var s=new V.a(Rt.NAME,Ae,t);return i.a.Logger.w("FileHierarchy","#deleteFiles() - "+s),void(r&&r(s))}if(c.getPayload().code!=Me){var l=new V.a(Rt.NAME,c.getPayload().code,t);return i.a.Logger.w("FileHierarchy","#deleteFiles() - "+l),void(r&&r(l))}var f=c.getPayload().data.deletedList,h=[];f.forEach((function(t){var n=Y.a.create(t);e.removeFile(n),h.push(n)})),e.numFiles-=f.length,n(e,h),o.dirMap.put(e.getId(),e)}))}}},{key:"listTrash",value:function(e,t,n,r){var i=this,o=new _.a(ce,{root:this.root.id,begin:e,end:t});this.storage.pipeline.send(Rt.NAME,o,(function(e,t,o){if(null!=o&&o.getStateCode()==M.a.OK)if(o.getPayload().code==Me){var a=[],u=o.getPayload().data,c=u.begin,s=u.end;u.list.forEach((function(e){void 0!==e.directory?a.push(new He(e)):void 0!==e.file&&a.push(new Ze(e))})),n(i.root,a,c,s)}else{var l=new V.a(Rt.NAME,o.getPayload().code,i.root);r&&r(l)}else{var f=new V.a(Rt.NAME,Ae,i.root);r&&r(f)}}))}},{key:"eraseTrash",value:function(e,t,n){var r=this,o=[];e.forEach((function(e){o.push(parseInt(e))}));var a=new _.a(se,{root:this.root.id,list:o});this.storage.pipeline.send(Rt.NAME,a,(function(e,a,u){if(null==u||u.getStateCode()!=M.a.OK){var c=new V.a(Rt.NAME,Ae,o);return i.a.Logger.w("FileHierarchy","#eraseTrash() - "+c),void(n&&n(c))}if(u.getPayload().code!=Me){var s=new V.a(Rt.NAME,u.getPayload().code,o);return i.a.Logger.w("FileHierarchy","#eraseTrash() - "+s),void(n&&n(s))}t(r.root)}))}},{key:"emptyTrash",value:function(e,t){var n=this,r=new _.a(le,{root:this.root.id});this.storage.pipeline.send(Rt.NAME,r,(function(r,i,o){if(null!=o&&o.getStateCode()==M.a.OK)if(o.getPayload().code==Me)e(n.root);else{var a=new V.a(Rt.NAME,o.getPayload().code,n.root);t&&t(a)}else{var u=new V.a(Rt.NAME,Ae,n.root);t&&t(u)}}))}},{key:"restoreTrash",value:function(e,t,n){var r=this,o=[];e.forEach((function(e){o.push(parseInt(e))}));var a=new _.a(fe,{root:this.root.id,list:o});this.storage.pipeline.send(Rt.NAME,a,(function(e,a,u){if(null==u||u.getStateCode()!=M.a.OK){var c=new V.a(Rt.NAME,Ae,o);return i.a.Logger.w("FileHierarchy","#restoreTrash() - "+c),void(n&&n(c))}if(u.getPayload().code!=Me){var s=new V.a(Rt.NAME,u.getPayload().code,o);return i.a.Logger.w("FileHierarchy","#restoreTrash() - "+s),void(n&&n(s))}var l=u.getPayload().data;l.successList.forEach((function(e){if(e.parentId==r.root.id)if(e.file){var t=Y.a.create(e.file);r.root.addFile(t)}else if(e.directory){var n=tt.create(e.directory,r);r.root.addChild(n)}})),t(r.root,l)}))}},{key:"searchFile",value:function(e,t,n){var r=this,i=new _.a(he,{root:this.root.id,filter:e});this.storage.pipeline.send(Rt.NAME,i,(function(e,i,o){if(null!=o&&o.getStateCode()==M.a.OK)if(o.getPayload().code==Me){var a=o.getPayload().data,u=a.filter,c=a.result,s=[];c.forEach((function(e){var t=r._toDirectory(e.directory),n=Y.a.create(e.file),i=new Qe(t,n);s.push(i),r._putSearchItem(i)})),t(u,s)}else{var l=new V.a(Rt.NAME,o.getPayload().code,r.root);n&&n(l)}else{var f=new V.a(Rt.NAME,Ae,r.root);n&&n(f)}}))}},{key:"getSearchItem",value:function(e,t){for(var n=0;n<this.searchResults.length;++n){var r=this.searchResults[n];if(r.directory.id==e&&r.file.fileCode==t)return r}return null}},{key:"_recurseRoot",value:function(e){return null==e.parent?e:this._recurseRoot(e.parent)}},{key:"_toDirectory",value:function(e){var t=new tt(null);return t.id=e.id,t.domain=e.domain,t.name=e.name,t.creation=e.creation,t.lastModified=e.lastModified,t.size=e.size,t.hidden=e.hidden,t.numDirs=e.numDirs,t.numFiles=e.numFiles,e.parent&&(t.parent=this._toDirectory(e.parent),t.parentId=t.parent.id),t}},{key:"_putSearchItem",value:function(e){for(var t=0;t<this.searchResults.length;++t){var n=this.searchResults[t];if(e.equals(n))return}this.searchResults.push(e)}}])&&$e(t.prototype,n),r&&$e(t,r),e}();function et(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var tt=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.hierarchy=t,this.id=0,this.domain=null,this.ownerId=0,this.parentId=0,this.parent=null,this.name=null,this.creation=0,this.lastModified=0,this.hidden=!1,this.size=0,this.numDirs=0,this.children=new s.a,this.numFiles=0,this.files=new s.a}var t,n,r;return t=e,r=[{key:"create",value:function(t,n){var r=new e(n);if(r.ownerId=t.owner,r.id=t.id,r.domain=t.domain,r.name=t.name,r.creation=t.creation,r.lastModified=t.lastModified,r.size=t.size,r.hidden=t.hidden,r.numDirs=t.numDirs,r.numFiles=t.numFiles,void 0!==t.parentId&&(r.parentId=t.parentId),void 0!==t.dirs)for(var i=0;i<t.dirs.length;++i){var o=e.create(t.dirs[i],n);r.addChild(o)}return r}}],(n=[{key:"getId",value:function(){return this.id}},{key:"getDomain",value:function(){return this.domain}},{key:"getParent",value:function(){return this.parent}},{key:"isRoot",value:function(){return null==this.parent}},{key:"getName",value:function(){return this.name}},{key:"getCreation",value:function(){return this.creation}},{key:"getLastModified",value:function(){return this.lastModified}},{key:"getSize",value:function(){return this.size}},{key:"isHidden",value:function(){return this.hidden}},{key:"totalDirs",value:function(){return this.numDirs}},{key:"totalFiles",value:function(){return this.numFiles}},{key:"listDirectories",value:function(e,t){var n=this;this.numDirs!=this.children.size()?null!=this.hierarchy&&void 0!==this.hierarchy?this.hierarchy.listDirs(this,(function(t){e(n,n.children.values())}),(function(e){console.debug(e.toString()),t&&t(e)})):e(this,[]):e(this,this.children.values())}},{key:"getDirectory",value:function(e){return this.children.get(parseInt(e))}},{key:"getDirectoryByName",value:function(e){for(var t=this.children.values(),n=0;n<t.length;++n){var r=t[n];if(r.name==e)return r}return null}},{key:"uploadFile",value:function(e,t,n,r){this.hierarchy.uploadFile(e,this,t,n,r)}},{key:"uploadFileWithSelector",value:function(e,t,n){this.hierarchy.uploadFile(null,this,e,t,n)}},{key:"listFiles",value:function(e,t,n,r){if(this.numFiles!=this.files.size())null!=this.hierarchy&&void 0!==this.hierarchy?this.hierarchy.listFiles(this,e,t,(function(e,t,r,i){n(e,t,r,i)}),(function(e){r&&r(e)})):n(this,[],e,t);else{var i=e,o=t;if(o+1>this.numFiles&&(o=this.numFiles),i>=o)return void n(this,[]);var a=this.files.values().slice(i,o);n(this,a,e,t)}}},{key:"getFile",value:function(e){if("string"==typeof e)return this.files.get(e);for(var t=this.files.values(),n=0;n<t.length;++n){var r=t[n];if(r.id==e)return r}return null}},{key:"getFileByName",value:function(e){for(var t=this.files.values(),n=0;n<t.length;++n){var r=t[n];if(r.fileName==e)return r}return null}},{key:"newDirectory",value:function(e,t,n){this.hierarchy.newDirectory(this,e,t,n)}},{key:"deleteDirectory",value:function(e,t,n,r){this.hierarchy.deleteDirectory(this,e,t,n,r)}},{key:"deleteFiles",value:function(e,t,n){var r=this,i=[];e.forEach((function(e){"number"==typeof e?i.push(r.getFile(e).getFileCode()):i.push(e)})),this.hierarchy.deleteFiles(this,i,t,n)}},{key:"searchFile",value:function(e,t,n){this.hierarchy.searchFile(e,t,n)}},{key:"addChild",value:function(e){this.children.containsKey(e.id)&&this.removeChild(e),e.parent=this,this.children.put(e.id,e),this.hierarchy&&this.hierarchy.dirMap.put(e.id,e)}},{key:"removeChild",value:function(t){var n=t instanceof e?t.id:t;null!=this.children.remove(n)&&(t.parent=null)}},{key:"addFile",value:function(e){this.files.containsKey(e.getFileCode())||this.files.put(e.getFileCode(),e)}},{key:"removeFile",value:function(e){this.files.remove(e.getFileCode())}}])&&et(t.prototype,n),r&&et(t,r),e}(),nt=n(39);function rt(e){return(rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function it(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ot(e,t){return(ot=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function at(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ct(e);if(t){var i=ct(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ut(this,n)}}function ut(e,t){return!t||"object"!==rt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ct(e){return(ct=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var st=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ot(e,t)}(o,e);var t,n,r,i=at(o);function o(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(n=i.call(this,e)).code=t,n.expiryDate=0,n.creator=null,n.device=null,n.fileLabel=null,n.duration=0,n.password=null,n.preview=!1,n.download=!0,n.traceDownload=!0,n.httpURL=null,n.httpsURL=null,n.previewList=null,n}return t=o,r=[{key:"create",value:function(e){var t=new o(e.id,e.code);t.timestamp=e.timestamp,t.expiryDate=e.expiryDate,t.creator=void 0!==e.config.contact?K.a.create(e.config.contact):null,t.device=void 0!==e.config.device?nt.a.create(e.config.device):null,t.fileLabel=Y.a.create(e.config.fileLabel),t.duration=e.config.duration,t.password=void 0!==e.config.password?e.config.password:null,t.preview=e.config.preview,t.download=e.config.download,t.traceDownload=e.config.traceDownload,t.httpURL=void 0!==e.httpURL?e.httpURL:null,t.httpsURL=void 0!==e.httpsURL?e.httpsURL:null;var n=e.parent.string;return null==t.httpURL&&(t.httpURL="http://"+p.a.CONFIG.address+":7010/sharing/"+t.code+"?p="+n),null==t.httpsURL&&(t.httpsURL="https://"+p.a.CONFIG.address+":7017/sharing/"+t.code+"?p="+n),e.previewList&&(t.previewList=[],e.previewList.forEach((function(e){var n=Y.a.create(e);t.previewList.push(n)}))),t}}],(n=[{key:"getURL",value:function(){return document.URL.toLowerCase().startsWith("https")?this.httpsURL:this.httpURL}}])&&it(t.prototype,n),r&&it(t,r),o}(h.a);function lt(e){return(lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ft(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ht(e,t){return(ht=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function pt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=vt(e);if(t){var i=vt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return dt(this,n)}}function dt(e,t){return!t||"object"!==lt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function vt(e){return(vt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function yt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var gt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ht(e,t)}(o,e);var t,n,r,i=pt(o);function o(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(e=i.call(this)).platform=null,e.time=0,e.address=null,e.domain=null,e.url=null,e.title=null,e.screenSize={width:0,height:0},e.screenColorDepth=0,e.screenOrientation=null,e.userAgent=null,e.agent=null,e.language=null,e.event=null,e.eventTag=null,e.eventParam=null,e.contactId=0,e.contactDomain=null,e.sharerId=0,e.parentId=0,e}return t=o,r=[{key:"create",value:function(e){var t=new o;return t.platform=e.platform,t.time=e.time,t.address=e.address,t.url=e.url,t.domain=void 0!==e.domain?e.domain:null,t.title=void 0!==e.title?e.title:null,t.screenSize.width=e.screen.width,t.screenSize.height=e.screen.height,t.screenColorDepth=e.screen.colorDepth,t.screenOrientation=e.screen.orientation,t.language=e.language,t.userAgent=void 0!==e.userAgent?e.userAgent:null,t.agent=void 0!==e.agent?e.agent:null,t.event=void 0!==e.event?e.event:null,t.eventTag=void 0!==e.eventTag?e.eventTag:null,t.eventParam=void 0!==e.eventParam?e.eventParam:null,t.contactId=e.contactId,t.contactDomain=void 0!==e.contactDomain?e.contactDomain:null,t.sharerId=e.sharerId,t.parentId=e.parentId,t}}],(n=null)&&ft(t.prototype,n),r&&ft(t,r),o}(h.a);function mt(e){return(mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function bt(e,t,n,r,i,o,a){try{var u=e[o](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,i)}function wt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function kt(e,t,n){return(kt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Et(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function St(e,t){return(St=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ot(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Et(e);if(t){var i=Et(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return _t(this,n)}}function _t(e,t){return!t||"object"!==mt(t)&&"function"!=typeof t?Ct(e):t}function Ct(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Et(e){return(Et=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}yt(gt,"PlatformBrowser","Browser"),yt(gt,"PlatformAppletWeChat","AppletWeChat");var Rt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&St(e,t)}(a,e);var t,n,r,o=Ot(a);function a(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(e=o.call(this,"FileStorage")).require(J.a.NAME),e.contactService=null,e.fileLabels=new s.a,e.fileAnchors=new s.a,e.fileHierarchyMap=new s.a,e.secure=window.location.protocol.toLowerCase().indexOf("https")>=0,e.fileURL="https://cube.shixincube.com/filestorage/file/",e.block=524288,e.pipelineListener=new _e(Ct(e)),e.filePipeline=null,e.storage=new Te,e.serviceReady=!1,e}return t=a,(n=[{key:"start",value:function(){var e=this;return!!kt(Et(a.prototype),"start",this).call(this)&&(this.filePipeline=this.kernel.getPipeline(H.NAME),this.pipeline.addListener(a.NAME,this.pipelineListener),this.contactService=this.kernel.getModule(J.a.NAME),this.contactService.attach((function(t){e._fireContactEvent(t)})),this.storage.open(z.a.DOMAIN),this.contactService.isReady()&&(this.serviceReady=!0,setTimeout((function(){e.notifyObservers(new u.a(Q.Ready))}),0)),!0)}},{key:"stop",value:function(){kt(Et(a.prototype),"stop",this).call(this),null!=this.pipeline&&this.pipeline.removeListener(a.NAME,this.pipelineListener),this.storage.close()}},{key:"isReady",value:function(){return this.serviceReady}},{key:"config",value:function(e){this.secure?e.fileSecureURL&&(this.fileURL=e.fileSecureURL):e.fileURL&&(this.fileURL=e.fileURL)}},{key:"launchFileSelector",value:function(e,t){void 0===t&&(t="*.*");var n=document.querySelector("div#_cube_file_selector"),r=null;if(null==n){(n=document.createElement("div")).setAttribute("id","_cube_file_selector"),n.style.position="absolute",n.style.float="left",n.style.left="0",n.style.top="0",n.style.zIndex=-999,n.style.visibility="hidden";var i=['<label for="_cube_file_input"></label>','<input type="file" id="_cube_file_input" name="_cube_file_input" accept="',t,'"></input>'];n.innerHTML=i.join(""),document.body.appendChild(n)}(r=document.getElementById("_cube_file_input")).setAttribute("accept",t),r.onchange=function(t){var n=t.target.files[0];e(n)},r.click()}},{key:"findFile",value:function(e,t,n){var r={fileName:e.name,lastModified:e.lastModified,fileSize:e.size},i=new _.a(pe,r);this.pipeline.send(a.NAME,i,(function(r,i,o){if(null!=o&&o.getStateCode()==M.a.OK){var u=o.extractServiceStateCode();if(u==Me){var c=o.extractServiceData(),s=Y.a.create(c);t(s)}else{var l=new V.a(a.NAME,u,e);n(l)}}else{var f=new V.a(a.NAME,o.getStateCode(),e);n(f)}}))}},{key:"uploadFileWithSelector",value:function(e,t,n){var r=this;if(void 0!==window&&void 0!==document){var i=null,o=document.querySelector("div#cube_fs_selector");null==o?((o=document.createElement("div")).id="cube_fs_selector",o.style.position="absolute",o.style.float="left",o.style.left="0",o.style.top="0",o.style.visibility="hidden",o.style.zIndex="-999",o.innerHTML=['<label for="cube_fs_selector_file"></label>','<input id="cube_fs_selector_file" type="file" name="cube-select-file" accept="*.*" />'].join(""),document.body.appendChild(o),(i=o.querySelector("input#cube_fs_selector_file")).addEventListener("change",(function(i){var o=i.target.files[0];r.uploadFile(o,e,t,n)}))):i=o.querySelector("input#cube_fs_selector_file"),i.click()}else{var u=new V.a(a.NAME,Ie,null);n(u)}}},{key:"uploadFile",value:function(e,t,n,r){var o=this,c=e.size,s=new Z.a,l=new FileReader;return l.onload=function(t){s.position+=t.total,i.a.Logger.d(a.NAME,"Read: "+s+"/"+c),s.position<c||i.a.Logger.d(a.NAME,"Read completed: "+e.name)},s.fileName=e.name,s.fileSize=e.size,s.lastModified=e.lastModified,s.finishCallback=n,this._serialReadAndUpload(l,e,s,c,(function(e){if(null==e){s.fileCode=null,s.success=!1;var n=new V.a(a.NAME,De,s);r&&r(n);var i=new u.a(Q.UploadFailed,n);o.notifyObservers(i)}else{o.fileAnchors.put(s.fileCode,s),s.fileName=e.fileName,s.fileSize=e.fileSize,s.fileCode=e.fileCode,s.success=!0,t&&t(s);var c=new u.a(Q.UploadCompleted,s);o.notifyObservers(c),o._queryFileLabel(s,0,r)}}),(function(e){t&&t(e)})),s}},{key:"_queryFileLabel",value:function(e,t,n){var r=this,i=e.finishCallback;i&&this.getFileLabel(e.fileCode,(function(t){e.finishCallback=null,i(t),r.fileAnchors.remove(e.fileCode)}),(function(i){i.code==Le&&(t=0),t>5?n&&n(i):setTimeout((function(){var i=t+1;r._queryFileLabel(e,i,n)}),1e3)}))}},{key:"downloadFile",value:function(e){var t=this,n=function(e){var n=new _.a("GET",null);n.responseType="blob",t.notifyObservers(new u.a(Q.Downloading,e));var r=t.secure?e.getFileSecureURL():e.getFileURL();r+="&type=ignore",t.filePipeline.send(r,n,(function(n,r,i){var o=i.data,a=new FileReader;a.readAsDataURL(o),a.onload=function(n){t.notifyObservers(new u.a(Q.DownloadCompleted,e));var r=document.createElement("a");r.style.display="inline",r.style.position="absolute",r.style.cssFloat="left",r.style.visibility="hidden",r.download=e.getFileName(),r.href=n.target.result,document.body.appendChild(r),r.click(),r.parentElement.removeChild(r)}}))};e instanceof Y.a?n(e):this.getFileLabel(e,(function(e){n(e)}),(function(e){var n=new V.a(a.NAME,Be,e);t.notifyObservers(new u.a(Q.DownloadFailed,n))}))}},{key:"getFileURL",value:function(e,t){var n=this;if(this.started||this.start(),e instanceof Y.a){var r=[e.getFileURL(),"&token=",this.filePipeline.tokenCode],i=[e.getFileSecureURL(),"&token=",this.filePipeline.tokenCode];t(e,r.join(""),i.join(""))}else this.getFileLabel(e,(function(e){var r=[e.getFileURL(),"&token=",n.filePipeline.tokenCode],i=[e.getFileSecureURL(),"&token=",n.filePipeline.tokenCode];t(e,r.join(""),i.join(""))}),(function(e){t(fileLabel,null,null)}))}},{key:"getFileLabel",value:function(e,t,n){var r=this;this.started||this.start();var i=this.fileLabels.get(e);if(null==i){var o=function(){var i=new _.a(ee,{fileCode:e});r.pipeline.send(a.NAME,i,(function(i,o,u){if(null!=u&&u.getStateCode()==M.a.OK)if(0==u.getPayload().code){var c=Y.a.create(u.getPayload().data);r.storage.writeFileLabel(c),r.fileLabels.put(e,c),t(c)}else{var s=new V.a(a.NAME,u.getPayload().code,e);n&&n(s)}else{var l=new V.a(a.NAME,je,e);n&&n(l)}}))};this.storage.readFileLabel(e,(function(e,n){null!=n?(r.fileLabels.put(e,n),t(n)):o()}))}else t(i)}},{key:"getSelfRoot",value:function(e,t){var n=this;if(this.serviceReady)this.getRoot(this.contactService.getSelf().getId(),e,t);else var r=setTimeout((function(){clearTimeout(r),function e(t,r,i){if(n.serviceReady)n.getRoot(n.contactService.getSelf().getId(),r,i);else if(t>=10){var o=new V.a(a.NAME,Fe,null);i(o)}else var u=setTimeout((function(){clearTimeout(u),e(++t,r,i)}),500)}(1,e,t)}),500)}},{key:"getRoot",value:function(e,t,n){var r=this;if(this.started&&this.serviceReady){var o=0;if("number"==typeof e)o=e;else if(e instanceof q.a)o=e.getId();else if(e instanceof K.a)o=e.getId();else{if("string"!=typeof e){var u=new V.a(a.NAME,Ne,e);return void n(u)}o=parseInt(e)}var c=this.fileHierarchyMap.get(o);if(null==c){var s=new _.a(te,{id:o});this.pipeline.send(a.NAME,s,(function(e,u,c){if(null!=c&&c.getStateCode()==M.a.OK){if(c.getPayload().code!=Me){var s=new V.a(a.NAME,c.getPayload().code,o);return i.a.Logger.w("FileStorage","#getRoot() - "+s.toString()),void n(s)}var l=new Xe(r),f=tt.create(c.getPayload().data,l);l.root=f,r.fileHierarchyMap.put(f.getId(),l),t(f)}else{var h=new V.a(a.NAME,Ae,o);n(h)}}))}else t(c.getRoot())}else{var l=new V.a(a.NAME,Fe,e);n(l)}}},{key:"querySelfDirectory",value:function(e){var t=this.fileHierarchyMap.get(this.contactService.getSelf().getId());return null==t?null:t.getDirectory(e)}},{key:"newDirectory",value:function(e,t,n,r){var i=this,o=this._recurseRoot(e);this.getRoot(o.getId(),(function(o){i.fileHierarchyMap.get(o.getId()).newDirectory(e,t,n,r)}),(function(e){r&&r(e)}))}},{key:"deleteDirectory",value:function(e,t,n,r,i){var o=this,a=this._recurseRoot(e);this.getRoot(a.getId(),(function(a){o.fileHierarchyMap.get(a.getId()).deleteDirectory(e,t,n,r,i)}),(function(e){i&&i(e)}))}},{key:"renameDirectory",value:function(e,t,n,r,i){}},{key:"deleteFiles",value:function(e,t,n,r){var i=this,o=this._recurseRoot(e);this.getRoot(o.getId(),(function(o){i.fileHierarchyMap.get(o.getId()).deleteFiles(e,t,n,r)}),(function(e){r&&r(e)}))}},{key:"listTrash",value:function(e,t,n,r){var i=this;this.getSelfRoot((function(o){i.fileHierarchyMap.get(i.contactService.getSelf().getId()).listTrash(e,t,n,r)}),(function(e){r&&r(e)}))}},{key:"eraseTrash",value:function(e,t,n){var r=this;this.getSelfRoot((function(i){r.fileHierarchyMap.get(r.contactService.getSelf().getId()).eraseTrash(e,t,n)}),(function(e){n&&n(e)}))}},{key:"emptyTrash",value:function(e,t){var n=this;this.getSelfRoot((function(r){n.fileHierarchyMap.get(n.contactService.getSelf().getId()).emptyTrash(e,t)}),(function(e){t&&t(e)}))}},{key:"restoreTrash",value:function(e,t,n){var r=this;this.getSelfRoot((function(i){r.fileHierarchyMap.get(r.contactService.getSelf().getId()).restoreTrash(e,t,n)}),(function(e){n&&n(e)}))}},{key:"searchFile",value:function(e,t,n){var r=this;this.getSelfRoot((function(i){r.fileHierarchyMap.get(r.contactService.getSelf().getId()).searchFile(e,t,n)}),(function(e){n&&n(e)}))}},{key:"querySearch",value:function(e,t){var n=this.fileHierarchyMap.get(this.contactService.getSelf().getId());return null==n?null:n.getSearchItem(parseInt(e),t)}},{key:"createSharingTag",value:function(e,t,n,r){if(this.hasStarted())if(this.pipeline.isReady()){var i={fileCode:e.getFileCode(),duration:t.duration,preview:void 0!==t.preview&&t.preview,download:void 0===t.download||t.download,traceDownload:void 0===t.traceDownload||t.traceDownload};void 0!==t.password&&null!=t.password&&(i.password=password),void 0!==t.watermark&&null!=t.watermark&&(i.watermark=t.watermark);var o=new _.a(de,i);this.pipeline.send(a.NAME,o,(function(t,i,o){if(null!=o&&o.getStateCode()==M.a.OK){var u=o.extractServiceStateCode();if(u==Me){var c=o.extractServiceData(),s=st.create(c);n(s)}else{var l=new V.a(a.NAME,u,e);r(l)}}else{var f=new V.a(a.NAME,o.getStateCode(),e);r(f)}}))}else{var u=new V.a(a.NAME,Ge,e);r(u)}else{var c=new V.a(a.NAME,Fe,e);r(c)}}},{key:"listSharingTags",value:function(e,t,n,r,i){var o=this;if(t<e){var u=new V.a(a.NAME,Ie);i(u)}else if(this.hasStarted())if(this.pipeline.isReady()){var c=[],s=t-e;if(s>9){for(var l=Math.floor((s+1)/10),f=(s+1)%10,h=e,p=0;p<l;++p)h+=9,c.push(h),h+=1;0!=f&&(h+=f-1,c.push(h))}else c.push(t);var d=c.length,v=[],y=e;c.forEach((function(u){var c={begin:y,end:u,order:"desc",valid:n},s=new _.a(ve,c);o.pipeline.send(a.NAME,s,(function(o,u,c){if(--d,null!=c&&c.getStateCode()==M.a.OK){var s=c.extractServiceStateCode();if(s==Me){var l=c.extractServiceData();l.list.forEach((function(e){v.push(st.create(e))})),0==d&&(v.sort((function(e,t){return t.timestamp-e.timestamp})),r(v,l.total,e,t,n))}else{var f=new V.a(a.NAME,s);i(f)}}else{var h=new V.a(a.NAME,c.getStateCode());i(h)}})),y=u+1}))}else{var g=new V.a(a.NAME,Ge);i(g)}else{var m=new V.a(a.NAME,Fe);i(m)}}},{key:"listVisitTraces",value:function(e,t,n,r,i){var o=this;if(this.hasStarted())if(this.pipeline.isReady()){var u=[],c=n-t;if(c>9){for(var s=Math.floor((c+1)/10),l=(c+1)%10,f=t,h=0;h<s;++h)f+=9,u.push(f),f+=1;0!=l&&(f+=l-1,u.push(f))}else u.push(n);var p=u.length,d=[],v=t,y=0;u.forEach((function(u){var c={sharingCode:e,begin:v,end:u},s=new _.a(ye,c);o.pipeline.send(a.NAME,s,(function(o,u,c){if(--p,null!=c&&c.getStateCode()==M.a.OK){var s=c.extractServiceStateCode();if(s==Me){var l=c.extractServiceData();l.list.forEach((function(e){d.push(gt.create(e))})),0==y&&(y=l.total),0==p&&(d.sort((function(e,t){return t.time-e.time})),r(d,y,e,t,n))}else{var f=new V.a(a.NAME,s);i(f)}}else{var h=new V.a(a.NAME,c.getStateCode());i(h)}})),v=u+1}))}else{var g=new V.a(a.NAME,Ge,e);i(g)}else{var m=new V.a(a.NAME,Fe,e);i(m)}}},{key:"_recurseRoot",value:function(e){return null==e.parent?e:this._recurseRoot(e.parent)}},{key:"_serialReadAndUpload",value:function(e,t,n,r,o,c){var s,l=this;(s=regeneratorRuntime.mark((function s(){var f;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,l._readFileBlock(e,t,n);case 2:if(null!=(f=s.sent)){s.next=6;break}return o(null),s.abrupt("return");case 6:c(n),l._submit(f,(function(s){if(null==s)return i.a.Logger.e(a.NAME,"Upload failed: "+t.name),void o(null);var f=s.getPayload();if(0==f.code){i.a.Logger.d(a.NAME,"File cursor: "+n+"/"+r);var h=Z.a.create(f.data),p=new u.a(Q.Uploading,h);l.notifyObservers(p),n.position<r?setTimeout((function(){l._serialReadAndUpload(e,t,n,r,o,c)}),0):o(h)}else i.a.Logger.w(a.NAME,"Packet state code: "+f.code),o(null)}));case 8:case"end":return s.stop()}}),s)})),function(){var e=this,t=arguments;return new Promise((function(n,r){var i=s.apply(e,t);function o(e){bt(i,n,r,o,a,"next",e)}function a(e){bt(i,n,r,o,a,"throw",e)}o(void 0)}))})()}},{key:"_readFileBlock",value:function(e,t,n){var r=this;return new Promise((function(i,o){var a=null,u=n.position+r.block+1;t.slice?a=t.slice(n.position,u):t.webkitSlice?a=t.webkitSlice(n.position,u):t.mozSlice&&(a=t.mozSlice(n.position,u)),e.readAsBinaryString(a),i(new T(r.contactService.getSelf().getId(),r.getAuthToken().domain,t.name,t.size,t.lastModified,a,n.position,a.size))}))}},{key:"_submit",value:function(e,t){this.filePipeline.send(this.fileURL,e,(function(e,n,r){t(r)}))}},{key:"triggerPutFile",value:function(e,t){if(0==e.code){var n=null==t?Y.a.create(e.data):t;this.secure?i.a.Logger.d("FileStorage",'File "'+n.getFileName()+'" URL : '+n.getFileSecureURL()):i.a.Logger.d("FileStorage",'File "'+n.getFileName()+'" URL : '+n.getFileURL()),this.fileLabels.put(n.getFileCode(),n),this.storage.writeFileLabel(n);var r=this.fileAnchors.remove(n.getFileCode());null!=r&&r.finishCallback&&(r.finishCallback(n),r.finishCallback=null),this.notifyObservers(new u.a(Q.FileUpdated,n))}}},{key:"_fireContactEvent",value:function(e){var t=this;e.name==W.a.SignIn?(this.serviceReady=!0,setTimeout((function(){t.notifyObservers(new u.a(Q.Ready))}),0)):e.name==W.a.SignOut&&(this.fileHierarchyMap.clear(),this.serviceReady=!1)}}])&&wt(t.prototype,n),r&&wt(t,r),a}(d.a);!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(Rt,"NAME","FileStorage");var xt=n(37),Pt=n(19),Tt=n(21),Mt="push",At="pull",Nt="notify",jt="recall",It="delete",Lt="read",Ft="getConversations",Dt="updateConversation";function Bt(e){return(Bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Gt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ut(e,t,n){return(Ut="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Vt(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Ht(e,t){return(Ht=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function zt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Vt(e);if(t){var i=Vt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Jt(this,n)}}function Jt(e,t){return!t||"object"!==Bt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Vt(e){return(Vt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Kt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ht(e,t)}(a,e);var t,n,r,o=zt(a);function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=o.call(this)).messagingService=e,t}return t=a,(n=[{key:"onReceived",value:function(e,t,n){Ut(Vt(a.prototype),"onReceived",this).call(this,e,t,n),n.getStateCode()==M.a.OK?n.name==Nt?this.messagingService.triggerNotify(n.data):n.name==At?this.messagingService.triggerPull(n.data):n.name==Lt?this.messagingService.triggerRead(n.data):n.name==jt&&this.messagingService.triggerRecall(n.data):i.a.Logger.w("MessagingPipelineListener","Pipeline error: "+n.name+" - "+n.getStateCode())}},{key:"onOpened",value:function(e){Ut(Vt(a.prototype),"onOpened",this).call(this,e)}}])&&Gt(t.prototype,n),r&&Gt(t,r),a}($.a),qt={Ready:"Ready",Notify:"Notify",Sent:"Sent",Sending:"Sending",Processing:"Processing",Recall:"Recall",Delete:"Delete",Read:"Read",MarkOnlyOwner:"MarkOnlyOwner",SendBlocked:"SendBlocked",ReceiveBlocked:"ReceiveBlocked",ConversationUpdated:"ConversationUpdated",RemoteConversationsCompleted:"RemoteConversationsCompleted",Fault:"Fault",Unknown:"Unknown"},Wt={Ok:0,InvalidParameter:5,Failure:9,InvalidDomain:11,DataStructureError:12,NoDomain:13,NoDevice:14,NoContact:15,NoGroup:16,AttachmentError:17,GroupError:18,BeBlocked:30,Forbidden:101,IllegalOperation:103,DataTimeout:104,ServerFault:105,StorageNoData:106,PipelineFault:107,NoConversation:110,ConversationDisabled:111,Unknown:99},Zt={Contact:1,Group:2,Organization:3,System:4,Notifier:5,Assistant:6,Other:9,toString:function(e){switch(e){case 1:return"Contact";case 2:return"Group";case 3:return"Organization";case 4:return"System";case 5:return"Notifier";case 6:return"Assistant";default:return"Other"}}},Yt={Normal:1,Important:2,Deleted:3,Destroyed:4,toString:function(e){switch(e){case 1:return"Normal";case 2:return"Important";case 3:return"Deleted";case 4:return"Destroyed";default:return"?"}}},Qt={Normal:1,Closed:2,NotCare:3,Refused:4,toString:function(e){switch(e){case 1:return"Normal";case 2:return"Closed";case 3:return"NotCare";case 4:return"Refused";default:return"?"}}};function $t(e){return($t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Xt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function en(e,t,n){return(en="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=on(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function tn(e,t){return(tn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function nn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=on(e);if(t){var i=on(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return rn(this,n)}}function rn(e,t){return!t||"object"!==$t(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function on(e){return(on=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var an=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&tn(e,t)}(o,e);var t,n,r,i=nn(o);function o(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(n=i.call(this,e,t)).ownerId=0,n.type=Zt.Other,n.state=Yt.Normal,n.reminding=Qt.Normal,n.pivotalId=0,n.pivotal=null,n.unread=0,n.recentMessage=null,n.avatarURL=null,n.avatarName=null,n}return t=o,r=[{key:"create",value:function(e){var t=new o(e.id,e.timestamp);return t.ownerId=void 0!==e.owner?e.owner:e.ownerId,t.type=e.type,t.state=e.state,t.reminding=e.reminding,t.pivotalId=void 0!==e.pivotal?e.pivotal:e.pivotalId,void 0!==e.unread&&(t.unread=e.unread),void 0!==e.recentMessage&&(t.recentMessage=Pt.a.create(e.recentMessage)),void 0!==e.avatarURL&&(t.avatarURL=e.avatarURL),void 0!==e.avatarName&&(t.avatarName=e.avatarName),t}}],(n=[{key:"getContact",value:function(){return this.type==Zt.Contact?this.pivotal:null}},{key:"getGroup",value:function(){return this.type==Zt.Group?this.pivotal:null}},{key:"getName",value:function(){return this.type==Zt.Contact?this.pivotal.getPriorityName():this.type==Zt.Group?this.pivotal.getName():""}},{key:"getState",value:function(){return this.state}},{key:"getType",value:function(){return this.type}},{key:"getReminding",value:function(){return this.reminding}},{key:"getPivotal",value:function(){return this.pivotal}},{key:"toJSON",value:function(){var e=en(on(o.prototype),"toCompactJSON",this).call(this);return e.domain=z.a.DOMAIN,e.ownerId=this.ownerId,e.type=this.type,e.state=this.state,e.reminding=this.reminding,e.pivotalId=this.pivotalId,e.unread=this.unread,null!=this.recentMessage&&(e.recentMessage=this.recentMessage.toJSON()),null!=this.avatarName&&(e.avatarName=this.avatarName),null!=this.avatarURL&&(e.avatarURL=this.avatarURL),e}},{key:"toCompactJSON",value:function(){var e=this.toJSON();return void 0!==e.recentMessage&&delete e.recentMessage,e}}])&&Xt(t.prototype,n),r&&Xt(t,r),o}(h.a);function un(e){return(un="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function cn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function sn(e,t,n){return(sn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=pn(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function ln(e,t){return(ln=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function fn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=pn(e);if(t){var i=pn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return hn(this,n)}}function hn(e,t){return!t||"object"!==un(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function pn(e){return(pn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var dn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ln(e,t)}(o,e);var t,n,r,i=fn(o);function o(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(n=i.call(this)).ownerId="number"==typeof e?e:e.getId(),n.message=t,n}return t=o,(n=[{key:"getOwnerId",value:function(){return this.ownerId}},{key:"getMessage",value:function(){return this.message}},{key:"toJSON",value:function(){var e=sn(pn(o.prototype),"toJSON",this).call(this);return e.owner=this.ownerId,e.message=this.message.toJSON(),e}}])&&cn(t.prototype,n),r&&cn(t,r),o}(h.a);function vn(e,t,n,r,i,o,a){try{var u=e[o](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,i)}function yn(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){vn(o,r,i,a,u,"next",e)}function u(e){vn(o,r,i,a,u,"throw",e)}a(void 0)}))}}function gn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var mn=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.service=t,this.domain=null,this.db=null,this.configStore=null,this.messageStore=null,this.draftStore=null}var t,n,r;return t=e,(n=[{key:"open",value:function(e,t){if(null==this.db){i.a.Logger.d("MessagingStorage","Open messaging storage : "+t),this.domain=t;var n={name:"CubeMessaging-"+t+"-"+e,version:1,stores:[{name:"message",keyPath:"id",indexes:[{name:"id",keyPath:"id",unique:!0},{name:"from",keyPath:"from",unique:!1},{name:"to",keyPath:"to",unique:!1},{name:"source",keyPath:"source",unique:!1},{name:"rts",keyPath:"rts",unique:!1}]},{name:"conversation",keyPath:"id",indexes:[{name:"id",keyPath:"id",unique:!0},{name:"timestamp",keyPath:"timestamp",unique:!1},{name:"type",keyPath:"type",unique:!1},{name:"state",keyPath:"state",unique:!1},{name:"reminding",keyPath:"reminding",unique:!1},{name:"pivotalId",keyPath:"pivotalId",unique:!1}]},{name:"draft",keyPath:"owner",indexes:[{name:"owner",keyPath:"owner",unique:!0}]},{name:"recent_messager",keyPath:"id",indexes:[{name:"id",keyPath:"id",unique:!0},{name:"time",keyPath:"time",unique:!1}]},{name:"config",keyPath:"item",indexes:[{name:"item",keyPath:"item",unique:!0}]}]};this.db=new Ee.a(n),this.configStore=this.db.use("config"),this.messageStore=this.db.use("message"),this.conversationStore=this.db.use("conversation"),this.draftStore=this.db.use("draft"),this.recentMessagerStore=this.db.use("recent_messager")}}},{key:"close",value:function(){null!=this.db&&(i.a.Logger.d("MessagingStorage","Close messaging storage : "+this.domain),this.db.close(),this.db=null)}},{key:"reset",value:function(){null!=this.db&&(this.configStore.clear(),this.messageStore.clear(),this.conversationStore.clear(),this.draftStore.clear(),this.recentMessagerStore.clear())}},{key:"queryRecentConversations",value:function(e,t){var n=this;yn(regeneratorRuntime.mark((function r(){var i,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=[],r.next=3,n.conversationStore.select([{key:"state",value:Yt.Normal,compare:"="},{key:"state",value:Yt.Important,compare:"=",optional:!0}]);case 3:null!=(o=r.sent)&&(o.sort((function(e,t){return e.timestamp>t.timestamp?-1:e.timestamp<t.timestamp?1:0})),o.some((function(t){var n=an.create(t);return i.push(n),i.length==e}))),t(i);case 6:case"end":return r.stop()}}),r)})))()}},{key:"readConversation",value:function(e,t){var n=this;return null==this.db?(t(null),!1):(yn(regeneratorRuntime.mark((function r(){var i,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.conversationStore.get(e);case 2:if(null!=(i=r.sent)){r.next=6;break}return t(null),r.abrupt("return");case 6:o=an.create(i),t(o);case 8:case"end":return r.stop()}}),r)})))(),!0)}},{key:"writeConversation",value:function(e){var t=this;return null!=this.db&&(yn(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.conversationStore.put(e.toJSON());case 2:case"end":return n.stop()}}),n)})))(),!0)}},{key:"deleteConversation",value:function(e){var t=this;return null!=this.db&&(yn(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.conversationStore.delete(e.id);case 2:case"end":return n.stop()}}),n)})))(),!0)}},{key:"updateLastMessage",value:function(e,t){var n=this;return null!=this.db&&(t&&yn(regeneratorRuntime.mark((function t(){var r,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.getRemoteTimestamp(),i={item:"lastMessageTime",value:r},t.next=4,n.configStore.put(i);case 4:case"end":return t.stop()}}),t)})))(),yn(regeneratorRuntime.mark((function t(){var r,i,o,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=0,i=!1,e.isFromGroup()?(r=e.getSource(),i=!0):r=n.service.isSender(e)?e.getTo():e.getFrom(),t.next=5,n.recentMessagerStore.get(r);case 5:if(!(null!=(o=t.sent)&&o.length>0)){t.next=13;break}if(a=o[0].time,!(e.remoteTS>a)){t.next=11;break}return t.next=11,n.recentMessagerStore.put({id:r,time:e.remoteTS,group:i,message:e.toJSON()});case 11:t.next=15;break;case 13:return t.next=15,n.recentMessagerStore.put({id:r,time:e.remoteTS,group:i,message:e.toJSON()});case 15:case"end":return t.stop()}}),t)})))(),!0)}},{key:"queryRecentMessagers",value:function(e){var t=this;return null!=this.db&&(yn(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.recentMessagerStore.all();case 2:null!=(r=n.sent)&&r.sort((function(e,t){return e.time>t.time?-1:e.time<t.time?1:0})),e(r);case 5:case"end":return n.stop()}}),n)})))(),!0)}},{key:"deleteRecentMessager",value:function(e,t){var n=this;return null!=this.db&&(yn(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.recentMessagerStore.delete(e);case 2:t&&t(e);case 3:case"end":return r.stop()}}),r)})))(),!0)}},{key:"queryLastMessageTime",value:function(e){var t=this;return null==this.db?(e(0),!1):(yn(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.configStore.get("lastMessageTime");case 2:void 0!==(r=n.sent)&&null!=r||(r={value:0}),e(r.value);case 5:case"end":return n.stop()}}),n)})))(),!0)}},{key:"containsMessage",value:function(e,t){var n=this;return null!=this.db&&(yn(regeneratorRuntime.mark((function r(){var i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=3,n.messageStore.get(e.getId());case 3:i=r.sent,t(e,void 0!==i&&null!=i);case 6:case"end":return r.stop()}}),r)})))(),!0)}},{key:"writeMessage",value:function(e){var t=this;return null!=this.db&&(yn(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return delete(r=e.toJSON()).domain,n.next=4,t.messageStore.put(r);case 4:case"end":return n.stop()}}),n)})))(),!0)}},{key:"reverseReadMessages",value:function(){}},{key:"readMessages",value:function(e,t,n){var r=this;return null!=this.db&&(void 0===n&&(n=100),yn(regeneratorRuntime.mark((function o(){var a,u,c,s,l,f,h;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,r.messageStore.query("rts",e,">");case 2:a=o.sent,u=[],c=0;case 5:if(!(c<a.length)){o.next=18;break}if(a[c].domain=r.domain,(s=Pt.a.create(a[c])).state!=Tt.a.Deleted&&s.state!=Tt.a.Recalled){o.next=10;break}return o.abrupt("continue",15);case 10:return o.next=12,r.service.fillMessage(s);case 12:(l=o.sent)instanceof V.a&&i.a.Logger.e(Mn.NAME,l.toString()),u.push(s);case 15:++c,o.next=5;break;case 18:f=null,u.length>n?(h=u.length-n,f=u.slice(h)):f=u,t(e,f);case 21:case"end":return o.stop()}}),o)})))(),!0)}},{key:"readMessageById",value:function(e,t){var n=this;return null!=this.db&&(yn(regeneratorRuntime.mark((function r(){var o,a,u;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.messageStore.get(e);case 2:if(null!=(o=r.sent)){r.next=6;break}return t(null),r.abrupt("return");case 6:return o.domain=n.domain,a=Pt.a.create(o),r.next=10,n.service.fillMessage(a);case 10:(u=r.sent)instanceof V.a&&i.a.Logger.e(Mn.NAME,u.toString()),t(a);case 13:case"end":return r.stop()}}),r)})))(),!0)}},{key:"readMessageWithContact",value:function(e,t,n){var r=this;return null!=this.db&&(yn(regeneratorRuntime.mark((function o(){var a,u,c,s,l;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,r.messageStore.select([{key:"rts",value:t,compare:">"},{key:"source",value:0,compare:"="},{key:"from",value:e,optional:!0},{key:"to",value:e,optional:!0}]);case 2:a=o.sent,u=[],c=0;case 5:if(!(c<a.length)){o.next=18;break}if(a[c].domain=r.domain,(s=Pt.a.create(a[c])).state!=Tt.a.Deleted&&s.state!=Tt.a.Recalled){o.next=10;break}return o.abrupt("continue",15);case 10:return o.next=12,r.service.fillMessage(s);case 12:(l=o.sent)instanceof V.a&&i.a.Logger.e(Mn.NAME,l.toString()),u.push(s);case 15:++c,o.next=5;break;case 18:n(e,t,u);case 19:case"end":return o.stop()}}),o)})))(),!0)}},{key:"readMessageWithGroup",value:function(e,t,n){var r=this;return null!=this.db&&(yn(regeneratorRuntime.mark((function o(){var a,u,c,s,l;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,r.messageStore.select([{key:"rts",value:t,compare:">"},{key:"source",value:e,optional:!0}]);case 2:a=o.sent,u=[],c=0;case 5:if(!(c<a.length)){o.next=18;break}if(a[c].domain=r.domain,(s=Pt.a.create(a[c])).state!=Tt.a.Deleted&&s.state!=Tt.a.Recalled){o.next=10;break}return o.abrupt("continue",15);case 10:return o.next=12,r.service.fillMessage(s);case 12:(l=o.sent)instanceof V.a&&i.a.Logger.e(Mn.NAME,l.toString()),u.push(s);case 15:++c,o.next=5;break;case 18:n(e,t,u);case 19:case"end":return o.stop()}}),o)})))(),!0)}},{key:"readLastMessageWtihContact",value:function(e,t){var n=this;return null!=this.db&&(yn(regeneratorRuntime.mark((function r(){var o,a;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o=null,r.next=3,n.messageStore.iterate((function(t,r,i){var a=t.value;if(a.from!=e&&a.to!=e||0!=a.source||a.state!=Tt.a.Read&&a.state!=Tt.a.Sent)r();else{a.domain=n.domain;var u=Pt.a.create(a);o=u,i()}}),{writable:!1,direction:"prev"});case 3:if(null==o){r.next=8;break}return r.next=6,n.service.fillMessage(o);case 6:(a=r.sent)instanceof V.a&&i.a.Logger.e(Mn.NAME,a.toString());case 8:t(o);case 9:case"end":return r.stop()}}),r)})))(),!0)}},{key:"readLastMessageWtihGroup",value:function(e,t){var n=this;return null!=this.db&&(yn(regeneratorRuntime.mark((function r(){var o,a;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o=null,r.next=3,n.messageStore.iterate((function(t,r,i){var a=t.value;if(a.source!=e||a.state!=Tt.a.Read&&a.state!=Tt.a.Sent)r();else{a.domain=n.domain;var u=Pt.a.create(a);o=u,i()}}),{writable:!1,direction:"prev"});case 3:if(null==o){r.next=8;break}return r.next=6,n.service.fillMessage(o);case 6:(a=r.sent)instanceof V.a&&i.a.Logger.e(Mn.NAME,a.toString());case 8:t(o);case 9:case"end":return r.stop()}}),r)})))(),!0)}},{key:"readLastMessage",value:function(e){var t=this;return null!=this.db&&(yn(regeneratorRuntime.mark((function n(){var r,o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=null,n.next=3,t.messageStore.iterate((function(e,n,i){var o=e.value;if(o.state==Tt.a.Read||o.state==Tt.a.Sent){o.domain=t.domain;var a=Pt.a.create(o);r=a,i()}else n()}),{writable:!1,direction:"prev"});case 3:if(null==r){n.next=8;break}return n.next=6,t.service.fillMessage(r);case 6:(o=n.sent)instanceof V.a&&i.a.Logger.e(Mn.NAME,o.toString());case 8:e(r);case 9:case"end":return n.stop()}}),n)})))(),!0)}},{key:"iterateContactMessage",value:function(e,t,n,r){var i=this;if(null==this.db)return!1;var o=null,a=null,u=function(){o()},c=function(){a()};return yn(regeneratorRuntime.mark((function s(){return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,i.messageStore.iterate((function(s,l,f){var h=s.value;if(h.source>0)l();else if(h.state!=Tt.a.Deleted&&h.state!=Tt.a.Recalled){if(r){if(h.rts>t)return void l()}else if(h.rts<t)return void l();if(h.from==e||h.to==e){h.domain=i.domain;var p=Pt.a.create(h),d=n(p,u,c);void 0===d?(o=l,a=f):d?l():f()}else l()}else l()}),{writable:!1,direction:r?"prev":"next"});case 2:n(null);case 3:case"end":return s.stop()}}),s)})))(),!0}},{key:"iterateGroupMessage",value:function(e,t,n,r){var i=this;if(null==this.db)return!1;var o=null,a=null,u=function(){o()},c=function(){a()};return yn(regeneratorRuntime.mark((function s(){return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,i.messageStore.iterate((function(s,l,f){var h=s.value;if(h.source==e)if(h.state!=Tt.a.Deleted&&h.state!=Tt.a.Recalled){if(r){if(h.rts>t)return void l()}else if(h.rts<t)return void l();h.domain=i.domain;var p=Pt.a.create(h),d=n(p,u,c);void 0===d?(o=l,a=f):d?l():f()}else l();else l()}),{writable:!1,direction:r?"prev":"next"});case 2:n(null);case 3:case"end":return s.stop()}}),s)})))(),!0}},{key:"updateMessage",value:function(e){var t=this;return null!=this.db&&(yn(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return delete(r=e.toJSON()).domain,n.next=4,t.messageStore.put(r);case 4:case"end":return n.stop()}}),n)})))(),!0)}},{key:"writeDraft",value:function(e){var t=this;return null!=this.db&&(yn(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.toJSON(),n.next=3,t.draftStore.put(r);case 3:case"end":return n.stop()}}),n)})))(),!0)}},{key:"deleteDraft",value:function(e){var t=this;return null!=this.db&&(yn(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.draftStore.delete(e);case 2:case"end":return n.stop()}}),n)})))(),!0)}},{key:"readDraft",value:function(e,t){var n=this;return null!=this.db&&(yn(regeneratorRuntime.mark((function r(){var i,o,a;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.draftStore.get(e);case 2:if(null!=(i=r.sent)){r.next=6;break}return t(null),r.abrupt("return");case 6:i.message.domain=n.domain,o=Pt.a.create(i.message),a=new dn(e,o),t(a);case 10:case"end":return r.stop()}}),r)})))(),!0)}}])&&gn(t.prototype,n),r&&gn(t,r),e}(),bn=n(30),wn=n(86);function kn(e){return(kn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Sn(e,t,n,r,i,o,a){try{var u=e[o](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,i)}function On(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){Sn(o,r,i,a,u,"next",e)}function u(e){Sn(o,r,i,a,u,"throw",e)}a(void 0)}))}}function _n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Cn(e,t){return(Cn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function En(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Tn(e);if(t){var i=Tn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Rn(this,n)}}function Rn(e,t){return!t||"object"!==kn(t)&&"function"!=typeof t?xn(e):t}function xn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Pn(e,t,n){return(Pn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Tn(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Tn(e){return(Tn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Mn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Cn(e,t)}(a,e);var t,n,r,o=En(a);function a(){var e,t,n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),Pn((e=xn(n=o.call(this,"Messaging")),Tn(a.prototype)),"require",e).call(e,J.a.NAME),Pn((t=xn(n),Tn(a.prototype)),"require",t).call(t,Rt.NAME),n.contactService=null,n.contactEventFun=null,n.fileStorageEventFun=null,n.pushQueue=[],n.notifiedQueue=[],n.sendingMap=new s.a,n.timer=0,n.timerLastTime=0,n.pipelineListener=new Kt(xn(n)),n.storage=new mn(xn(n)),n.conversations=[],n.lastMessageTime=0,n.lastQueryTime=0,n.pullHandler=null,n.pullHandlerTimer=0,n.serviceReady=!1,n}return t=a,(n=[{key:"start",value:function(){var e=this;if(!Pn(Tn(a.prototype),"start",this).call(this))return!1;this.assemble(),this.contactService=this.kernel.getModule(J.a.NAME),this.contactEventFun=function(t){e._fireContactEvent(t)},this.contactService.attach(this.contactEventFun),this.fileStorageEventFun=function(t){e._fireFileStorageEvent(t)},this.kernel.getModule(Rt.NAME).attach(this.fileStorageEventFun),this.pipeline.addListener(a.NAME,this.pipelineListener),this.resetTimer();var t=this.contactService.getSelf();return null!=t&&this.contactService.hasSignedIn()&&this._prepare(t),!0}},{key:"stop",value:function(){if(Pn(Tn(a.prototype),"stop",this).call(this),null!=this.pipeline){0!=this.timer&&(clearInterval(this.timer),this.timer=0),this.pipeline.removeListener(a.NAME,this.pipelineListener),null!=this.contactService&&(this.contactService.detach(this.contactEventFun),this.contactEventFun=null);var e=this.kernel.getModule(Rt.NAME);null!=e&&(e.detach(this.fileStorageEventFun),this.fileStorageEventFun=null),this.notifiedQueue.splice(0,this.notifiedQueue.length),this.storage.close(),this.serviceReady=!1}}},{key:"_prepare",value:function(e){var t=this,n=!1,r=!1;this.storage.open(e.getId(),e.getDomain()),this.storage.queryLastMessageTime((function(e){var o=Date.now();t.lastMessageTime=0==e?o-t.defaultRetrospect:e,t.queryRemoteMessage(t.lastMessageTime,o,(function(){if(i.a.Logger.d("MessagingService","#queryRemoteMessage"),n=!0,r){i.a.Logger.d("MessagingService","Ready"),t.serviceReady=!0;var e=new u.a(qt.Ready,t);t.notifyObservers(e)}}));var a=50;o-t.lastQueryTime>36e5&&(a=100),t.queryRemoteConversations(a,(function(e){if(i.a.Logger.d("MessagingService","#queryRemoteConversations"),r=!0,n){i.a.Logger.d("MessagingService","Ready"),t.serviceReady=!0;var o=new u.a(qt.Ready,t);t.notifyObservers(o)}}),(function(e){if(i.a.Logger.w("MessagingService",e.toString()),r=!0,n){t.serviceReady=!0;var o=new u.a(qt.Ready,t);t.notifyObservers(o)}}))}))}},{key:"isReady",value:function(){return this.serviceReady}},{key:"assemble",value:function(){this.pluginSystem.addHook(new bn.a)}},{key:"resetTimer",value:function(){var e=this;this.timer>0&&clearInterval(this.timer),this.timer=setInterval((function(t){e._processQueue()}),100)}},{key:"isSender",value:function(e){var t=this.contactService.getSelf();return null!=t&&e.from==t.getId()}},{key:"getRecentConversations",value:function(e){var t=this;this.isReady()?0==this.conversations.length?this.storage.queryRecentConversations(50,(function(n){!function(n){var r=[];n.forEach((function(i){On(regeneratorRuntime.mark((function o(){var a;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,t.fillConversation(i);case 2:a=o.sent,r.push(a),r.length==n.length&&(t.conversations=r,setTimeout((function(){e(t.conversations)}),0));case 5:case"end":return o.stop()}}),o)})))()}))}(n)})):e(this.conversations):e(null)}},{key:"getConversation",value:function(e,t,n){var r=this,i=e;if("string"==typeof e&&(i=parseInt(e)),this.conversations.length>0)for(var o=0;this.conversations.length;++o){var u=this.conversations[o];if(u.id==i)return void t(u)}this.storage.readConversation(i,(function(i){if(null!=i)On(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.fillConversation(i);case 2:n=e.sent,t(n);case 4:case"end":return e.stop()}}),e)})))();else if(void 0!==n){var o=new V.a(a.NAME,Wt.StorageNoData,e);n(o)}}))}},{key:"createGroupConversation",value:function(e,t,n){var r=this;this.contactService.createGroup(this.contactService.getSelf().getName()+"创建的群组",e,(function(e){r.applyConversation(e,(function(e){t(e)}),(function(e){n(e)}))}),(function(e){n(e)}))}},{key:"applyConversation",value:function(e,t,n){var r=this,i=e;(e instanceof K.a||e instanceof q.a)&&(i=e.id);for(var o=0;o<this.conversations.length;++o){var u=this.conversations[o];if(u.id==i)return void t(u)}var c=function(e){var n=new an(e.id);n.pivotal=e,n.pivotalId=e.id,e instanceof K.a?n.type=Zt.Contact:e instanceof q.a&&(n.type=Zt.Group),r.storage.writeConversation(n),r._tryAddConversation(n),t(n)};this.storage.readConversation(i,(function(e){if(null==e)r.contactService.getLocalContact(i,(function(e){c(e)}),(function(e){r.contactService.getGroup(i,(function(e){c(e)}),(function(e){n(e)}))}));else{if(e.state==Yt.Destroyed){var o=new V.a(a.NAME,Wt.Forbidden,e);return void n(o)}e.state==Yt.Deleted?(e.state=Yt.Normal,r.updateConversation(e,(function(e){On(regeneratorRuntime.mark((function n(){var i;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.fillConversation(e);case 2:i=n.sent,r._tryAddConversation(i),t(i);case 5:case"end":return n.stop()}}),n)})))()}),(function(e){n(e)}))):On(regeneratorRuntime.mark((function n(){var i;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.fillConversation(e);case 2:i=n.sent,r._tryAddConversation(i),t(i);case 5:case"end":return n.stop()}}),n)})))()}}))}},{key:"deleteConversation",value:function(e,t,n){var r=this;if("number"!=typeof e){var i=e;i.state=Yt.Deleted,this.updateConversation(i,(function(e){t(e)}),(function(e){n(e)}))}else this.getConversation(e,(function(e){setTimeout((function(){r.deleteConversation(e)}),0)}),(function(e){n(e)}))}},{key:"destroyConversation",value:function(e,t,n){var r=this;e.type==Zt.Contact?(e.state=Yt.Destroyed,this.updateConversation(e,t,n)):e.type==Zt.Group?this.contactService.quitGroup(e.getGroup(),(function(i){e.state=Yt.Destroyed,r.updateConversation(e,t,n)}),(function(t){var r=new V.a(a.NAME,Wt.Forbidden,e);n(r)})):i.a.Logger.w(a.NAME,"#destroyConversation - Not support conversation type : "+Zt.toString(e.type))}},{key:"changeConversationName",value:function(e,t,n,r){if(e.type!=Zt.Contact)this.contactService.modifyGroup(e.getGroup(),null,t,null,(function(t){n(e)}),(function(t){var n=new V.a(a.NAME,Wt.NoGroup,e);r(n)}));else{var i=new V.a(a.NAME,Wt.Forbidden,e);r(i)}}},{key:"updateConversation",value:function(e,t,n){var r=this;if(this.pipeline.isReady()){var i=new _.a(Dt,e.toCompactJSON());this.pipeline.send(a.NAME,i,(function(i,o,c){if(c.getStateCode()==M.a.OK){var s=c.extractServiceStateCode();if(s==Wt.Ok){var l=an.create(c.extractServiceData());if(e.state=l.state,e.reminding=l.reminding,e.timestamp=l.timestamp,r.storage.writeConversation(e),e.state==Yt.Deleted||e.state==Yt.Destroyed)for(var f=0;f<r.conversations.length;++f)if(r.conversations[f].id==e.id){r.conversations.splice(f,1);break}e.state==Yt.Destroyed&&r.storage.deleteConversation(e),t(e);var h=new u.a(qt.ConversationUpdated,e);r.notifyObservers(h)}else{var p=new V.a(a.NAME,s,e);n(p)}}else{var d=new V.a(a.NAME,Wt.ServerFault,e);n(d)}}))}else{var o=new V.a(a.NAME,Wt.PipelineFault,e);n(o)}}},{key:"_tryAddConversation",value:function(e){for(var t=0;t<this.conversations.length;++t)if(this.conversations[t].id==e.id)return;this.conversations.push(e),this.conversations.sort((function(e,t){return e.timestamp>t.timestamp?-1:e.timestamp<t.timestamp?1:0}))}},{key:"sendTo",value:function(e,t,n){return e instanceof q.a?this.sendToGroup(e,t,n):e instanceof K.a?this.sendToContact(e,t,n):null}},{key:"sendToContact",value:function(e,t,n){var r=this;this.started||this.start();var o=this.contactService.getSelf();if(null==o)return null;var u=t;t instanceof Pt.a||(u=new Pt.a(t,n));var c=0;if(e instanceof K.a)c=e.getId();else if("string"==typeof e)c=parseInt(e);else{if("number"!=typeof e)return null;c=e}return u.state=Tt.a.Sending,u.from=o.getId(),u.to=c,u.localTS=Date.now(),u.remoteTS=u.localTS,On(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.fillMessage(u);case 2:(t=e.sent)instanceof V.a&&i.a.Logger.e(a.NAME,t.toString()),new Promise((function(e,t){r.storage.writeMessage(u),e(u)})).then((function(e){r.pushQueue.push(e)}));case 6:case"end":return e.stop()}}),e)})))(),u.localTS-this.timerLastTime>5e3&&this.resetTimer(),u}},{key:"sendToGroup",value:function(e,t,n){var r=this;this.started||this.start();var o=this.contactService.getSelf();if(null==o)return null;var u=t;t instanceof Pt.a||(u=new Pt.a(t,n));var c=0;if(e instanceof q.a)c=e.getId();else if("string"==typeof e)c=parseInt(e);else{if("number"!=typeof e)return null;c=e}return u.state=Tt.a.Sending,u.from=o.getId(),u.source=c,u.localTS=Date.now(),u.remoteTS=u.localTS,On(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.fillMessage(u);case 2:(t=e.sent)instanceof V.a&&i.a.Logger.e(a.NAME,t.toString()),new Promise((function(e,t){r.storage.writeMessage(u),e(u)})).then((function(e){r.pushQueue.push(e)}));case 6:case"end":return e.stop()}}),e)})))(),u.localTS-this.timerLastTime>5e3&&this.resetTimer(),u}},{key:"markLocalOnlyOwner",value:function(e,t){var n=this;this.started||this.start(),t.scope=1;var r=this.contactService.getSelf();t.from=r.getId(),t.to=e.getId(),t.localTS=Date.now(),t.remoteTS=t.localTS+1,t.owner=r.getId(),t.state=Tt.a.Read,On(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.storage.writeMessage(t),e.next=3,n.fillMessage(t);case 3:n.notifyObservers(new u.a(qt.MarkOnlyOwner,t));case 4:case"end":return e.stop()}}),e)})))()}},{key:"markRead",value:function(e,t,n){var r=this;this.started||this.start();var i=this.contactService.getSelf();if(null==i)return!1;var o=0;if(e instanceof Pt.a){if(o=e.getId(),e.getTo()!=i.getId()){var c=new V.a(a.NAME,Wt.Forbidden,e);return n&&n(c),!1}}else o=e;var s={contactId:i.getId(),messageId:o},l=new _.a(Lt,s);return this.pipeline.send(a.NAME,l,(function(e,i,c){null!=c&&c.getStateCode()==M.a.OK?0==c.data.code?r.storage.readMessageById(o,(function(e){e.state=Tt.a.Read,r.storage.updateMessage(e),null!=e.attachment&&(e.attachment.token=r.getAuthToken().code),e=r.pluginSystem.getHook(bn.a.NAME).apply(e),t&&t(e),r.notifyObservers(new u.a(qt.Read,e))})):r.storage.readMessageById(o,(function(e){var t=new V.a(a.NAME,c.data.code,e);n&&n(t)})):r.storage.readMessageById(o,(function(e){var t=new V.a(a.NAME,Wt.Failure,e);n&&n(t)}))})),!0}},{key:"deleteMessage",value:function(e,t,n){var r=this;this.started||this.start();var i=this.contactService.getSelf();if(null==i)return!1;var o=e instanceof Pt.a?e.getId():e,c={contactId:i.getId(),messageId:o},s=new _.a(It,c);return this.pipeline.send(a.NAME,s,(function(e,i,a){null!=a&&a.getStateCode()==M.a.OK&&0==a.data.code?r.storage.readMessageById(o,(function(e){e.state=Tt.a.Deleted,r.storage.updateMessage(e),null!=e.attachment&&(e.attachment.token=r.getAuthToken().code),e=r.pluginSystem.getHook(bn.a.NAME).apply(e),t&&t(e),r.notifyObservers(new u.a(qt.Delete,e))})):r.storage.readMessageById(o,(function(e){n&&n(e)}))})),!0}},{key:"recallMessage",value:function(e,t,n){var r=this;this.started||this.start();var i=this.contactService.getSelf();if(null==i)return!1;var o=e instanceof Pt.a?e.getId():parseInt(e);return this.storage.readMessageById(o,(function(e){if(e.getFrom()==i.getId())if(Date.now()-e.getRemoteTimestamp()>12e4){if(n){var u=new V.a(a.NAME,Wt.DataTimeout,e);n(u)}}else{var c={contactId:i.getId(),messageId:o},s=new _.a(jt,c);r.pipeline.send(a.NAME,s),t&&t(e)}else if(n){var l=new V.a(a.NAME,Wt.IllegalOperation,e);n(l)}})),!0}},{key:"queryMessageById",value:function(e,t){this.started||this.start(),this.storage.readMessageById(e,t)||t(null)}},{key:"queryMessages",value:function(e,t){var n=this;this.started||this.start();var r=this.storage.readMessages(e,(function(e,r){for(var i=r.sort((function(e,t){return e.remoteTS<t.remoteTS?-1:e.remoteTS>t.remoteTS?1:0})),o=[],a=0;a<i.length;++a){var u=i[a];null!=u.attachment&&(u.attachment.token=n.getAuthToken().code);var c=n.pluginSystem.getHook(bn.a.NAME);o.push(c.apply(u))}t(e,o)}));return r||t(e,[]),r}},{key:"queryRecentMessagers",value:function(e,t){var n=this;if(this.contactService.isReady()){var r=[];this.storage.queryRecentMessagers((function(i){!function i(o){if(0!=o.length){var a=o.shift();a.group?On(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.contactService.getGroup(a.id);case 2:if("public"==(t=e.sent).tag&&t.state==xt.a.Normal){e.next=6;break}return i(o),e.abrupt("return");case 6:r.push(t),i(o);case 8:case"end":return e.stop()}}),e)})))():On(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.contactService.getContact(a.id);case 2:t=e.sent,r.push(t),i(o);case 5:case"end":return e.stop()}}),e)})))()}else e(r,t)}(i)}))}else e([],t)}},{key:"deleteRecentMessager",value:function(e,t,n){this.started||this.start();var r=0;if("number"==typeof e)r=e;else if(e instanceof q.a)r=e.getId();else{if(!(e instanceof K.a))return void(n&&n(new V.a(a.NAME,Wt.Failure,e)));r=e.getId()}this.storage.deleteRecentMessager(r,t)}},{key:"queryMessagesWithContact",value:function(e,t,n){var r=this;this.started||this.start();var i=e;e instanceof K.a?i=e.getId():void 0!==e.id&&(i=parseInt(e.id));var o=this.storage.readMessageWithContact(i,t,(function(e,t,i){for(var o=i.sort((function(e,t){return e.remoteTS<t.remoteTS?-1:e.remoteTS>t.remoteTS?1:0})),a=[],u=0;u<o.length;++u){var c=o[u];null!=c.attachment&&(c.attachment.token=r.getAuthToken().code);var s=r.pluginSystem.getHook(bn.a.NAME);a.push(s.apply(c))}n(e,t,a)}));return o||n(i,t,[]),o}},{key:"queryMessagesWithGroup",value:function(e,t,n){var r=this;this.started||this.start();var i=e;e instanceof q.a?i=e.getId():void 0!==e.id&&(i=parseInt(e.id));var o=this.storage.readMessageWithGroup(i,t,(function(e,t,i){for(var o=i.sort((function(e,t){return e.remoteTS<t.remoteTS?-1:e.remoteTS>t.remoteTS?1:0})),a=[],u=0;u<o.length;++u){var c=o[u];null!=c.attachment&&(c.attachment.token=r.getAuthToken().code);var s=r.pluginSystem.getHook(bn.a.NAME);a.push(s.apply(c))}n(e,t,a)}));return o||n(i,t,[]),o}},{key:"queryLastMessageWithContact",value:function(e,t){var n=this;this.started||this.start();var r=e;e instanceof K.a?r=e.getId():void 0!==e.id&&(r=parseInt(e.id)),this.storage.readLastMessageWtihContact(r,(function(e){if(null!=e){null!=e.attachment&&(e.attachment.token=n.getAuthToken().code);var r=n.pluginSystem.getHook(bn.a.NAME).apply(e);t(r)}else t(null)}))}},{key:"queryLastMessageWithGroup",value:function(e,t){var n=this;this.started||this.start();var r=e;e instanceof q.a?r=e.getId():void 0!==e.id&&(r=parseInt(e.id)),this.storage.readLastMessageWtihGroup(r,(function(e){if(null!=e){null!=e.attachment&&(e.attachment.token=n.getAuthToken().code);var r=n.pluginSystem.getHook(bn.a.NAME).apply(e);t(r)}else t(null)}))}},{key:"queryRecentMessagesWithContact",value:function(e,t,n){var r=this,i="number"==typeof e?e:e.id,o=[];this.storage.iterateContactMessage(i,Date.now(),(function(e){if(null==e){var a=o.sort((function(e,t){return e.remoteTS<t.remoteTS?-1:e.remoteTS>t.remoteTS?1:0}));return setTimeout((function(){!function(e){var t=[];On(regeneratorRuntime.mark((function o(){var a,u,c,s;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:a=0;case 1:if(!(a<e.length)){o.next=12;break}return u=e[a],o.next=5,r.fillMessage(u);case 5:c=r.pluginSystem.getHook(bn.a.NAME),s=c.apply(u),t.push(s),t.length==e.length&&n(i,t);case 9:++a,o.next=1;break;case 12:case"end":return o.stop()}}),o)})))()}(a)}),1),!0}return o.push(e),!(o.length>=t)}),!0)}},{key:"queryRecentMessagesWithGroup",value:function(e,t,n){var r=this,i="number"==typeof e?e:e.id,o=[];this.storage.iterateGroupMessage(i,Date.now(),(function(e){if(null==e){var a=o.sort((function(e,t){return e.remoteTS<t.remoteTS?-1:e.remoteTS>t.remoteTS?1:0}));return setTimeout((function(){!function(e){var t=[];On(regeneratorRuntime.mark((function o(){var a,u,c,s;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:a=0;case 1:if(!(a<e.length)){o.next=12;break}return u=e[a],o.next=5,r.fillMessage(u);case 5:c=r.pluginSystem.getHook(bn.a.NAME),s=c.apply(u),t.push(s),t.length==e.length&&n(i,t);case 9:++a,o.next=1;break;case 12:case"end":return o.stop()}}),o)})))()}(a)}),1),!0}return o.push(e),!(o.length>=t)}),!0)}},{key:"reverseIterateMessageWithContact",value:function(e,t,n,r){var i=this,o="number"==typeof e?e:e.id;this.storage.iterateContactMessage(o,t,(function(e,t,a){if(null==e)return r&&r(),!0;On(regeneratorRuntime.mark((function r(){var u,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,i.fillMessage(e);case 2:u=i.pluginSystem.getHook(bn.a.NAME),c=u.apply(e),n(o,c)?t():a();case 5:case"end":return r.stop()}}),r)})))()}),!0)}},{key:"reverseIterateMessageWithGroup",value:function(e,t,n,r){var i=this,o="number"==typeof e?e:e.id;this.storage.iterateGroupMessage(o,t,(function(e,t,a){if(null==e)return r&&r(),!0;On(regeneratorRuntime.mark((function r(){var u,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,i.fillMessage(e);case 2:u=i.pluginSystem.getHook(bn.a.NAME),c=u.apply(e),n(o,c)?t():a();case 5:case"end":return r.stop()}}),r)})))()}),!0)}},{key:"queryRemoteMessage",value:function(e,t,n){var r=this;if(!this.contactService.selfReady)return!1;if(0!=this.pullHandlerTimer)return!1;var o=Date.now();if(o-this.lastQueryTime<2e3)return!1;void 0!==n&&"function"==typeof n&&(this.pullHandler=n,this.pullHandlerTimer=setTimeout((function(){clearTimeout(r.pullHandlerTimer),r.pullHandlerTimer=0,r.pullHandler=null,n(r)}),1e4)),this.lastQueryTime=o;var u=void 0===e?this.lastMessageTime+1:e,c=void 0===t?o:t,s=this.contactService.getSelf(),l={id:s.getId(),domain:s.getDomain(),device:s.getDevice().toJSON(),beginning:u,ending:c};i.a.Logger.d("MessagingService","Pull message @ "+u+" - "+c);var f=new _.a(At,l);return this.pipeline.send(a.NAME,f),!0}},{key:"queryRemoteConversations",value:function(e,t,n){var r=this;if(this.pipeline.isReady()){var o={limit:e},u=new _.a(Ft,o);this.pipeline.send(a.NAME,u,(function(e,o,u){if(u.getStateCode()==M.a.OK)if(u.extractServiceStateCode()==Wt.Ok){r.conversations.splice(0,r.conversations.length);var c=u.extractServiceData().list;c.forEach((function(e){var n=an.create(e);On(regeneratorRuntime.mark((function e(){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.fillConversation(n);case 2:i=e.sent,r.conversations.push(i),r.storage.writeConversation(i),r.conversations.length==c.length&&setTimeout((function(){r.conversations.sort((function(e,t){return e.timestamp>t.timestamp?-1:e.timestamp<t.timestamp?1:0})),t(r.conversations)}),0);case 6:case"end":return e.stop()}}),e)})))()}))}else{i.a.Logger.w(a.NAME,"#queryRemoteConversations : "+u.extractServiceStateCode());var s=new V.a(a.NAME,u.extractServiceStateCode());n(s)}else{i.a.Logger.w(a.NAME,"#queryRemoteConversations : "+u.getStateCode());var l=new V.a(a.NAME,Wt.ServerFault);n(l)}}))}else{var c=new V.a(a.NAME,Wt.Failure);n(c)}}},{key:"saveDraft",value:function(e,t){return!!this.serviceReady&&(this.storage.writeDraft(new dn(e,t)),!0)}},{key:"deleteDraft",value:function(e){if(!this.serviceReady)return!1;var t="number"==typeof e?e:e.getId();return this.storage.deleteDraft(t),!0}},{key:"loadDraft",value:function(e,t,n){var r=this;if(!this.serviceReady){var i=new V.a(a.NAME,Wt.Failure,e);return n&&n(i),!1}var o=0;return o="number"==typeof e?e:e.getId(),this.storage.readDraft(o,(function(i){if(null!=i){var o=r.pluginSystem.getHook(bn.a.NAME).apply(i.message);i.message=o,t(i)}else{var u=new V.a(a.NAME,Wt.StorageNoData,e);n&&n(u)}})),!0}},{key:"register",value:function(e){e instanceof wn.a&&this.pluginSystem.register(bn.a.NAME,e)}},{key:"deregister",value:function(e){e instanceof wn.a&&this.pluginSystem.deregister(bn.a.NAME,e)}},{key:"fillMessage",value:function(e){var t=this;return new Promise((function(n,r){var i=!1,o=!1,a=!1;e.isFromGroup()?(t.contactService.getContact(e.getFrom(),(function(t){e.sender=t,i=!0,a&&n(e)}),(function(e){i=!0,a&&r(e)})),t.contactService.getGroup(e.getSource(),(function(t){e.sourecGroup=t,a=!0,i&&n(e)}),(function(e){a=!0,i&&r(e)}))):(t.contactService.getContact(e.getFrom(),(function(t){e.sender=t,i=!0,o&&n(e)}),(function(e){i=!0,o&&r(e)})),t.contactService.getContact(e.getTo(),(function(t){e.receiver=t,o=!0,i&&n(e)}),(function(e){o=!0,i&&r(e)})))}))}},{key:"fillConversation",value:function(e){var t=this;return new Promise((function(n,r){e.type==Zt.Contact?t.contactService.getContact(e.pivotalId,(function(t){e.pivotal=t,n(e)}),(function(t){i.a.Logger.w(a.NAME,"#fillConversation (Contact) - "+e.id+" : "+t),n(e)})):e.type==Zt.Group?t.contactService.getGroup(e.pivotalId,(function(t){e.pivotal=t,n(e)}),(function(t){i.a.Logger.w(a.NAME,"#fillConversation (Group) - "+e.id+" : "+t),n(e)})):n(e)}))}},{key:"triggerNotify",value:function(e){var t=void 0===e.code&&void 0===e.data?e:e.data,n=Pt.a.create(t),r=0==this.notifiedQueue.length;this.notifiedQueue.push(n),r&&this._processNotify()}},{key:"_processNotify",value:function(){var e=this;On(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!=e.notifiedQueue.length){t.next=2;break}return t.abrupt("return");case 2:return n=e.notifiedQueue.shift(),r=null,t.prev=4,t.next=7,e.fillMessage(n);case 7:r=t.sent,t.next=14;break;case 10:return t.prev=10,t.t0=t.catch(4),i.a.Logger.d(a.NAME,t.t0.toString()),t.abrupt("return");case 14:n=r,e.refreshLastMessageTime(n),new Promise((function(t,r){n.getSource()>0&&e.contactService.updateGroupActiveTime(n.getSource(),n.getRemoteTimestamp()),e.storage.containsMessage(n,(function(n,r){e.storage.writeMessage(n),t(r)}))})).then((function(t){if(!t){null!=n.attachment&&(n.attachment.token=e.getAuthToken().code);var r=e.pluginSystem.getHook(bn.a.NAME);n=r.apply(n),e.notifyObservers(new u.a(qt.Notify,n))}setTimeout((function(){e._processNotify()}),0)})).catch((function(t){console.log("MessagingService "+t),setTimeout((function(){e._processNotify()}),0)}));case 18:case"end":return t.stop()}}),t,null,[[4,10]])})))()}},{key:"triggerPull",value:function(e){if(this.pullHandlerTimer>0&&(clearTimeout(this.pullHandlerTimer),this.pullHandlerTimer=0),e.code!=Wt.Ok)return this.pullHandler=null,void this.triggerFail(At,e);var t=e.data,n=t.total,r=t.beginning,o=t.ending,a=t.messages;i.a.Logger.d("MessagingService","Query/Pull messages total: "+n+" - "+r+" - "+o);for(var u=0,c=a.length;u<c;++u)this.triggerNotify(a[u]);null!=this.pullHandler&&(this.pullHandler(this),this.pullHandler=null)}},{key:"triggerRead",value:function(e){var t=this;if(e.code==Wt.Ok){var n=Pt.a.create(e.data);On(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.fillMessage(n);case 2:(r=e.sent)instanceof V.a&&i.a.Logger.e(a.NAME,r.toString()),n.getFrom()==t.contactService.getSelf().getId()&&t.storage.readMessageById(n.getId(),(function(e){null!=e&&(e.state=Tt.a.Read,t.storage.updateMessage(e),null!=e.attachment&&(e.attachment.token=t.getAuthToken().code),e=t.pluginSystem.getHook(bn.a.NAME).apply(e),t.notifyObservers(new u.a(qt.Read,e)))}));case 5:case"end":return e.stop()}}),e)})))()}}},{key:"triggerRecall",value:function(e){var t=this;if(e.code==Wt.Ok){var n=Pt.a.create(e.data);this.storage.readMessageById(n.getId(),(function(e){null==e?On(regeneratorRuntime.mark((function e(){var r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.fillMessage(n);case 2:(r=e.sent)instanceof V.a&&i.a.Logger.e(a.NAME,r.toString()),n.state=Tt.a.Recalled,t.storage.updateMessage(n),i.a.Logger.d("MessagingService","Recall message: "+n.getId()),null!=n.attachment&&(n.attachment.token=t.getAuthToken().code),o=t.pluginSystem.getHook(bn.a.NAME),n=o.apply(n),t.notifyObservers(new u.a(qt.Recall,n));case 11:case"end":return e.stop()}}),e)})))():(e.state=Tt.a.Recalled,t.storage.updateMessage(e),i.a.Logger.d("MessagingService","Recall message: "+e.getId()),null!=e.attachment&&(e.attachment.token=t.getAuthToken().code),e=t.pluginSystem.getHook(bn.a.NAME).apply(e),t.notifyObservers(new u.a(qt.Recall,e)))}))}else this.triggerFail(jt,e)}},{key:"triggerFail",value:function(e,t){i.a.Logger.w("MessagingService","Failed #"+e+" : "+t.code)}},{key:"refreshLastMessageTime",value:function(e){var t=!1;e.getRemoteTimestamp()>this.lastMessageTime&&(this.lastMessageTime=e.getRemoteTimestamp(),t=!0),this.storage.updateLastMessage(e,t)}},{key:"_processQueue",value:function(){var e=this;if(this.timerLastTime=Date.now(),this.pushQueue.length>0&&this.pipeline.isReady()){var t=this.pushQueue.shift();if(this.sendingMap.put(t.getId(),t),null!=t.attachment)this._processAttachment(t);else{0==t.scope&&this.notifyObservers(new u.a(qt.Sending,t));var n=new _.a(Mt,t.toJSON());this.pipeline.send(a.NAME,n,(function(n,r,i){e._processPushResult(t,i)}))}}}},{key:"_processAttachment",value:function(e){var t=this,n=this.kernel.getModule(Rt.NAME);n.start();var r=n.uploadFile(e.attachment.file,(function(n){e.attachment.anchor=n,t.notifyObservers(new u.a(qt.Processing,e))}),(function(n){e.attachment.anchor=n;var r=new _.a(Mt,e.toJSON());t.pipeline.send(a.NAME,r,(function(n,r,i){t._processPushResult(e,i)}))}),(function(e){var n=new V.a(a.NAME,Wt.AttachmentError,e);t.notifyObservers(new u.a(qt.Fault,n))}));e.attachment.anchor=r,0==e.scope&&this.notifyObservers(new u.a(qt.Sending,e))}},{key:"_processPushResult",value:function(e,t){if(null!=t&&t.getStateCode()==M.a.OK){var n=t.data.data,r=this.sendingMap.remove(n.id);if(null==r)return void i.a.Logger.e("MessagingService","Can NOT find message in cache: "+n.id);if(r.remoteTS=n.rts,this.refreshLastMessageTime(r),t.data.code==Wt.Ok){if(r.state=n.state,n.attachment){var o=Pt.a.create(n);o.attachment.token=this.getAuthToken().code,r.setAttachment(o.attachment)}0==r.scope?this.notifyObservers(new u.a(qt.Sent,r)):this.notifyObservers(new u.a(qt.MarkOnlyOwner,r))}else if(t.data.code==Wt.BeBlocked)r.state=n.state,n.state==Tt.a.SendBlocked?this.notifyObservers(new u.a(qt.SendBlocked,r)):n.state==Tt.a.ReceiveBlocked?this.notifyObservers(new u.a(qt.ReceiveBlocked,r)):this.notifyObservers(new u.a(qt.Fault,r));else{i.a.Logger.w("MessagingService","Sent failed: "+t.data.code),r.state=n.state;var c=new V.a(a.NAME,t.data.code,r);this.notifyObservers(new u.a(qt.Fault,c))}this.storage.updateMessage(r)}else{i.a.Logger.e("MessagingService","Pipeline error : "+Mt+" - "+t.getStateCode()),this.sendingMap.remove(e.getId()),e.state=Tt.a.Fault,this.storage.updateMessage(e);var s=new V.a(a.NAME,Wt.ServerFault,e);this.notifyObservers(new u.a(qt.Fault,s))}}},{key:"_fireContactEvent",value:function(e){if(this.started)if(e.name==W.a.SignIn||e.name==W.a.Comeback){var t=e.data;this.serviceReady||this._prepare(t)}else e.name==W.a.SignOut&&this.storage.close()}},{key:"_fireFileStorageEvent",value:function(e){this.started&&e.getName()}}])&&_n(t.prototype,n),r&&_n(t,r),a}(d.a);!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(Mn,"NAME","Messaging");var An="getMediaSource",Nn="workflowOperating",jn="image",In="video",Ln="detectObject",Fn=0,Dn=9;function Bn(e){return(Bn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Gn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Un(e,t){return(Un=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Hn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Jn(e);if(t){var i=Jn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return zn(this,n)}}function zn(e,t){return!t||"object"!==Bn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Jn(e){return(Jn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Vn(e){return(Vn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Kn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function qn(e,t,n){return(qn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Qn(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Wn(e,t){return(Wn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Zn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Qn(e);if(t){var i=Qn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Yn(this,n)}}function Yn(e,t){return!t||"object"!==Vn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Qn(e){return(Qn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var $n=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Wn(e,t)}(o,e);var t,n,r,i=Zn(o);function o(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),i.call(this)}return t=o,(n=[{key:"getOperation",value:function(){return null}},{key:"getProcessAction",value:function(){return jn}},{key:"toJSON",value:function(){var e=qn(Qn(o.prototype),"toJSON",this).call(this);return e.process=this.getProcessAction(),e.operation=this.getOperation(),e}},{key:"toCompactJSON",value:function(){return this.toJSON()}}])&&Kn(t.prototype,n),r&&Kn(t,r),o}(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Un(e,t)}(i,e);var t,n,r;Hn(i);function i(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),zn(void 0)}return t=i,(n=[{key:"getProcessAction",value:function(){return null}}])&&Gn(t.prototype,n),r&&Gn(t,r),i}(c.a));function Xn(e){return(Xn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function er(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function tr(e,t,n){return(tr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=or(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function nr(e,t){return(nr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function rr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=or(e);if(t){var i=or(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ir(this,n)}}function ir(e,t){return!t||"object"!==Xn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function or(e){return(or=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ar=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&nr(e,t)}(o,e);var t,n,r,i=rr(o);function o(e,t,n,r){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(a=i.call(this)).x=e,a.y=t,a.width=n,a.height=r,a}return t=o,r=[{key:"create",value:function(e){return new o(e.x,e.y,e.width,e.height)}}],(n=[{key:"getOperation",value:function(){return o.Operation}},{key:"toJSON",value:function(){var e=tr(or(o.prototype),"toJSON",this).call(this);return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e}}])&&er(t.prototype,n),r&&er(t,r),o}($n);function ur(e){return(ur="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function cr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function sr(e,t){return(sr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function lr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=hr(e);if(t){var i=hr(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return fr(this,n)}}function fr(e,t){return!t||"object"!==ur(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function hr(e){return(hr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(ar,"Operation","Crop");var pr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&sr(e,t)}(o,e);var t,n,r,i=lr(o);function o(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),i.call(this)}return t=o,r=[{key:"create",value:function(e){return new o}}],(n=[{key:"getOperation",value:function(){return o.Operation}}])&&cr(t.prototype,n),r&&cr(t,r),o}($n);function dr(e){return(dr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function vr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function yr(e,t,n){return(yr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=wr(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function gr(e,t){return(gr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function mr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wr(e);if(t){var i=wr(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return br(this,n)}}function br(e,t){return!t||"object"!==dr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function wr(e){return(wr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(pr,"Operation","ReverseColor");var kr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&gr(e,t)}(i,e);var t,n,r;mr(i);function i(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(void 0).fileOperation=e,br(void 0)}return t=i,r=[{key:"create",value:function(e){var t=null,n=e.process;if(n==jn){var r=e.operation;r==ar.Operation?t=ar.create(e):r==pr.Operation&&(t=pr.create(e))}else n==In&&e.operation;return t}}],(n=[{key:"toJSON",value:function(){var e=yr(wr(i.prototype),"toJSON",this).call(this);return e.operation=this.fileOperation.toJSON(),e}}])&&vr(t.prototype,n),r&&vr(t,r),i}(c.a);function Sr(e){return(Sr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Or(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _r(e,t,n){return(_r="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=xr(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Cr(e,t){return(Cr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Er(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=xr(e);if(t){var i=xr(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Rr(this,n)}}function Rr(e,t){return!t||"object"!==Sr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function xr(e){return(xr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Pr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Cr(e,t)}(o,e);var t,n,r;Er(o);function o(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(void 0).sn=i.a.Utils.generateSerialNumber(),(void 0).domain=null,(void 0).sourceFileCode=null,(void 0).contactId=0,(void 0).workList=[],(void 0).resultFileLabel=null,Rr(void 0)}return t=o,r=[{key:"create",value:function(e){var t=new o;return t.sn=e.sn,t.domain=e.domain,t.sourceFileCode=e.source,t.contactId=e.contactId,void 0!==e.works&&e.works.forEach((function(e){t.works.push(kr.create(e))})),t}}],(n=[{key:"toJSON",value:function(){for(var e=this.toCompactJSON(),t=[],n=0;n<this.workList.length;++n){var r=this.workList[n];t.push(r.toJSON())}return e.works=t,e}},{key:"toCompactJSON",value:function(){var e=_r(xr(o.prototype),"toJSON",this).call(this);return e.sn=this.sn,e.domain=this.domain,e.source=this.sourceFileCode,e.contactId=this.contactId,e}}])&&Or(t.prototype,n),r&&Or(t,r),o}(c.a);function Tr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Mr=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t.name,this.workflow=Pr.create(t.workflow),this.work=void 0!==t.work?kr.create(t.work):null}var t,n,r;return t=e,(n=[{key:"getName",value:function(){return this.name}},{key:"getWorkflow",value:function(){return this.workflow}},{key:"getWork",value:function(){return this.work}}])&&Tr(t.prototype,n),r&&Tr(t,r),e}();function Ar(e){return(Ar="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Nr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function jr(e,t,n){return(jr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Dr(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Ir(e,t){return(Ir=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Lr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Dr(e);if(t){var i=Dr(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Fr(this,n)}}function Fr(e,t){return!t||"object"!==Ar(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Dr(e){return(Dr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Br=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ir(e,t)}(o,e);var t,n,r,i=Lr(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this)).service=e,t}return t=o,(n=[{key:"onReceived",value:function(e,t,n){if(jr(Dr(o.prototype),"onReceived",this).call(this,e,t,n),n.getStateCode()==M.a.OK){if(n.name==Nn){var r=n.extractServiceData(),i=new Mr(r);this.service._processEvent(i)}}else cell.Logger.w("FileProcessorPipelineListener","Pipeline error: "+n.name+" - "+n.getStateCode())}}])&&Nr(t.prototype,n),r&&Nr(t,r),o}($.a);var Gr=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height};function Ur(e){return(Ur="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Hr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function zr(e,t){return(zr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Jr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Kr(e);if(t){var i=Kr(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Vr(this,n)}}function Vr(e,t){return!t||"object"!==Ur(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Kr(e){return(Kr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var qr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&zr(e,t)}(o,e);var t,n,r,i=Jr(o);function o(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(r=i.call(this)).className=e,r.probability=t,r.bbox=n,r}return t=o,r=[{key:"create",value:function(e){return new o(e.class,e.probability,new Gr(e.bound))}}],(n=[{key:"getClassName",value:function(){return this.className}},{key:"getProbability",value:function(){return this.probability}},{key:"getBoundingBox",value:function(){return this.bbox}}])&&Hr(t.prototype,n),r&&Hr(t,r),o}(h.a);function Wr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Zr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fileCode=null,this.detectedObjects=[]}var t,n,r;return t=e,r=[{key:"create",value:function(t){var n=new e;n.fileCode=t.fileCode;for(var r=0;r<t.detectedObjects.length;++r){var i=t.detectedObjects[r],o=qr.create(i);n.detectedObjects.push(o)}return n}}],(n=[{key:"getFileCode",value:function(){return this.fileCode}},{key:"getDetectedObjects",value:function(){return this.detectedObjects}}])&&Wr(t.prototype,n),r&&Wr(t,r),e}();function Yr(e){return(Yr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Qr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function $r(e,t,n){return($r="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ni(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Xr(e,t){return(Xr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ei(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ni(e);if(t){var i=ni(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ti(this,n)}}function ti(e,t){return!t||"object"!==Yr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ni(e){return(ni=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ri=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Xr(e,t)}(a,e);var t,n,r,o=ei(a);function a(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(e=o.call(this,"FileProcessor")).pipelineListener=null,e}return t=a,(n=[{key:"start",value:function(){return!!$r(ni(a.prototype),"start",this).call(this)&&(this.pipelineListener=new Br(this),this.pipeline.addListener(a.NAME,this.pipelineListener),!0)}},{key:"stop",value:function(){this.pipeline.removeListener(a.NAME,this.pipelineListener)}},{key:"detectObject",value:function(e,t,n){var r=e;e instanceof Y.a&&(r=e.getFileCode());var i=new _.a(Ln,{domain:z.a.DOMAIN,fileCode:r,drawBoundingBox:!1});this.pipeline.send(a.NAME,i,(function(e,i,o){if(null!=o&&o.getStateCode()==M.a.OK){var u=o.getPayload().data,c=Zr.create(u);t(c)}else{var s=new V.a(a.NAME,Dn,r);n(s)}}))}},{key:"getMediaSource",value:function(e,t,n){var r=this,i=new _.a(An,{domain:z.a.DOMAIN,fileCode:e.fileCode,secure:window.location.protocol.toLowerCase().indexOf("https")>=0});this.pipeline.send(a.NAME,i,(function(i,o,u){if(u.getStateCode()==M.a.OK){var c=u.extractServiceStateCode();if(c==Fn){var s=u.extractServiceData().url+"?t="+r.kernel.getAuthToken().code;t(s)}else{var l=new V.a(a.NAME,c,e);n(l)}}else{var f=new V.a(a.NAME,u.getStateCode(),e);n(f)}}))}},{key:"_processEvent",value:function(e){i.a.Logger.d("FileProcessor","event - "+e.name),e.getWorkflow()}}])&&Qr(t.prototype,n),r&&Qr(t,r),a}(d.a);!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(ri,"NAME","FileProcessor");var ii=n(16);function oi(e){return(oi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ai(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ui(e,t,n){return(ui="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=fi(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function ci(e,t){return(ci=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function si(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=fi(e);if(t){var i=fi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return li(this,n)}}function li(e,t){return!t||"object"!==oi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function fi(e){return(fi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var hi=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ci(e,t)}(o,e);var t,n,r,i=si(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this)).service=e,t}return t=o,(n=[{key:"onReceived",value:function(e,t,n){ui(fi(o.prototype),"onReceived",this).call(this,e,t,n)}}])&&ai(t.prototype,n),r&&ai(t,r),o}($.a);function pi(e){return(pi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function di(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function vi(e,t,n){return(vi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=wi(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function yi(e,t){return(yi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function gi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wi(e);if(t){var i=wi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return mi(this,n)}}function mi(e,t){return!t||"object"!==pi(t)&&"function"!=typeof t?bi(e):t}function bi(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function wi(e){return(wi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ki=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&yi(e,t)}(o,e);var t,n,r,i=gi(o);function o(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(e=i.call(this,o.NAME)).pipelineListener=new hi(bi(e)),e}return t=o,(n=[{key:"start",value:function(){return!!vi(wi(o.prototype),"start",this).call(this)&&(this.pipeline.addListener(this.pipelineListener),!0)}},{key:"stop",value:function(){vi(wi(o.prototype),"stop",this).call(this),null!=this.pipeline&&this.pipeline.removeListener(this.pipelineListener)}}])&&di(t.prototype,n),r&&di(t,r),o}(d.a);function Si(e){return(Si="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Oi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _i(e,t,n){return(_i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=xi(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Ci(e,t){return(Ci=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ei(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=xi(e);if(t){var i=xi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ri(this,n)}}function Ri(e,t){return!t||"object"!==Si(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function xi(e){return(xi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(ki,"NAME","Whiteboard");var Pi=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ci(e,t)}(o,e);var t,n,r,i=Ei(o);function o(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(r=i.call(this)).id=e,r.invitee=t,r.displayName=n,r.accepted=!1,r.acceptionTime=0,r}return t=o,r=[{key:"create",value:function(e){var t=new o(e.id,e.invitee,e.displayName);return t.accepted=e.accepted,t.acceptionTime=e.acceptionTime,t}}],(n=[{key:"toJSON",value:function(){var e=_i(xi(o.prototype),"toJSON",this).call(this);return e.id=this.id,e.invitee=this.invitee,e.displayName=this.displayName,e.accepted=this.accepted,e.acceptionTime=this.acceptionTime,e}}])&&Oi(t.prototype,n),r&&Oi(t,r),o}(c.a),Ti=n(34);function Mi(e){return(Mi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ai(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ni(e,t,n){return(Ni="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Fi(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function ji(e,t){return(ji=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ii(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Fi(e);if(t){var i=Fi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function Li(e,t){return!t||"object"!==Mi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Fi(e){return(Fi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Di=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ji(e,t)}(o,e);var t,n,r,i=Ii(o);function o(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(n=i.call(this)).maxParticipants=50,n.participantGroup=void 0!==e?e:null,n.participantGroupId=null!=n.participantGroup?n.participantGroup.getId():0,n.commField=void 0!==t?t:null,n.commFieldId=null!=n.commField?n.commField.getId():0,n}return t=o,r=[{key:"create",value:function(e){var t=new o;return t.maxParticipants=e.maxParticipants,t.participantGroupId=e.participantGroupId,t.commFieldId=e.commFieldId,t}}],(n=[{key:"toJSON",value:function(){var e=Ni(Fi(o.prototype),"toJSON",this).call(this);return e.maxParticipants=this.maxParticipants,e.participantGroupId=this.participantGroupId,e.commFieldId=this.commFieldId,e}}])&&Ai(t.prototype,n),r&&Ai(t,r),o}(h.a);function Bi(e){return(Bi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Gi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ui(e,t,n){return(Ui="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Vi(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Hi(e,t){return(Hi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function zi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Vi(e);if(t){var i=Vi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ji(this,n)}}function Ji(e,t){return!t||"object"!==Bi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Vi(e){return(Vi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ki=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Hi(e,t)}(o,e);var t,n,r,i=zi(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this)).service=e,t.code=null,t.subject=null,t.existingPwd=!1,t.summary="",t.founder=null,t.presenter=null,t.creation=0,t.scheduleTime=0,t.expireTime=0,t.invitees=new s.a,t.room=null,t.cancelled=!1,t}return t=o,r=[{key:"create",value:function(e,t){var n=new o(e);return n.id=t.id,n.code=t.code,n.subject=t.subject,n.existingPwd=t.existingPwd,n.summary=t.summary,n.founder=K.a.create(t.founder),n.presenter=K.a.create(t.presenter),n.creation=t.creation,n.scheduleTime=t.scheduleTime,n.expireTime=t.expireTime,t.invitees.forEach((function(e){var t=Pi.create(e);n.invitees.put(t.id,t)})),n.room=Di.create(t.room),n.cancelled=t.cancelled,n}}],(n=[{key:"getId",value:function(){return this.id}},{key:"getCode",value:function(){return this.code}},{key:"hasPassword",value:function(){return this.existingPwd}},{key:"getFounder",value:function(){return this.founder}},{key:"getPresenter",value:function(){return this.presenter}},{key:"getRoom",value:function(){return this.room}},{key:"getInvitees",value:function(){return this.invitees.values()}},{key:"toJSON",value:function(){var e=Ui(Vi(o.prototype),"toJSON",this).call(this);return e.id=this.id,e.code=this.code,e.subject=this.subject,e.existingPwd=this.existingPwd,e.summary=this.summary,e.founder=this.founder.toCompactJSON(),e.presenter=this.presenter.toCompactJSON(),e.creation=this.creation,e.scheduleTime=this.scheduleTime,e.expireTime=this.expireTime,e.invitees=[],this.invitees.values().forEach((function(t){e.invitees.push(t.toJSON())})),e.room=this.room.toJSON(),e.cancelled=this.cancelled,e}},{key:"toCompactJSON",value:function(){return this.toJSON()}}])&&Gi(t.prototype,n),r&&Gi(t,r),o}(h.a),qi=0,Wi=101;function Zi(e){return(Zi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Yi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Qi(e,t){return(Qi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function $i(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=eo(e);if(t){var i=eo(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Xi(this,n)}}function Xi(e,t){return!t||"object"!==Zi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function eo(e){return(eo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var to=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Qi(e,t)}(o,e);var t,n,r,i=$i(o);function o(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),i.call(this)}return t=o,(n=[{key:"onReceived",value:function(e,t,n){}}])&&Yi(t.prototype,n),r&&Yi(t,r),o}($.a),no="listConferences",ro="createConference",io="Created";function oo(e){return(oo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ao(e,t,n,r,i,o,a){try{var u=e[o](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,i)}function uo(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){ao(o,r,i,a,u,"next",e)}function u(e){ao(o,r,i,a,u,"throw",e)}a(void 0)}))}}function co(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function so(e,t){return(so=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function lo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=vo(e);if(t){var i=vo(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return fo(this,n)}}function fo(e,t){return!t||"object"!==oo(t)&&"function"!=typeof t?ho(e):t}function ho(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function po(e,t,n){return(po="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=vo(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function vo(e){return(vo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var yo=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&so(e,t)}(o,e);var t,n,r,i=lo(o);function o(){var e,t,n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),po((e=ho(n=i.call(this,"Conference")),vo(o.prototype)),"require",e).call(e,J.a.NAME),po((t=ho(n),vo(o.prototype)),"require",t).call(t,ii.a.NAME),n.confs=[],n.pipelineListener=new to,n.contact=null,n.mpcomm=null,n}return t=o,(n=[{key:"start",value:function(){return!!po(vo(o.prototype),"start",this).call(this)&&(this.contact=this.kernel.getModule(J.a.NAME),this.mpcomm=this.kernel.getModule(ii.a.NAME),this.pipeline.addListener(o.NAME,this.pipelineListener),!0)}},{key:"stop",value:function(){po(vo(o.prototype),"stop",this).call(this),null!=this.pipeline&&this.pipeline.removeListener(o.NAME,this.pipelineListener)}},{key:"listConferences",value:function(e,t,n,r){var i=this;this.started||this.start();var a=new _.a(no,{beginning:e,ending:t});this.pipeline.send(o.NAME,a,(function(e,t,a){if(null!=a&&a.getStateCode()==M.a.OK)if(a.getPayload().code==qi){i.confs=[];var u=a.getPayload().data,c=u.beginning,s=u.ending;uo(regeneratorRuntime.mark((function e(){var t,r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=a.getPayload().data.list,r=0;case 2:if(!(r<t.length)){e.next=10;break}return o=Ki.create(i,t[r]),e.next=6,i.fillConference(o);case 6:i.confs.push(o);case 7:++r,e.next=2;break;case 10:n(i.confs,c,s);case 11:case"end":return e.stop()}}),e)})))()}else{var l=new V.a(o.NAME,a.getPayload().code,i);r&&r(l)}else{var f=new V.a(o.NAME,Wi,i);r&&r(f)}}))}},{key:"createConference",value:function(e,t,n,r,i,a,c,s){var l=this;this.started||this.start();var f=[];null!=a&&a.forEach((function(e){f.push(e.toJSON())}));var h={subject:e,password:null==t?"":t,summary:null==n?"":n,scheduleTime:r,expireTime:i,invitations:f},p=new _.a(ro,h);this.pipeline.send(o.NAME,p,(function(e,t,n){if(null!=n&&n.getStateCode()==M.a.OK)if(n.data.code==qi){var r=Ki.create(l,n.data.data);uo(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.fillConference(r);case 2:l.confs.push(r),c&&c(r),l.notifyObservers(new u.a(io,r));case 5:case"end":return e.stop()}}),e)})))()}else{var i=new V.a(o.NAME,n.data.code,h);s&&s(i)}else{var a=new V.a(o.NAME,Wi,h);s&&s(a)}}))}},{key:"fillConference",value:function(e){var t=this,n=!1,r=!1,i=!1;return new Promise((function(o,a){var u=function(){n&&r&&i&&o()};t.contact.getContact(e.founder.getId(),(function(t){e.founder=t,n=!0,u()}),(function(e){n=!0,u()})),t.contact.getContact(e.presenter.getId(),(function(t){e.presenter=t,r=!0,u()}),(function(e){r=!0,u()})),t.contact.getGroup(e.room.participantGroupId,(function(t){e.room.participantGroup=t,i=!0,u()}),(function(e){i=!0,u()}))}))}}])&&co(t.prototype,n),r&&co(t,r),o}(d.a);function go(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(yo,"NAME","Conference");var mo=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.count=0,this.total=t,this.timeout=n,this.timer=setTimeout((function(e){clearTimeout(r.timer),r._fireTimeout()}),n),this.announceDataMap=new s.a,this.audienceList=[]}var t,n,r;return t=e,(n=[{key:"getTotal",value:function(){return this.total}},{key:"announce",value:function(e,t){var n=this;void 0!==e&&(void 0===t&&(t=e),this.announceDataMap.containsKey(e)?this.announceDataMap.put(e,t):(this.announceDataMap.put(e,t),++this.count,this.count==this.total&&(clearTimeout(this.timer),new Promise((function(e,t){e()})).then((function(){for(var e=0;e<n.audienceList.length;++e)(0,n.audienceList[e])(n.count,n.announceDataMap)})))))}},{key:"addAudience",value:function(e){this.audienceList.indexOf(e)>=0||this.audienceList.push(e)}},{key:"_fireTimeout",value:function(){for(var e=0;e<this.audienceList.length;++e)(0,this.audienceList[e])(this.count,this.announceDataMap)}}])&&go(t.prototype,n),r&&go(t,r),e}(),bo={LoadLibFailed:11},wo={Ready:"Ready",Load:"Load",Loaded:"Loaded",Touched:"Touched",Error:"Error"};function ko(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var So=function(){function e(t,n,r,i,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.touched=t,this.numPixels=n,this.facePixels=r,this.score=i,this.touchScore=o,this.touch=i/r}var t,n,r;return t=e,(n=[{key:"toString",value:function(){return"Face Pixels %: ".concat(this.facePixels/this.numPixels,", Score: ").concat(this.score,", TouchScore: ").concat(this.touchScore,", ")+"Touch %: ".concat(this.touch)}}])&&ko(t.prototype,n),r&&ko(t,r),e}();function Oo(e){return(Oo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _o(e,t,n,r,i,o,a){try{var u=e[o](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,i)}function Co(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){_o(o,r,i,a,u,"next",e)}function u(e){_o(o,r,i,a,u,"throw",e)}a(void 0)}))}}function Eo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ro(e,t,n){return(Ro="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Mo(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function xo(e,t){return(xo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Po(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Mo(e);if(t){var i=Mo(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return To(this,n)}}function To(e,t){return!t||"object"!==Oo(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Mo(e){return(Mo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ao=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xo(e,t)}(a,e);var t,n,r,o=Po(a);function a(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(e=o.call(this,a.NAME)).containerEl=null,e.videoEl=null,e.width=640,e.height=480,e.canvasEl=null,e.drawCtx=null,e.stream=null,e.flipHorizontal=!0,e.ready=!1,e.isPlaying=!1,e.gotMetadata=!1,e.stopPrediction=!0,e.maskDisplayed=!0,e.updateFaceTimer=0,e.loadTimestamp=0,e}return t=a,(n=[{key:"start",value:function(){var e=this;if(!Ro(Mo(a.prototype),"start",this).call(this))return!1;if(null==this.containerEl)return!1;var t=new mo(2,1e4);return t.addAudience((function(t,n){if(2==t)e.flipHorizontal&&(e.videoEl.style.transform="scale(-1, 1)",e.videoEl.style.webkitTransform="scale(-1, 1)"),null==e.canvasEl&&(e.canvasEl=document.createElement("canvas"),e.canvasEl.setAttribute("class","cube-facemonitor-canvas"),e.canvasEl.style.position="absolute",e.canvasEl.style.float="left",e.canvasEl.style.zIndex=1,e.canvasEl.style.display="none",e.canvasEl.style.width="auto",e.canvasEl.style.height="auto",e.canvasEl.style.background="unset",e.canvasEl.style.maxWidth="unset",e.containerEl.appendChild(e.canvasEl)),e.ready=!0,e.notifyObservers(new u.a(wo.Ready,e)),e.gotMetadata&&e.isPlaying&&e.launch();else{var r=new V.a(a.NAME,bo.LoadLibFailed,e);e.notifyObservers(new u.a(wo.Error,r))}})),Ro(Mo(a.prototype),"requireFile",this).call(this,"https://static.shixincube.com/cube/javascript/libs/tfjs.js",(function(e){t.announce("tfjs")}),(function(e){i.a.Logger.w("FaceMonitor",'Load "tfjs" failed')})),Ro(Mo(a.prototype),"requireFile",this).call(this,"https://static.shixincube.com/cube/javascript/libs/body-pix.js",(function(e){t.announce("body-pix")}),(function(e){i.a.Logger.w("FaceMonitor",'Load "body-pix" failed')})),!0}},{key:"stop",value:function(){Ro(Mo(a.prototype),"stop",this).call(this),null!=this.videoEl&&this.videoEl.pause(),this.stopPrediction=!0,this.updateFaceTimer>0&&(clearInterval(this.updateFaceTimer),this.updateFaceTimer=0)}},{key:"setup",value:function(e,t){var n=this;this.containerEl=e,this.videoEl=t,this.videoEl.addEventListener("loadedmetadata",(function(){i.a.Logger.d("FaceMonitor","video metadata ready"),n.width=parseInt(n.videoEl.videoWidth),n.height=parseInt(n.videoEl.videoHeight),n.gotMetadata=!0,n.ready&&n.isPlaying&&n.launch()})),this.videoEl.addEventListener("playing",(function(){i.a.Logger.d("FaceMonitor","video playing"),n.isPlaying=!0,n.ready&&n.gotMetadata&&n.launch()}))}},{key:"activeCameraSource",value:function(e,t){var n=this;if(null==this.canvasEl)return!1;this.flipHorizontal=!0;var r=void 0===t?{width:parseInt(e)}:{width:parseInt(e),height:parseInt(t)};return l.a.getUserMedia({video:r},(function(e){n.stream=e,n.videoEl.srcObject=e}),(function(e){})),!0}},{key:"deactiveCameraSource",value:function(){this.videoEl.pause(),null!=this.stream&&this.stream.getTracks()[0].stop()}},{key:"showMask",value:function(){this.maskDisplayed=!0}},{key:"hideMask",value:function(){this.maskDisplayed=!1}},{key:"isMaskDisplayed",value:function(){return this.maskDisplayed}},{key:"pausePrediction",value:function(){}},{key:"launch",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.75,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16;this.canvasEl.style.display="inline-block",this.drawCtx=this.canvasEl.getContext("2d"),this.videoEl.width=this.videoEl.videoWidth,this.videoEl.height=this.videoEl.videoHeight,this.canvasEl.width=this.videoEl.videoWidth,this.canvasEl.height=this.videoEl.videoHeight,this.canvasEl.style.left=this.videoEl.offsetLeft+"px",i.a.Logger.i("FaceMonitor","Loading BodyPix with multiplier ".concat(e," and stride ").concat(t));var n=this,r="https://static.shixincube.com/cube/javascript/models/model-stride16.json";this.loadTimestamp=Date.now(),bodyPix.load({multiplier:e,stride:t,quantBytes:4,modelUrl:r}).then((function(e){return No(n,e)})).catch((function(e){return console.error(e)}));var o=new u.a(wo.Load,{width:n.width,height:n.height,multiplier:e,stride:t,quantBytes:4});this.notifyObservers(o)}},{key:"draw",value:function(e){var t=this,n=this.videoEl,r=this.canvasEl,i=this.drawCtx;if(this.maskDisplayed){var o=e;o.data=e.data.map((function(e){return 0!==e&&1!==e&&10!==e&&11!==e?-1:e}));var a=bodyPix.toColoredPartMask(o,[[76,187,185],[119,216,216],[255,169,49],[7,121,228],[232,94,73],[242,117,75],[248,142,83],[251,167,96],[253,190,112],[254,210,129],[254,227,149],[254,240,166],[251,248,176],[243,249,172],[231,245,163],[213,238,159],[190,229,160],[164,218,163],[137,207,165],[110,192,168],[86,173,174],[70,150,179],[67,127,180],[77,103,173]]);bodyPix.drawMask(r,n,a,.6,0,this.flipHorizontal)}0==this.maskDisplayed&&i.clearRect(0,0,r.width,r.height),this.maskDisplayed&&e.allPoses.forEach((function(n){t.flipHorizontal&&(n=bodyPix.flipPoseHorizontal(n,e.width)),t.drawKeypoints(n.keypoints,.9,i)}))}},{key:"drawKeypoints",value:function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"aqua",i=0;i<e.length;++i){var o=e[i];if(!(o.score<t)){var a=o.position,u=a.y,c=a.x;n.beginPath(),n.arc(c,u,4,0,2*Math.PI),n.fillStyle=r,n.fill()}}}},{key:"triggerTouchedEvent",value:function(e){var t=new u.a(wo.Touched,e);this.notifyObservers(t)}},{key:"_touchingCheck",value:function(e,t,n){for(var r=0,i=n;i<e.length-n;i++)for(var o=n;o<e[0].length-n;o++)if(e[i][o]>-1)for(var a=0;a<n;a++)(t[i][o-a]>-1||t[i][o+a]>-1||t[i-a][o]>-1||t[i+a][o]>-1)&&r++;return r}},{key:"_arrayToMatrix",value:function(e,t){if(e.length%t>0||t<1)return console.log("array not divisible by rowLength ",e,t),null;for(var n=[],r=e.length/t,i=0;i<r;i++){var o=e.slice(i*t,i*t+t);n.push(o)}return n}}])&&Eo(t.prototype,n),r&&Eo(t,r),a}(d.a);function No(e,t){return jo.apply(this,arguments)}function jo(){return(jo=Co(regeneratorRuntime.mark((function e(t,n){var r,i,o,a,c,s,l,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.videoEl,2,t.stopPrediction=!1,i=new Int32Array(r.width*r.height),o=!1,a=0,c=!0,t.updateFaceTimer=setInterval((function(){c=!c}),1e3),s=Date.now()-t.loadTimestamp,l=new u.a(wo.Loaded,{resetDelay:2,elapsed:s}),t.notifyObservers(l),f=regeneratorRuntime.mark((function e(){var u,s,l,f,h,p,d,v,y,g,m,b,w,k,S,O;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u={flipHorizontal:t.flipHorizontal,maxDetections:1,scoreThreshold:.5,segmentationThreshold:.6},e.next=3,n.segmentPersonParts(r,u);case 3:if(s=e.sent,l=.9,f=.01,h=s.width*s.height,void 0!==s.allPoses[0]){e.next=9;break}return e.abrupt("return","continue");case 9:if(t.draw(s),p=s.allPoses[0].keypoints[0].score>l,d=s.allPoses[0].keypoints[1].score>l,v=s.allPoses[0].keypoints[2].score>l,p&&(d||v)){for(y=s.data.map((function(e){return 0===e||1===e?e:-1})),g=s.data.map((function(e){return 10===e||11===e?e:-1})),m=0,b=0,w=0;w<i.length;w++)i[w]>-1&&m++,i[w]>-1&&g[w]>-1&&b++;k=t._arrayToMatrix(y,s.width),S=t._arrayToMatrix(g,s.width),O=t._touchingCheck(k,S,10),c&&(i=y),(b+=O)>m*f&&(o?(a>0&&clearTimeout(a),a=setTimeout((function(){o=!1,t.triggerTouchedEvent(new So(o,h,m,b,O))}),2e3)):(o=!0,t.triggerTouchedEvent(new So(o,h,m,b,O)),a>0&&clearTimeout(a),a=setTimeout((function(){o=!1,t.triggerTouchedEvent(new So(o,h,m,b,O))}),2e3)))}case 14:case"end":return e.stop()}}),e)}));case 12:if(!t.isPlaying||t.stopPrediction){e.next=19;break}return e.delegateYield(f(),"t0",14);case 14:if("continue"!==e.t0){e.next=17;break}return e.abrupt("continue",12);case 17:e.next=12;break;case 19:a>0&&clearTimeout(a);case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Io(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(Ao,"NAME","FaceMonitor");var Lo=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.kernel=new p.a,this.kernel.installPipeline(new S.a),this.kernel.installPipeline(new H),this.kernel.installModule(new z.a),this.kernel.installModule(new J.a),this.kernel.installModule(new Rt),this.kernel.installModule(new Mn),this.kernel.installModule(new ri),this.kernel.installModule(new ii.a),this.kernel.installModule(new ki),this.kernel.installModule(new yo),this.kernel.installModule(new Ao),this.selectFileHandle=null}var t,n,r;return t=e,(n=[{key:"start",value:function(e,t,n){var r=this,i=t||function(){},o=n||function(){};this.kernel.startup(e,(function(){i(r)}),(function(e){o(e)}))}},{key:"stop",value:function(){this.kernel.shutdown()}},{key:"suspend",value:function(){this.kernel.suspend()}},{key:"resume",value:function(){this.kernel.resume()}},{key:"getMainPipeline",value:function(){return this.kernel.getPipeline(S.a.NAME)}},{key:"getModule",value:function(e){return this.kernel.getModule(e)}},{key:"getAuthService",value:function(){return this.kernel.getModule(z.a.NAME)}},{key:"getContactService",value:function(){return this.kernel.getModule(J.a.NAME)}},{key:"getFileStorage",value:function(){return this.kernel.getModule(Rt.NAME)}},{key:"getMessagingService",value:function(){return this.kernel.getModule(Mn.NAME)}},{key:"getFileProcessor",value:function(){return this.kernel.getModule(ri.NAME)}},{key:"getMultipointComm",value:function(){return this.kernel.getModule(ii.a.NAME)}},{key:"getConferenceService",value:function(){return this.kernel.getModule(yo.NAME)}},{key:"launchFileSelector",value:function(e,t){var n=this;void 0===t&&(t="*.*");var r=document.querySelector("div#_cube_file_selector");if(null==r){(r=document.createElement("div")).setAttribute("id","_cube_file_selector"),r.style.position="absolute",r.style.float="left",r.style.top="0",r.style.zIndex=-99,r.style.visibility="hidden";var i=['<label for="_cube_file_input"></label>','<input type="file" id="_cube_file_input" name="_cube_file_input" accept="',t,'"></input>'];r.innerHTML=i.join(""),document.body.appendChild(r),document.getElementById("_cube_file_input").onchange=function(e){n._onFileInputChanged(e)}}this.selectFileHandle=e;var o=document.getElementById("_cube_file_input");o.setAttribute("accept",t),o.click()}},{key:"addLogHandler",value:function(e){i.a.Logger.addHandler(e)}},{key:"removeLogHandler",value:function(e){i.a.Logger.removeHandler(e)}},{key:"_onFileInputChanged",value:function(e){this.selectFileHandle(e)}}])&&Io(t.prototype,n),r&&Io(t,r),e}();function Fo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Do=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.engine=new Lo,this.auth=this.engine.getAuthService(),this.contact=this.engine.getContactService(),this.fileStorage=this.engine.getFileStorage(),this.fs=this.fileStorage,this.messaging=this.engine.getMessagingService(),this.fileProcessor=this.engine.getFileProcessor(),this.fp=this.fileProcessor,this.mpComm=this.engine.getMultipointComm(),this.conference=this.engine.getConferenceService(),this.cs=this.conference}var t,n,r;return t=e,(n=[{key:"start",value:function(e,t,n){var r=this;void 0===e.pipelineReady&&(e.pipelineReady=!0),this.engine.start(e,(function(e){r.contact.start(),r.fileStorage.start(),r.fileProcessor.start(),r.messaging.start(),r.mpComm.start(),t(e)}),n)}},{key:"stop",value:function(){this.engine.stop()}},{key:"isReady",value:function(){return this.contact.isReady()&&this.fileStorage.isReady()&&this.fileProcessor.isReady()&&this.mpComm.isReady()}},{key:"getModule",value:function(e){return this.engine.getModule(e)}},{key:"on",value:function(e,t){"network"!=e&&"pipeline"!=e||this.engine.getMainPipeline().addStateListener(t)}},{key:"signIn",value:function(e,t,n,r){this.engine.getContactService().signIn(e,t,n,r)}},{key:"signOut",value:function(){return this.engine.getContactService().signOut()}},{key:"launchFileSelector",value:function(e,t){this.engine.launchFileSelector(e,t)}},{key:"addLogHandler",value:function(e){this.engine.addLogHandler(e)}},{key:"removeLogHandler",value:function(e){this.engine.removeLogHandler(e)}}])&&Fo(t.prototype,n),r&&Fo(t,r),e}(),Bo=n(103),Go=n(70),Uo=n(124),Ho=n(5),zo=n(89),Jo=n(105),Vo={Normal:0,Pending:1,KnownPending:2,Reject:3},Ko=n(88),qo=n(126),Wo=n(56),Zo=n(64);function Yo(e){return(Yo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Qo(e,t){return(Qo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function $o(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ea(e);if(t){var i=ea(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Xo(this,n)}}function Xo(e,t){return!t||"object"!==Yo(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ea(e){return(ea=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ta,na=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Qo(e,t)}(n,e);var t=$o(n);function n(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),t.call(this,0,"CubeDummyContact")}return n}(K.a),ra=n(104),ia=n(62),oa=n(71),aa=n(127),ua=n(54),ca=n(106),sa=n(83),la=n(158),fa=n(9),ha=n(8),pa=n(63),da=fa.a,va=ha.a,ya=fa.a,ga=n(43);(ta=void 0===window.CubeNamespace?window:window.CubeNamespace).Subject=o.a,ta.Observer=a.a,ta.ObservableEvent=u.a,ta.JSONable=c.a,ta.Entity=h.a,ta.OrderMap=s.a,ta.MediaDeviceTool=l.a,ta.MediaDeviceDescription=f.a,ta.CubeEngine=Lo,ta.Kernel=p.a,ta.Plugin=Bo.a,ta.CellPipeline=S.a,ta.AuthToken=Go.a,ta.AuthService=z.a,ta.PrimaryDescription=Uo.a,ta.ContactService=J.a,ta.ContactServiceState=Ho.a,ta.ContactContextProvider=zo.a,ta.ContactEvent=W.a,ta.Contact=K.a,ta.ContactZone=Jo.a,ta.ContactZoneParticipantType=Ko.a,ta.ContactZoneParticipantState=Vo,ta.ContactZoneParticipant=qo.a,ta.Self=Wo.a,ta.Group=q.a,ta.GroupState=xt.a,ta.GroupBundle=Zo.a,ta.DummyContact=na,ta.ContactAppendix=ra.a,ta.GroupAppendix=ia.a,ta.MessagingService=Mn,ta.MessagingServiceState=Wt,ta.MessagingEvent=qt,ta.Message=Pt.a,ta.MessageState=Tt.a,ta.MessagePlugin=wn.a,ta.Conversation=an,ta.ConversationType=Zt,ta.ConversationState=Yt,ta.ConversationReminding=Qt,ta.FileStorage=Rt,ta.FileAnchor=Z.a,ta.FileLabel=Y.a,ta.FileAttachment=oa.a,ta.FileStorageEvent=Q,ta.Directory=tt,ta.SearchItem=Qe,ta.TrashFile=Ze,ta.TrashDirectory=He,ta.SharingTag=st,ta.VisitTrace=gt,ta.FileProcessor=ri,ta.FileThumbnail=aa.a,ta.MultipointComm=ii.a,ta.VideoDimension=ca.a,ta.MediaConstraint=ua.a,ta.RTCDevice=sa.a,ta.MultipointCommEvent=fa.a,ta.MultipointCommState=ha.a,ta.CallRecord=pa.a,ta.CallEvent=da,ta.CallState=va,ta.CommEvent=ya,ta.CommField=Ti.a,ta.CommFieldEndpoint=ga.a,ta.MediaListener=la.a,ta.ConferenceService=yo,ta.Conference=Ki,ta.Invitation=Pi,ta.FaceMonitor=Ao,ta.FaceMonitorEvent=wo,ta.FaceMonitorState=bo,ta.Announcer=mo,ta.cell=i.a,ta._cube_=null,ta.cube=function(){return void 0!==ta._cube_&&null!=ta._cube_||(ta._cube_=new Do),ta._cube_},void 0===ta.engine&&(ta.engine=ta.cube())},function(e,t,n){"use strict";n.r(t);var r=n(86);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=s(e);if(t){var i=s(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return c(this,n)}}function c(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(c,e);var t,n,r,i=u(c);function c(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),i.call(this,e)}return t=c,(n=[{key:"getType",value:function(){return this.payload.type}}])&&o(t.prototype,n),r&&o(t,r),c}(n(19).a);function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=y(e);if(t){var i=y(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return v(this,n)}}function v(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var g=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(o,e);var t,n,r,i=d(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),t=i.call(this,e),"string"==typeof e?t.payload={type:"text",content:e}:void 0!==e&&null!=e||(t.payload={type:"text"}),t}return t=o,(n=[{key:"getSummary",value:function(){return this.getText()}},{key:"setText",value:function(e){this.payload.content=e}},{key:"getText",value:function(){return this.payload.content}}])&&h(t.prototype,n),r&&h(t,r),o}(l);function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=O(e);if(t){var i=O(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return S(this,n)}}function S(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var _=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(o,e);var t,n,r,i=k(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this,e)).hasAttachment()&&t.getAttachment().enableThumb(),void 0===t.payload.type&&(t.payload.type="image"),t}return t=o,(n=[{key:"getSummary",value:function(){return"[图片] "+this.getFileName()}},{key:"getFileName",value:function(){return this.attachment.getFileName()}},{key:"disableThumb",value:function(){this.hasAttachment()&&this.getAttachment().disableThumb()}}])&&b(t.prototype,n),r&&b(t,r),o}(l);function C(e){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function R(e,t){return(R=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function x(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=T(e);if(t){var i=T(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return P(this,n)}}function P(e,t){return!t||"object"!==C(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var M=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&R(e,t)}(o,e);var t,n,r,i=x(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),void 0===(t=i.call(this,e)).payload.type&&(t.payload.type="file"),t}return t=o,(n=[{key:"getSummary",value:function(){return"[文件] "+this.getFileName()}},{key:"getFileName",value:function(){return this.attachment.getFileName()}},{key:"getFileSize",value:function(){return this.attachment.getFileSize()}},{key:"getExtension",value:function(){if(!this.hasAttachment())return null;var e=this.attachment.getFileName(),t=e.lastIndexOf(".");return t>0?e.substring(t+1,e.length):null}}])&&E(t.prototype,n),r&&E(t,r),o}(l),A=n(7),N=n(63);function j(e){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function I(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function L(e,t){return(L=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function F(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=B(e);if(t){var i=B(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return D(this,n)}}function D(e,t){return!t||"object"!==j(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function B(e){return(B=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var G=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&L(e,t)}(o,e);var t,n,r,i=F(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this,e)).caller=null,t.callee=null,e instanceof N.a?(t.payload={},t.payload.type="call",t.setConstraint(e.callerMediaConstraint.videoEnabled,e.callerMediaConstraint.audioEnabled),t.setCaller(e.getCaller()),t.setCallee(e.getCallee()),t.setDuration(e.getDuration()),t.setAnswerTime(e.answerTime)):void 0===t.payload.type&&(t.payload.type="call"),t}return t=o,(n=[{key:"getSummary",value:function(){return this.getConstraint().video?"[视频通话]":"[语音通话]"}},{key:"setConstraint",value:function(e,t){this.payload.constraint={video:e,audio:t}}},{key:"getConstraint",value:function(){return this.payload.constraint}},{key:"isCaller",value:function(e){return"number"==typeof e?this.payload.caller.id==e:this.payload.caller.id==e.id}},{key:"setCaller",value:function(e){null!=e&&(this.caller=e,this.payload.caller=e.toCompactJSON())}},{key:"getCaller",value:function(){return void 0===this.payload.caller?null:(null==this.caller&&(this.caller=A.a.create(this.payload.caller)),this.caller)}},{key:"setCallee",value:function(e){null!=e&&(this.callee=e,this.payload.callee=e.toCompactJSON())}},{key:"getCallee",value:function(){return void 0===this.payload.callee?null:(null==this.callee&&(this.callee=A.a.create(this.payload.callee)),this.callee)}},{key:"setDuration",value:function(e){this.payload.duration=e}},{key:"getDuration",value:function(){return this.payload.duration}},{key:"setAnswerTime",value:function(e){this.payload.answerTime=e}},{key:"getAnswerTime",value:function(){return this.payload.answerTime}}])&&I(t.prototype,n),r&&I(t,r),o}(l);function U(e){return(U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function H(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function z(e,t){return(z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function J(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=K(e);if(t){var i=K(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return V(this,n)}}function V(e,t){return!t||"object"!==U(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function K(e){return(K=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var q=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&z(e,t)}(o,e);var t,n,r,i=J(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),t=i.call(this,e),"string"==typeof e?t.payload={type:"hypertext",content:e}:void 0!==e&&null!=e||(t.payload={type:"hypertext"}),t.formattedContents=[],t.plaintext=t.payload.content,t.parse(t.payload.content),t}return t=o,(n=[{key:"getSummary",value:function(){return this.plaintext}},{key:"getPlaintext",value:function(){return this.plaintext}},{key:"getFormattedContents",value:function(){return this.formattedContents}},{key:"setContent",value:function(e){this.payload.content=e}},{key:"getContent",value:function(){return this.payload.content}},{key:"parse",value:function(e){for(var t=[],n=!1,r=!1,i=[],o=0;o<e.length;++o){var a=e.charAt(o);if("\\"==a)a=e.charAt(++o),n||r?i.push(a):t.push(a);else if("["==a){var u=e.charAt(o+1);"E"==u?(this.formattedContents.push({format:"text",content:t.join("")}),t.splice(0,t.length),n=!0,++o):"@"==u&&(this.formattedContents.push({format:"text",content:t.join("")}),t.splice(0,t.length),r=!0,++o)}else if("]"==a){if(n){n=!1;var c=this.parseEmoji(i);i.splice(0,i.length),this.formattedContents.push({format:"emoji",content:c})}else if(r){r=!1;var s=this.parseAt(i);i.splice(0,i.length),this.formattedContents.push({format:"at",content:s})}}else n||r?i.push(a):t.push(a)}t.length>0&&this.formattedContents.push({format:"text",content:t.join("")}),t.splice(0,t.length);for(var l=0;l<this.formattedContents.length;++l){var f=this.formattedContents[l];"text"==f.format?t.push(f.content):"emoji"==f.format?(t.push("["),t.push(f.content.desc),t.push("]")):"at"==f.format&&(t.push(" @"),t.push(f.content.name),t.push(" "))}this.plaintext=t.join("")}},{key:"parseEmoji",value:function(e){var t=e.join(""),n=t.lastIndexOf("#");return{desc:t.substring(0,n),code:t.substring(n+1)}}},{key:"parseAt",value:function(e){var t=e.join(""),n=t.lastIndexOf("#");return{name:t.substring(0,n),id:parseInt(t.substring(n+1))}}}])&&H(t.prototype,n),r&&H(t,r),o}(l);function W(e){return(W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Y(e,t){return(Y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Q(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=X(e);if(t){var i=X(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return $(this,n)}}function $(e,t){return!t||"object"!==W(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function X(e){return(X=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ee=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Y(e,t)}(o,e);var t,n,r,i=Q(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),t=i.call(this,e),"string"==typeof e?t.payload={type:"localnote",note:{text:e,level:1}}:void 0!==e&&null!=e||(t.payload={type:"localnote",note:{text:"",level:1}}),t.markOnlyOwner(),t}return t=o,(n=[{key:"getSummary",value:function(){return this.getText()}},{key:"setText",value:function(e){this.payload.note.text=e}},{key:"getText",value:function(){return this.payload.note.text}},{key:"setLevel",value:function(e){this.payload.note.level=e}},{key:"getLevel",value:function(){return this.payload.note.level}}])&&Z(t.prototype,n),r&&Z(t,r),o}(l);function te(e){return(te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ne(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function re(e,t){return(re=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ie(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ae(e);if(t){var i=ae(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return oe(this,n)}}function oe(e,t){return!t||"object"!==te(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ae(e){return(ae=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ue,ce=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&re(e,t)}(o,e);var t,n,r,i=ie(o);function o(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),i.call(this)}return t=o,(n=[{key:"onInstantiate",value:function(e){var t=e.getPayload();if(void 0!==t.type){if("text"==t.type)return new g(e);if("hypertext"==t.type)return new q(e);if("file"==t.type)return new M(e);if("image"==t.type)return new _(e);if("call"==t.type)return new G(e);if("localnote"==t.type)return new ee(e)}return e}}])&&ne(t.prototype,n),r&&ne(t,r),o}(r.a);(ue=void 0===window.CubeNamespace?window:window.CubeNamespace).MessageTypePlugin=ce,ue.TextMessage=g,ue.ImageMessage=_,ue.FileMessage=M,ue.CallRecordMessage=G,ue.HyperTextMessage=q,ue.LocalNoteMessage=ee}]);
//# sourceMappingURL=cube.js.map