!function(e){var n=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3}),i=Swal.mixin({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3}),o=function(){},s=function(){},l=null,r=null,c=!1,t={getFullHeight:function(){return parseInt(document.body.clientHeight)+57+8},launchToast:function(t,e,a){(a?i:n).fire({icon:t,title:e})},showPrompt:function(t,e,a,n){var i=$("#modal_prompt");i.find(".modal-title").text(t),i.find(".prompt-label").text(e),n?i.find(".prompt-input").val(n):i.find(".prompt-input").val(""),o=a,i.modal()},closePrompt:function(t){var e,a=$("#modal_prompt");t?void 0!==(e=o(t,a.find(".prompt-input").val()))&&!e||a.modal("hide"):o(t,a.find(".prompt-input").val())},hidePrompt:function(t){void 0!==t?this.closePrompt(t):$("#modal_prompt").modal("hide")},showConfirm:function(t,e,a,n){var i=$("#modal_confirm");i.find(".modal-title").text(t),i.find(".modal-body").html("<p>"+e+"</p>"),i.find(".btn-primary").text(n||"确定"),s=a,i.modal()},closeConfirm:function(t){s(t)},hideConfirm:function(t){this.closeConfirm(t)},showAlert:function(t,e,a){var n=$("#modal_alert");n.find(".modal-body").html("<p>"+t+"</p>"),a?n.find("button.btn-default").text(a):n.find("button.btn-default").text("确定"),l=void 0===e?null:e,n.modal()},closeAlert:function(){null!=l&&l(),$("#modal_alert").modal("hide")},hideAlert:function(){this.closeAlert()},showLoading:function(t,e){if(!c){c=!0,void 0===e&&(e=8e3);var a=0,n=0;null==r&&(r=$("#modal_loading")).on("hidden.bs.modal",function(){0!=a&&clearInterval(a),0!=n&&clearTimeout(n),c=!1});var i=r;i.find(".modal-title").html(t+"&hellip;");var o=i.find(".modal-elapsed-time");o.text("0 秒");var s=0,a=setInterval(function(){++s,o.text(s+" 秒")},1e3);return i.modal({keyboard:!1,backdrop:"static"}),n=setTimeout(function(){clearInterval(a),a=0,clearTimeout(n),n=0,i.modal("hide")},e),i}},hideLoading:function(){(null!=r?r:$("#modal_loading")).modal("hide")},showImage:function(t){e.cube().fileStorage.getFileURL(t,function(t,e,a){!function(t){var e=new Image;e.src=t;var a=new Viewer(e,{hidden:function(){a.destroy()}});a.show()}(e)})},downloadFile:function(t){e.cube().fileStorage.downloadFile(t)}};e.dialog=t,e.Toast={Success:"success",Info:"info",Error:"error",Warning:"warning",Question:"question"}}(window),function(e){"use strict";function t(){var t=$("body");i=t.find('a[data-widget="pushmenu"]'),$(document).on("shown.lte.pushmenu",function(){o=!1,e.app.saveConfig("sidebarCollapse",o)}),$(document).on("collapsed.lte.pushmenu",function(){o=!0,e.app.saveConfig("sidebarCollapse",o)}),$(".main-sidebar").on("mouseout",function(){o&&(0<s||(s=setTimeout(function(){clearTimeout(s),s=0,$(".main-sidebar").removeClass("sidebar-focused")},100)))})}var a="messaging",n="tab_messaging",i=null,o=!1,s=0,l=null,r=null;t.prototype.prepare=function(){var t=e.app.loadConfig("sidebarCollapse");null!=t&&void 0!==t&&(o=t)&&i.PushMenu("collapse"),l=$('audio[data-target="call-ring"]')[0],r=$('audio[data-target="waiting-tone"]')[0]},t.prototype.toggle=function(t){var e;a!=t&&(e="tab_"+t,$("#"+a).addClass("content-wrapper-hidden"),$("#"+t).removeClass("content-wrapper-hidden"),a=t,$("#"+n).removeClass("active"),$("#"+e).addClass("active"),n=e,"messaging"==t?$(".main-title").text("消息"):"files"==t?$(".main-title").text("文件"):"conference"==t?$(".main-title").text("会议"):"contacts"==t&&$(".main-title").text("联系人"))},t.prototype.playCallRing=function(){l.volume=1,l.paused&&(l.removeAttribute("muted"),l.play())},t.prototype.stopCallRing=function(){l.pause(),l.setAttribute("muted","muted")},t.prototype.playWaitingTone=function(){r.volume=1,r.paused&&(r.removeAttribute("muted"),r.play())},t.prototype.stopWaitingTone=function(){r.pause(),r.setAttribute("muted","muted")},e.MainPanel=t}(window),function(i){var a=null,n=null,o=null,s=0,l=null,r=null;function e(){0<s&&(clearTimeout(s),s=0)}function c(){0<s||(s=setTimeout(function(){a.hide()},500))}function d(){$(this).next().css("display","block")}function p(){$(this).next().css("display","none")}function u(){var t=$(this),e={code:t.text().codePointAt(0).toString(16),desc:t.next().text()};r(e),t.hasClass("recent-emoji")||a.appendRecent(e)}function t(t){a=this,r=t,(n=$(".emoji-panel")).on("mouseover",e),n.on("mouseout",c),n.blur(blur),n.find(".emoji").on("mouseover",d),n.find(".emoji").on("mouseout",p),n.find(".emoji").click(u),o=n.find(".recent"),setTimeout(function(){a.loadRecent()},1e3)}t.prototype.show=function(t){var e=i.getElementLeft(t[0]),t=i.getElementTop(t[0]);t-=338,n.css("left",e+"px"),n.css("top",t+"px"),n.css("display","block"),0<s&&(clearTimeout(s),s=0)},t.prototype.hide=function(){n.css("display","none")},t.prototype.tryHide=function(){0<s&&(clearTimeout(s),s=0),s=setTimeout(function(){a.hide()},500)},t.prototype.loadRecent=function(){if(null!=(l=i.app.loadConfig("recentEmoji")))for(var t=0;t<l.length;++t){var e=l[t],a=o.find(".recent-"+t);a.find(".emoji").html("&#x"+e.code+";"),a.find(".emoji-desc").html(e.desc),a.css("visibility","visible")}else l=[]},t.prototype.appendRecent=function(t){for(var e=0;e<l.length;++e)if(l[e].code==t.code){l.splice(e,1);break}l.unshift(t),10<l.length&&l.pop();for(e=0;e<l.length;++e){var a=l[e];(n=o.find(".recent-"+e)).find(".emoji").html("&#x"+a.code+";"),n.find(".emoji-desc").html(a.desc),n.css("visibility","visible")}for(var n,e=l.length;e<10;++e)(n=o.find(".recent-"+e)).find(".emoji").html("&nbsp;"),n.find(".emoji-desc").html("&nbsp;"),n.css("visibility","hidden");i.app.saveConfig("recentEmoji",l)},i.EmojiPanel=t}(window),function(n){"use strict";function t(t){i=t}var i=null;t.prototype.open=function(t,e){var a;i.find('h3[data-target="file-name"]').text(t.getFileName()),i.find('h5[data-target="file-type"]').text(t.getFileType().toUpperCase()),i.find('h5[data-target="file-size"]').text(n.formatSize(t.getFileSize())),i.find('h5[data-target="file-date"]').text(n.formatYMDHMS(t.getLastModified())),e?(n.recurseParent(t=[],e),a=[],1==t.length?a.push("/"):t.forEach(function(t){t.isRoot()||a.push(t.getName()+" &gt; ")}),i.find('h5[data-target="file-path"]').html(a.join(""))):i.find('h5[data-target="file-path"]').text("--"),i.modal("show")},t.prototype.close=function(){i.modal("hide")},n.FileDetails=t}(window),function(t){"use strict";function e(t){this.el=t;var e=this;this.el.find('a[data-target="name"]').on("click",function(){e.showDetail()})}e.prototype.updateAvatar=function(t){this.el.find('img[data-target="avatar"]').attr("src","images/"+t)},e.prototype.updateName=function(t){this.el.find('a[data-target="name"]').text(t)},e.prototype.showDetail=function(){},t.SidebarAccountPanel=e}(window),function(a){"use strict";function s(t,e){return 0==e.time&&0==t.time?e.label.localeCompare(t.label):e.time-t.time}function t(t){this.el=t.find('ul[data-target="catalogue"]'),this.noMsgEl=t.find(".no-message"),this.items=[],this.topItems=[],this.currentItem=null}t.prototype.getActiveItem=function(){return this.currentItem},t.prototype.getItem=function(t){for(var e=parseInt(t),a=0;a<this.items.length;++a){var n=this.items[a];if(n.id==e)return n}return null},t.prototype.getEntityList=function(){var e=[];return this.items.forEach(function(t){e.push(t.entity)}),e},t.prototype.appendItem=function(t,e){var a=this.items.length,n=0,i=null,o="images/group-avatar.png",s=null,l=null,r=null,c=0;if(t instanceof Group?(n=t.getId(),s=t.getName(),l="　",r=formatShortTime(t.getLastActiveTime()),c=t.getLastActiveTime()):t instanceof Contact?(n=t.getId(),o="images/"+t.getContext().avatar,s=t.getAppendix().hasRemarkName()?t.getAppendix().getRemarkName():t.getContext().name,l="　",r=""):"object"==typeof t&&(n=t.id,o="images/"+t.avatar,s=t.name,l="　",r=""),null==s||null==s)return!1;if(null!=(d=this.getItem(n)))return!1;this.noMsgEl.css("display","none");var d={index:a,id:n,el:i,entity:t,thumb:o,label:s,desc:l,lastDesc:"　",timeBadge:r,time:c,top:!1},i=$(['<li id="mc_item_',a,'" class="item pl-2 pr-2" data="',n,'">','<div class="item-img" style="background-image:url(',o,');">','<div class="item-state">',"</div>",'<div class="item-top"><div class="top-action" onclick="app.messageCatalog.topItem(',n,');">','<i class="fas fa-sort-up"></i><div>置顶</div>',"</div></div>",'<span class="badge badge-danger unread-badge"></span>','<div class="top-wrapper">','<div class="top text-primary"><i class="fas fa-caret-up"></i></div>',"</div>","</div>",'<div class="product-info ellipsis">','<span class="product-title ellipsis">','<span class="title">',s,"</span>",'<span class="badge badge-light float-right last-time">',r,"</span>","</span>",'<span class="product-description">',l,"</span>",'<div class="item-close">','<a href="javascript:;" onclick="app.messageCatalog.onItemClose(',n,');"><span class="badge badge-light"><i class="fas fa-times"></i></span></a>',"</div>","</div>","</li>"].join(""));if(d.el=i,e){if(0==this.items.length)this.el.append(i);else for(var p=0;p<this.items.length;++p){var u=this.items[p];if(!(0<=this.topItems.indexOf(u))){u.el.before(i);break}}this.items.unshift(d)}else this.el.append(i),this.items.push(d);return this.bindEvent(i),!0},t.prototype.removeItem=function(t){for(var e=0,e=t instanceof Group||t instanceof Contact?t.getId():parseInt(t),a=null,n=0;n<this.items.length;++n){var i=this.items[n];if(i.id==e){a=i,this.items.splice(n,1);break}}0==this.items.length&&this.noMsgEl.css("display","table"),null!=this.currentItem&&e==this.currentItem.id&&(this.currentItem=null),null!=a&&a.el.remove()},t.prototype.updateItem=function(t,e,a,n){var i=0;if("number"==typeof t)i=t;else if(t instanceof Group)i=t.getId();else{if(!(t instanceof Contact))return console.log("[App] MessageCatalogue#updateItem 输入参数错误"),!1;i=t.getId()}var o=this.getItem(i);if(null==o){if(!this.appendItem(t,!0))return!1;o=this.getItem(i)}var s=o.el;if(null!=e){if(o.lastDesc=o.desc,"string"==typeof e)o.desc=0==e.length?"　":e;else if(e instanceof TextMessage)o.desc=e.getSummary();else if(e instanceof HyperTextMessage)o.desc=e.getSummary();else if(e instanceof ImageMessage)o.desc=e.getSummary();else if(e instanceof FileMessage){i=e;i.hasAttachment()?o.desc=i.getSummary():o.desc="[文件]"}else if(e instanceof CallRecordMessage)e.getConstraint().video?o.desc="[视频通话]":o.desc="[语音通话]";else{if(!(e instanceof File))return!1;o.desc="[文件] "+e.name}s.find(".product-description").html(o.desc)}null!=a&&(o.time=a,s.find(".last-time").text(formatShortTime(a))),n&&(o.label=n,s.find(".title").text(n));for(var l=0;l<this.items.length;++l)if(this.items[l]==o){this.items.splice(l,1);break}if(this.items.unshift(o),o.top){for(l=0;l<this.topItems.length;++l)if(this.topItems[l]==o){this.topItems.splice(l,1);break}this.topItems.unshift(o),s.remove(),this.el.prepend(s)}else if(s.remove(),1==this.items.length)this.el.append(s);else{for(var r=!1,l=1;l<this.items.length;++l)if(!this.items[l].top){r=!0,this.items[l].el.before(s);break}r||this.el.append(s)}return this.bindEvent(s),!0},t.prototype.topItem=function(t){var i,o=this.getItem(t);null!=o&&(i=this,o.top?a.cube().contact.removeTopList(o.entity,function(){o.top=!1,o.el.find(".top-action").html('<i class="fas fa-sort-up"></i><div>置顶</div>'),o.el.find(".top-wrapper").css("visibility","hidden");var t=i.topItems.indexOf(o);i.topItems.splice(t,1),i.items.sort(s);for(var e=[],a=0;a<i.items.length;++a){var n=i.items[a];0<=i.topItems.indexOf(n)||e.push(n)}0==(t=e.indexOf(o))&&1<e.length?(o.el.remove(),e[t+1].el.before(o.el),i.bindEvent(o.el)):0<t&&(o.el.remove(),e[t-1].el.after(o.el),i.bindEvent(o.el))}):a.cube().contact.addTopList(o.entity,function(){o.top=!0,o.el.find(".top-action").html('<i class="fas fa-sort"></i>'),o.el.find(".top-wrapper").css("visibility","visible"),i.topItems.push(o),i.topItems.sort(s);var t=i.topItems.indexOf(o);0==t?(o.el.remove(),i.el.prepend(o.el)):(o.el.remove(),i.topItems[t-1].el.after(o.el)),i.bindEvent(o.el)}))},t.prototype.restoreDesc=function(t,e){var a=0;if("number"==typeof t)a=t;else if(t instanceof Contact)a=t.getId();else{if(!(t instanceof Group))return void console.log("[App] MessageCatalogue#restoreLastDesc 输入参数错误");a=t.getId()}a=this.getItem(a);null!=a&&(a.el.find(".product-description").html(e),a.desc=e)},t.prototype.updateBadge=function(t,e){t=this.getItem(t);null!=t&&(0==e?t.el.find(".unread-badge").text(""):99<e?t.el.find(".unread-badge").text("99+"):t.el.find(".unread-badge").text(e))},t.prototype.updateState=function(t,e){t=this.getItem(t);null!=t&&(t=t.el.find(".item-state"),"video"==e?t.html('<div><i class="fas fa-video"></i></div>'):"voice"==e||"audio"==e?t.html('<div><i class="fas fa-phone-alt"></i></div>'):t.html(""))},t.prototype.refreshOrder=function(){var o=this;o.topItems=[],a.cube().contact.queryTopList(function(t){for(var e=0;e<t.length;++e){var a=o.getItem(t[e].id);null!=a&&(o.topItems.push(a),a.top=!0)}o.items.sort(s),o.topItems.sort(s);for(var n=o.topItems.concat();0<n.length;){for(var i=n.pop(),e=0;e<o.items.length;++e)if(i.id==o.items[e].id){o.items.splice(e,1);break}o.items.unshift(i),i.el.find(".top-action").html('<i class="fas fa-sort"></i>'),i.el.find(".top-wrapper").css("visibility","visible")}o.el.empty(),o.items.forEach(function(t){o.el.append(t.el),o.bindEvent(t.el)})})},t.prototype.activeItem=function(t){if(null!=this.currentItem){if(this.currentItem.id==t)return;this.currentItem.el.removeClass("catalog-active")}t=this.getItem(t);t.el.addClass("catalog-active"),this.currentItem=t},t.prototype.onItemClick=function(t){if(null!=this.currentItem){if(this.currentItem.id==t)return;this.currentItem.el.removeClass("catalog-active")}t=this.getItem(t);t.el.addClass("catalog-active"),this.currentItem=t,a.app.messagingCtrl.toggle(this.currentItem.id)},t.prototype.onItemDoubleClick=function(t){var e=a.app.queryContact(t);null==e?a.cube().contact.getGroup(t,function(t){a.app.groupDetails.show(t)}):a.app.contactDetails.show(e)},t.prototype.onItemMouseover=function(t){this.getItem(t).el.find(".item-close").css("visibility","visible")},t.prototype.onItemMouseout=function(t){this.getItem(t).el.find(".item-close").css("visibility","hidden")},t.prototype.onItemClose=function(t){var e=a.app.queryContact(t);null==e?a.cube().contact.getGroup(t,function(t){a.app.messagingCtrl.removeGroup(t)}):a.app.messagingCtrl.removeContact(e)},t.prototype.bindEvent=function(t){var a=this;t.on("click",function(t){var e=parseInt($(this).attr("data"));a.onItemClick(e)}),t.on("dblclick",function(t){var e=parseInt($(this).attr("data"));a.onItemDoubleClick(e)}),t.on("mouseenter",function(t){var e=parseInt($(this).attr("data"));a.onItemMouseover(e)}),t.on("mouseleave",function(t){var e=parseInt($(this).attr("data"));a.onItemMouseout(e)}),t.find(".item-state").on("mouseenter",function(){t.find(".top-action").css("visibility","visible")}),t.find(".item-top").on("mouseleave",function(){t.find(".top-action").css("visibility","hidden")})},a.MessageCatalogue=t}(window),function(C){var c=null;function t(t){this.el=t,this.panels={},(c=this).current=null,this.elTitle=this.el.find(".card-title"),this.elStateBar=this.el.find(".card-header").find(".state-bar"),this.elInfoBar=this.el.find(".card-header").find(".info-bar"),this.elContent=this.el.find(".card-body"),this.inputEditor=null,this.elInput=null,this.atPanel=this.el.find(".at-someone"),this.atPanel.blur(function(t){c.onAtPanelBlur(t)}),this.atElList=[],this.formatContents=[],this.lastInput="",this.el.find("textarea").parent().remove(),$("#message-editor").parent().css("display","flex");var e=new window.wangEditor("#message-editor");e.config.menus=[],e.config.height=70,e.config.placeholder="",e.config.fontSizes={normal:"14px",value:"3"},e.config.lineHeights=["1"],e.config.onchange=function(t){c.onEditorChange(t)},e.config.pasteTextHandle=function(t){return c.handlePasteText(t)},e.create(),e.disable(),this.inputEditor=e,(e=$("#message-editor").find(".w-e-text")).keypress(function(t){c.onEditorKeypress(t)}),this.weEl=e,this.infoBarDelayTimer=0,this.elStateBar.on("mouseenter",function(){0<c.infoBarDelayTimer&&(clearTimeout(c.infoBarDelayTimer),c.infoBarDelayTimer=0),c.toggleBarInfo()}),this.elStateBar.on("mouseleave",function(){c.infoBarDelayTimer=setTimeout(function(){c.toggleBarInfo(),clearTimeout(c.infoBarDelayTimer),c.infoBarDelayTimer=0},1e3)}),this.elInfoBar.on("mouseenter",function(){0<c.infoBarDelayTimer&&(clearTimeout(c.infoBarDelayTimer),c.infoBarDelayTimer=0)}),this.elInfoBar.on("mouseleave",function(){0<c.infoBarDelayTimer&&(clearTimeout(c.infoBarDelayTimer),c.infoBarDelayTimer=0),c.toggleBarInfo()}),this.btnSend=t.find('button[data-target="send"]'),this.btnSend.attr("disabled","disabled"),this.btnSend.on("click",function(t){c.onSend(t)}),this.emojiPanel=new EmojiPanel(c.onEmojiClick),this.btnEmoji=t.find('button[data-target="emoji"]'),this.btnEmoji.attr("disabled","disabled"),this.btnEmoji.on("mouseover",function(){null!=c.current&&c.emojiPanel.show(c.btnEmoji)}),this.btnEmoji.on("mouseout",function(){null!=c.current&&c.emojiPanel.tryHide()}),this.btnSendFile=t.find('button[data-target="send-file"]'),this.btnSendFile.attr("disabled","disabled"),this.btnSendFile.on("click",function(t){C.app.messagingCtrl.selectFile($("#select_file"))}),this.btnVideoCall=t.find('button[data-target="video-call"]'),this.btnVideoCall.attr("disabled","disabled"),this.btnVideoCall.on("click",function(){C.app.messagingCtrl.openVideoChat(c.current.entity)}),this.btnVoiceCall=t.find('button[data-target="voice-call"]'),this.btnVoiceCall.attr("disabled","disabled"),this.btnVoiceCall.on("click",function(){C.app.messagingCtrl.openVoiceCall(c.current.entity)}),t.find('button[data-target="new-group"]').on("click",function(t){c.onNewGroupClick(t)}),t.find('button[data-target="details"]').on("click",function(t){c.onDetailsClick(t)}),t.find('button[data-target="collapse"]').on("click",function(t){c.onCollapseClick(t)}),this.callTimer=0,this.callStartTime=0,this.initContextMenu()}function r(t){var i=[],t=$("<div>"+t+"</div>").find("p"),o=!1;return t.each(function(){var t,e,a=$(this);if(a.hasClass("emoji"))0<i.length&&160==i[i.length-1].data.charCodeAt(0)&&i.pop(),0!=(n=a.text()).length&&(t=n.codePointAt(0).toString(16),e=a.attr("desc"),i.push({format:"emoji",data:t,desc:e}),o=!0);else if(a.hasClass("at-wrapper")){0<i.length&&160==i[i.length-1].data.charCodeAt(0)&&i.pop();var n=a.text();i.push({format:"at",data:parseInt(a.attr("data")),name:n.substring(1)}),o=!0}else{if(o){if(o=!1,160==(n=a.text()).charCodeAt(0)&&1==n.length)return;if(0<(n=n.substring(1)).length)return void i.push({format:"txt",data:n})}0!=a.text().length&&i.push({format:"txt",data:a.text()})}}),i}t.prototype.initContextMenu=function(){this.elContent.contextMenu({selector:".direct-chat-text",callback:function(t,e){var a=c.current.entity;"delete"==t?C.app.messagingCtrl.deleteMessage(a,parseInt($(this).attr("data-id"))):"recall"==t&&C.app.messagingCtrl.recallMessage(a,parseInt($(this).attr("data-id")))},items:{recall:{name:"撤回",disabled:function(t,e){return"false"==$(this).attr("data-owner")}},delete:{name:"删除",disabled:function(t,e){return!1}}}})},t.prototype.getCurrentPanel=function(){return this.current},t.prototype.getPanel=function(t){return this.panels[t.toString()]},t.prototype.hasPanel=function(t){return"number"==typeof t?void 0!==this.panels[t.toString()]:void 0!==this.panels[t.getId().toString()]},t.prototype.updatePanel=function(t,e){var a=this.panels[t.toString()];void 0===a&&(a={id:t,el:$('<div class="direct-chat-messages"><div class="more-messages"><a href="javascript:app.messagingCtrl.prependMore('+t+');">查看更多消息</a></div></div>'),entity:e,messageIds:[],messageTimes:[],unreadCount:0,groupable:e instanceof Group},this.panels[t.toString()]=a),null!=this.current&&this.current.id==t&&(this.current.entity=e,a.groupable?this.elTitle.text(e.getName()):this.elTitle.text(e.getPriorityName()),this.refreshStateBar())},t.prototype.refreshStateBar=function(){if(null==this.current)return this.elInfoBar.css("visibility","hidden"),this.elStateBar.css("visibility","hidden"),0<this.callTimer&&(clearInterval(this.callTimer),this.callTimer=0),void(this.callStartTime=0);var t=this.current.entity;t instanceof Group?t.getAppendix().getCommId(function(i){0!=i?C.cube().mpComm.getCommField(i,function(t){0<c.callTimer&&clearInterval(c.callTimer);var e=t.mediaConstraint.videoEnabled;function a(){var t;0!=c.callStartTime?(t=Date.now()-c.callStartTime,c.elStateBar.find(".timer").text(C.formatClockTick(Math.round(t/1e3)))):C.cube().mpComm.getCommField(i,function(t){c.callStartTime=t.startTime,0==c.callStartTime&&(c.callStartTime=Date.now())})}c.elStateBar.find(".col-2").html(e?'<i class="fas fa-video"></i>':'<i class="fas fa-phone-alt"></i>'),c.elStateBar.find(".participant").text(t.numEndpoints()+"/"+(e?"6":"8")),c.callStartTime=t.startTime,c.callTimer=setInterval(a,1e3),c.elStateBar.find(".timer").text("--:--:--"),a(),c.elStateBar.css("visibility","visible");e=c.elInfoBar.find(".row").eq(0);e.empty();var n=[];t.getEndpoints().forEach(function(t){t=t.contact;C.app.getContact(t.getId(),function(t){n.push('<div class="col-3"><img src="images/'+t.getContext().avatar+'" /></div>')})}),e.html(n.join(""))}):(0<c.callTimer&&(clearInterval(c.callTimer),c.callTimer=0),c.callStartTime=0,c.elStateBar.css("visibility","hidden"))}):(this.elInfoBar.css("visibility","hidden"),this.elStateBar.css("visibility","hidden"))},t.prototype.toggleBarInfo=function(){var t=this.elInfoBar;"hidden"==t.css("visibility")?t.css("visibility","visible"):t.css("visibility","hidden")},t.prototype.changePanel=function(t,e){var a=this.panels[t.toString()];void 0===a&&(a={id:t,el:$('<div class="direct-chat-messages"><div class="more-messages"><a href="javascript:app.messagingCtrl.prependMore('+t+');">查看更多消息</a></div></div>'),entity:e,messageIds:[],messageTimes:[],unreadCount:0,groupable:e instanceof Group},this.panels[t.toString()]=a),null==this.current?(this.inputEditor.enable(),this.btnEmoji.removeAttr("disabled"),this.btnSend.removeAttr("disabled"),this.btnSendFile.removeAttr("disabled"),this.btnVideoCall.removeAttr("disabled"),this.btnVoiceCall.removeAttr("disabled")):(0<(t=(t=(t=this.inputEditor.txt.text().trim()).startsWith("&nbsp;")?t.substring(6,t.length):t).endsWith("&nbsp;")?t.substring(0,t.length-6):t).length?(t=this.serializeHyperText(),t=new HyperTextMessage(t),window.cube().messaging.saveDraft(this.current.entity,t)&&C.app.messageCatalog.updateItem(this.current.id,'<span class="text-danger">[草稿] '+t.getSummary()+"</span>",null,null)):window.cube().messaging.deleteDraft(this.current.id),this.inputEditor.txt.clear(),this.current.el.remove()),this.elContent.append(a.el),(this.current=a).unreadCount=0,a.groupable?this.elTitle.text(e.getName()):this.elTitle.text(e.getAppendix().hasRemarkName()?e.getAppendix().getRemarkName():e.getName()),this.refreshStateBar();e=parseInt(this.elContent.prop("scrollHeight"));this.elContent.scrollTop(e),a.messageIds.forEach(function(t){window.cube().messaging.markRead(t)}),window.cube().messaging.loadDraft(this.current.id,function(t){a.groupable?window.cube().messaging.queryLastMessageWithGroup(a.entity.getId(),function(t){C.app.messageCatalog.restoreDesc(a.id,t.getSummary())}):window.cube().messaging.queryLastMessageWithContact(a.entity.getId(),function(t){C.app.messageCatalog.restoreDesc(a.id,t.getSummary())});t=c.deserializeHyperText(t.getMessage(),!0);c.inputEditor.txt.append(t)})},t.prototype.clearPanel=function(t){var e=this.panels[t.toString()];void 0!==e&&(e.el.remove(),this.current==e&&(this.btnEmoji.attr("disabled","disabled"),this.btnVideoCall.attr("disabled","disabled"),this.btnVoiceCall.attr("disabled","disabled"),this.btnSendFile.attr("disabled","disabled"),this.elTitle.text(""),this.inputEditor.txt.clear(),this.inputEditor.disable(),this.formatContents=[],this.lastInput="",this.current=null,this.refreshStateBar()),delete this.panels[t.toString()])},t.prototype.removeMessage=function(t,e){var a=t.getId(),t=this.panels[a.toString()];void 0!==t&&(a=e.getId(),0<=(e=t.messageIds.indexOf(a))&&(t.messageIds.splice(e,1),t.messageTimes.splice(e,1)),t.el.find("#"+a).remove())},t.prototype.appendMessage=function(t,e,a,n,i){var o=t.getId(),s=this.panels[o.toString()];void 0===s&&(s={id:o,el:$('<div class="direct-chat-messages"><div class="more-messages"><a href="javascript:app.messagingCtrl.prependMore('+o+');">查看更多消息</a></div></div>'),entity:t,messageIds:[],messageTimes:[],unreadCount:0,groupable:t instanceof Group},this.panels[o.toString()]=s);var l=a.getId(),r=a.getRemoteTimestamp(),c=s.messageIds.indexOf(l);if(0<=c)return null;if(0==s.messageIds.length)s.messageTimes.push(r),s.messageIds.push(l);else for(var d=0,p=s.messageTimes.length;d<p;++d){if(r<=s.messageTimes[d]){s.messageTimes.splice(d,0,r),s.messageIds.splice(d,0,l);break}var u=d+1<p?s.messageTimes[d+1]:null;if(null==u){s.messageTimes.push(r),s.messageIds.push(l);break}if(r<u){s.messageTimes.splice(d+1,0,r),s.messageIds.splice(d+1,0,l);break}}c=s.messageIds.indexOf(l),a.isRead()||(s.unreadCount+=1);var g=null,f=null,t=null;if(a instanceof TextMessage)f=a.getText();else if(a instanceof HyperTextMessage)f=this.deserializeHyperText(a);else if(a instanceof ImageMessage||a instanceof FileMessage)var m=null,f=((t=a.getAttachment()).isImageType()?(m=["javascript:dialog.showImage('",t.getFileCode(),"');"],['<table class="file-label" border="0" cellspacing="4" cellpodding="0">',"<tr>","<td>",'<img class="thumb" src="',t.getDefaultThumbURL(),'" onclick="',m.join(""),'"',' onload="app.messagePanel.refreshScroll()"',' alt="',t.getFileName(),'"'," />","</td>","</tr>","</table>"]):(m=['<a class="btn btn-xs btn-default" title="下载文件" href="javascript:dialog.downloadFile(\'',t.getFileCode(),"');\">",'<i class="fas fa-download"></i>',"</a>"],['<table class="file-label" border="0" cellspacing="4" cellpodding="0">',"<tr>",'<td rowspan="2" valign="middle" align="center">',"png"==(o=t.getFileType())||"jpeg"==o||"gif"==o||"jpg"==o||"bmp"==o?'<i class="file-icon ci-wide ci-file-image-wide"></i>':"xls"==o||"xlsx"==o?'<i class="file-icon ci-wide ci-file-excel-wide"></i>':"ppt"==o||"pptx"==o?'<i class="file-icon ci-wide ci-file-powerpoint-wide"></i>':"doc"==o||"docx"==o?'<i class="file-icon ci-wide ci-file-word-wide"></i>':"mp3"==o||"ogg"==o||"wav"==o?'<i class="file-icon ci-wide ci-file-music-wide"></i>':"pdf"==o?'<i class="file-icon ci-wide ci-file-pdf-wide"></i>':"rar"==o?'<i class="file-icon ci-wide ci-file-rar-wide"></i>':"zip"==o||"gz"==o?'<i class="file-icon ci-wide ci-file-zip-wide"></i>':"txt"==o||"log"==o?'<i class="file-icon ci-wide ci-file-text-wide"></i>':"mp4"==o||"mkv"==o||"avi"==o||"ts"==o?'<i class="file-icon ci-wide ci-file-video-wide"></i>':"psd"==o?'<i class="file-icon ci-wide ci-file-psd-wide"></i>':"exe"==o||"dll"==o?'<i class="file-icon ci-wide ci-file-windows-wide"></i>':"apk"==o?'<i class="file-icon ci-wide ci-file-apk-wide"></i>':"dmg"==o?'<i class="file-icon ci-wide ci-file-dmg-wide"></i>':'<i class="file-icon ci-wide ci-file-unknown-wide"></i>',"</td>",'<td colspan="2" class="file-name">',t.getFileName(),"</td>","</tr>","<tr>",'<td class="file-size">',formatSize(t.getFileSize()),"</td>",'<td class="file-action">',m.join(""),"</td>","</tr>","</table>"])).join("");else if(a instanceof CallRecordMessage)f=(f=["<div>",a.getConstraint().video?'<i class="fas fa-video"></i>':'<i class="fas fa-phone-alt"></i>','&nbsp;&nbsp;<span style="font-size:14px;">',0<a.getAnswerTime()?"通话时长 "+C.formatClockTick(parseInt(a.getDuration()/1e3)):a.isCaller(C.app.getSelf().getId())?"对方未接听":"未接听","</span></div>"]).join("");else{if(!(a instanceof LocalNoteMessage))return null;var h=a.getText(),v=a.getLevel(),g=1==v?['<div id="',a.getId(),'" class="note">',h,"</div>"]:2==v?['<div id="',a.getId(),'" class="note"><span class="text-warning">',h,"</span></div>"]:['<div id="',a.getId(),'" class="note"><span class="text-danger">',h,"</span></div>"]}null==g&&(t="",m="float-left",v="float-right",e.getId()==C.app.getSelf().getId()&&(t="right",m="float-right",v="float-left"),h=[],0<t.length&&(a.getState()==MessageState.Sending?h.push('<div class="direct-chat-state"><i class="fas fa-spinner sending"></i></div>'):a.getState()!=MessageState.SendBlocked&&a.getState()!=MessageState.ReceiveBlocked||h.push('<div class="direct-chat-state"><i class="fas fa-exclamation-circle fault"></i></div>')),b=void 0!==i&&i?"direct-chat-text-anim":"",g=['<div id="',l,'" class="direct-chat-msg ',t,'"><div class="direct-chat-infos clearfix">','<span class="direct-chat-name ',m,s.groupable?"":" no-display",'">',e.getPriorityName(),'</span><span class="direct-chat-timestamp ',v,'">',formatFullTime(r),"</span></div>",'<img src="images/',e.getContext().avatar,'" class="direct-chat-img">',h.join(""),'<div data-id="',l,'" data-owner="',0<t.length,'" class="direct-chat-text ',b,'">',f,"</div></div>"]);var b=$(g.join("")),f=s.el;return 0==c?f.find(".more-messages").after(b):c==s.messageIds.length-1?f.append(b):(g=0<=c-1?s.messageIds[c-1]:0,c=c+1<s.messageIds.length?s.messageIds[c+1]:0,0<g?f.find("#"+g).after(b):0<c&&f.find("#"+c).before(b)),void 0!==n&&(n?(n=parseInt(this.elContent.prop("scrollHeight")),this.elContent.scrollTop(n)):this.elContent.scrollTop(0)),this.loadDraft(s),b},t.prototype.changeMessageState=function(t){var e=this.elContent.find("#"+t.getId()).find(".direct-chat-state");t.getState()==MessageState.Sent?e.html(""):t.getState()==MessageState.SendBlocked||t.getState()==MessageState.ReceiveBlocked?e.html('<i class="fas fa-exclamation-circle fault"></i>'):t.getState()==MessageState.Sending&&e.html('<i class="fas fa-spinner sending"></i>')},t.prototype.appendNote=function(t,e){var a="number"==typeof t?t:t.getId(),n=this.panels[a.toString()];void 0===n&&(n={id:a,el:$('<div class="direct-chat-messages"><div class="more-messages"><a href="javascript:app.messagingCtrl.prependMore('+a+');">查看更多消息</a></div></div>'),entity:t,messageIds:[],messageTimes:[],groupable:t instanceof Group},this.panels[a.toString()]=n),n.el.append($(['<div class="note">',e,"</div>"].join("")));e=parseInt(this.elContent.prop("scrollHeight"));this.elContent.scrollTop(e)},t.prototype.refreshScroll=function(){var t=parseInt(this.elContent.prop("scrollHeight"));this.elContent.scrollTop(t)},t.prototype.loadDraft=function(e){window.cube().messaging.loadDraft(e.id,function(t){C.app.messageCatalog.restoreDesc(e.id,'<span class="text-danger">[草稿] '+t.getMessage().getSummary()+"</span>")})},t.prototype.serializeHyperText=function(){for(var t=[],e=0;e<this.formatContents.length;++e){var a,n=this.formatContents[e];"txt"==n.format?t.push(function(t){for(var e=[],a=0;a<t.length;++a){var n=t.charAt(a);"["!=n&&"]"!=n||e.push("\\"),e.push(n)}return e.join("")}(n.data)):"emoji"==n.format?(a=["[E",n.desc,"#",n.data,"]"],t.push(a.join(""))):"at"==n.format&&(a=["[@",n.name,"#",n.data,"]"],t.push(a.join("")))}return t.join("")},t.prototype.deserializeHyperText=function(t,e){var a=[];if(e){for(var n=t.getFormattedContents(),i=0,o=n.length-1;i<o;++i){var s=n[i];"text"==s.format?(a.push("<p>"),a.push(s.content),a.push("</p>")):"emoji"==s.format?(l=String.fromCodePoint("0x"+s.content.code),a.push('<p>&nbsp;</p><p class="emoji" desc="'),a.push(s.content.desc),a.push('">'),a.push(l),a.push("</p><p>&nbsp;</p>")):"at"==s.format&&(a.push('<p>&nbsp;</p><p class="at-wrapper"><span class="at">@'),a.push(s.content.name),a.push("</span></p><p>&nbsp;</p>"))}var l,e=n[n.length-1];"text"==e.format?a.push("<p>"+e.content+"<br></p>"):"emoji"==e.format?(l=String.fromCodePoint("0x"+e.content.code),a.push('<p>&nbsp;</p><p class="emoji" desc="'+e.content.desc+'">'+l+"</p><p><br></p>")):"at"==e.format&&a.push('<p>&nbsp;</p><p class="at-wrapper"><span class="at">@'+e.content.name+"</span></p><p><br></p>")}else t.getFormattedContents().forEach(function(t){var e;"text"==t.format?a.push(t.content):"emoji"==t.format?(e=String.fromCodePoint("0x"+t.content.code),a.push('&nbsp;<span class="emoji">'+e+"</span>&nbsp;")):"at"==t.format&&a.push('&nbsp;<span class="at">@'+t.content.name+"</span>&nbsp;")});return a.join("")},t.prototype.onEmojiClick=function(t){var e=String.fromCodePoint("0x"+t.code);c.inputEditor.cmd.do("insertHTML",'<p>&nbsp;</p><p class="emoji" desc="'+t.desc+'">'+e+"</p><p>&nbsp;</p>")},t.prototype.onSend=function(t){var e=this.inputEditor.txt.text();if(0!=e.length){if(e=this.serializeHyperText(),this.current.entity instanceof Group){var a=this.current.entity.getState();if(a==GroupState.Dismissed)return void this.appendNote(this.current.entity,"群组已解散");if(a==GroupState.Disabled)return void this.appendNote(this.current.entity,"群组已删除")}this.inputEditor.txt.clear(),null==C.app.messagingCtrl.fireSend(this.current.entity,e)&&C.dialog.launchToast(Toast.Error,"发送消息失败"),0<this.formatContents.length&&this.formatContents.splice(0,this.formatContents.length),this.lastInput=""}},t.prototype.onNewGroupClick=function(t){if(null!=this.current)if(this.current.groupable){for(var e=this.current.entity,a=C.app.contactsCtrl.getContacts(),n=e.getMembers(),i=[],o=!1,s=0;s<a.length;++s){for(var l=a[s],o=!1,r=0;r<n.length;++r)if(n[r].id==l.id){o=!0;break}o||i.push(l)}C.app.contactListDialog.show(i,[],function(t){0<t.length&&e.addMembers(t,function(t){C.app.messageSidebar.update(t)},function(t){C.dialog.launchToast(Toast.Error,"邀请入群操作失败 - "+t.code)})},"邀请入群","请选择您要邀请入群的联系人")}else C.app.newGroupDialog.show([this.current.entity.getId()])},t.prototype.onDetailsClick=function(t){var e;null!=this.current&&(e=this.current.entity,(this.current.groupable?C.app.groupDetails:C.app.contactDetails).show(e))},t.prototype.onCollapseClick=function(t){null!=this.current&&C.app.messagingCtrl.toggleSidebar()},t.prototype.onEditorChange=function(t){if(0==t.length)return this.formatContents.splice(0,this.formatContents.length),this.lastInput="",void(null!=this.current&&window.cube().messaging.deleteDraft(this.current.id));if(this.lastInput!=t){var e=t.replace(/<[^<>]+>/g,"");if(0==e.length||" "==e||"&nbsp;"==e)return this.formatContents.splice(0,this.formatContents.length),this.lastInput="",void(null!=this.current&&window.cube().messaging.deleteDraft(this.current.id));e=function(t,e){for(var a=r(t),n=r(e),i=!1,o=0;o<a.length&&o<n.length;++o){var s=a[o],l=n[o];if("at"==s.format&&"at"==l.format&&s.name!=l.name){i=!0,n.splice(o,1);break}}return{deleted:i,newestContents:n,lastContents:a}}(this.lastInput,t);if(e.deleted){for(var a=e.newestContents,n=[],i=0;i<a.length;++i){var o,s=a[i];"txt"==s.format?n.push("<p>"+s.data+"</p>"):"emoji"==s.format?(o=String.fromCodePoint("0x"+s.data),n.push('<p>&nbsp;</p><p class="emoji" desc="'+s.desc+'">'+o+"</p><p>&nbsp;</p>")):"at"==s.format&&(s='<p>&nbsp;</p><p class="at-wrapper" data="'+s.data+'"><span class="at">@'+s.name+"</span></p><p>&nbsp;</p>",n.push(s))}setTimeout(function(){c.inputEditor.txt.html(n.join(""))},10)}this.formatContents=e.newestContents,this.lastInput=t}},t.prototype.handlePasteText=function(t){return t.replace(/<[^<>]+>/g,"")},t.prototype.onEditorKeypress=function(t){t=t||window.event;t&&13==t.keyCode&&t.ctrlKey?c.onSend(t):64==t.keyCode&&this.current.groupable&&(this.makeAtPanel(this.current.entity),this.atPanel.css("display","block"),this.atPanel.focus(),C.app.onKeyUp(c.onAtPanelKeyUp))},t.prototype.makeAtPanel=function(a){var t=a.getMembers(),e=t.length-1;this.atElList=[],this.atPanel.empty();var n=null,i=function(t){var e=window.getSelection(),a=-1,n=null;if(e.focusNode&&function(t,e){for(;null!==t;){if(t.id===e)return!0;t=t.parentNode}return!1}(e.focusNode,t))for(n=e.focusNode,a=e.focusOffset;n&&n.id!==t;)if(n.previousSibling)n=n.previousSibling,a+=n.textContent.length;else if(null===(n=n.parentNode))break;return{node:n,charCount:a}}($("#message-editor").find(".w-e-text").attr("id"));if(null!=(n=i.node)){var o=parseInt(n.clientWidth||n.offsetWidth||n.style.width||n.scrollWidth),s=parseInt(n.offsetLeft)+parseInt(n.offsetParent.offsetLeft),n=parseInt(n.offsetTop)+parseInt(n.offsetParent.offsetTop);o<=(s+=function(t){for(var e=0,a=c.lastInput.replace(/<[^<>]+>/g,"").replaceAll("&nbsp;"," "),n=0,i=0;i<a.length&&i<t;++i){var o=a.charCodeAt(i);127<o||94==o?(e+=2,n+=14):(e+=1,n+=105<=o&&o<=108||114==o||116==o?4:64<=o&&o<=90?10:8)}return[Math.round(n),e]}(i.charCount)[0])+12&&(n+=21*Math.floor((s+12)/o),s=12+(s+12)%o),e<=5?(this.atPanel.css("height",32*e+2+"px"),n-=32*e+4):(this.atPanel.css("height","162px"),n-=170);for(var l=0;l<t.length;++l){var r=t[l];r.getId()!=C.app.account.id&&C.app.getContact(r.getId(),function(t){a.modifyMember(t);var e=a.getMemberName(t),e=['<div class="row align-items-center" data="',t.getId(),'">','<div class="col-2 avatar"><img src="images/',t.getContext().avatar,'" /></div>','<div class="col-10">',e,"</div>","</div>"],e=$(e.join(""));e.on("click",function(){c.onAtRowClick($(this))}),c.atElList.push(e),1==c.atElList.length&&c.atElList[0].addClass("active"),c.atPanel.append(e)})}this.atPanel.css("left",s+"px"),this.atPanel.css("top",n+"px")}},t.prototype.selectAtItem=function(){var t,e;c.current.groupable&&(t=parseInt(c.atPanel.find(".active").attr("data")),e=c.current.entity.getMemberById(t),e='<p>&nbsp;</p><p class="at-wrapper" data="'+t+'"><span class="at">@'+c.current.entity.getMemberName(e)+"</span></p><p>&nbsp;</p>",c.inputEditor.cmd.do("insertHTML",e),c.atPanel.blur())},t.prototype.onAtRowClick=function(t){for(var e=0,a=0;a<c.atElList.length;++a)if(c.atElList[a].hasClass("active")){e=a;break}c.atElList[e].removeClass("active"),t.addClass("active"),c.selectAtItem()},t.prototype.onAtPanelBlur=function(t){C.app.unKeyUp(c.onAtPanelKeyUp),c.atElList=[],c.atPanel.css("display","none")},t.prototype.onAtPanelKeyUp=function(t){if(13!=t.keyCode){if(27==t.keyCode)return c.atPanel.blur(),void c.inputEditor.txt.append("@");if(40==t.keyCode||38==t.keyCode){for(var e=0,a=0;a<c.atElList.length;++a)if(c.atElList[a].hasClass("active")){e=a;break}var n=c.atElList[e];40==t.keyCode?(n.removeClass("active"),e>=c.atElList.length-1?e=0:e+=1,c.atElList[e].addClass("active")):38==t.keyCode&&(n.removeClass("active"),0==e?e=c.atElList.length-1:--e,c.atElList[e].addClass("active"))}}else c.selectAtItem()},C.MessagePanel=t}(window),function(r){"use strict";var c,d=null,e=null,a=null,n=null,i=null,o=null,s=null,l=null,p=null,u=null,g=null,f=null,m=null;function h(){var t;p.prop("disabled")?(e=p.val().trim(),p.removeAttr("disabled"),p.focus()):(t=p.val().trim(),p.attr("disabled","disabled"),e!=t&&window.cube().contact.remarkGroup(d,t,function(){dialog.launchToast(Toast.Success,"已备注群组")},function(t){dialog.launchToast(Toast.Error,"修改群组备注失败："+t.code),p.val(e)}))}function v(){h()}function b(){var t;u.prop("disabled")?(a=u.val().trim(),u.removeAttr("disabled"),u.focus()):(t=u.val().trim(),u.attr("disabled","disabled"),a!=t&&d.getAppendix().updateNotice(t,function(){dialog.launchToast(Toast.Success,"已修改群组公告")},function(t){dialog.launchToast(Toast.Error,"修改群组公告失败："+t.code),u.val(a)}))}function C(){b()}function y(t){13==t.keyCode&&T($(this))}function w(t){T($(this))}function T(t){var e=t.val(),a=t.attr("predata"),n=t.attr("data-target");e==a||e.length<3?r.app.messageSidebar.recoverMemberName(n,t.parent(),a):(d.getAppendix().updateMemberRemark(n,e,function(){dialog.launchToast(Toast.Success,"已修改群组成员备注")},function(t){dialog.launchToast(Toast.Error,"备注群组成员失败："+t.code)}),r.app.messageSidebar.recoverMemberName(n,t.parent(),e))}function I(t){for(var e=r.app.contactsCtrl.getContacts(),a=d.getMembers(),n=[],i=!1,o=0;o<e.length;++o){for(var s=e[o],i=!1,l=0;l<a.length;++l)if(a[l].id==s.id){i=!0;break}i||n.push(s)}r.app.contactListDialog.show(n,[],function(t){0<t.length&&d.addMembers(t,function(t){c.updateGroup(t)},function(t){r.dialog.launchToast(Toast.Error,"邀请入群操作失败 - "+t.code)})},"邀请入群","请选择您要邀请入群的联系人")}function x(t){if(d.isOwner()){var e=d.getMembers().concat();if(2!=e.length){for(var a=0;a<e.length;++a)if(e[a].id==r.app.account.id){e.splice(a,1);break}r.app.contactListDialog.show(e,[],function(t){0<t.length&&d.removeMembers(t,function(t){c.updateGroup(t)},function(t){r.dialog.launchToast(Toast.Error,"移除成员操作失败 - "+t.code)})},"移除成员","请选择您要从群组移除的联系人")}else r.dialog.launchToast(Toast.Warning,"群里仅有两名成员，没有可移除的成员。")}else r.dialog.launchToast(Toast.Info,"您不能移除该群组成员。")}function k(){var t;f.prop("disabled")?(i=f.val().trim(),f.removeAttr("disabled"),f.focus()):(t=f.val().trim(),f.attr("disabled","disabled"),i!=t&&window.cube().contact.remarkContactName(n,t,function(){dialog.launchToast(Toast.Success,"已备注联系人")},function(t){dialog.launchToast(Toast.Error,"修改联系人备注失败："+t.code),f.val(i)}))}function P(){k()}function S(t,e){var a=r.cube().contact.getSelf().getAppendix();e?a.addNoNoticeGroup(d.getId()):a.removeNoNoticeGroup(d.getId())}function M(t,e){var a=r.cube().contact.getSelf().getAppendix();e?a.addNoNoticeContact(n.getId()):a.removeNoNoticeContact(n.getId())}function t(t){c=this,s=(o=t).find(".for-group"),l=o.find(".for-contact"),(p=s.find('input[data-target="group-remark"]')).attr("disabled","disabled"),p.blur(v),s.find('button[data-target="remark"]').click(h),(u=s.find('textarea[data-target="group-notice"]')).attr("disabled","disabled"),u.blur(C),s.find('button[data-target="notice"]').click(b),s.find('button[data-target="add-member"]').click(I),s.find('button[data-target="remove-member"]').click(x),g=s.find(".group-member-list"),s.find('input[data-target="no-noticing-switch"]').bootstrapSwitch({onText:"已开启",offText:"已关闭",size:"small",handleWith:50,labelWidth:15,onSwitchChange:S}),(f=l.find('input[data-target="contact-remark"]')).attr("disabled","disabled"),f.blur(P),l.find('button[data-target="remark"]').click(k),(m=l.find('input[data-target="no-noticing-switch"]')).bootstrapSwitch({onText:"已开启",offText:"已关闭",size:"small",handleWith:50,labelWidth:15,onSwitchChange:M})}t.prototype.update=function(t){t instanceof Group?(this.updateGroup(t),s.hasClass("no-display")&&s.removeClass("no-display"),l.hasClass("no-display")||l.addClass("no-display")):(this.updateContact(t),l.hasClass("no-display")&&l.removeClass("no-display"),s.hasClass("no-display")||s.addClass("no-display"))},t.prototype.updateContact=function(t){n=t,l.find('input[data-target="contact-name"]').val(t.getName()),f.val(t.getAppendix().hasRemarkName()?t.getAppendix().getRemarkName():""),r.app.getSelf().getAppendix().isNoNoticeContact(t)?m.bootstrapSwitch("state",!0):m.bootstrapSwitch("state",!1)},t.prototype.updateGroup=function(a){d=a,s.find('input[data-target="group-name"]').val(a.getName()),d.isOwner()?s.find(".group-notice-btn-group").css("display","block"):s.find(".group-notice-btn-group").css("display","none"),p.val(a.getAppendix().getRemark()),u.val(a.getAppendix().getNotice()),g.empty(),a.getMembers().forEach(function(t){r.app.getContact(t.getId(),function(t){a.modifyMember(t);var e=['<button class="btn btn-sm btn-default btn-flat"',' onclick="javascript:app.messageSidebar.fireUpdateMemberRemark(',t.getId(),');"><i class="fas fa-edit"></i></button>'],e=['<div class="group-member-cell" data-target="',t.getId(),'" ondblclick="javascript:app.contactDetails.show(',t.getId(),');">','<div class="member-avatar"><img class="img-size-32 img-round-rect" src="images/',t.getContext().avatar,'" /></div>','<div class="member-name">',a.getAppendix().hasMemberRemark(t)?a.getAppendix().getMemberRemark(t):t.getPriorityName(),"</div>",'<div class="member-operate">',a.isOwner()||t.getId()==r.app.account.id?e.join(""):"","</div>","</div>"];g.append($(e.join("")))})}),r.app.getSelf().getAppendix().isNoNoticeGroup(a)?m.bootstrapSwitch("state",!0):m.bootstrapSwitch("state",!1)},t.prototype.appendImage=function(t){},t.prototype.fireUpdateMemberRemark=function(t){var e=o.find('div[data-target="'+t+'"]');e.find("button").attr("disabled","disabled");var a=parseInt(e.width()),n=(e=e.find(".member-name")).text();e.empty(),e.html(['<input class="form-control form-control-sm" type="text" style="width:',a-=100,'px;" predata="',n,'" data-target="',t,'" />'].join(""));e=e.find("input");e.blur(w),e.keyup(y),e.focus()},t.prototype.recoverMemberName=function(t,e,a){e.empty(),e.text(a),o.find('div[data-target="'+t+'"]').find(".member-operate").find("button").removeAttr("disabled")},r.MessageSidebar=t}(window),function(o){function t(){a=this;var t=$("#voice_call");this.panelEl=t,this.elPeerAvatar=t.find('img[data-target="avatar"]'),this.elPeerName=t.find('span[data-target="name"]'),this.elInfo=t.find('span[data-target="info"]'),this.remoteVideo=t.find('video[data-target="remote"]')[0],this.localVideo=t.find('video[data-target="local"]')[0],this.btnMic=t.find('button[data-target="microphone"]'),this.btnMic.attr("disabled","disabled"),this.btnMic.on("click",function(){o.app.callCtrl.toggleMicrophone()?a.btnMic.html('<i class="ci ci-btn ci-microphone-opened"></i>'):a.btnMic.html('<i class="ci ci-btn ci-microphone-closed"></i>')}),this.btnVol=t.find('button[data-target="volume"]'),this.btnVol.attr("disabled","disabled"),this.btnVol.on("click",function(){o.app.callCtrl.toggleLoudspeaker()?a.btnVol.html('<i class="ci ci-btn ci-volume-unmuted"></i>'):a.btnVol.html('<i class="ci ci-btn ci-volume-muted"></i>')}),this.btnHangup=t.find('button[data-target="hangup"]'),this.btnHangup.on("click",function(){a.terminate()}),t.draggable({handle:".modal-header"}),t.on("hide.bs.modal",function(){0<n&&(clearInterval(n),n=0),0<e&&(clearTimeout(e),e=0),i=0,a.btnMic.attr("disabled","disabled"),a.btnVol.attr("disabled","disabled")})}var a=null,n=0,e=0,i=0;t.prototype.open=function(t){console.log("发起语音通话 "+t.getId());function n(){o.app.callCtrl.makeCall(t,!1,i)?(a.elPeerAvatar.attr("src","images/"+t.getContext().avatar),a.elPeerName.text(t.getName()),a.elInfo.text("正在呼叫..."),a.panelEl.modal({keyboard:!1,backdrop:!1})):o.dialog.launchToast(Toast.Warning,"您当前正在通话中")}var i=null;o.cube().mpComm.listMediaDevices(function(t){if(0!=t.length){for(var a=[],e=0;e<t.length;++e)t[e].isAudioInput()&&a.push(t[e]);1<a.length?o.app.callCtrl.showSelectMediaDevice(a,function(t,e){t&&(e>=a.length?o.dialog.showAlert("选择的设备数据错误"):(i=a[e],n()))}):n()}else o.dialog.showAlert("没有找到可用的麦克风设备，请您确认是否正确连接了麦克风设备。")})},t.prototype.showAnswer=function(t){console.log("应答语音通话 "+t.getId()),this.elPeerAvatar.attr("src","images/"+t.getContext().avatar),this.elPeerName.text(t.getName()),this.elInfo.text("正在应答..."),this.btnMic.removeAttr("disabled"),this.btnVol.removeAttr("disabled"),this.panelEl.modal({keyboard:!1,backdrop:!1})},t.prototype.close=function(){this.panelEl.modal("hide"),o.app.mainPanel.stopWaitingTone(),o.app.mainPanel.stopCallRing(),this.btnMic.attr("disabled","disabled"),this.btnVol.attr("disabled","disabled")},t.prototype.tipWaitForAnswer=function(t){var e;0<n||(e=0,n=setInterval(function(){a.elInfo.text("等待应答，已等待 "+ ++e+" 秒...")},1e3),o.app.mainPanel.playWaitingTone(),a.btnMic.removeAttr("disabled"),a.btnVol.removeAttr("disabled"))},t.prototype.tipConnected=function(){0<n&&(clearInterval(n),n=0),0<e||(o.app.callCtrl.isMicrophoneOpened()?a.btnMic.html('<i class="ci ci-btn ci-microphone-opened"></i>'):a.btnMic.html('<i class="ci ci-btn ci-microphone-closed"></i>'),o.app.callCtrl.isUnmuted()?a.btnVol.html('<i class="ci ci-btn ci-volume-unmuted"></i>'):a.btnVol.html('<i class="ci ci-btn ci-volume-muted"></i>'),e=setInterval(function(){a.elInfo.text(o.formatClockTick(++i))},1e3),o.app.mainPanel.stopWaitingTone())},t.prototype.openNewCallToast=function(t){t=['<div class="toasts-info">                <div class="info-box">                    <span class="info-box-icon"><img src="images/',t.getContext().avatar,'" /></span>                    <div class="info-box-content">                        <span class="info-box-text">',t.getName(),'</span>                        <span class="info-box-desc">邀请您参与语音通话</span>                    </div>                </div>                <div class="call-answer">                    <button type="button" class="btn btn-danger" onclick="javascript:app.callCtrl.hangupCall();"><i class="ci ci-hangup"></i> 拒绝</button>                    <button type="button" class="btn btn-success" onclick="javascript:app.callCtrl.answerCall();"><i class="ci ci-answer"></i> 接听</button>                </div>            </div>'];$(document).Toasts("create",{title:"语音通话邀请",position:"bottomRight",icon:"fas fa-phone-alt",close:!1,class:"voice-new-call",body:t.join("")}),o.app.mainPanel.playCallRing()},t.prototype.closeNewCallToast=function(){$("#toastsContainerBottomRight").find(".voice-new-call").remove(),o.app.mainPanel.stopCallRing()},t.prototype.terminate=function(){o.app.callCtrl.hangupCall()},o.VoiceCallPanel=t}(window),function(o){"use strict";function t(t){s=this,t=$("#video_chat"),this.panelEl=t,window.addEventListener("resize",this.onResize,!1),(n=t.find('button[data-target="minimize"]')).on("click",function(){s.minimize()}),(i=t.find('button[data-target="maximize"]')).on("click",function(){s.maximize()}),(l=t.find('button[data-target="restore"]')).on("click",function(){s.restore()}),l.css("display","none"),u=t.find('div[data-target="video-remote"]'),g=t.find('div[data-target="video-local"]'),u.on("click",function(t){v==h&&s.switchVideo()}),g.on("click",function(t){v==m&&s.switchVideo()}),a=g,m=(f=u)[0].querySelector("video"),h=g[0].querySelector("video"),(v=m).style.visibility="hidden",this.remoteVideo=m,this.localVideo=h,this.headerTip=t.find(".header-tip"),this.callTip=t.find(".call-tip"),this.elRemoteLabel=u.find(".video-label"),this.elLocalLabel=g.find(".video-label"),this.btnCam=t.find('button[data-target="camera"]'),this.btnMic=t.find('button[data-target="microphone"]'),this.btnVol=t.find('button[data-target="volume"]'),this.btnCam.attr("disabled","disabled"),this.btnMic.attr("disabled","disabled"),this.btnVol.attr("disabled","disabled"),this.btnCam.on("click",function(){o.app.callCtrl.toggleCamera()?s.btnCam.html('<i class="ci ci-btn ci-camera-opened"></i>'):s.btnCam.html('<i class="ci ci-btn ci-camera-closed"></i>')}),this.btnMic.on("click",function(){o.app.callCtrl.toggleMicrophone()?s.btnMic.html('<i class="ci ci-btn ci-microphone-opened"></i>'):s.btnMic.html('<i class="ci ci-btn ci-microphone-closed"></i>')}),this.btnVol.on("click",function(){o.app.callCtrl.toggleLoudspeaker()?s.btnVol.html('<i class="ci ci-btn ci-volume-unmuted"></i>'):s.btnVol.html('<i class="ci ci-btn ci-volume-muted"></i>')}),this.btnHangup=t.find('button[data-target="hangup"]'),this.btnHangup.on("click",function(){s.terminate()}),t.draggable({handle:".modal-header",containment:"document"}),t.on("hide.bs.modal",function(){0<b&&(clearInterval(b),b=0),0<e&&(clearInterval(e),e=0),C=0,m.style.visibility="hidden",s.callTip.text(""),s.headerTip.text("")})}var s=null,n=null,i=null,l=null,r=0,c="640px",d="0px",p=1,u=null,g=null,f=null,a=null,m=null,h=null,v=null,b=0,e=0,C=0;t.prototype.restore=function(){var t,e=this.panelEl.find(".modal-content"),a=this.panelEl.find(".modal-footer");0==p?(this.panelEl.removeClass("video-chat-panel-mini"),e.removeClass("modal-content-mini"),u.removeClass("video-mini"),g.removeClass("video-mini"),g.css("visibility","visible"),a.css("display","flex"),n.css("display","block"),i.css("display","block"),l.css("display","none")):2==p&&(0<r&&(clearTimeout(r),r=0),this.panelEl.css("left",c),this.panelEl.css("top",d),this.panelEl.css("width",""),this.panelEl.css("height",""),(t=this.panelEl.find(".modal-dialog")).css("width",""),t.css("height",""),e.css("width",""),e.css("height",""),a.css("width",""),u.css("width",""),u.css("height",""),g.css("width",""),g.css("height",""),n.css("display","block"),i.css("display","block"),l.css("display","none"),this.panelEl.draggable({handle:".modal-header",containment:"document",disabled:!1})),this.refresh(),p=1},t.prototype.minimize=function(){var t,e;1==p&&(p=0,t=this.panelEl.find(".modal-content"),e=this.panelEl.find(".modal-footer"),this.panelEl.addClass("video-chat-panel-mini"),t.addClass("modal-content-mini"),u.addClass("video-mini"),g.addClass("video-mini"),g.css("visibility","hidden"),e.css("display","none"),n.css("display","none"),i.css("display","none"),l.css("display","block"),this.refresh())},t.prototype.maximize=function(){1==p&&(p=2,this.resize(),n.css("display","none"),i.css("display","none"),l.css("display","block"),this.panelEl.draggable({disabled:!0}))},t.prototype.open=function(t){console.log("发起视频连线 "+t.getId());function n(){o.app.callCtrl.makeCall(t,!0,i)?(s.elRemoteLabel.text(t.getName()),s.elLocalLabel.text("我"),s.panelEl.modal({keyboard:!1,backdrop:!1})):o.dialog.launchToast(Toast.Warning,"您当前正在通话中")}var i=null;o.cube().mpComm.listMediaDevices(function(t){if(0!=t.length){for(var a=[],e=0;e<t.length;++e)t[e].isVideoInput()&&a.push(t[e]);1<a.length?o.app.callCtrl.showSelectMediaDevice(a,function(t,e){t&&(e>=a.length?o.dialog.showAlert("选择的设备数据错误"):(i=a[e],n()))}):n()}else o.dialog.showAlert("没有找到可用的摄像机设备，请您确认是否正确连接了摄像机设备。")})},t.prototype.showAnswer=function(t){console.log("应答视频通话 "+t.getId()),this.elRemoteLabel.text(t.getName()),this.elLocalLabel.text("我"),s.btnCam.removeAttr("disabled"),s.btnMic.removeAttr("disabled"),s.btnVol.removeAttr("disabled"),this.panelEl.modal({keyboard:!1,backdrop:!1})},t.prototype.close=function(){this.panelEl.modal("hide"),o.app.mainPanel.stopWaitingTone(),o.app.mainPanel.stopCallRing()},t.prototype.tipWaitForAnswer=function(t){var e,a;0<b||(e=s.callTip.parent().height(),s.callTip.css("top",.5*(e-21)+"px"),a=0,b=setInterval(function(){s.callTip.text("正在呼叫“"+t.getName()+"”："+ ++a+" 秒...")},1e3),o.app.mainPanel.playWaitingTone(),s.btnCam.removeAttr("disabled"),s.btnMic.removeAttr("disabled"),s.btnVol.removeAttr("disabled"))},t.prototype.tipConnected=function(){0<b&&(clearInterval(b),b=0),0<e||(s.callTip.text(""),m.style.visibility="visible",e=setInterval(function(){s.headerTip.text(o.formatClockTick(++C))},1e3),o.app.callCtrl.isCameraOpened()?s.btnCam.html('<i class="ci ci-btn ci-camera-opened"></i>'):s.btnCam.html('<i class="ci ci-btn ci-camera-closed"></i>'),o.app.callCtrl.isMicrophoneOpened()?s.btnMic.html('<i class="ci ci-btn ci-microphone-opened"></i>'):s.btnMic.html('<i class="ci ci-btn ci-microphone-closed"></i>'),o.app.callCtrl.isUnmuted()?s.btnVol.html('<i class="ci ci-btn ci-volume-unmuted"></i>'):s.btnVol.html('<i class="ci ci-btn ci-volume-muted"></i>'))},t.prototype.openNewCallToast=function(t){t=['<div class="toasts-info">                <div class="info-box">                    <span class="info-box-icon"><img src="images/',t.getContext().avatar,'" /></span>                    <div class="info-box-content">                        <span class="info-box-text">',t.getName(),'</span>                        <span class="info-box-desc">邀请您参与视频通话</span>                    </div>                </div>                <div class="call-answer">                    <button type="button" class="btn btn-danger" onclick="javascript:app.callCtrl.hangupCall();"><i class="ci ci-hangup"></i> 拒绝</button>                    <button type="button" class="btn btn-success" onclick="javascript:app.callCtrl.answerCall();"><i class="ci ci-answer"></i> 接听</button>                </div>            </div>'];$(document).Toasts("create",{title:"视频通话邀请",position:"bottomRight",icon:"fas fa-video",close:!1,class:"video-new-call",body:t.join("")}),o.app.mainPanel.playCallRing()},t.prototype.closeNewCallToast=function(){$("#toastsContainerBottomRight").find(".video-new-call").remove()},t.prototype.switchVideo=function(){var t,e;a=v==m?(v=h,f=g,u):(v=m,f=u,g),f.removeClass("video-pip"),a.removeClass("video-main"),f.addClass("video-main"),a.addClass("video-pip"),2==p&&(t=parseInt(document.body.clientWidth),e=o.dialog.getFullHeight(),f.css("width",t-4+"px"),f.css("height",e-105-4+"px"),a.css("width",""),a.css("height",""))},t.prototype.terminate=function(){o.app.callCtrl.hangupCall()},t.prototype.onResize=function(t){2==p&&(0<r&&(clearTimeout(r),r=0),r=setTimeout(function(){clearTimeout(r),r=0,s.resize()},600))},t.prototype.resize=function(){var t,e,a,n,i;2==p&&(t=parseInt(document.body.clientWidth),e=o.dialog.getFullHeight(),c=this.panelEl.css("left"),d=this.panelEl.css("top"),this.panelEl.css("left","322px"),this.panelEl.css("top","-1px"),this.panelEl.css("width",t+"px"),this.panelEl.css("height",e+"px"),a=this.panelEl.find(".modal-dialog"),n=this.panelEl.find(".modal-content"),i=this.panelEl.find(".modal-footer"),e-=2,a.css("width",(t-=2)+"px"),a.css("height",e+"px"),n.css("width",t+"px"),n.css("height",e+"px"),f.css("width",t-2+"px"),f.css("height",e-105-2+"px"),i.css("width",t+"px"),this.refresh())},t.prototype.refresh=function(){var t=s.callTip.parent().height();s.callTip.css("top",.5*(t-21)+"px")},o.VideoChatPanel=t}(window),function(s){function t(){i=this,l=$("#group_voice_call"),i.localVideo=l.find('video[data-target="local"]')[0],l.find('button[data-target="minimize"]').click(function(){i.minimize()}),l.find('button[data-target="restore"]').click(function(){i.restore()}),l.find('button[data-target="hangup"]').click(function(){i.terminate()}),l.draggable({handle:".modal-header"})}var i=null,l=null,e=!1;t.prototype.open=function(e){var a=[],n=null;e.getMembers().forEach(function(t){t.getId()!=s.app.getSelf().getId()&&s.app.getContact(t.getId(),function(t){a.push(t),a.length==e.numMembers()-1&&s.app.contactListDialog.show(a,[],function(t){t.unshift(s.app.getSelf().getId()),i.resetLayout(t),t.shift(),t=e,s.app.callCtrl.makeCall(t,!1,n)?(l.find(".voice-group-default .modal-title").text("群通话 - "+t.getName()),l.find(".voice-group-minisize .modal-title").text(t.getName()),l.modal({keyboard:!1,backdrop:!1})):s.dialog.launchToast(Toast.Warning,"您当前正在通话中")},"群通话","请选择要邀请通话的群组成员")})})},t.prototype.close=function(){l.modal("hide")},t.prototype.tipWaitForAnswer=function(t){l.find(".header-tip").text("正在等待服务器应答...")},t.prototype.tipConnected=function(t){l.find(".header-tip").text("已接通...")},t.prototype.minimize=function(){e||(e=!0,l.addClass("voice-group-panel-mini"),l.find(".voice-group-default").css("display","none"),l.find(".voice-group-minisize").css("display","block"))},t.prototype.restore=function(){e&&(e=!1,l.removeClass("voice-group-panel-mini"),l.find(".voice-group-default").css("display","block"),l.find(".voice-group-minisize").css("display","none"))},t.prototype.terminate=function(){s.app.callCtrl.hangupCall()},t.prototype.resetLayout=function(t){for(var e=l.find(".layout"),a=t.length,n=[],i=0;i<a;++i){var o=t[i];s.app.getContact(o,function(t){t=['<div class="',"col-3",'">','<div class="avatar">','<img src="images/',t.getContext().avatar,'" />',"</div>",'<div class="name">',"<div>",t.getName(),"</div>","</div>","</div>"];n.push(t.join("")),n.length==a&&(e.empty(),e.append($(n.join(""))))})}},t.prototype.openInviteToast=function(t){},t.prototype.closeInviteToast=function(){},s.VoiceGroupCallPanel=t}(window),function(l){var r=null,p=null,c={list:null,timer:[]},n=[],i=0;function a(t){t=t instanceof Contact?t.getId():parseInt(t);return p.find('video[data-target="'+t+'"]')[0]}function t(){r=this,p=$("#group_video_chat"),r.localVideo=null,p.find('button[data-target="minimize"]').click(function(){r.minimize()}),p.find('button[data-target="restore"]').click(function(){r.restore()}),p.find('button[data-target="hangup"]').click(function(){r.terminate()}),p.draggable({handle:".modal-header"})}t.prototype.open=function(n){c.list=null,c.timer=[],p.find(".header-tip").text(""),l.cube().mpComm.setVideoElementAgent(a);function i(t,e){r.localVideo=a(l.app.getSelf().getId()),void 0===r.localVideo&&alert("查找本地视频标签错误"),l.app.callCtrl.makeCall(t,!0,s)?(p.find(".video-group-default .modal-title").text("群通话 - "+t.getName()),p.find(".video-group-minisize .modal-title").text(t.getName()),p.find(".header-tip").text("正在接通，请稍候..."),p.modal({keyboard:!1,backdrop:!1}),e&&(c.list=e)):l.dialog.launchToast(Toast.Warning,"您当前正在通话中")}function o(){p.find(".header-tip").text("正在启动摄像机..."),l.cube().mpComm.isCalling(n,function(t){var e;t?l.cube().mpComm.getCommField(n,function(e){var a=[l.app.getSelf().getId()];e.getEndpoints().forEach(function(t){a.push(t.getContact().getId()),a.length==e.numEndpoints()+1&&(r.resetLayout(a),a.shift(),setTimeout(function(){i(n)},500))})}):(e=[],n.getMembers().forEach(function(t){t.getId()!=l.app.getSelf().getId()&&l.app.getContact(t.getId(),function(t){e.push(t),e.length==n.numMembers()-1&&l.app.contactListDialog.show(e,[],function(t){return 0==t.length?(l.dialog.showAlert("没有邀请任何联系人参与视频通话"),!1):(t.unshift(l.app.getSelf().getId()),6<t.length?(l.dialog.showAlert("超过最大通话人数（最大通话人数 6 人）"),!1):(r.resetLayout(t),t.shift(),void i(n,t)))},"群通话","请选择要邀请通话的群组成员",5)})}))})}var s=null;l.cube().mpComm.listMediaDevices(function(t){if(0!=t.length){for(var a=[],e=0;e<t.length;++e)t[e].isVideoInput()&&a.push(t[e]);1<a.length?l.app.callCtrl.showSelectMediaDevice(a,function(t,e){t&&(e>=a.length?l.dialog.showAlert("选择的设备错误"):(s=a[e],console.log("Select device: "+s.label),o()))}):o()}else l.dialog.showAlert("没有找到可用的摄像机设备，请您确认是否正确连接了摄像机设备。")})},t.prototype.tipWaitForAnswer=function(t){p.find(".header-tip").text("正在等待服务器应答..."),null!=c.list&&(c.list.forEach(function(t){var e=setTimeout(function(){r.fireInviteTimeout(t)},3e4);c.timer.push(e)}),l.cube().mpComm.inviteCall(t.field,c.list))},t.prototype.tipConnected=function(a){p.find(".header-tip").text(""),0<i&&clearInterval(i),i=setInterval(function(){if(null==a.field)return clearInterval(i),void(i=0);var t,e=a.field.startTime;e<=0||(t=Date.now(),e=Math.round((t-e)/1e3),p.find(".header-tip").text(l.formatClockTick(e)))},1e3)},t.prototype.unmark=function(t){p.find(".container").find('td[data="'+t.getId()+'"]').find(".mask").css("visibility","hidden")},t.prototype.close=function(){0<i&&(clearInterval(i),i=0),p.modal("hide"),p.find(".header-tip").text(""),c.timer.forEach(function(t){clearTimeout(t)}),c.timer.splice(0,c.timer.length)},t.prototype.terminate=function(){l.app.callCtrl.hangupCall()||r.close()},t.prototype.appendContact=function(t){for(var e=0;e<n.length;++e)if(n[e].getId()==t.getId())return;n.push(t),this.updateLayout(n)},t.prototype.removeContact=function(t){for(var e=0;e<n.length;++e)if(n[e].getId()==t.getId()){n.splice(e,1);break}this.updateLayout(n)},t.prototype.updateLayout=function(t){var a=[],n=p.find(".container");t.forEach(function(t){var e=n.find('td[data="'+t.getId()+'"]');0<e.length?e.hasClass("colspan")&&(e.removeClass("colspan"),e.removeAttr("colspan")):e=$(['<td data="',t.getId(),'">','<div class="viewport"><video autoplay data-target="',t.getId(),'"></video></div>','<div class="mask" style="background-image:linear-gradient(rgba(0,0,0,0.7),rgba(0,0,0,0.7)), url(images/',t.context.avatar,');"><div>接入“',t.getPriorityName(),"”...</div></div>",'<div class="toolbar"><div class="name">',t.getPriorityName(),"</div></div>","</td>"].join("")),a.push(e)});var e=null,i=null;if(t.length<=2)e=['<table class="table table-borderless layout-pattern-1">',"<tr></tr>","</table>"],i=$(e.join("")),a.forEach(function(t){i.find("tr").append(t)}),p.css("height","366px");else if(3==t.length){var e=['<table class="table table-borderless layout-pattern-1">',"<tr></tr>","<tr></tr>","</table>"],i=$(e.join("")),o=a[0];o.attr("colspan","2"),o.addClass("colspan"),i.find("tr").eq(0).append(o),i.find("tr").eq(1).append(a[1]),i.find("tr").eq(1).append(a[2]),p.css("height","606px")}else if(4==t.length){e=['<table class="table table-borderless layout-pattern-2">',"<tr></tr>","<tr></tr>","</table>"];o=(i=$(e.join(""))).find("tr").eq(0);o.append(a[0]),o.append(a[1]);o=i.find("tr").eq(1);o.append(a[2]),o.append(a[3]),p.css("height","606px")}else if(5<=t.length){var s=parseInt(Math.ceil(t.length/3)),l=0;for(e=['<table class="table table-borderless layout-pattern-3">'];l<s;)e.push("<tr></tr>"),++l;e.push("</table>"),i=$(e.join(""));for(var l=0,r=0;r<s;++r)for(var c=i.find("tr").eq(r),d=0;d<3;++d)c.append(a[l]),++l;p.css("height","406px")}n.empty(),n.append(i)},t.prototype.resetLayout=function(e){n=[];for(var t=0;t<e.length;++t){var a=e[t];l.app.getContact(a,function(t){n.push(t),n.length==e.length&&r.doLayout(n)})}},t.prototype.doLayout=function(t){var e=null;if(2==t.length)e=['<table class="table table-borderless layout-pattern-1">',"<tr>",'<td data="',t[0].getId(),'">','<div class="viewport"><video autoplay data-target="',t[0].getId(),'"></video></div>','<div class="toolbar"><div class="name">',t[0].getPriorityName(),"</div></div>","</td>",'<td data="',t[1].getId(),'">','<div class="viewport"><video autoplay data-target="',t[1].getId(),'"></video></div>','<div class="mask" style="background-image:linear-gradient(rgba(0,0,0,0.7),rgba(0,0,0,0.7)), url(images/',t[1].context.avatar,');"><div>正在邀请“',t[1].getPriorityName(),"”...</div></div>",'<div class="toolbar"><div class="name">',t[1].getPriorityName(),"</div></div>","</td>","</tr>","</table>"],p.css("height","366px");else if(3==t.length)e=['<table class="table table-borderless layout-pattern-1">',"<tr>",'<td colspan="2" class="colspan" data="',t[0].getId(),'">','<div class="viewport"><video autoplay data-target="',t[0].getId(),'"></video></div>','<div class="toolbar"><div class="name">',t[0].getPriorityName(),"</div></div>","</td>","</tr>","<tr>",'<td data="',t[1].getId(),'">','<div class="viewport"><video autoplay data-target="',t[1].getId(),'"></video></div>','<div class="mask" style="background-image:linear-gradient(rgba(0,0,0,0.7),rgba(0,0,0,0.7)), url(images/',t[1].context.avatar,');"><div>正在邀请“',t[1].getPriorityName(),"”...</div></div>",'<div class="toolbar"><div class="name">',t[1].getPriorityName(),"</div></div>","</td>",'<td data="',t[2].getId(),'">','<div class="viewport"><video autoplay data-target="',t[2].getId(),'"></video></div>','<div class="mask" style="background-image:linear-gradient(rgba(0,0,0,0.7),rgba(0,0,0,0.7)), url(images/',t[2].context.avatar,');"><div>正在邀请“',t[2].getPriorityName(),"”...</div></div>",'<div class="toolbar"><div class="name">',t[2].getPriorityName(),"</div></div>","</td>","</tr>","</table>"],p.css("height","606px");else if(4==t.length)e=['<table class="table table-borderless layout-pattern-2">',"<tr>",'<td data="',t[0].getId(),'">','<div class="viewport"><video autoplay data-target="',t[0].getId(),'"></video></div>','<div class="toolbar"><div class="name">',t[0].getPriorityName(),"</div></div>","</td>",'<td data="',t[1].getId(),'">','<div class="viewport"><video autoplay data-target="',t[1].getId(),'"></video></div>','<div class="mask" style="background-image:linear-gradient(rgba(0,0,0,0.7),rgba(0,0,0,0.7)), url(images/',t[1].context.avatar,');"><div>正在邀请“',t[1].getPriorityName(),"”...</div></div>",'<div class="toolbar"><div class="name">',t[1].getPriorityName(),"</div></div>","</td>","</tr>","<tr>",'<td data="',t[2].getId(),'">','<div class="viewport"><video autoplay data-target="',t[2].getId(),'"></video></div>','<div class="mask" style="background-image:linear-gradient(rgba(0,0,0,0.7),rgba(0,0,0,0.7)), url(images/',t[2].context.avatar,');"><div>正在邀请“',t[2].getPriorityName(),"”...</div></div>",'<div class="toolbar"><div class="name">',t[2].getPriorityName(),"</div></div>","</td>",'<td data="',t[3].getId(),'">','<div class="viewport"><video autoplay data-target="',t[3].getId(),'"></video></div>','<div class="mask" style="background-image:linear-gradient(rgba(0,0,0,0.7),rgba(0,0,0,0.7)), url(images/',t[3].context.avatar,');"><div>正在邀请“',t[3].getPriorityName(),"”...</div></div>",'<div class="toolbar"><div class="name">',t[3].getPriorityName(),"</div></div>","</td>","</tr>","</table>"],p.css("height","606px");else if(5<=t.length){for(var e=['<table class="table table-borderless layout-pattern-3">'],a=3,n=parseInt(Math.ceil(t.length/a)),i=0;0<n;){for(e.push("<tr>");0<a;){var o=t[i],o=['<td data="',o.getId(),'">','<div class="viewport"><video autoplay data-target="',o.getId(),'"></video></div>',0!=i?'<div class="mask" style="background-image:linear-gradient(rgba(0,0,0,0.7),rgba(0,0,0,0.7)), url(images/'+o.context.avatar+');"><div>正在邀请“'+o.getPriorityName()+"”...</div></div>":"",'<div class="toolbar"><div class="name">',o.getPriorityName(),"</div></div>","</td>"];if(e.push(o.join("")),--a,++i>=t.length)break}if(e.push("</tr>"),--n,a=3,i>=t.length)break}e.push("</table>"),p.css("height","406px")}p.find(".container").html(e.join(""))},t.prototype.minimize=function(){var t=l.app.getSelf().getId(),e=p.find('video[data-target="'+t+'"]'),a=p.find(".video-group-minisize"),n=p.find(".video-group-default"),t=a.find(".viewport");t.empty(),e.remove(),t.append(e),p.addClass("video-group-panel-mini"),n.css("visibility","collapse"),a.css("visibility","visible"),n.insertAfter(a)},t.prototype.restore=function(){var t=l.app.getSelf().getId(),e=p.find('video[data-target="'+t+'"]'),a=p.find(".video-group-minisize"),n=p.find(".video-group-default");e.remove(),p.find('td[data="'+t+'"]').find(".viewport").append(e),p.removeClass("video-group-panel-mini"),n.css("visibility","visible"),a.css("visibility","collapse"),a.insertAfter(n)},t.prototype.openInviteToast=function(t){t=['<div class="toasts-info">                <div class="info-box">                    <span class="info-box-icon"><img src="images/group-avatar.png" /></span>                    <div class="info-box-content">                        <span class="info-box-text">',t.getName(),'</span>                        <span class="info-box-desc">邀请您参与群组视频通话</span>                    </div>                </div>                <div class="call-answer">                    <button type="button" class="btn btn-danger" onclick="javascript:app.callCtrl.rejectInvitation();"><i class="ci ci-hangup"></i> 拒绝</button>                    <button type="button" class="btn btn-success" onclick="javascript:app.callCtrl.acceptInvitation();"><i class="ci ci-answer"></i> 加入</button>                </div>            </div>'];$(document).Toasts("create",{title:"视频通话邀请",position:"bottomRight",icon:"fas fa-video",close:!1,class:"video-new-call",body:t.join("")}),l.app.mainPanel.playCallRing()},t.prototype.closeInviteToast=function(){$("#toastsContainerBottomRight").find(".video-new-call").remove(),l.app.mainPanel.stopCallRing()},t.prototype.fireInviteTimeout=function(t){var e,a=c.list.indexOf(t);0<=a&&(e=c.timer[a],clearTimeout(e),c.list.splice(a,1),c.timer.splice(a,1)),l.app.getContact(t,function(t){r.removeContact(t)})},l.VideoGroupChatPanel=t}(window),function(i){"use strict";function e(){a.getId()==i.app.getSelf().getId()?dialog.showPrompt("修改我的昵称","请输入新昵称：",function(t,n){t&&0!=n.length&&$.ajax({type:"POST",url:"/account/info",data:{name:n},success:function(t,e,a){null!=t&&(i.cube().contact.modifyContact(n,t,function(t){i.app.updateContact(t),i.app.sidebarAccountPanel.updateName(t.getName())},function(t){console.log(t)}),o.find(".widget-user-username").text(t.name))},error:function(t,e){console.log(e)}})}):dialog.showPrompt("修改联系人备注","请输入“"+a.getName()+"”的备注名：",function(t,e){t&&a.getAppendix().updateRemarkName(e,function(t){dialog.launchToast(Toast.Success,"已修改联系人备注名"),o.find(".widget-user-username").text(t.hasRemarkName()?t.getRemarkName():a.getName()),i.app.messagingCtrl.updateContact(a)},function(t){dialog.launchToast(Toast.Success,"修改联系人备注名失败: "+t.code)})},a.getAppendix().getRemarkName())}function t(t){(n=(o=t).find('button[data-target="edit-remarkname"]')).click(e)}var o=null,n=null,a=null;t.prototype.show=function(t){function e(t){var e=o,a=t.getAppendix().hasRemarkName()?t.getAppendix().getRemarkName():t.getName();e.find(".widget-user-username").text(a),e.find(".user-avatar").attr("src","images/"+t.getContext().avatar),e.find(".user-id").text(t.getId()),e.find(".user-region").text(t.getContext().region),e.find(".user-department").text(t.getContext().department),t.getId()==i.app.getSelf().getId()?(n.attr("title","修改昵称"),e.find(".widget-user-desc").text("")):(n.attr("title","修改备注"),e.find(".widget-user-desc").text(t.getName())),e.modal("show")}t instanceof Contact?e(a=t):i.app.getContact(t,function(t){null!=(a=t)&&e(a)})},t.prototype.hide=function(){o.modal("hide")},i.ContactDetails=t}(window),function(r){function e(){r.dialog.showPrompt("修改群名称","请输入新的群组名",function(t,e){if(t){if(!(3<=e.length))return r.dialog.showAlert("输入的群组名称不能少于3个字符。"),!1;r.app.messagingCtrl.modifyGroupName(o,e,function(t){l.text(t.getName())})}})}function a(){var e=r.app.getMyContacts(),a=o.getMembers();r.app.contactListDialog.show(e,a,function(t){return e.length==a.length+1||(0==t.length?(r.dialog.showAlert("没有选择联系人"),!1):(o.addMembers(t,function(){r.app.groupDetails.refresh()},function(t){r.dialog.launchToast(Toast.Error,"添加群组成员失败: "+t.code)}),!0))})}function n(){o.isOwner()?r.dialog.showAlert("您是该群组的群主，不能退出该群。",null,"我知道了"):r.dialog.showConfirm("退出群组","您确定要退出“"+o.getName()+"”群组吗？",function(t){t&&window.cube().contact.quitGroup(o,function(){r.app.messagingCtrl.removeGroup(o),r.app.groupDetails.hide()},function(t){r.dialog.launchToast(Toast.Error,"退出群组失败: "+t.code)})})}function i(){o.isOwner()?r.dialog.showConfirm("解散群组","您确定要解散“"+o.getName()+"”群组吗？",function(t){t&&window.cube().contact.dissolveGroup(o,function(t){r.app.groupDetails.hide()},function(t){r.dialog.launchToast(Toast.Error,"解散群组失败: "+t.code)})}):r.dialog.showAlert("您不是该群组的群主，不能解散该群。",null,"我知道了")}function t(t){this.el=t,l=t.find(".widget-user-username"),(c=$("#group_details_modify")).click(e),(d=$("#group_details_add")).click(a),(p=$("#group_details_quit")).click(n),(u=$("#group_details_dissolve")).click(i)}var o=null,s=0,l=null,c=null,d=null,p=null,u=null;t.prototype.show=function(t){var e,a;null==o||o.getId()!=t.getId()||t.getLastActiveTime()!=s?(s=(o=t).getLastActiveTime(),e=this.el,l.text(t.getName()),c.attr("data",t.getId()),d.attr("data",t.getId()),p.attr("data",t.getId()),u.attr("data",t.getId()),(a=e.find(".table")).find("tbody").remove(),a.append(this.createGroupDetailsTable(t)),e.modal("show")):this.el.modal("show")},t.prototype.hide=function(){this.el.modal("hide")},t.prototype.refresh=function(){var t,e;null!=o&&((e=(t=this.el).find(".table")).find("tbody").remove(),e.append(this.createGroupDetailsTable(o)),t.modal("show"))},t.prototype.createGroupDetailsTable=function(t){for(var e=$("<tbody></tbody>"),a=t.isOwner(),n=(n=["app.contactsCtrl.removeGroupMember(","parseInt($(this).attr('data-group')),","parseInt($(this).attr('data-member'))",");"]).join(""),i=t.getMembers(),o=0;o<i.length;++o){var s=i[o],l=a?['<button class="btn btn-danger btn-xs" onclick="',n,'"',' data-member="',s.getId(),'"',' data-group="',t.getId(),'"',' data-original-title="从本群中移除" data-placement="top" data-toggle="tooltip"><i class="fas fa-minus"></i></button>']:[],l=(l=a&&s.equals(r.app.getSelf())?[]:l).join(""),s=r.app.queryContact(s.getId()),l=["<tr>","<td>",o+1,"</td>",'<td><img class="table-avatar" src="images/',s.getContext().avatar,'" /></td>',"<td>",s.getPriorityName(),"</td>","<td>",s.getId(),"</td>","<td>",s.getContext().region,"</td>","<td>",s.getContext().department,"</td>","<td>",l,"</td>","</tr>"],l=$(l.join(""));e.append(l)}return e},r.GroupDetails=t}(window),function(s){"use strict";function t(t){c=(r=t).find('div[data-target="my-contacts"]'),d=t.find('input[data-target="group-name"]'),t.find('button[data-target="confirm"]').click(function(){var t=d.val().trim();0==t.length&&(t=s.app.getSelf().getName()+"创建的群组");var a=[];c.find('input[type="checkbox"]:checked').each(function(t,e){a.push(parseInt($(e).attr("data")))}),0!=a.length?window.cube().contact.createGroup(t,a,function(t){s.app.messageCatalog.appendItem(t),r.modal("hide")},function(t){s.dialog.launchToast(Toast.Error,"创建群组失败: "+t.code)}):s.dialog.showAlert("请选择群组成员。",null,"我知道了")})}var l,r=null,c=null,d=null;t.prototype.show=function(t){l=s.app.getMyContacts(),d.val(""),c.empty();for(var e=0;e<l.length;++e){var a=l[e],n=a.getId(),i=a.getContext().avatar,o=a.getPriorityName(),a=void 0!==t&&0<=t.indexOf(n);c.append($(['<div class="col-6"><div class="form-group"><div class="custom-control custom-checkbox select-group-member">','<input class="custom-control-input" type="checkbox"',a?' checked="checked"':"",' id="group_member_',e,'" data="',n,'" />','<label class="custom-control-label" for="group_member_',e,'">','<img src="images/',i,'" />',"<span>",o,"</span>","</label>","</div></div></div>"].join("")))}r.modal("show")},s.NewGroupDialog=t}(window),function(n){"use strict";var d=null,p=null,u=-1,g=[],f=null;function m(t,e){for(var a="number"==typeof t?t:t.getId(),n=0;n<e.length;++n){var i=e[n];if(i.getId()==a)return i}return null}function t(){var a,t;null!=f&&(a=[],d.find("tbody").find('input[type="checkbox"]:checked').each(function(t,e){e=parseInt($(e).attr("data"));null==m(e,p)&&a.push(e)}),void 0!==(t=f(a))&&!t||(d.modal("hide"),f=null))}function e(){(d=$("#contact_list_dialog")).find('button[data-target="confirm"]').click(t)}e.prototype.show=function(t,e,a,n,i,o){p=e,u=void 0!==o?o:-1,g.splice(0,g.length),n?d.find(".modal-title").text(n):d.find(".modal-title").text("联系人列表"),i?d.find(".tip").text(i):d.find(".tip").text("请选择联系人"),a&&(f=a);a=d.find("tbody");a.empty();for(var s=[],l=0;l<t.length;++l)var r=t[l],c=null!=m(r,e),r=['<tr onclick="app.contactListDialog.toggleChecked(',r.getId(),')">',"<td>",'<div class="custom-control custom-checkbox">','<input class="custom-control-input" type="checkbox" data="',r.getId(),'" id="list_contact_',r.getId(),'"',c?' checked="checked" disabled="disabled"':"",">","</input>",'<label class="custom-control-label" for="list_contact_',r.getId(),'">',"</label>","</div>","</td>",'<td><img class="table-avatar" src="images/',r.getContext().avatar,'" /></td>',"<td>",r.getName(),"</td>","<td>",r.getId(),"</td>","<td>",r.getContext().region,"</td>","<td>",r.getContext().department,"</td>","</tr>"],s=s.concat(r);a.append(s.join("")),d.modal("show")},e.prototype.hide=function(){d.modal("hide"),f=null},e.prototype.toggleChecked=function(t){var e,a=d.find('input[data="'+t+'"]');a.prop("checked")?(a.prop("checked",!1),0<=(e=g.indexOf(t))&&g.splice(e,1)):(a.prop("checked",!0),(e=g.indexOf(t))<0&&g.push(t)),0<u&&setTimeout(function(){var t;g.length>u&&(t=g.pop(),d.find('input[data="'+t+'"]').prop("checked",!1),n.dialog.launchToast(Toast.Info,"最多只能选择"+u+"个联系人"))},10)},n.ContactListDialog=e}(window),function(p){var n=null,u=null,e=null,a=null,i=null,o=!0,s=!0;function l(t){n.onNewMessage(t.data)}function r(t){t=t.data;p.app.messagePanel.appendMessage(p.app.messagePanel.current.entity,p.app.getSelf(),t,!0,!0),t.isFromGroup()?p.app.messageCatalog.updateItem(t.getSource(),t,t.getRemoteTimestamp()):p.app.messageCatalog.updateItem(t.getTo(),t,t.getRemoteTimestamp())}function c(t){p.app.messagePanel.changeMessageState(t.data)}function d(t){t=t.data;p.app.messagePanel.appendMessage(t.getReceiver(),p.app.getSelf(),t,!0)}function g(t){var e=t.data;p.app.messagePanel.changeMessageState(e);t=new LocalNoteMessage("“"+e.getReceiver().getName()+"”在你的“黑名单”里，不能向他发送消息！");t.setLevel(3),u.messaging.markLocalOnlyOwner(e.getReceiver(),t)}function f(t){var e=t.data;p.app.messagePanel.changeMessageState(e);t=new LocalNoteMessage("“"+e.getReceiver().getName()+"”已拒收你的消息！");t.setLevel(3),u.messaging.markLocalOnlyOwner(e.getReceiver(),t)}function m(t){t.data.data}function h(t){var e=t.data,t=e.getAppendix().getCommId();0!=t?u.mpComm.getCommField(t,function(t){t.mediaConstraint.videoEnabled?p.app.messageCatalog.updateState(e.getId(),"video"):p.app.messageCatalog.updateState(e.getId(),"audio"),p.app.messagePanel.refreshStateBar()}):(p.app.messageCatalog.updateState(e.getId()),p.app.messagePanel.refreshStateBar())}function t(t){u=t,n=this,$("#col_messaging_catalog"),a=$("#col_messaging_content"),(i=$("#col_messaging_sidebar")).hasClass("no-display")||i.addClass("no-display"),u.messaging.on(MessagingEvent.Sending,r),u.messaging.on(MessagingEvent.Sent,c),u.messaging.on(MessagingEvent.Notify,l),u.messaging.on(MessagingEvent.MarkOnlyOwner,d),u.messaging.on(MessagingEvent.SendBlocked,g),u.messaging.on(MessagingEvent.ReceiveBlocked,f),u.messaging.on(MessagingEvent.Fault,m),u.contact.on(ContactEvent.GroupAppendixUpdated,h)}t.prototype.ready=function(){p.app.messageCatalog.refreshOrder();for(var t=p.app.messageCatalog.getEntityList(),e=0;e<t.length;++e){var a=t[e];a instanceof Group&&(0!=(a=a.getAppendix().getCommId())&&u.mpComm.getCommField(a,function(t){t.mediaConstraint.videoEnabled?p.app.messageCatalog.updateState(t.group.getId(),"video"):p.app.messageCatalog.updateState(t.group.getId(),"audio")}))}},t.prototype.fireJoin=function(){var t,e=p.app.messagePanel.getCurrentPanel();null==e||!e.groupable||0!=(t=e.entity.getAppendix().getCommId())&&u.mpComm.getCommField(t,function(t){t.hasJoin()?p.dialog.launchToast(Toast.Info,"您已经加入了当前群通话。"):p.app.callCtrl.launchGroupCall(e.entity,t.mediaConstraint.videoEnabled)})},t.prototype.updateContactMessages=function(t,l){var r;t.getId()!=p.app.account.id&&(r=0,u.messaging.queryRecentMessagesWithContact(t,10,function(t,e){if(0!=(r=e.length)){for(var a,n=0,i=0;i<e.length;++i){var o=e[i];a=o,u.messaging.isSender(a)?p.app.messagePanel.appendMessage(a.getReceiver(),a.getSender(),a,!0):p.app.messagePanel.appendMessage(a.getSender(),a.getSender(),a,!0),--r,l&&0==r&&l(),o.isRead()||++n}for(i=e.length-1;0<=i;--i){var s=e[i];if(p.app.messageCatalog.updateItem(t,s,s.getRemoteTimestamp())){0<n&&p.app.messageCatalog.updateBadge(t,n);break}}}else l&&l()}))},t.prototype.updateGroupMessages=function(s,l){var r=0,c=null,d=new OrderMap;u.messaging.queryRecentMessagesWithGroup(s,10,function(t,e){if(0!=(r=e.length)){c=e;for(var a=0,n=0;n<e.length;++n){var i=e[n];!function(a,e){p.app.getContact(e.getFrom(),function(t){d.put(e.getId(),t),0==--r&&(c.forEach(function(t){var e=d.get(t.getId());p.app.messagePanel.appendMessage(a,e,t,!0)}),c=null,d.clear(),d=null,l&&l())})}(s,i),i.isRead()||++a}for(n=e.length-1;0<=n;--n){var o=e[n];if(p.app.messageCatalog.updateItem(t,o,o.getRemoteTimestamp())){0<a&&p.app.messageCatalog.updateBadge(t,a);break}}}else l&&l()})},t.prototype.updateContact=function(t){p.app.messagePanel.updatePanel(t.getId(),t),p.app.messageCatalog.updateItem(t,null,null,t.getAppendix().hasRemarkName()?t.getAppendix().getRemarkName():t.getName()),p.app.messageSidebar.update(group)},t.prototype.updateGroup=function(t){p.app.messagePanel.updatePanel(t.getId(),t),p.app.messageCatalog.updateItem(t,null,null,t.getName()),p.app.messageSidebar.update(t)},t.prototype.selectFile=function(t){null==e&&(e=t).on("change",function(t){t=t.target.files[0];n.fireSend(p.app.messagePanel.current.entity,t)}),e.click()},t.prototype.fireSend=function(t,e){if(t instanceof Group&&t.getState()!=GroupState.Normal)return null;var a=null;if("string"==typeof e)a=new HyperTextMessage(e);else{if(!(e instanceof File))return p.dialog.launchToast(Toast.Warning,"程序内部错误"),null;a=new(0<=e.type.indexOf("image")?ImageMessage:FileMessage)(e)}return a=u.messaging.sendTo(t,a)},t.prototype.toggle=function(e){var a;e!=p.app.account.id&&(a=function(t){null!=t&&(p.app.messagePanel.changePanel(e,t),p.app.messageCatalog.activeItem(e),p.app.messageCatalog.updateBadge(e,0))},p.app.getGroup(e,function(t){null==t?p.app.getContact(e,function(t){a(t),p.app.messageSidebar.update(t),s?n.showSidebar():n.hideSidebar()}):(a(t),p.app.messageSidebar.update(t),o?n.showSidebar():n.hideSidebar())}))},t.prototype.toggleSidebar=function(){i.hasClass("no-display")?(this.showSidebar(),p.app.messagePanel.getCurrentPanel().groupable?o=!0:s=!0):(this.hideSidebar(),p.app.messagePanel.getCurrentPanel().groupable?o=!1:s=!1)},t.prototype.showSidebar=function(){i.hasClass("no-display")&&(a.removeClass("col-md-9"),a.removeClass("col-sm-10"),a.addClass("col-md-6"),a.addClass("col-sm-6"),i.removeClass("no-display"))},t.prototype.hideSidebar=function(){i.hasClass("no-display")||(a.removeClass("col-md-6"),a.removeClass("col-sm-6"),a.addClass("col-md-9"),a.addClass("col-sm-10"),i.addClass("no-display"))},t.prototype.showGroupMember=function(){},t.prototype.recallMessage=function(e,t){u.messaging.recallMessage(t,function(t){p.app.messagePanel.appendNote(e,"消息已撤回 "+p.formatFullTime(Date.now())),p.app.messagePanel.removeMessage(e,t)},function(t){p.dialog.launchToast(Toast.Error,t.code==MessagingServiceState.DataTimeout?"消息发送超过2分钟，不能撤回":"撤回消息失败"),console.log("撤回消息失败 - "+t)})},t.prototype.deleteMessage=function(e,t){u.messaging.deleteMessage(t,function(t){p.dialog.launchToast(Toast.Success,"消息已删除"),p.app.messagePanel.removeMessage(e,t)},function(t){p.dialog.launchToast(Toast.Error,"删除消息失败"),console.log("删除消息失败 - "+t)})},t.prototype.prependMore=function(t){var a=p.app.messagePanel.getPanel(t),e=0==a.messageTimes.length?Date.now():a.messageTimes[0]-1,n=10;a.groupable?u.messaging.reverseIterateMessageWithGroup(t,e,function(t,e){return p.app.messagePanel.appendMessage(a.entity,e.getSender(),e,!1),0!=--n},function(){10==n&&p.dialog.launchToast(Toast.Info,"没有更多消息了")}):u.messaging.reverseIterateMessageWithContact(t,e,function(t,e){return p.app.messagePanel.appendMessage(a.entity,e.getSender(),e,!1),0!=--n},function(){10==n&&p.dialog.launchToast(Toast.Info,"没有更多消息了")})},t.prototype.openVoiceCall=function(t){t instanceof Group?p.app.callCtrl.launchGroupCall(t,!1):p.app.callCtrl.callContact(t,!1)},t.prototype.openVideoChat=function(t){t instanceof Group?p.app.callCtrl.launchGroupCall(t,!0):p.app.callCtrl.callContact(t,!0)},t.prototype.onNewMessage=function(t){t.isFromGroup()?(p.app.messagePanel.hasPanel(t.getSourceGroup())?p.app.messagePanel.appendMessage(t.getSourceGroup(),t.getSender(),t):n.updateGroupMessages(t.getSourceGroup(),function(){p.app.messagePanel.appendMessage(t.getSourceGroup(),t.getSender(),t,!1)}),p.app.messageCatalog.updateItem(t.getSourceGroup(),t,t.getRemoteTimestamp())||console.debug("#onNewMessage - update catalog item failed"),n.updateUnread(t.getSource(),t)):p.app.account.id==t.getFrom()?(p.app.messagePanel.hasPanel(t.getReceiver())?p.app.messagePanel.appendMessage(t.getReceiver(),t.getSender(),t):n.updateContactMessages(t.getReceiver(),function(){p.app.messagePanel.appendMessage(t.getReceiver(),t.getSender(),t,!1)}),p.app.messageCatalog.updateItem(t.getReceiver(),t,t.getRemoteTimestamp()),n.updateUnread(t.getTo(),t)):(p.app.messagePanel.hasPanel(t.getSender())?p.app.messagePanel.appendMessage(t.getSender(),t.getSender(),t,!1):n.updateContactMessages(t.getSender(),function(){p.app.messagePanel.appendMessage(t.getSender(),t.getSender(),t,!1)}),p.app.messageCatalog.updateItem(t.getSender(),t,t.getRemoteTimestamp()),n.updateUnread(t.getFrom(),t))},t.prototype.updateUnread=function(t,e){var a;e.isRead()||(null==(a=p.app.messagePanel.getCurrentPanel())||a.id!=t?void 0!==(a=p.app.messagePanel.getPanel(t))&&0<a.unreadCount&&p.app.messageCatalog.updateBadge(t,a.unreadCount):u.messaging.markRead(e))},t.prototype.modifyGroupName=function(t,e,a){t.modifyName(e,function(t){p.dialog.launchToast(Toast.Success,"已修改群组名称"),a&&a(t)},function(t){p.dialog.launchToast(Toast.Warning,"修改群名称失败: "+t.code)})},t.prototype.removeGroup=function(t){p.app.messageCatalog.removeItem(t),p.app.messagePanel.clearPanel(t.getId()),this.hideSidebar(),u.messaging.deleteRecentMessager(t)},t.prototype.removeContact=function(t){p.app.messageCatalog.removeItem(t),p.app.messagePanel.clearPanel(t.getId()),this.hideSidebar(),u.messaging.deleteRecentMessager(t)},p.MessagingController=t}(window),function(o){var a,s=null,r=null,c=null,d=!1,p=[],u=-1,l=!1,g=!1,n=!1,i=1,e=0;function f(t){var e=t.data,t=e.getCaller();null!=t&&(e.callerMediaConstraint.videoEnabled?(l=!(g=!1),o.app.videoChatPanel.openNewCallToast(t)):(l=g=!0,o.app.voiceCallPanel.openNewCallToast(t)))}function m(t){t=t.data;null!=t.group&&(l?o.dialog.launchToast(Toast.Warning,"收到来自“"+t.group.getName()+"”通话邀请"):((t.mediaConstraint.videoEnabled?o.app.videoGroupChatPanel:o.app.voiceGroupCallPanel).openInviteToast(t.group),e=setTimeout(function(){a.rejectInvitation()},3e4)))}function h(t){o.app.getContact(t.data.contact.getId(),function(t){g||o.app.videoGroupChatPanel.appendContact(t)}),o.app.messagePanel.refreshStateBar()}function v(t){o.app.getContact(t.data.contact.getId(),function(t){g||o.app.videoGroupChatPanel.removeContact(t)}),o.app.messagePanel.refreshStateBar()}function b(t){t=t.data;g||o.app.videoGroupChatPanel.unmark(t.contact)}function C(t){}function y(t){console.log("#onInProgress")}function w(t){n?(g?o.app.voiceGroupCallPanel:o.app.videoGroupChatPanel).tipWaitForAnswer(t.data):(g?o.app.voiceCallPanel:o.app.videoChatPanel).tipWaitForAnswer(t.data.getCallee())}function T(t){n?((g?o.app.voiceGroupCallPanel:o.app.videoGroupChatPanel).tipConnected(t.data),o.app.messagePanel.refreshStateBar()):(g?o.app.voiceCallPanel:o.app.videoChatPanel).tipConnected(t.data)}function I(t){console.log("#onMediaConnected")}function x(t){console.log("#onMediaDisconnected")}function k(t){var e=t.data;l=!1,n?(g?(o.app.voiceGroupCallPanel.close(),o.dialog.launchToast(Toast.Info,"群组语音通话已结束")):(o.app.videoGroupChatPanel.close(),o.dialog.launchToast(Toast.Info,"群组视频通话已结束")),o.app.messagePanel.refreshStateBar()):((g?o.app.voiceCallPanel:o.app.videoChatPanel).close(),e.isCaller()&&(t=new CallRecordMessage(e),s.messaging.sendTo(e.getCallee(),t)),e=1e3<(e=e.getDuration())?"通话结束 - "+o.formatClockTick(parseInt(e/1e3)):"通话结束",console.log(e),o.dialog.launchToast(Toast.Info,e))}function P(t){var e=t.data;l=!1;t=null,t=e.isCaller()?"被叫忙，拒绝通话":"已拒绝通话邀请";console.log(t),o.dialog.launchToast(Toast.Info,t),g?(o.app.voiceCallPanel.close(),o.app.voiceCallPanel.closeNewCallToast()):(o.app.videoChatPanel.close(),o.app.videoChatPanel.closeNewCallToast())}function S(t){n||(g?(o.app.voiceCallPanel.close(),o.app.voiceCallPanel.closeNewCallToast()):(o.app.videoChatPanel.close(),o.app.videoChatPanel.closeNewCallToast()),t.data.isCaller()&&o.dialog.launchToast(Toast.Info,"对方无应答"))}function M(t){var e=t.data;l=!1,console.log("onFailed - "+e),e.code==CallState.MediaPermissionDenied?g?o.dialog.launchToast(Toast.Warning,"未能获得麦克风使用权限"):o.dialog.launchToast(Toast.Warning,"未能获得摄像头/麦克风使用权限"):e.code==CallState.BeCallerBlocked?o.dialog.showAlert("你已经把“"+e.data.field.callee.getName()+"”添加到黑名单里，不能邀请他通话！"):e.code==CallState.BeCalleeBlocked?o.dialog.showAlert("“"+e.data.field.callee.getName()+"”已经阻止了你的通话邀请！"):(o.dialog.launchToast(Toast.Warning,"通话失败，故障码："+e.code),a.hangupCall()),setTimeout(function(){n?console.log("#onFailed: "+e.code):g?(o.app.voiceCallPanel.close(),o.app.voiceCallPanel.closeNewCallToast()):(o.app.videoChatPanel.close(),o.app.videoChatPanel.closeNewCallToast())},500)}function t(t){a=this,(s=t).mpComm.on(CommEvent.NewCall,f),s.mpComm.on(CommEvent.Invited,m),s.mpComm.on(CommEvent.InProgress,y),s.mpComm.on(CommEvent.Ringing,w),s.mpComm.on(CommEvent.Connected,T),s.mpComm.on(CommEvent.Bye,k),s.mpComm.on(CommEvent.Arrived,h),s.mpComm.on(CommEvent.Left,v),s.mpComm.on(CommEvent.Followed,b),s.mpComm.on(CommEvent.Unfollowed,C),s.mpComm.on(CommEvent.Busy,P),s.mpComm.on(CommEvent.Timeout,S),s.mpComm.on(CommEvent.Failed,M),s.mpComm.on(CommEvent.MediaConnected,I),s.mpComm.on(CommEvent.MediaDisconnected,x)}t.prototype.showSelectMediaDevice=function(t,e){var a;if(c=e,u=-1,d=!!t[0].isVideoInput(),null==r&&((a=$("#select_media_device")).find('button[data-target="cancel"]').click(function(){for(var t=0;t<p.length;++t)if(void 0===p[t].stream)return;u=-1,r.modal("hide")}),a.find('button[data-target="confirm"]').click(function(){for(var t=0;t<p.length;++t)if(void 0===(e=p[t]).stream)return;var e=r.find(d?'input:radio[name="VideoDevice"]:checked':'input:radio[name="AudioDevice"]:checked').attr("data");u=parseInt(e),r.modal("hide")}),a.on("hide.bs.modal",function(){if(0<p.length){for(var t=0;t<p.length;++t){var e=p[t];MediaDeviceTool.stopStream(e.stream,e.videoEl)}p.splice(0,p.length)}0<=u?setTimeout(function(){c(!0,u)},1e3):setTimeout(function(){c(!1)},500)}),r=a),d){(a=r.find(".modal-dialog")).hasClass("modal-lg")||a.addClass("modal-lg"),r.find('div[data-target="audio"]').css("display","none");var n=r.find('div[data-target="video"]');n.css("display","flex"),n.find(".col-6").css("display","none"),t.forEach(function(t,e){e=n.find('div[data-target="video-'+e+'"]');e.find("label").text(t.label),p.push({device:t}),MediaDeviceTool.loadVideoDeviceStream(e.find("video")[0],t,!1,function(t,e,a){for(var n=0;n<p.length;++n)if(p[n].device==e){p[n]={videoEl:t,device:e,stream:a};break}},function(t){console.log(t)}),e.css("display","block")})}else{r.find(".modal-dialog").removeClass("modal-lg"),r.find('div[data-target="video"]').css("display","none");var i=r.find('div[data-target="audio"]');i.css("display","block"),i.find(".custom-radio").css("display","none");for(var o=0;o<t.length;++o){var s=t[o],l=i.find('div[data-target="audio-'+o+'"]');l.find("label").text(s.label),l.css("display","block")}}r.modal("show")},t.prototype.callContact=function(e,a){n=!1,s.contact.queryBlockList(function(t){0<=t.indexOf(e.getId())?o.dialog.showAlert("你已经把“"+e.getName()+"”添加到黑名单里，不能邀请他通话！"):(a?o.app.videoChatPanel:o.app.voiceCallPanel).open(e)})},t.prototype.launchGroupCall=function(t,e){t.getState()==GroupState.Normal?(n=!0,g=!e,(e?o.app.videoGroupChatPanel:o.app.voiceGroupCallPanel).open(t)):o.dialog.showAlert("群组“"+t.getName()+"”已不存在！")},t.prototype.makeCall=function(t,e,a,n){if(l)return!1;l=!0,g=!e;var i=new MediaConstraint(e,!0);return t instanceof Contact?(e?(s.mpComm.setRemoteVideoElement(o.app.videoChatPanel.remoteVideo),s.mpComm.setLocalVideoElement(o.app.videoChatPanel.localVideo),a&&i.setVideoDevice(a)):(s.mpComm.setRemoteVideoElement(o.app.voiceCallPanel.remoteVideo),s.mpComm.setLocalVideoElement(o.app.voiceCallPanel.localVideo),a&&i.setAudioDevice(a)),s.mpComm.makeCall(t,i,n)):t instanceof Group&&(e?(i.setVideoDimension(VideoDimension.VGA_IDEAL),s.mpComm.setLocalVideoElement(o.app.videoGroupChatPanel.localVideo),a&&i.setVideoDevice(a)):(s.mpComm.setLocalVideoElement(o.app.voiceGroupCallPanel.localVideo),a&&i.setAudioDevice(a)),s.mpComm.makeCall(t,i,n))},t.prototype.answerCall=function(){if(!l)return!1;if(g){o.app.voiceCallPanel.closeNewCallToast(),s.mpComm.setRemoteVideoElement(o.app.voiceCallPanel.remoteVideo),s.mpComm.setLocalVideoElement(o.app.voiceCallPanel.localVideo);var t=new MediaConstraint(!1,!0);if(s.mpComm.answerCall(t))return o.app.voiceCallPanel.showAnswer(s.mpComm.getActiveRecord().getCaller()),!0}else{o.app.videoChatPanel.closeNewCallToast(),s.mpComm.setRemoteVideoElement(o.app.videoChatPanel.remoteVideo),s.mpComm.setLocalVideoElement(o.app.videoChatPanel.localVideo);t=new MediaConstraint(!0,!0);if(s.mpComm.answerCall(t))return o.app.videoChatPanel.showAnswer(s.mpComm.getActiveRecord().getCaller()),!0}return!1},t.prototype.hangupCall=function(){return!!l&&(l=!1,s.mpComm.hangupCall()||console.log("CallController : 终止通话时发生错误。"),n?(g?o.app.voiceGroupCallPanel:o.app.videoGroupChatPanel).close():g?(o.app.voiceCallPanel.close(),o.app.voiceCallPanel.closeNewCallToast()):(o.app.videoChatPanel.close(),o.app.videoChatPanel.closeNewCallToast()),!0)},t.prototype.joinGroupCalling=function(t){},t.prototype.acceptInvitation=function(){0<e&&(clearTimeout(e),e=0);var t=s.mpComm.getActiveRecord().field;t.mediaConstraint.videoEnabled?(o.app.videoGroupChatPanel.closeInviteToast(),o.app.videoGroupChatPanel.open(t.group)):(o.app.voiceGroupCallPanel.closeInviteToast(),o.app.voiceGroupCallPanel.open(t.group))},t.prototype.rejectInvitation=function(){0<e&&(clearTimeout(e),e=0),(s.mpComm.getActiveRecord().field.mediaConstraint.videoEnabled?o.app.videoGroupChatPanel:o.app.voiceGroupCallPanel).closeInviteToast()},t.prototype.isCameraOpened=function(){var t=o.cube().mpComm.getActiveField();if(null==t)return!1;t=t.getRTCDevice();return null!=t&&t.outboundVideoEnabled()},t.prototype.toggleCamera=function(){var t=s.mpComm.getActiveField();if(null==t)return console.debug("CallController - #toggleCamera() field is null"),!0;t=t.getRTCDevice();return null==t?(console.debug("CallController - #toggleCamera() rtcDevice is null"),!0):(t.outboundVideoEnabled()?t.enableOutboundVideo(!1):t.enableOutboundVideo(!0),t.outboundVideoEnabled())},t.prototype.isMicrophoneOpened=function(){var t=o.cube().mpComm.getActiveField();if(null==t)return!1;t=t.getRTCDevice();return null!=t&&t.outboundAudioEnabled()},t.prototype.toggleMicrophone=function(){var t=s.mpComm.getActiveField();if(null==t)return console.debug("CallController - #toggleMicrophone() field is null"),!0;t=t.getRTCDevice();return null==t?(console.debug("CallController - #toggleMicrophone() rtcDevice is null"),!0):(t.outboundAudioEnabled()?t.enableOutboundAudio(!1):t.enableOutboundAudio(!0),t.outboundAudioEnabled())},t.prototype.isUnmuted=function(){var t=o.cube().mpComm.getActiveField();if(null==t)return!1;t=t.getRTCDevice();return null!=t&&0<t.getVolume()},t.prototype.toggleLoudspeaker=function(){var t=s.mpComm.getActiveField();if(null==t)return console.debug("CallController - #toggleLoudspeaker() field is null"),!0;var e=t.getRTCDevice();if(null==e)return console.debug("CallController - #toggleLoudspeaker() rtcDevice is null"),!0;t=e.getVolume();return console.debug("CallController - #toggleLoudspeaker() volume is "+t),0<t?(i=t,e.setVolume(0),!1):(e.setVolume(i),!0)},o.CallController=t}(window),function(e){"use strict";function t(t,e){i=e,o=(n=t).find("#btn_all_files"),s=n.find("#btn_image_files"),l=n.find("#btn_doc_files"),r=n.find("#btn_recyclebin"),i.find("#btn_trans_upload"),i.find("#btn_trans_download"),i.find("#btn_trans_complete"),c=o,a=this}var a=null,n=null,i=null,o=null,s=null,l=null,r=null,c=null;t.prototype.prepare=function(){e.app.filesPanel.showRoot(),o.click(function(){a.select($(this).attr("id"))}),s.click(function(){a.select($(this).attr("id"))}),l.click(function(){a.select($(this).attr("id"))}),r.click(function(){a.select($(this).attr("id"))})},t.prototype.select=function(t){c.attr("id")!=t&&(c.removeClass("active"),o.attr("id")==t?(c=o,e.app.filesPanel.showRoot()):s.attr("id")==t?(c=s,e.app.filesPanel.showImages()):l.attr("id")==t?(c=l,e.app.filesPanel.showDocuments()):r.attr("id")==t&&(c=r,e.app.filesPanel.showRecyclebin()),c.addClass("active"),e.app.filesPanel.setTitle(c.attr("title")))},e.FilesCatalogue=t}(window),function(r){"use strict";var e,a=null,n=null,i=null;function c(t,e){var a=t.getId(),n=t.getName(),i=t.getLastModified();return["<tr onclick=\"app.filesPanel.toggleSelect('",a,"')\""," ondblclick=\"app.filesPanel.changeDirectory('",a,'\')" id="ftr_',a,'">','<td><div class="icheck-primary">','<input type="checkbox" data-type="folder" id="',a,'">','<label for="',a,'"></label></div></td>','<td class="file-icon"><i class="ci ci-file-directory"></i></td>','<td class="file-name"><a href="javascript:app.filesPanel.changeDirectory(\'',a,"');\">",n=e?n+" （于 "+r.formatYMDHMS(t.getTrashTimestamp())+"）":n,"</a></td>",'<td class="file-size">--</td>','<td class="file-lastmodifed">',r.formatYMDHMS(i),"</td>","</tr>"]}function d(t){t=t.getFileType();return"png"==t||"jpeg"==t||"gif"==t||"jpg"==t||"bmp"==t?'<i class="ci ci-file-image"></i>':"xls"==t||"xlsx"==t?'<i class="ci ci-file-excel"></i>':"ppt"==t||"pptx"==t?'<i class="ci ci-file-powerpoint"></i>':"doc"==t||"docx"==t?'<i class="ci ci-file-word"></i>':"mp3"==t||"ogg"==t||"wav"==t?'<i class="ci ci-file-music"></i>':"pdf"==t?'<i class="ci ci-file-pdf"></i>':"rar"==t?'<i class="ci ci-file-rar"></i>':"zip"==t||"gz"==t?'<i class="ci ci-file-zip"></i>':"txt"==t||"log"==t?'<i class="ci ci-file-text"></i>':"mp4"==t||"mkv"==t||"avi"==t||"ts"==t?'<i class="ci ci-file-video"></i>':"psd"==t?'<i class="ci ci-file-psd"></i>':"exe"==t||"dll"==t?'<i class="ci ci-file-windows"></i>':"apk"==t?'<i class="ci ci-file-apk"></i>':"dmg"==t?'<i class="ci ci-file-dmg"></i>':"ipa"==t?'<i class="ci ci-file-ipa"></i>':'<i class="fa fa-file-alt ci-fa-file"></i>'}function t(t){a=t,n=$("#table_files_nofile"),e=t.find('tbody[data-target="surface-a"]'),t.find('tbody[data-target="surface-b"]'),i=e}t.prototype.updatePage=function(t,s){if(0==t.length)return i[0].innerHTML="",void n.css("display","block");var l=[];t.forEach(function(t){var e,a,n,i,o=null,o=t instanceof FileLabel||t instanceof TrashFile?(n=s,i=(a=t).getFileName(),n&&(i=i+" （于 "+r.formatYMDHMS(a.getTrashTimestamp())+"）"),["<tr onclick=\"app.filesPanel.toggleSelect('",n=a.getId(),"')\""," ondblclick=\"app.filesPanel.openFileDetails('",a.getFileCode(),"')\"",' id="ftr_',n,'">','<td><div class="icheck-primary">','<input type="checkbox" data-type="file" id="',n,'">','<label for="',n,'"></label></div></td>','<td class="file-icon">',d(a),"</td>",'<td class="file-name"><a href="javascript:app.filesPanel.openFile(\'',a.getFileCode(),"');\">",i,"</a></td>",'<td class="file-size">',r.formatSize(a.getFileSize()),"</td>",'<td class="file-lastmodifed">',r.formatYMDHMS(a.getLastModified()),"</td>","</tr>"]):t instanceof SearchItem?(n=(e=t).file,i=e.directory,"root"==(a=i.getName())&&(a="/"),["<tr onclick=\"app.filesPanel.toggleSelect('",e=n.getId(),'\')" id="ftr_',e,'">','<td><div class="icheck-primary">','<input type="checkbox" data-type="file" id="',e,'">','<label for="',e,'"></label></div></td>','<td class="file-icon">',d(n),"</td>",'<td class="file-name"><a href="javascript:app.filesPanel.openFile(\'',n.getFileCode(),"','",i.getId(),"');\">",n.getFileName(),"</a>",'<span class="desc">所在目录: ',a,"</span>","</td>",'<td class="file-size">',r.formatSize(n.getFileSize()),"</td>",'<td class="file-lastmodifed">',r.formatYMDHMS(n.getLastModified()),"</td>","</tr>"]):c(t,s);l=l.concat(o)}),0<l.length&&n.css("display","none"),i[0].innerHTML=l.join("")},t.prototype.toggleSelect=function(t){r.app.filesPanel.resetSelectAllButton();var e=a.find("#"+t);e.prop("checked")?(e.prop("checked",!1),a.find("#ftr_"+t).removeClass("table-primary")):(e.prop("checked",!0),a.find("#ftr_"+t).addClass("table-primary"))},t.prototype.unselect=function(t){var e=a.find("#"+t);e.prop("checked")&&(e.prop("checked",!1),a.find("#ftr_"+t).removeClass("table-primary"))},t.prototype.insertFolder=function(t){t=c(t);i.prepend($(t.join("")))},r.FilesTable=t}(window),function(r){"use strict";function t(t){d=t,m=new FilesTable(t.find(".table-files")),e=t.find(".checkbox-toggle"),a=t.find('button[data-target="upload"]'),i=t.find('button[data-target="empty-trash"]'),o=t.find('button[data-target="restore"]'),n=t.find('button[data-target="new-dir"]'),s=t.find('button[data-target="parent"]'),l=t.find('button[data-target="recycle"]'),p=t.find(".info-loaded"),u=t.find(".info-total"),(g=t.find('button[data-target="prev"]')).attr("disabled","disabled"),(f=t.find('button[data-target="next"]')).attr("disabled","disabled"),(c=this).initUI()}var c=null,d=null,e=null,a=null,n=null,i=null,o=null,s=null,l=null,p=0,u=0,g=null,f=null,m=null,h=null,v=null,b={page:0,loaded:0},C=null,y=!1,w=!1;t.prototype.initUI=function(){e.click(function(){var t=$(this).data("clicks");t?($('.table-files input[type="checkbox"]').prop("checked",!1),$(".checkbox-toggle .far.fa-check-square").removeClass("fa-check-square").addClass("fa-square")):($('.table-files input[type="checkbox"]').prop("checked",!0),$(".checkbox-toggle .far.fa-square").removeClass("fa-square").addClass("fa-check-square")),$(this).data("clicks",!t)}),a.click(function(){window.cube().launchFileSelector(function(t){t=t.target.files[0];v.uploadFile(t,function(t){},function(t,e){c.refreshTable(!0)},function(t){})})}),n.click(function(){r.dialog.showPrompt("新建文件夹","请输入新建文件夹的名称",function(t,e){if(t){e=e.trim();return 0==e.length?(alert("文件夹名称不能为空。"),!1):(c.newDirectory(e),!0)}})}),i.click(function(){r.dialog.showConfirm("清空回收站",'您确认清空回收站吗？<p class="text-danger tip">清空回收站将删除回收站内的所有文件，不可恢复！</p>',function(t){t&&window.cube().fs.emptyTrash(function(t){c.showRecyclebin()},function(t){r.dialog.launchToast(Toast.Error,"清空回收站失败: "+t.code)})},"清空回收站")}),o.click(function(){for(var t=[],e=d.find('.table-files input[type="checkbox"]'),a=0;a<e.length;++a){var n=$(e.get(a));n.prop("checked")&&t.push(parseInt(n.attr("id")))}0!=t.length&&window.cube().fs.restoreTrash(t,function(t,e){c.showRecyclebin(),app.filesCtrl.resetPageData(t)},function(t){r.dialog.launchToast(Toast.Error,"清空回收站失败: "+t.code)})}),s.click(function(){var t;v!=h&&(t=v.getParent(),c.changeDirectory(t))}),l.click(function(){for(var e,t,a,n,o=[],i=d.find('.table-files input[type="checkbox"]'),s=0;s<i.length;++s){var l=$(i.get(s));l.prop("checked")&&o.push({id:parseInt(l.attr("id")),type:l.attr("data-type")})}0!=o.length&&(n=null,w?(e=[],o.forEach(function(t){e.push(t.id)}),n=['您确定要删除所选择的“<span class="text-danger">',e.length,"</span>”个项目吗？",'<p class="text-danger tip">将立即删除此项目。您不能撤销此操作。</p>'],r.dialog.showConfirm("立即删除",n.join(""),function(t){t&&window.cube().fs.eraseTrash(e,function(t){c.showRecyclebin()},function(t){r.dialog.launchToast(Toast.Error,"删除文件失败: "+t.code)})},"立即删除")):(n=1==o.length?(a="",a=null==(t=v.getDirectory(o[0].id))?(t=v.getFile(o[0].id)).getFileName():t.getName(),["您确定要删除","folder"==o[0].type?"文件夹":"文件",'“<span class="text-danger">',a,"</span>”吗？"]):["您确定要删除所选择的<b>",o.length,"</b>个项目吗？"],r.dialog.showConfirm("删除文件",n.join(""),function(t){var e,a,n,i;t&&(e=[],a=[],o.forEach(function(t){("folder"==t.type?e:a).push(t.id)}),n=0==e.length,i=0==a.length,v.deleteDirectory(e,!0,function(t,e){n=!0,i&&c.refreshTable(!0)},function(t){r.dialog.launchToast(Toast.Error,"删除文件夹失败: "+t.code)}),v.deleteFile(a,function(t,e){i=!0,n&&c.refreshTable(!0)},function(t){r.dialog.launchToast(Toast.Error,"删除文件失败: "+t.code)}))},"删除")))}),g.click(function(){w||(y?0!=C.begin&&(C.end=C.begin,C.begin=C.begin-r.app.filesCtrl.numPerPage,0==C.begin&&g.attr("disabled","disabled"),window.cube().fs.searchFile(C,function(t,e){e.length<r.app.filesCtrl.numPerPage&&(f.attr("disabled","disabled"),0==e.length)||(m.updatePage(e),p.text(e.length),f.removeAttr("disabled"))},function(t){r.dialog.launchToast(Toast.Error,"过滤文件错误: "+t.code)})):0!=b.page&&(--b.page,0==b.page&&g.attr("disabled","disabled"),c.refreshTable(),f.removeAttr("disabled")))}),f.click(function(){w||(y?(C.begin=C.end,C.end=C.end+r.app.filesCtrl.numPerPage,window.cube().fs.searchFile(C,function(t,e){return e.length<r.app.filesCtrl.numPerPage&&(f.attr("disabled","disabled"),0==e.length)?(C.end=C.end-r.app.filesCtrl.numPerPage,void(C.begin=C.end-r.app.filesCtrl.numPerPage)):(g.removeAttr("disabled"),m.updatePage(e),void p.text(e.length))},function(t){r.dialog.launchToast(Toast.Error,"过滤文件错误: "+t.code)})):r.app.filesCtrl.getPageData(v,b.page+1,function(t){null==t?(f.attr("disabled","disabled"),0!=b.page&&g.removeAttr("disabled"),r.dialog.launchToast(Toast.Info,"没有更多数据")):(b.page+=1,c.refreshTable())}))})},t.prototype.setTitle=function(t){d.find(".fp-title").text(t)},t.prototype.updateTitlePath=function(){if(null!=v){var t=[];this.recurseParent(t,v);for(var e=['<ol class="breadcrumb float-sm-right">','<li class="breadcrumb-item',0==t.length?" active":"",'">',0==t.length?"我的文件":"<a href=\"javascript:app.filesPanel.changeDirectory('"+h.getId()+"');\">我的文件</a>","</li>"],a=0;a<t.length;++a){var n=t[a];e.push('<li class="breadcrumb-item'),a+1==t.length?(e.push(" active"),e.push('">'),e.push(n.getName()),e.push("</li>")):(e.push('"><a href="javascript:;">'),e.push(n.getName()),e.push("</a></li>"))}e.push("</ol>"),d.find(".fp-path").html(e.join(""))}},t.prototype.recurseParent=function(t,e){var a=e.getParent();null!=a&&(t.push(e),this.recurseParent(t,a))},t.prototype.refreshTable=function(t){t&&r.app.filesCtrl.resetPageData(v),r.app.filesCtrl.getPageData(v,b.page,function(t){return null==t?(f.attr("disabled","disabled"),m.updatePage([]),p.text(0),void u.text(0)):(m.updatePage(t),b.loaded=t.length,p.text(b.page*r.app.filesCtrl.numPerPage+t.length),u.text(v.totalDirs()+v.totalFiles()),void(b.loaded<r.app.filesCtrl.numPerPage?f.attr("disabled","disabled"):f.removeAttr("disabled")))}),0==b.page?g.attr("disabled","disabled"):g.removeAttr("disabled"),b.loaded<r.app.filesCtrl.numPerPage?f.attr("disabled","disabled"):f.removeAttr("disabled")},t.prototype.showRoot=function(){w=y=!1,null!=v?(a.css("display","inline-block"),n.css("display","inline-block"),s.css("display","block"),i.css("display","none"),o.css("display","none"),this.refreshTable(),this.updateTitlePath()):r.app.filesCtrl.getRoot(function(t){v=h=t,c.showRoot()})},t.prototype.showImages=function(){w=!(y=!0),i.css("display","none"),o.css("display","none"),d.find(".fp-path").html(""),a.css("display","none"),n.css("display","none"),s.css("display","none"),g.attr("disabled","disabled"),f.attr("disabled","disabled"),C={begin:0,end:r.app.filesCtrl.numPerPage,type:["jpg","png","gif","bmp"]},window.cube().fs.searchFile(C,function(t,e){m.updatePage(e),p.text(e.length),e.length==r.app.filesCtrl.numPerPage&&f.removeAttr("disabled")},function(t){r.dialog.launchToast(Toast.Error,"过滤图片文件: "+t.code)}),u.text("--")},t.prototype.showDocuments=function(){w=!(y=!0),i.css("display","none"),o.css("display","none"),d.find(".fp-path").html(""),a.css("display","none"),n.css("display","none"),s.css("display","none"),g.attr("disabled","disabled"),f.attr("disabled","disabled"),C={begin:0,end:r.app.filesCtrl.numPerPage,type:["pdf","doc","docx","xls","xlsx","ppt","pptx","docm","dotm","dotx","ett","xlsm","xlt","dpt","ppsm","ppsx","pot","potm","potx","pps","ptm"]},window.cube().fs.searchFile(C,function(t,e){m.updatePage(e),p.text(e.length),e.length==r.app.filesCtrl.numPerPage&&f.removeAttr("disabled")},function(t){r.dialog.launchToast(Toast.Error,"过滤文档文件: "+t.code)}),u.text("--")},t.prototype.showRecyclebin=function(){w=!(y=!1),i.css("display","inline-block"),o.css("display","inline-block"),d.find(".fp-path").html(""),a.css("display","none"),n.css("display","none"),s.css("display","none"),g.attr("disabled","disabled"),f.attr("disabled","disabled"),window.cube().fs.listTrash(0,20,function(t,e,a,n){m.updatePage(e,!0),p.text(e.length),u.text("--")},function(t){r.dialog.launchToast(Toast.Error,"读取回收站数据错误: "+t.code),m.updatePage([]),p.text(0),u.text("--")})},t.prototype.toggleSelect=function(t){m.toggleSelect(t)},t.prototype.changeDirectory=function(t){if(!w&&!y){var e=typeof t;if("number"==e||"string"==e){var a=parseInt(t);if(v.getId()==a)return;v=a==h.getId()?h:e=null==(e=v.getDirectory(a))?r.cube().fs.querySelfDirectory(a):e,m.unselect(a)}else{if(t==v)return;v=t}this.refreshTable(),this.updateTitlePath()}},t.prototype.openFile=function(t,e){var a,n=null,i=null;w||(y?null!=(a=window.cube().fs.querySearch(e,t))&&(i=a.directory,n=a.file):n=(i=v).getFile(t)),null!=n&&("png"==(a=n.getFileType())||"jpeg"==a||"gif"==a||"jpg"==a||"bmp"==a?(m.unselect(t),r.dialog.showImage(n)):(m.unselect(t),r.app.fileDetails.open(n,i)))},t.prototype.openFileDetails=function(t){var e;w||y||null!=(e=v.getFile(t))&&(m.unselect(t),r.app.fileDetails.open(e,v))},t.prototype.newDirectory=function(t){r.dialog.launchToast(Toast.Info,"新建文件夹“"+t+"”"),v.newDirectory(t,function(t){m.insertFolder(t),r.app.filesCtrl.resetPageData(v)},function(t){r.dialog.launchToast(Toast.Error,"新建文件夹失败: "+t.code)})},t.prototype.resetSelectAllButton=function(){e.data("clicks",!1),$(".checkbox-toggle .far.fa-check-square").removeClass("fa-check-square").addClass("fa-square")},r.FilesPanel=t}(window),function(t){"use strict";function e(){this.pages=new OrderMap,this.list=[],this.fileIndex=0}var a=null,n=null,r=new OrderMap;e.prototype.get=function(t){return this.pages.get(t)},e.prototype.append=function(t,e){if(this.contains(e))return!1;var a=this.pages.get(t);return null==a&&this.pages.put(t,a=[]),a.push(e),this.list.push(e),!0},e.prototype.size=function(t){t=this.pages.get(t);return null==t?0:t.length},e.prototype.contains=function(t){for(var e=0;e<this.list.length;++e)if(this.list[e].getId()==t.getId())return!0;return!1};function i(t){a=t,this.numPerPage=20}i.prototype.getRoot=function(e){null==n?a.fs.getSelfRoot(function(t){e(n=t)},function(t){console.log(t)}):e(n)},i.prototype.resetPageData=function(t){r.remove(t.getId())},i.prototype.sizePage=function(t,e){t=r.get(t.getId());if(null==t)return 0;e=t.get(e);return null==e?0:e.length},i.prototype.getPageData=function(n,i,o){var s=r.get(n.getId());null==s&&(s=new e,r.put(n.getId(),s));var l=s.get(i);null==l?n.listDirectories(function(t,e){if(s.list.length<e.length){for(var a=0;a<e.length&&(s.append(i,e[a]),20!=s.size(i));++a);if(null!=(l=s.get(i))&&20==l.length)return void o(l)}n.listFiles(s.fileIndex,s.fileIndex+20,function(t,e){for(var a=0;a<e.length&&(!s.append(i,e[a])||(s.fileIndex+=1,20!=s.size(i)));++a);o(s.get(i))})}):o(l)},t.FilesController=i}(window),function(t){function e(t){n=(a=t).find(".table"),s=n.find("tbody"),l=t.find(".pagination")}var a=null,n=null,s=null,l=null,i=[],o=null,r=1,c=0;e.prototype.getCurrentContact=function(t){return o[t]},e.prototype.update=function(t){if(0==t.length)return s.empty(),l.css("visibility","hidden"),void a.find(".no-record").css("display","table");a.find(".no-record").css("display","none"),l.css("visibility","visible"),(i=t).sort(function(t,e){return t.getName().localeCompare(e.getName())}),o=[];for(var e=0;e<10&&e<i.length;++e)o.push(i[e]);c=Math.ceil(i.length/10),this.paging(c),r=0,this.show(1,o)},e.prototype.showPage=function(t){if(r!=t&&!(t<1||c<t)){o=[];for(var e=10*(t-1);e<i.length&&o.length<10;++e)o.push(i[e]);this.show(t,o)}},e.prototype.paging=function(t){for(var e=['<li class="page-item"><a class="page-link" href="javascript:app.contactsCtrl.prevPage();">«</a></li>'],a=1;a<=t;++a)e.push('<li class="page-item page-'+a+'"><a class="page-link" href="javascript:app.contactsCtrl.showPage('+a+');">'+a+"</a></li>");e.push('<li class="page-item"><a class="page-link" href="javascript:app.contactsCtrl.nextPage();">»</a></li>'),l.html(e.join(""))},e.prototype.show=function(t,e){if(t!=r){0<r&&l.find(".page-"+r).removeClass("active"),l.find(".page-"+t).addClass("active"),r=t,s.empty();for(var a=0;a<e.length;++a){var n=e[a],i=n.getContext(),o=n.getAppendix(),i=['<tr data-target="',a,'">',"<td>",10*(t-1)+(a+1),"</td>",'<td><img class="table-avatar" src="images/',i.avatar,'" /></td>',"<td>",n.getName(),"</td>",'<td class="text-muted">',o.hasRemarkName()?o.getRemarkName():"","</td>","<td>",n.getId(),"</td>","<td>",i.region,"</td>","<td>",i.department,"</td>",'<td class="text-right">','<a class="btn btn-primary btn-sm" href="javascript:app.contactsCtrl.goToMessaging(',a,');"><i class="fas fa-comments"></i> 发消息</a>','<a class="btn btn-info btn-sm" href="javascript:app.contactsCtrl.editRemark(',a,');" style="margin-left:8px;"><i class="fas fa-pencil-alt"></i> 备注</a>','<a class="btn btn-danger btn-sm" href="javascript:app.contactsCtrl.remove(',a,');" style="margin-left:8px;"><i class="fas fa-user-minus"></i> 删除</a>','<a class="btn btn-secondary btn-sm" href="javascript:app.contactsCtrl.blockContact(',a,');" style="margin-left:8px;"><i class="fas fa-user-slash"></i> 黑名单</a>',"</td>","</tr>"];s.append($(i.join("")))}}},e.prototype.prevPage=function(){1!=r&&this.showPage(r-1)},e.prototype.nextPage=function(){r!=c&&this.showPage(r+1)},e.prototype.modifyRemark=function(t,e){this.modifyCell(t,3,e)},e.prototype.modifyCell=function(t,e,a){s.find('tr[data-target="'+t+'"]').find("td").eq(e).text(a)},t.ContactsTable=e}(window),function(t){function e(t){n=(a=t).find(".table"),o=n.find("tbody"),s=t.find(".pagination")}var a=null,n=null,o=null,s=null,i=[],l=null,r=1,c=0;e.prototype.getCurrentContact=function(t){return l[t]},e.prototype.update=function(t){if(0==t.length)return o.empty(),s.css("visibility","hidden"),void a.find(".no-record").css("display","table");a.find(".no-record").css("display","none"),s.css("visibility","visible"),(i=t).sort(function(t,e){return t.getName().localeCompare(e.getName())}),l=[];for(var e=0;e<10&&e<i.length;++e)l.push(i[e]);c=Math.ceil(i.length/10),this.paging(c),r=0,this.show(1,l)},e.prototype.showPage=function(t){if(r!=t&&!(t<1||c<t)){l=[];for(var e=10*(t-1);e<i.length&&l.length<10;++e)l.push(i[e]);this.show(t,l)}},e.prototype.paging=function(t){for(var e=['<li class="page-item"><a class="page-link" href="javascript:app.contactsCtrl.prevPage();">«</a></li>'],a=1;a<=t;++a)e.push('<li class="page-item page-'+a+'"><a class="page-link" href="javascript:app.contactsCtrl.showPage('+a+');">'+a+"</a></li>");e.push('<li class="page-item"><a class="page-link" href="javascript:app.contactsCtrl.nextPage();">»</a></li>'),s.html(e.join(""))},e.prototype.show=function(t,e){if(t!=r){0<r&&s.find(".page-"+r).removeClass("active"),s.find(".page-"+t).addClass("active"),r=t,o.empty();for(var a=0;a<e.length;++a){var n=e[a],i=n.getAppendix();n.tableSN=a,n.listMembers(function(t,e){var a=4,n=8,i=['<ul class="list-inline">'];t.some(function(t){var e=t.getContext(),e=(e=null==e?(t=app.queryContact(t.getId())).getContext():e).avatar;if(i.push('<li class="list-inline-item">'),i.push('<img title="'+t.getPriorityName()+'" class="table-avatar" src="images/'+e+'" />'),i.push("</li>"),--a,0==--n)return!0;0==a&&(i.push('</ul><ul class="list-inline">'),a=4)}),i.push("</ul>"),o.find('tr[data-target="'+e.tableSN+'"]').find(".members").html(i.join(""))});i=['<tr data-target="',a,'">',"<td>",10*(t-1)+(a+1),"</td>",'<td><img class="table-avatar" src="',"images/group-avatar.png",'" /></td>','<td><a href="javascript:app.contactsCtrl.showGroup(',a,');">',n.getName(),"</a></td>",'<td class="text-muted">',i.hasRemark()?i.getRemark():"","</td>","<td>",n.getId(),"</td>","<td>",i.getNotice(),"</td>",'<td class="members">',"</td>",'<td class="text-right">','<a class="btn btn-primary btn-sm" href="javascript:app.contactsCtrl.goToMessaging(',a,');"><i class="fas fa-comments"></i> 发消息</a>','<a class="btn btn-info btn-sm" href="javascript:app.contactsCtrl.editRemark(',a,');" style="margin-left:8px;"><i class="fas fa-pencil-alt"></i> 备注</a>',"</td>","</tr>"];o.append($(i.join("")))}}},e.prototype.prevPage=function(){1!=r&&this.showPage(r-1)},e.prototype.nextPage=function(){r!=c&&this.showPage(r+1)},e.prototype.modifyRemark=function(t,e){this.modifyCell(t,3,e)},e.prototype.modifyCell=function(t,e,a){o.find('tr[data-target="'+t+'"]').find("td").eq(e).text(a)},t.GroupsTable=e}(window),function(t){function e(t){n=(a=t).find(".table"),i=n.find("tbody"),o=t.find(".pagination")}var a=null,n=null,i=null,o=null,s=[],l=null,r=1,c=0;e.prototype.getCurrentContact=function(t){return l[t]},e.prototype.update=function(t){if(0==t.length)return i.empty(),o.css("visibility","hidden"),void a.find(".no-record").css("display","table");a.find(".no-record").css("display","none"),o.css("visibility","visible"),(s=t).sort(function(t,e){return t.getName().localeCompare(e.getName())}),l=[];for(var e=0;e<10&&e<s.length;++e)l.push(s[e]);c=Math.ceil(s.length/10),this.paging(c),r=0,this.show(1,l)},e.prototype.showPage=function(t){if(r!=t&&!(t<1||c<t)){l=[];for(var e=10*(t-1);e<s.length&&l.length<10;++e)l.push(s[e]);this.show(t,l)}},e.prototype.paging=function(t){for(var e=['<li class="page-item"><a class="page-link" href="javascript:app.contactsCtrl.prevPage();">«</a></li>'],a=1;a<=t;++a)e.push('<li class="page-item page-'+a+'"><a class="page-link" href="javascript:app.contactsCtrl.showPage('+a+');">'+a+"</a></li>");e.push('<li class="page-item"><a class="page-link" href="javascript:app.contactsCtrl.nextPage();">»</a></li>'),o.html(e.join(""))},e.prototype.show=function(t,e){if(t!=r){0<r&&o.find(".page-"+r).removeClass("active"),o.find(".page-"+t).addClass("active"),r=t,i.empty();for(var a=0;a<e.length;++a){var n=e[a],n=['<tr data-target="',a,'">',"<td>",10*(t-1)+(a+1),"</td>",'<td><img class="table-avatar" src="',n instanceof Group?"images/group-avatar.png":"images/"+n.getContext().avatar,'" /></td>',"<td>",n.getName(),"</td>",'<td class="text-muted">',n.getId(),"</td>","<td>",n.postscript,"</td>",'<td class="text-right">','<a class="btn btn-primary btn-sm" href="javascript:app.contactsCtrl.acceptPendingContact(',a,');"><i class="fas fa-user-check"></i> 添加联系人</a>',"</td>","</tr>"];i.append($(n.join("")))}}},e.prototype.prevPage=function(){1!=r&&this.showPage(r-1)},e.prototype.nextPage=function(){r!=c&&this.showPage(r+1)},e.prototype.modifyRemark=function(t,e){this.modifyCell(t,3,e)},e.prototype.modifyCell=function(t,e,a){i.find('tr[data-target="'+t+'"]').find("td").eq(e).text(a)},t.PendingTable=e}(window),function(s){function t(t){l=this,e=(o=t).find(".table"),r=e.find("tbody"),c=t.find(".pagination")}var l,o,e=null,r=null,c=null,d=null,p=1,u=0,g=null,f=null;t.prototype.getCurrentContact=function(t){return d[t]},t.prototype.update=function(t){if(0==t.length)return r.empty(),c.css("visibility","hidden"),void o.find(".no-record").css("display","table");o.find(".no-record").css("display","none"),c.css("visibility","visible"),(g=t).reverse(),f=[];for(var e=0;e<g.length;++e)f.push(null);for(var a=0,n=Math.min(g.length,10),e=0;e<g.length&&e<10;++e){var i=g[e];s.app.getContact(i,function(t){++a;var e=g.indexOf(t.getId());f[e]=t,a==n&&l.handleUpdate()})}},t.prototype.handleUpdate=function(){d=[];for(var t=0;t<10&&t<f.length;++t)d.push(f[t]);u=Math.ceil(g.length/10),this.paging(u),p=0,this.show(1,d)},t.prototype.showPage=function(t){if(p!=t&&!(t<1||u<t)){for(var e=[],a=10*(t-1);a<g.length&&e.length<10;++a)e.push(a);function n(){e.length==d.length&&l.show(t,d)}d=[];for(a=0;a<e.length;++a){var i=e[a],o=f[i];null==o?(i=g[i],s.app.getContact(i,function(t){d.push(t),n()})):d.push(o),n()}}},t.prototype.paging=function(t){for(var e=['<li class="page-item"><a class="page-link" href="javascript:app.contactsCtrl.prevPage();">«</a></li>'],a=1;a<=t;++a)e.push('<li class="page-item page-'+a+'"><a class="page-link" href="javascript:app.contactsCtrl.showPage('+a+');">'+a+"</a></li>");e.push('<li class="page-item"><a class="page-link" href="javascript:app.contactsCtrl.nextPage();">»</a></li>'),c.html(e.join(""))},t.prototype.show=function(t,e){if(t!=p){0<p&&c.find(".page-"+p).removeClass("active"),c.find(".page-"+t).addClass("active"),p=t,r.empty();for(var a=0;a<e.length;++a){var n=e[a],n=['<tr data-target="',a,'">',"<td>",10*(t-1)+(a+1),"</td>",'<td><img class="table-avatar" src="',"images/"+n.getContext().avatar,'" /></td>',"<td>",n.getName(),"</td>","<td>",n.getId(),"</td>",'<td class="text-right">','<a class="btn btn-danger btn-sm" href="javascript:app.contactsCtrl.unblockContact(',a,');"><i class="fas fa-user-times"></i> 解除阻止</a>',"</td>","</tr>"];r.append($(n.join("")))}}},t.prototype.prevPage=function(){1!=p&&this.showPage(p-1)},t.prototype.nextPage=function(){p!=u&&this.showPage(p+1)},s.BlockListTable=t}(window),function(o){"use strict";var s=null,l=null,n=[],i=[],e=[],r=null,c=null,a=null,d=null,p=null,u=0,g=0,f=0;function m(t){p="contacts-tabs-default-tab"==t.target.id?r:"contacts-tabs-groups-tab"==t.target.id?c:"contacts-tabs-pending-tab"==t.target.id?a:d}function t(t){s=this,l=t,$("#contacts-tabs-tab").on("show.bs.tab",m),r=new ContactsTable($('div[data-target="contacts-table"]')),c=new GroupsTable($('div[data-target="groups-table"]')),a=new PendingTable($('div[data-target="pending-table"]')),d=new BlockListTable($('div[data-target="block-table"]')),$(".contacts-card").find('a[data-target="add-contact"]').on("click",function(){o.app.searchDialog.show()}),$(".contacts-card").find('a[data-target="new-group"]').on("click",function(){o.app.newGroupDialog.show()}),$(".contacts-card").find('button[data-target="refresh"]').on("click",function(){s.update()}),p=r}t.prototype.ready=function(i){e=[],l.contact.getPendingZone(o.app.contactZone,function(a){var n=a.contacts.length;a.contacts.forEach(function(t){app.getContact(t,function(t){var e=a.getPostscript(t.getId());t.postscript=e,s.addPending(t),0==--n&&i&&i()})}),0==n&&i&&i()},function(t){console.log(t)}),l.contact.queryBlockList(function(t){d.update(t)})},t.prototype.getContacts=function(){return n},t.prototype.addContact=function(t){n.push(t),0<u&&clearTimeout(u),u=setTimeout(function(){clearTimeout(u),u=0,r.update(n)},1e3)},t.prototype.removeContact=function(t){for(var e=!1,a=0;a<n.length;++a)if(n[a].getId()==t.getId()){n.splice(a,1),e=!0;break}e&&r.update(n)},t.prototype.updateGroup=function(t){var e=function(t){for(var e=0;e<i.length;++e)if(i[e].getId()==t.getId())return e;return-1}(t);0<=e&&i.splice(e,1),i.push(t),0<g&&clearTimeout(g),g=setTimeout(function(){clearTimeout(g),g=0,c.update(i)},1e3)},t.prototype.removeGroup=function(t){for(var e=!1,a=0;a<i.length;++a)if(i[a].getId()==t.getId()){i.splice(a,1),e=!0;break}e&&c.update(i)},t.prototype.addPending=function(t){e.push(t),0<f&&clearTimeout(f),f=setTimeout(function(){clearTimeout(f),f=0,a.update(e)},1e3)},t.prototype.showGroup=function(t){t=p.getCurrentContact(t);void 0!==t&&o.app.groupDetails.show(t)},t.prototype.goToMessaging=function(t){var e=p.getCurrentContact(t);void 0!==e&&(app.messageCatalog.appendItem(e,!0),app.toggle("messaging"),setTimeout(function(){e instanceof Group?app.messagingCtrl.updateGroupMessages(e,function(){app.messagingCtrl.toggle(e.getId())}):app.messagingCtrl.updateContactMessages(e,function(){app.messagingCtrl.toggle(e.getId())})},100))},t.prototype.editRemark=function(n){var i;p!=r||void 0!==(i=r.getCurrentContact(n))&&o.dialog.showPrompt("备注联系人","请填写联系人“"+i.getName()+"”的备注：",function(t,e){if(t){var a=e.trim();if(0==a.length)return o.dialog.launchToast(o.Toast.Warning,"请正确填写联系人备注"),!1;i.getAppendix().updateRemarkName(a,function(){r.modifyRemark(n,a)})}})},t.prototype.remove=function(t){var a=r.getCurrentContact(t);o.dialog.showConfirm("删除联系人","您确认要从“我的联系人”里删除“<b>"+a.getPriorityName()+"</b>”？",function(t){t&&l.contact.removeContactFromZone(o.app.contactZone,a.getId(),function(t,e){s.removeContact(a),o.app.messagingCtrl.removeContact(a)})})},t.prototype.blockContact=function(t){var a=r.getCurrentContact(t);o.dialog.showConfirm("阻止联系人","您确认要将“<b>"+a.getPriorityName()+"</b>”加入“黑名单”吗？",function(t){t&&l.contact.addBlockList(a.getId(),function(t,e){s.removeContact(a),d.update(e)})})},t.prototype.acceptPendingContact=function(t){var e=p.getCurrentContact(t);o.dialog.showConfirm("添加联系人","您确认要添加联系人“<b>"+e.getName()+"</b>”吗？",function(t){t&&l.contact.addContactToZone(o.app.contactZone,e.getId(),null,function(){n.push(e),s.ready(function(){s.update()})})})},t.prototype.addContactToZone=function(t,e,a,n){l.contact.addContactToZone(t,e,a,function(t,e){o.app.getContact(e,function(t){s.addContact(t),n&&n(t)})},function(t){console.log(t),n&&n(null)})},t.prototype.unblockContact=function(t){var e=d.getCurrentContact(t);o.dialog.showConfirm("解除阻止","您确认要将“<b>"+e.getPriorityName()+"</b>”移出“黑名单”并添加为“我的联系人”吗？",function(t){t&&l.contact.removeBlockList(e,function(t,e){d.update(e),s.addContactToZone(o.app.contactZone,t,"")})})},t.prototype.showPage=function(t){p.showPage(t)},t.prototype.prevPage=function(){p.prevPage()},t.prototype.nextPage=function(){p.nextPage()},t.prototype.update=function(){r.update(n),c.update(i),a.update(e)},t.prototype.removeGroupMember=function(t,a,i){l.contact.getGroup(t,function(e){o.app.getContact(a,function(t){var n=t.getName();o.dialog.showConfirm("移除群成员","您确定要把“"+n+"”移除群组吗？",function(t){t&&e.removeMembers([a],function(t,e,a){o.dialog.launchToast(Toast.Success,"已移除成员“"+n+"”"),i&&i(t,e,a),o.app.groupDetails.refresh()},function(t){o.dialog.launchToast(Toast.Warning,"移除群成员失败: "+t.code)})})})})},o.ContactsController=t}(window),function(p){"use strict";function t(t){this.container=t,this.timelineEl=t.find(".timeline")}t.prototype.update=function(t){if(this.timelineEl.empty(),0<t.length){this.container.find(".no-conference").css("display","none");for(var e=Date.now(),a=0;a<t.length;++a){var n=t[a],i=new Date(n.scheduleTime),o=new Date(n.expireTime),s=null,l=[];e>=n.scheduleTime&&e<=n.expireTime?(s="bg-red",l.push('<button class="btn btn-success btn-sm" onclick="javascript:;">进入会议</button>'),n.getFounder().getId()==app.getSelf().getId()&&l.push('<button class="btn btn-danger btn-sm">结束会议</button>')):e>n.expireTime?(s="bg-green",l.push('<button class="btn btn-default btn-sm" onclick="javascript:;">查看会议记录</button>')):(s="bg-blue",l.push('<button class="btn btn-success btn-sm" onclick="javascript:;">进入会议</button>'),n.getFounder().getId()==app.getSelf().getId()&&l.push('<button class="btn btn-danger btn-sm" onclick="javascript:;">取消会议</button>'));var r=n.hasPassword()?'<i class="fas fa-lock" title="会议已设置密码"></i>':'<i class="fas fa-unlock" title="会议无密码"></i>',c=n.getInvitees();c.unshift(n.getFounder());var d=[];c.forEach(function(t,e){var a=app.queryContact(t.id),n=null,n=0==e?['<span class="badge badge-info"><i class="fas fa-user-cog"></i></span>']:0<t.acceptionTime?t.accepted?['<span class="badge badge-success"><i class="fas fa-check-circle"></i></span>']:['<span class="badge badge-danger"><i class="fas fa-ban"></i></span>']:['<span class="badge badge-info"><i class="fas fa-question-circle"></i></span>'],e=null,e=null!=a?['<div class="participant" data="',a.getId(),'">','<div class="avatar"><img src="images/',a.getContext().avatar,'"></div>','<div class="name"><div>',a.getName(),"</div></div>",n.join(""),"</div>"]:['<div class="participant" data="',t.id,'">','<div class="avatar"><img src="',"images/favicon.png",'"></div>','<div class="name"><div>',t.displayName,"</div></div>",n.join(""),"</div>"];d.push(e.join(""))});l=['<div class="time-label">','<span class="bg-blue">',i.getMonth()+1,"月",i.getDate(),"日</span>","</div>","<div>",'<i class="fas fa-users ',s,'"></i>','<div class="timeline-item">','<span class="time">',r,'&nbsp;&nbsp;<i class="fas fa-clock"></i> ',p.formatNumber(i.getHours()),":",p.formatNumber(i.getMinutes())," - ",p.formatNumber(o.getHours()),":",p.formatNumber(o.getMinutes()),"</span>",'<h3 class="timeline-header">',n.subject,"</h3>",'<div class="timeline-body">',"<p>",0==n.summary.length?'<i class="text-muted" style="font-size:12px;">无会议描述信息</i>':n.summary,"</p>",'<div class="invitees">',d.join(""),"</div>","</div>",'<div class="timeline-footer">',l.join(""),"</div>","</div>","</div>"];this.timelineEl.append($(l.join("")))}this.timelineEl.append($('<div><i class="fas fa-clock bg-gray"></i></div>'))}else this.container.find(".no-conference").css("display","table")},p.ConferenceTimeline=t}(window),function(l){"use strict";var r=null,c=null,d=null,p=null,u=null,g=null;function t(t){var e=g;e.find('input[name="conf-subject"]').val(""),e.find('input[name="conf-pwd"]').val(""),e.find('textarea[name="conf-summary"]').val("");var a=new Date,n=(n=a.getMinutes())<=15?15:15<n&&n<=30?30:30<n&&n<=45?45:0;a.setMinutes(n),0==n&&a.setHours(a.getHours()+1);var n=a.getMinutes()+30;60<=n?(a.setHours(a.getHours()+1),a.setMinutes(0)):a.setMinutes(n),e.find('input[name="conf-schedule"]').val(l.datetimePickerToString(a)),e.find("div.participant").each(function(){$(this).remove()}),e.find(".overlay").css("visibility","hidden"),e.modal("show")}function e(t){l.app.selectContactsDialog.show(function(t){var a=g.find("#conf-participant");t.forEach(function(t,e){t=['<div class="participant" data="',t.getId(),'">','<div class="avatar">','<img src="images/',t.getContext().avatar,'" />',"</div>",'<div class="name">',"<div>",t.getPriorityName(),"</div>","</div>",'<a href="javascript:app.confCtrl.removeParticipantInNewDialog(',t.getId(),');"><span class="badge badge-danger">&times;</span></a>',"</div>"];a.append($(t.join("")))})},f())}function f(){var e=[];return g.find("div.participant").each(function(){var t=$(this).attr("data");e.push(parseInt(t))}),e}function a(){var t,e,a,n,i,o=g.find('input[name="conf-subject"]'),s=o.val().trim();s.length<3?l.validate(o,"请填写会议主题，会议主题不能少于3个字符。"):(t=(o=g.find('input[name="conf-pwd"]')).val().trim(),e=(o=g.find('textarea[name="conf-summary"]')).val().trim(),(n=(o=g.find('input[name="conf-schedule"]')).val().trim()).length<=10?l.validate(o):(a=l.datetimePickerToDate(n).getTime(),o=(o=g.find('select[name="conf-duration"]')).find(":selected"),n=a+60*parseInt(o.attr("data"))*60*1e3,o=f(),i=[],o.forEach(function(t){t=app.queryContact(t);i.push(new Invitation(t.getId(),t.getName(),t.getPriorityName()))}),g.find(".overlay").css("visibility","visible"),r.cs.createConference(s,t,e,a,n,i,function(t){g.modal("hide"),l.dialog.showAlert("会议“<b>"+t.subject+"</b>”已创建，计划开始时间是<b>"+l.formatFullTime(t.scheduleTime)+"</b>。"),setTimeout(function(){app.confCtrl.ready()},1e3)},function(t){g.modal("hide"),l.dialog.showAlert("创建会议失败，请稍后再试！错误码："+t.code)})))}function n(t){r=t,this.init()}n.prototype.init=function(){c=new ConferenceTimeline($("#conf-timeline-all")),d=new ConferenceTimeline($("#conf-timeline-active")),p=new ConferenceTimeline($("#conf-timeline-scheme")),u=new ConferenceTimeline($("#conf-timeline-closed")),$('button[data-toggle="new-conference"]').on("click",t),(g=$("#new_conference_dialog")).find("#datetimepicker-schedule").datetimepicker({locale:"zh-cn",stepping:5}),g.find("#conf-participant button").on("click",e),g.find('button[data-target="confirm"]').on("click",a)},n.prototype.ready=function(){var s=Date.now();r.cs.listConferences(s-2592e6,s,function(t,e,a){c.update(t);var n=[],i=[],o=[];t.forEach(function(t){s<t.scheduleTime?i.push(t):s>=t.scheduleTime&&s<=t.expireTime?n.push(t):s>t.expireTime&&o.push(t)}),d.update(n),p.update(i),u.update(o)},function(t){console.log(t)})},n.prototype.removeParticipantInNewDialog=function(t){g.find("#conf-participant").find('div[data="'+t+'"]').remove()},n.prototype.fireNewConference=function(){t()},l.ConferenceController=n}(window),function(t){var a=null,c=null,d=null,p=!1;function e(){var a;d&&(a=[],p&&c.find(".selected-table").find('input[type="checkbox"]').each(function(t,e){a.push(app.queryContact(parseInt(e.getAttribute("data"))))}),d(a)),c.find(".selected-table").empty()}function u(){var t=$(this),e=app.queryContact(parseInt(t.attr("data")));t[0].checked?a.append(e):a.remove(e)}function n(){var t=$(this),e=app.queryContact(parseInt(t.attr("data")));t[0].checked||a.remove(e)}function i(){p=!0,c.modal("hide")}function o(t){a=this,(c=$("#select_contacts_dialog")).on("hidden.bs.modal",e),c.find('button[data-target="confirm"]').on("click",i)}o.prototype.show=function(t,e){d=t,p=!1;var a=c.find("#select-contact-tabs-default div");a.empty();for(var n=app.getMyContacts(),i=0;i<n.length;++i){var o=n[i],s=o.getId(),l=o.getContext().avatar,r=o.getPriorityName(),o=0<=e.indexOf(s);a.append($(['<div class="form-group"><div class="custom-control custom-checkbox select-group-member">','<input class="custom-control-input" type="checkbox" id="contact_',i,'" data="',s,'" ',o?'disabled="disabled"':""," />",'<label class="custom-control-label" for="contact_',i,'">','<img src="images/',l,'" />',"<span>",r,"</span>","</label>","</div></div>"].join("")))}c.modal("show"),a.find('input[type="checkbox"]').change(u)},o.prototype.append=function(t){var e=t.getId(),t=['<tr id="selected_tr_',e,'">','<td class="text-center pl-3" width="40">','<div class="custom-control custom-checkbox">','<input class="custom-control-input" type="checkbox" id="selected_',e,'" data="',e,'" checked="">','<label for="selected_',e,'" class="custom-control-label">&nbsp;</label>',"</div>","</td>",'<td width="50">','<img src="images/',t.getContext().avatar,'" class="avatar" />',"</td>","<td>",t.getPriorityName(),"</td>","</tr>"],t=$(t.join(""));c.find(".selected-table").append(t),t.find('input[type="checkbox"]').change(n)},o.prototype.remove=function(t){c.find(".selected-table").find("#selected_tr_"+t.getId()).remove()},t.SelectContactsDialog=o}(window),function(o){"use strict";function t(){var t=this;this.el=$("#search_dialog"),this.overlay=this.el.find(".item-overlay"),this.input=this.el.find('input[data-target="search-input"]'),this.input.on("input",function(){t.onInputChanged()}),this.resultEl=this.el.find('div[data-target="search-result"]'),this.submitTimer=0}t.prototype.show=function(){this.overlay.css("display","none"),this.input.val(""),this.resultEl.empty(),this.el.modal("show")},t.prototype.onInputChanged=function(){var t=this,e=t.input.val().trim();if(0==e.length)return 0<t.submitTimer&&(clearTimeout(t.submitTimer),t.submitTimer=0),t.overlay.css("display","none"),void t.resultEl.empty();0<t.submitTimer&&clearTimeout(t.submitTimer),t.submitTimer=setTimeout(function(){clearTimeout(t.submitTimer),t.submitTimer=0,t.overlay.css("display","flex"),t.resultEl.empty(),0==(e=t.input.val().trim()).length?t.overlay.css("display","none"):t.search(e),console.log('Search keyword: "'+e+'"')},1e3)},t.prototype.search=function(t){var e=this;o.cube().contact.search(t,function(t){0==t.contactList.length&&0==t.groupList.length?e.resultEl.html('<div class="no-result">没有找到匹配的结果</div>'):(t.contactList.forEach(function(t){e.appendContact(t)}),e.resultEl.append($("<hr/>")),t.groupList.forEach(function(t){e.appendGroup(t)})),e.overlay.css("display","none")},function(){e.overlay.css("display","none"),e.resultEl.html('<div class="no-result">发生错误，请稍候再试</div>')})},t.prototype.appendContact=function(t){var e=t.getContext().avatar,e=['<div class="row align-items-center" data="',t.getId(),'">','<div class="col-2"><img src="images/',e,'" class="avatar"></div>','<div class="col-7">','<span><a href="javascript:app.contactDetails.show(',t.getId(),');">',t.getName(),"</a></span>",'&nbsp;<span class="text-muted">(',t.getId(),")</span>","</div>",'<div class="col-3" data-target="action">',"</div>","</div>"],i=$(e.join(""));this.resultEl.append(i),o.cube().contact.containsContactInZone(o.app.contactZone,t,function(t,e,a){var n=null,n=t?'<span class="text-muted">已添加</span>':'<button class="btn btn-sm btn-default" onclick="app.searchDialog.fireAddContactToZone(\''+e+"', "+a+')">添加联系人</button>';i.find('div[data-target="action"]').html(n)})},t.prototype.appendGroup=function(t){var e=['<div class="row align-items-center" data="',t.getId(),'">','<div class="col-2"><img src="images/',"group-avatar.png",'" class="avatar"></div>','<div class="col-7">','<span><a href="javascript:;">',t.getName(),"</a></span>",'&nbsp;<span class="text-muted">(',t.getId(),")</span>","</div>",'<div class="col-3" data-target="action">',"</div>","</div>"],e=$(e.join(""));this.resultEl.append(e),o.cube().contact.getGroup(t.getId(),function(t){})},t.prototype.fireAddContactToZone=function(a,n){var i=this;o.dialog.showPrompt("添加联系人","附言",function(t,e){t&&o.app.contactsCtrl.addContactToZone(a,n,e,function(t){null!=t&&i.resultEl.find('div[data="'+n+'"]').find('div[data-target="action"]').html('<span class="text-muted">已添加</span>')})},"我是“"+o.app.account.name+"”。")},o.SearchDialog=t}(window),function(n){var e=null,i=null,a=null;function o(t){a.appendLog(t.name,t.data.getName())}function s(t){a.appendLog(t.name,t.data.field.getName())}function l(t){a.appendLog(t.name,t.data.field.getName())}function r(t){a.appendLog(t.name,t.data.field.getName())}function c(t){a.appendLog(t.name,t.data.field.getName())}function d(t){a.appendLog(t.name,t.data.field.getName())}function t(){a=this,i=$("aside.control-sidebar").find("#app-details-log")}t.prototype.start=function(t){(e=t).on("network",function(t){"failed"==t.name?n.dialog.launchToast(Toast.Error,"网络错误："+t.error.code,!0):"connected"==t.name&&(n.dialog.launchToast(Toast.Info,"已连接到服务器",!0),a.appendLog("Network","Ready"))}),e.contact.on(ContactEvent.SignIn,function(t){a.appendLog(t.name,t.data.id)}),e.contact.on(ContactEvent.SignOut,function(t){a.appendLog(t.name,t.data.id)}),e.contact.on(ContactEvent.Comeback,function(t){a.appendLog(t.name,t.data.id)}),e.contact.on(ContactEvent.GroupUpdated,function(t){a.appendLog(t.name,t.data.name),a.onGroupUpdated(t.data)}),e.contact.on(ContactEvent.GroupCreated,function(t){a.appendLog(t.name,t.data.name),a.onGroupCreated(t.data)}),e.contact.on(ContactEvent.GroupDissolved,function(t){a.appendLog(t.name,t.data.name),a.onGroupDissolved(t.data)}),e.contact.on(ContactEvent.GroupMemberAdded,function(t){a.appendLog(t.name,t.data.group.getName()),a.onGroupMemberAdded(t.data.group)}),e.contact.on(ContactEvent.GroupMemberRemoved,function(t){a.appendLog(t.name,t.data.group.getName()),a.onGroupMemberRemoved(t.data.group)}),e.messaging.on(MessagingEvent.Notify,function(t){var e=[t.data.getType()," - ",t.data.getSender().getName()," -> ",(t.data.isFromGroup()?t.data.getSourceGroup():t.data.getReceiver()).getName()];a.appendLog(t.name,e.join(""))}),e.messaging.on(MessagingEvent.Sent,function(t){var e=[t.data.getType()," - ",t.data.getSender().getName()," -> ",(t.data.isFromGroup()?t.data.getSourceGroup():t.data.getReceiver()).getName()];a.appendLog(t.name,e.join(""))}),e.messaging.on(MessagingEvent.Recall,function(t){console.log(t.data)}),e.messaging.on(MessagingEvent.SendBlocked,function(t){var e=[t.data.getType()," - ",t.data.getSender().getName()," -> ",(t.data.isFromGroup()?t.data.getSourceGroup():t.data.getReceiver()).getName()];a.appendLog(t.name,e.join(""))}),e.messaging.on(MessagingEvent.ReceiveBlocked,function(t){var e=[t.data.getType()," - ",t.data.getSender().getName()," -> ",(t.data.isFromGroup()?t.data.getSourceGroup():t.data.getReceiver()).getName()];a.appendLog(t.name,e.join(""))}),e.mpComm.on(CommEvent.InProgress,o),e.mpComm.on(CommEvent.Ringing,s),e.mpComm.on(CommEvent.Connected,l),e.mpComm.on(CommEvent.Bye,r),e.mpComm.on(CommEvent.Timeout,c),e.mpComm.on(CommEvent.NewCall,d)},t.prototype.appendLog=function(t,e){var a=new Date,e=['<div class="row align-items-center">','<div class="col-3">',n.formatNumber(a.getHours()),":",n.formatNumber(a.getMinutes()),":",n.formatNumber(a.getSeconds()),"</div>",'<div class="col-4"><b>',t,"</b></div>",'<div class="col-5">',e,"</div>","</div>"];i.append($(e.join("")))},t.prototype.onGroupUpdated=function(t){n.app.messagingCtrl.updateGroup(t),n.app.contactsCtrl.updateGroup(t)},t.prototype.onGroupCreated=function(t){n.app.contactsCtrl.updateGroup(t),n.dialog.launchToast(Toast.Info,t.isOwner()?"群组“"+t.getName()+"”已创建。":"“"+t.getOwner().getName()+"”邀请你加入群组“"+t.getName()+"” 。",!0)},t.prototype.onGroupDissolved=function(t){n.app.contactsCtrl.removeGroup(t),n.app.messagePanel.updatePanel(t.getId(),t),n.dialog.launchToast(Toast.Info,"群组 “"+t.getName()+"” 已解散。",!0)},t.prototype.onGroupMemberAdded=function(t){n.app.messagePanel.updatePanel(t.getId(),t)},t.prototype.onGroupMemberRemoved=function(t){n.app.messagePanel.updatePanel(t.getId(),t)},n.AppEventCenter=t}(window);
//# sourceMappingURL=components-min.js.map